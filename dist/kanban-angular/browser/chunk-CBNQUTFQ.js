import{a as Ii,c as Pi,d as Mi,f as Pt,g as Di}from"./chunk-BSBJOD5X.js";import{a as ki}from"./chunk-PI2U3DDZ.js";import"./chunk-WXHR6PAO.js";import{a as Fi}from"./chunk-LJSXBI7Y.js";import{B as se,C as ot,G as te,H as le,I as H,c as Si,e as Ei,g as Ie,h as Q,i as A,k as Z,l as Y,r as nt,s as J,t as Pe,u as Ti,w as X,x as ee,y as he,z as ae}from"./chunk-PU43IP5U.js";import{c as de}from"./chunk-HPS6D6FL.js";import{D as fe,E as V}from"./chunk-WN35IHPO.js";import{$ as Ye,$a as St,$b as y,Aa as xe,Ab as c,Ac as vi,Bb as r,Ca as ni,Cb as a,Db as g,Ea as oi,F as Jt,G as Qe,Gc as R,H as Xt,Hb as li,Hc as j,I as Ct,Ib as di,Ic as xi,Jc as yi,Kb as C,Mb as h,Mc as Ci,N as ei,Nc as O,Ob as u,Ra as Je,Rb as U,Rc as wi,Sa as Xe,Sb as q,Tb as G,U as Ze,Ua as l,Ub as ci,V as wt,Vb as $,W as we,Wb as P,X as ti,Xb as mi,Ya as Ee,Yb as re,Zb as d,_ as k,_a as ri,_b as E,a as F,ac as ui,b as oe,ba as ce,bc as pi,cb as T,cc as me,da as x,db as et,dc as ue,eb as Ae,ec as pe,f as S,fc as gi,g as be,gc as hi,ha as ii,hb as b,hc as Le,i as ke,ic as W,ja as f,ka as _,kb as I,kc as fi,l as D,lb as ye,lc as _i,m as Qt,mb as Et,na as Fe,oa as ve,p as yt,rb as It,sb as tt,ta as Se,v as Zt,vb as ai,wb as si,wc as it,ya as Oe,yc as ge,z as Yt,zc as bi}from"./chunk-WVXLNUB3.js";var rt=class o{firestoreService=x(V);smtpService=x(ki);subdomainService=x(de);processNewLeadAutomations(t,e,i){return S(this,null,function*(){console.log("\u{1F916} Processando automa\xE7\xF5es para novo lead:",t.id);try{let s=(yield this.firestoreService.getAutomations(i,e)).filter(m=>m.active&&m.triggerType==="new-lead-created");console.log(`\u{1F4CB} Encontradas ${s.length} automa\xE7\xF5es para novo lead`);for(let m of s)yield this.executeAutomation(m,t,e,i)}catch(n){console.error("\u274C Erro ao processar automa\xE7\xF5es de novo lead:",n)}})}processPhaseChangeAutomations(t,e,i,n,s){return S(this,null,function*(){console.log("\u{1F916} Processando automa\xE7\xF5es para mudan\xE7a de fase:",{leadId:t.id,oldColumnId:i,newColumnId:e});try{let p=(yield this.firestoreService.getAutomations(s,n)).filter(v=>v.active&&v.triggerType==="card-enters-phase"&&v.triggerPhase===e);console.log(`\u{1F4CB} Encontradas ${p.length} automa\xE7\xF5es para entrada na fase`);for(let v of p)yield this.executeAutomation(v,t,n,s)}catch(m){console.error("\u274C Erro ao processar automa\xE7\xF5es de mudan\xE7a de fase:",m)}})}executeAutomation(t,e,i,n){return S(this,null,function*(){console.log(`\u{1F680} Executando automa\xE7\xE3o: ${t.name}`,t);try{for(let s of t.actions)yield this.executeAction(s,e,i,n,t);yield this.addAutomationHistory(t,e,i,n,"success"),console.log(`\u2705 Automa\xE7\xE3o executada com sucesso: ${t.name}`)}catch(s){console.error(`\u274C Erro ao executar automa\xE7\xE3o ${t.name}:`,s),yield this.addAutomationHistory(t,e,i,n,"error",s.message)}})}executeAction(t,e,i,n,s){return S(this,null,function*(){switch(console.log(`\u{1F3AF} Executando a\xE7\xE3o: ${t.type}`,t),t.type){case"send-email":yield this.executeSendEmailAction(t,e,i,n);break;case"move-to-phase":yield this.executeMoveToPhaseAction(t,e,i,n);break;case"assign-user":yield this.executeAssignUserAction(t,e,i,n);break;case"add-note":yield this.executeAddNoteAction(t,e,i,n);break;default:console.warn(`\u26A0\uFE0F Tipo de a\xE7\xE3o n\xE3o reconhecido: ${t.type}`)}})}executeSendEmailAction(t,e,i,n){return S(this,null,function*(){if(!t.templateId)throw new Error("Template de email n\xE3o especificado");console.log("\u{1F4E7} Executando a\xE7\xE3o de envio de email:",{templateId:t.templateId,leadEmail:e.fields.contactEmail});let m=(yield this.firestoreService.getEmailTemplates(n,i)).find(M=>M.id===t.templateId);if(!m)throw new Error(`Template de email n\xE3o encontrado: ${t.templateId}`);if(!e.fields.contactEmail){console.warn("\u26A0\uFE0F Lead n\xE3o possui email para envio:",e.id);return}let p=this.processEmailTemplate(m.content,e),v=this.processEmailTemplate(m.subject||m.name,e),w={to:e.fields.contactEmail,subject:v,html:p};return new Promise((M,N)=>{this.smtpService.sendEmail(w).subscribe({next:z=>{console.log("\u2705 Email enviado com sucesso:",z),M()},error:z=>{console.error("\u274C Erro ao enviar email:",z),N(z)}})})})}executeMoveToPhaseAction(t,e,i,n){return S(this,null,function*(){if(!t.phaseId)throw new Error("Fase de destino n\xE3o especificada");console.log("\u27A1\uFE0F Executando a\xE7\xE3o de mover para fase:",{leadId:e.id,phaseId:t.phaseId}),yield this.firestoreService.updateLead(n,i,e.id,{columnId:t.phaseId,movedToCurrentColumnAt:new Date})})}executeAssignUserAction(t,e,i,n){return S(this,null,function*(){if(!t.userId)throw new Error("Usu\xE1rio n\xE3o especificado");console.log("\u{1F464} Executando a\xE7\xE3o de atribuir usu\xE1rio:",{leadId:e.id,userId:t.userId}),yield this.firestoreService.updateLead(n,i,e.id,{responsibleUserId:t.userId,responsibleUserName:"",responsibleUserEmail:""})})}executeAddNoteAction(t,e,i,n){return S(this,null,function*(){if(!t.note)throw new Error("Nota n\xE3o especificada");console.log("\u{1F4DD} Executando a\xE7\xE3o de adicionar nota:",{leadId:e.id,note:t.note});let s=this.processEmailTemplate(t.note,e),p=(e.fields.notes||"")+`

[AUTOMA\xC7\xC3O] `+new Date().toLocaleString("pt-BR")+`:
`+s;yield this.firestoreService.updateLead(n,i,e.id,{fields:oe(F({},e.fields),{notes:p})})})}processEmailTemplate(t,e){if(!t)return"";let i=t,n={"{{contactName}}":e.fields.contactName||"","{{companyName}}":e.fields.companyName||"","{{contactEmail}}":e.fields.contactEmail||"","{{contactPhone}}":e.fields.contactPhone||"","{{cnpj}}":e.fields.cnpj||""};return Object.entries(n).forEach(([s,m])=>{i=i.replace(new RegExp(s,"g"),m)}),Object.entries(e.fields).forEach(([s,m])=>{typeof m=="string"&&(i=i.replace(new RegExp(`{{${s}}}`,"g"),m))}),i}addAutomationHistory(t,e,i,n,s,m){return S(this,null,function*(){let p=F({automationId:t.id,automationName:t.name,leadId:e.id,leadName:e.fields.contactName||e.fields.companyName||"Lead sem nome",status:s,executedAt:new Date,actions:t.actions.map(v=>({type:v.type,details:this.getActionDetails(v)}))},m&&{errorMessage:m});try{yield this.firestoreService.addAutomationHistoryItem(n,i,p),console.log("\u{1F4CA} Item adicionado ao hist\xF3rico de automa\xE7\xE3o:",p)}catch(v){console.error("\u274C Erro ao adicionar ao hist\xF3rico de automa\xE7\xE3o:",v)}})}getActionDetails(t){switch(t.type){case"send-email":return`Template: ${t.templateId}`;case"move-to-phase":return`Fase: ${t.phaseId}`;case"assign-user":return`Usu\xE1rio: ${t.userId}`;case"add-note":return`Nota: ${t.note?.substring(0,50)}...`;default:return""}}processTimeBasedAutomations(){return S(this,null,function*(){console.log("\u{1F552} Processando automa\xE7\xF5es baseadas em tempo...")})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})};var Mt;function fn(){if(Mt==null){let o=typeof document<"u"?document.head:null;Mt=!!(o&&(o.createShadowRoot||o.attachShadow))}return Mt}function at(o){if(fn()){let t=o.getRootNode?o.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function Re(o){return o.composedPath?o.composedPath()[0]:o.target}function Oi(o){return o.buttons===0||o.detail===0}function Ai(o){let t=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function st(o,t=0){return _n(o)?Number(o):arguments.length===2?t:0}function _n(o){return!isNaN(parseFloat(o))&&!isNaN(Number(o))}function ne(o){return o instanceof xe?o.nativeElement:o}var lt=new WeakMap,Li=(()=>{class o{_appRef;_injector=x(Fe);_environmentInjector=x(ii);load(e){let i=this._appRef=this._appRef||this._injector.get(It),n=lt.get(i);n||(n={loaders:new Set,refs:[]},lt.set(i,n),i.onDestroy(()=>{lt.get(i)?.refs.forEach(s=>s.destroy()),lt.delete(i)})),n.loaders.has(e)||(n.loaders.add(e),n.refs.push(vi(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Dt;try{Dt=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Dt=!1}var Tt=(()=>{class o{_platformId=x(oi);isBrowser=this._platformId?wi(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||Dt)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var bn=new ce("cdk-dir-doc",{providedIn:"root",factory:vn});function vn(){return x(ve)}var xn=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function yn(o){let t=o?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?xn.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var kt=(()=>{class o{get value(){return this.valueSignal()}valueSignal=Se("ltr");change=new I;constructor(){let e=x(bn,{optional:!0});if(e){let i=e.body?e.body.dir:null,n=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(yn(i||n||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var wn=20,Ri=(()=>{class o{_ngZone=x(ye);_platform=x(Tt);_renderer=x(Ee).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new D;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=wn){return this._platform.isBrowser?new ke(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let n=e>0?this._scrolled.pipe(Ct(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{n.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Zt()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){let n=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Xt(s=>!s||n.indexOf(s)>-1))}getAncestorScrollContainers(e){let i=[];return this.scrollContainers.forEach((n,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_scrollableContainsElement(e,i){let n=ne(i),s=e.getElementRef().nativeElement;do if(n==s)return!0;while(n=n.parentElement);return!1}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Sn=20,Vi=(()=>{class o{_platform=x(Tt);_listeners;_viewportSize;_change=new D;_document=x(ve);constructor(){let e=x(ye),i=x(Ee).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let n=s=>this._change.next(s);this._listeners=[i.listen("window","resize",n),i.listen("window","orientationchange",n)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:i,height:n}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+n,right:e.left+i,height:n,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,i=this._getWindow(),n=e.documentElement,s=n.getBoundingClientRect(),m=-s.top||e.body.scrollTop||i.scrollY||n.scrollTop||0,p=-s.left||e.body.scrollLeft||i.scrollX||n.scrollLeft||0;return{top:m,left:p}}change(e=Sn){return e>0?this._change.pipe(Ct(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ni=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=et({type:o});static \u0275inj=Ye({})}return o})();var Ft={},Bi=(()=>{class o{_appId=x(ni);getId(e){return this._appId!=="ng"&&(e+=this._appId),Ft.hasOwnProperty(e)||(Ft[e]=0),`${e}${Ft[e]++}`}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function zi(o){return Array.isArray(o)?o:[o]}function Lt(o){let t=o.cloneNode(!0),e=t.querySelectorAll("[id]"),i=o.nodeName.toLowerCase();t.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return i==="canvas"?Hi(o,t):(i==="input"||i==="select"||i==="textarea")&&ji(o,t),$i("canvas",o,t,Hi),$i("input, textarea, select",o,t,ji),t}function $i(o,t,e,i){let n=t.querySelectorAll(o);if(n.length){let s=e.querySelectorAll(o);for(let m=0;m<n.length;m++)i(n[m],s[m])}}var En=0;function ji(o,t){t.type!=="file"&&(t.value=o.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${En++}`)}function Hi(o,t){let e=t.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function jt(o){let t=o.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Rt(o,t,e){let{top:i,bottom:n,left:s,right:m}=o;return e>=i&&e<=n&&t>=s&&t<=m}function In(o,t){let e=t.left<o.left,i=t.left+t.width>o.right,n=t.top<o.top,s=t.top+t.height>o.bottom;return e||i||n||s}function Be(o,t,e){o.top+=t,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function Ui(o,t,e,i){let{top:n,right:s,bottom:m,left:p,width:v,height:w}=o,M=v*t,N=w*t;return i>n-N&&i<m+N&&e>p-M&&e<s+M}var dt=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:jt(e)})})}handleScroll(t){let e=Re(t),i=this.positions.get(e);if(!i)return null;let n=i.scrollPosition,s,m;if(e===this._document){let w=this.getViewportScrollPosition();s=w.top,m=w.left}else s=e.scrollTop,m=e.scrollLeft;let p=n.top-s,v=n.left-m;return this.positions.forEach((w,M)=>{w.clientRect&&e!==M&&e.contains(M)&&Be(w.clientRect,p,v)}),n.top=s,n.left=m,{top:p,left:v}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function tn(o,t){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(n=>i.appendChild(n)),i}function Ht(o,t,e){for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];n?o.setProperty(i,n,e?.has(i)?"important":""):o.removeProperty(i)}return o}function Me(o,t){let e=t?"":"none";Ht(o.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function qi(o,t,e){Ht(o.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function ct(o,t){return t&&t!="none"?o+" "+t:o}function Gi(o,t){o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.style.transform=ze(t.left,t.top)}function ze(o,t){return`translate3d(${Math.round(o)}px, ${Math.round(t)}px, 0)`}function Ki(o){let t=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*t}function Pn(o){let t=getComputedStyle(o),e=Ot(t,"transition-property"),i=e.find(p=>p==="transform"||p==="all");if(!i)return 0;let n=e.indexOf(i),s=Ot(t,"transition-duration"),m=Ot(t,"transition-delay");return Ki(s[n])+Ki(m[n])}function Ot(o,t){return o.getPropertyValue(t).split(",").map(i=>i.trim())}var Mn=new Set(["position"]),Vt=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,n,s,m,p,v,w,M){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=n,this._previewTemplate=s,this._previewClass=m,this._pickupPositionOnPage=p,this._initialTransform=v,this._zIndex=w,this._renderer=M}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),Wi(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return Pn(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,n;if(i&&t){let s=t.matchSize?this._initialDomRect:null,m=t.viewContainer.createEmbeddedView(i,t.context);m.detectChanges(),n=tn(m,this._document),this._previewEmbeddedView=m,t.matchSize?Gi(n,s):n.style.transform=ze(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=Lt(this._rootElement),Gi(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return Ht(n.style,{"pointer-events":"none",margin:Wi(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Mn),Me(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(s=>n.classList.add(s)):n.classList.add(e)),n}};function Wi(o){return"showPopover"in o}var Dn={passive:!0},Qi={passive:!1},Tn={passive:!1,capture:!0},kn=800,Zi="cdk-drag-placeholder",Yi=new Set(["position"]),Nt=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Se(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new D;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=be.EMPTY;_pointerUpSubscription=be.EMPTY;_scrollSubscription=be.EMPTY;_resizeSubscription=be.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Me(e,t)))}_disabled=!1;beforeStarted=new D;started=new D;released=new D;ended=new D;entered=new D;exited=new D;dropped=new D;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,n,s,m,p){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=s,this._dragDropRegistry=m,this._renderer=p,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new dt(i),m.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>ne(i)),this._handles.forEach(i=>Me(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=ne(t);if(e!==this._rootElement){this._removeRootElementListeners();let i=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[i.listen(e,"mousedown",this._pointerDown,Qi),i.listen(e,"touchstart",this._pointerDown,Dn),i.listen(e,"dragstart",this._nativeDragStart,Qi)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?ne(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&In(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let t=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),i=0,n=0;e.left<t.left?i=t.left-e.left:e.right>t.right&&(i=t.right-e.right),e.top<t.top?n=t.top-e.top:e.bottom>t.bottom&&(n=t.bottom-e.bottom);let s=this._activeTransform.x,m=this._activeTransform.y,p=s+i,v=m+n;this._rootElement.style.transform=ze(p,v),this._activeTransform={x:p,y:v},this._passiveTransform={x:p,y:v}}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),Me(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),Me(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),s=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+s>=this._config.dragStartThreshold){let p=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),v=this._dropContainer;if(!p){this._endDragSequence(t);return}(!v||!v.isDragging()&&!v.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,s=this._activeTransform;s.x=i.x-n.x+this._passiveTransform.x,s.y=i.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(s.x,s.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){Ve(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",Fn,Tn)}),i){let n=this._rootElement,s=n.parentNode,m=this._placeholder=this._createPlaceholderElement(),p=this._marker=this._marker||this._document.createComment("");s.insertBefore(p,n),this._initialTransform=n.style.transform||"",this._preview=new Vt(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(s,e)),qi(n,!1,Yi),this._document.body.appendChild(s.replaceChild(m,n)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),n=Ve(e),s=!n&&e.button!==0,m=this._rootElement,p=Re(e),v=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+kn>Date.now(),w=n?Ai(e):Oi(e);if(p&&p.draggable&&e.type==="mousedown"&&e.preventDefault(),i||s||v||w)return;if(this._handles.length){let z=m.style;this._rootElementTapHighlight=z.webkitTapHighlightColor||"",z.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(z=>this._updateOnScroll(z)),this._boundaryElement&&(this._boundaryRect=jt(this._boundaryElement));let M=this._previewTemplate;this._pickupPositionInElement=M&&M.template&&!M.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let N=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:N.x,y:N.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){qi(this._rootElement,!0,Yi),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),s=this._getDragDistance(n),m=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:s,dropPoint:n,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:m,distance:s,dropPoint:n,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,m,s,n,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let s=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!s&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(s=this._initialContainer),s&&s!==this._dropContainer&&this._ngZone.run(()=>{let m=this._dropContainer.getItemIndex(this),p=this._dropContainer.getItemAtIndex(m+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(s,this._dropContainer,p),this._dropContainer=s,this._dropContainer.enter(this,t,e,s===this._initialContainer&&s.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:s,currentIndex:s.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let n=p=>{(!p||this._preview&&Re(p)===this._preview.element&&p.propertyName==="transform")&&(m(),i(),clearTimeout(s))},s=setTimeout(n,e*1.5),m=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=tn(this._placeholderRef,this._document)):i=Lt(this._rootElement),i.style.pointerEvents="none",i.classList.add(Zi),i}_getPointerPositionInElement(t,e,i){let n=e===this._rootElement?null:e,s=n?n.getBoundingClientRect():t,m=Ve(i)?i.targetTouches[0]:i,p=this._getViewportScrollPosition(),v=m.pageX-s.left-p.left,w=m.pageY-s.top-p.top;return{x:s.left-t.left+v,y:s.top-t.top+w}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=Ve(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,s=i.pageY-e.top;if(this._ownerSVGElement){let m=this._ownerSVGElement.getScreenCTM();if(m){let p=this._ownerSVGElement.createSVGPoint();return p.x=n,p.y=s,p.matrixTransform(m.inverse())}}return{x:n,y:s}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:s,y:m}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,p=this._boundaryRect,{width:v,height:w}=this._getPreviewRect(),M=p.top+m,N=p.bottom-(w-m),z=p.left+s,vt=p.right-(v-s);i=Ji(i,z,vt),n=Ji(n,M,N)}return{x:i,y:n}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,n=this._pointerDirectionDelta,s=this._pointerPositionAtLastDirectionChange,m=Math.abs(e-s.x),p=Math.abs(i-s.y);return m>this._config.pointerDirectionChangeThreshold&&(n.x=e>s.x?1:-1,s.x=e),p>this._config.pointerDirectionChangeThreshold&&(n.y=i>s.y?1:-1,s.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Me(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,n=ze(t*i,e*i),s=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=s.transform&&s.transform!="none"?s.transform:""),s.transform=ct(n,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,n=ze(t,e);this._preview.setTransform(ct(n,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||i.width===0&&i.height===0)return;let s=n.left-i.left,m=i.right-n.right,p=n.top-i.top,v=i.bottom-n.bottom;n.width>i.width?(s>0&&(t+=s),m>0&&(t-=m)):t=0,n.height>i.height?(p>0&&(e+=p),v>0&&(e-=v)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:Ve(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=Re(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&Be(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=at(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return ne(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}_conditionallyInsertAnchor(t,e,i){if(t===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let n=this._anchor??=Lt(this._placeholder);n.classList.remove(Zi),n.classList.add("cdk-drag-anchor"),n.style.transform="",i?i.before(n):ne(e.element).appendChild(n)}}};function Ji(o,t,e){return Math.max(t,Math.min(e,o))}function Ve(o){return o.type[0]==="t"}function Fn(o){o.preventDefault()}function De(o,t,e){let i=mt(t,o.length-1),n=mt(e,o.length-1);if(i===n)return;let s=o[i],m=n<i?-1:1;for(let p=i;p!==n;p+=m)o[p]=o[p+m];o[n]=s}function nn(o,t,e,i){let n=mt(e,o.length-1),s=mt(i,t.length);o.length&&t.splice(s,0,o.splice(n,1)[0])}function mt(o,t){return Math.max(0,Math.min(t,o))}var ut=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,n){let s=this._itemPositions,m=this._getItemIndexFromPointerPosition(t,e,i,n);if(m===-1&&s.length>0)return null;let p=this.orientation==="horizontal",v=s.findIndex(K=>K.drag===t),w=s[m],M=s[v].clientRect,N=w.clientRect,z=v>m?1:-1,vt=this._getItemOffsetPx(M,N,z),pn=this._getSiblingOffsetPx(v,s,z),gn=s.slice();return De(s,v,m),s.forEach((K,hn)=>{if(gn[hn]===K)return;let Gt=K.drag===t,xt=Gt?vt:pn,Kt=Gt?t.getPlaceholderElement():K.drag.getRootElement();K.offset+=xt;let Wt=Math.round(K.offset*(1/K.drag.scale));p?(Kt.style.transform=ct(`translate3d(${Wt}px, 0, 0)`,K.initialTransform),Be(K.clientRect,0,xt)):(Kt.style.transform=ct(`translate3d(0, ${Wt}px, 0)`,K.initialTransform),Be(K.clientRect,xt,0))}),this._previousSwap.overlaps=Rt(N,e,i),this._previousSwap.drag=w.drag,this._previousSwap.delta=p?n.x:n.y,{previousIndex:v,currentIndex:m}}enter(t,e,i,n){let s=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n,m=this._activeDraggables,p=m.indexOf(t),v=t.getPlaceholderElement(),w=m[s];if(w===t&&(w=m[s+1]),!w&&(s==null||s===-1||s<m.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(w=m[0]),p>-1&&m.splice(p,1),w&&!this._dragDropRegistry.isDragging(w)){let M=w.getRootElement();M.parentElement.insertBefore(v,M),m.splice(s,0,t)}else this._element.appendChild(v),m.push(t);v.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(n=>n.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return this._getVisualItemPositions().findIndex(e=>e.drag===t)}getItemAtIndex(t){return this._getVisualItemPositions()[t]?.drag||null}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{Be(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:jt(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(t,e,i){let n=this.orientation==="horizontal",s=n?e.left-t.left:e.top-t.top;return i===-1&&(s+=n?e.width-t.width:e.height-t.height),s}_getSiblingOffsetPx(t,e,i){let n=this.orientation==="horizontal",s=e[t].clientRect,m=e[t+i*-1],p=s[n?"width":"height"]*i;if(m){let v=n?"left":"top",w=n?"right":"bottom";i===-1?p-=m.clientRect[v]-s[w]:p+=s[v]-m.clientRect[w]}return p}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,n=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let m=i[i.length-1].clientRect;return n?t>=m.right:e>=m.bottom}else{let m=i[0].clientRect;return n?t<=m.left:e<=m.top}}_getItemIndexFromPointerPosition(t,e,i,n){let s=this.orientation==="horizontal",m=this._itemPositions.findIndex(({drag:p,clientRect:v})=>{if(p===t)return!1;if(n){let w=s?n.x:n.y;if(p===this._previousSwap.drag&&this._previousSwap.overlaps&&w===this._previousSwap.delta)return!1}return s?e>=Math.floor(v.left)&&e<Math.floor(v.right):i>=Math.floor(v.top)&&i<Math.floor(v.bottom)});return m===-1||!this._sortPredicate(m,t)?-1:m}},Bt=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let n=e[i];this._relatedNodes.push([n,n.nextSibling])}this.withItems(t)}sort(t,e,i,n){let s=this._getItemIndexFromPointerPosition(t,e,i),m=this._previousSwap;if(s===-1||this._activeItems[s]===t)return null;let p=this._activeItems[s];if(m.drag===p&&m.overlaps&&m.deltaX===n.x&&m.deltaY===n.y)return null;let v=this.getItemIndex(t),w=t.getPlaceholderElement(),M=p.getRootElement();s>v?M.after(w):M.before(w),De(this._activeItems,v,s);let N=this._getRootNode().elementFromPoint(e,i);return m.deltaX=n.x,m.deltaY=n.y,m.drag=p,m.overlaps=M===N||M.contains(N),{previousIndex:v,currentIndex:s}}enter(t,e,i,n){let s=this._activeItems.indexOf(t);s>-1&&this._activeItems.splice(s,1);let m=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n;m===-1&&(m=this._getClosestItemIndexToPointer(t,e,i));let p=this._activeItems[m];p&&!this._dragDropRegistry.isDragging(p)?(this._activeItems.splice(m,0,t),p.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[n,s]=this._relatedNodes[i];n.parentNode===t&&n.nextSibling!==s&&(s===null?t.appendChild(n):s.parentNode===t&&t.insertBefore(n,s))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}getItemAtIndex(t){return this._activeItems[t]||null}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),s=n?this._activeItems.findIndex(m=>{let p=m.getRootElement();return n===p||p.contains(n)}):-1;return s===-1||!this._sortPredicate(s,t)?-1:s}_getRootNode(){return this._rootNode||(this._rootNode=at(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,s=-1;for(let m=0;m<this._activeItems.length;m++){let p=this._activeItems[m];if(p!==t){let{x:v,y:w}=p.getRootElement().getBoundingClientRect(),M=Math.hypot(e-v,i-w);M<n&&(n=M,s=m)}}return s}},Xi=.05,on=.05,ie=(function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o})(ie||{}),B=(function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o})(B||{}),zt=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new D;entered=new D;exited=new D;dropped=new D;sorted=new D;receivingStarted=new D;receivingStopped=new D;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=be.EMPTY;_verticalScrollDirection=ie.NONE;_horizontalScrollDirection=B.NONE;_scrollNode;_stopScrollTimers=new D;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,n,s){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=s;let m=this.element=ne(t);this._document=i,this.withOrientation("vertical").withElementContainer(m),e.registerDropContainer(this),this._parentPositions=new dt(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,s,m,p,v={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:s,distance:m,dropPoint:p,event:v})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>t.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof ut&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new Bt(this._document,this._dragDropRegistry);else{let e=new ut(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=ne(this.element),i=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}getItemAtIndex(t){return this._isDragging?this._sortStrategy.getItemAtIndex(t):this._draggables[t]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._domRect||!Ui(this._domRect,Xi,e,i))return;let s=this._sortStrategy.sort(t,e,i,n);s&&this.sorted.next({previousIndex:s.previousIndex,currentIndex:s.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=ie.NONE,s=B.NONE;if(this._parentPositions.positions.forEach((m,p)=>{p===this._document||!m.clientRect||i||Ui(m.clientRect,Xi,t,e)&&([n,s]=On(p,m.clientRect,this._direction,t,e),(n||s)&&(i=p))}),!n&&!s){let{width:m,height:p}=this._viewportRuler.getViewportSize(),v={width:m,height:p,top:0,right:m,bottom:p,left:0};n=rn(v,e),s=an(v,t),i=window}i&&(n!==this._verticalScrollDirection||s!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=s,this._scrollNode=i,(n||s)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Jt(0,yt).pipe(we(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===ie.UP?t.scrollBy(0,-e):this._verticalScrollDirection===ie.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===B.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===B.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&Rt(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!Rt(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,i);return n?n===this._container||this._container.contains(n):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=at(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function rn(o,t){let{top:e,bottom:i,height:n}=o,s=n*on;return t>=e-s&&t<=e+s?ie.UP:t>=i-s&&t<=i+s?ie.DOWN:ie.NONE}function an(o,t){let{left:e,right:i,width:n}=o,s=n*on;return t>=e-s&&t<=e+s?B.LEFT:t>=i-s&&t<=i+s?B.RIGHT:B.NONE}function On(o,t,e,i,n){let s=rn(t,n),m=an(t,i),p=ie.NONE,v=B.NONE;if(s){let w=o.scrollTop;s===ie.UP?w>0&&(p=ie.UP):o.scrollHeight-w>o.clientHeight&&(p=ie.DOWN)}if(m){let w=o.scrollLeft;e==="rtl"?m===B.RIGHT?w<0&&(v=B.RIGHT):o.scrollWidth+w>o.clientWidth&&(v=B.LEFT):m===B.LEFT?w>0&&(v=B.LEFT):o.scrollWidth-w>o.clientWidth&&(v=B.RIGHT)}return[p,v]}var Ne={capture:!0},At={passive:!1,capture:!0},An=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275cmp=T({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),Ut=(()=>{class o{_ngZone=x(ye);_document=x(ve);_styleLoader=x(Li);_renderer=x(Ee).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new D;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Se([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new D;pointerUp=new D;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,At)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(An),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=i.type.startsWith("touch"),s=p=>this.pointerUp.next(p),m=[["scroll",p=>this._scroll.next(p),Ne],["selectstart",this._preventDefaultWhileDragging,At]];n?m.push(["touchend",s,Ne],["touchcancel",s,Ne]):m.push(["mouseup",s,Ne]),n||m.push(["mousemove",p=>this.pointerMove.next(p),At]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=m.map(([p,v,w])=>this._renderer.listen(this._document,p,v,w))})}}stopDragging(e){this._activeDragInstances.update(i=>{let n=i.indexOf(e);return n>-1?(i.splice(n,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this._scroll];return e&&e!==this._document&&i.push(new ke(n=>this._ngZone.runOutsideAngular(()=>{let s=this._renderer.listen(e,"scroll",m=>{this._activeDragInstances().length&&n.next(m)},Ne);return()=>{s()}}))),Qe(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Ln={dragStartThreshold:5,pointerDirectionChangeThreshold:5},qt=(()=>{class o{_document=x(ve);_ngZone=x(ye);_viewportRuler=x(Vi);_dragDropRegistry=x(Ut);_renderer=x(Ee).createRenderer(null,null);constructor(){}createDrag(e,i=Ln){return new Nt(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new zt(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),$t=new ce("CDK_DRAG_PARENT");var sn=new ce("CdkDragHandle"),ln=(()=>{class o{element=x(xe);_parentDrag=x($t,{optional:!0,skipSelf:!0});_dragDropRegistry=x(Ut);_stateChanges=new D;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let e=this.element.nativeElement.parentElement;for(;e;){let i=this._dragDropRegistry.getDragDirectiveForNode(e);if(i){this._parentDrag=i,i._addHandle(this);break}e=e.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ae({type:o,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",ge]},features:[Le([{provide:sn,useExisting:o}])]})}return o})(),dn=new ce("CDK_DRAG_CONFIG"),cn=new ce("CdkDropList"),pt=(()=>{class o{element=x(xe);dropContainer=x(cn,{optional:!0,skipSelf:!0});_ngZone=x(ye);_viewContainerRef=x(St);_dir=x(kt,{optional:!0});_changeDetectorRef=x(it);_selfHandle=x(sn,{optional:!0,self:!0});_parentDrag=x($t,{optional:!0,skipSelf:!0});_dragDropRegistry=x(Ut);_destroyed=new D;_handles=new Qt([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new I;released=new I;ended=new I;entered=new I;exited=new I;dropped=new I;moved=new ke(e=>{let i=this._dragRef.moved.pipe(Yt(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=x(Fe);constructor(){let e=this.dropContainer,i=x(dn,{optional:!0}),n=x(qt);this._dragRef=n.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(we(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Et(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,n=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),n=i.indexOf(e);n>-1&&(i.splice(n,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):ne(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,n=this.dragStartDelay,s=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,m=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:st(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(s).withPreviewTemplate(m).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(ei(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let n=this._dragDropRegistry.getDragDirectiveForNode(i);if(n){e.withParent(n._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:n,constrainPosition:s,previewClass:m,boundaryElement:p,draggingDisabled:v,rootElementSelector:w,previewContainer:M}=e;this.disabled=v??!1,this.dragStartDelay=n||0,i&&(this.lockAxis=i),s&&(this.constrainPosition=s),m&&(this.previewClass=m),p&&(this.boundaryElement=p),w&&(this.rootElementSelector=w),M&&(this.previewContainer=M)}_setupHandlesListener(){this._handles.pipe(ti(e=>{let i=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),wt(e=>Qe(...e.map(i=>i._stateChanges.pipe(Ze(i))))),we(this._destroyed)).subscribe(e=>{let i=this._dragRef,n=e.element.nativeElement;e.disabled?i.disableHandle(n):i.enableHandle(n)})}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ae({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,n){i&2&&P("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",ge],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",bi]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Le([{provide:$t,useExisting:o}]),Oe]})}return o})(),en=new ce("CdkDropListGroup");var gt=(()=>{class o{element=x(xe);_changeDetectorRef=x(it);_scrollDispatcher=x(Ri);_dir=x(kt,{optional:!0});_group=x(en,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new D;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=x(Bi).getId("cdk-drop-list-");lockAxis;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new I;entered=new I;exited=new I;sorted=new I;_unsortedItems=new Set;constructor(){let e=x(qt),i=x(dn,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(n,s)=>this.enterPredicate(n.data,s.data),this._dropListRef.sortPredicate=(n,s,m)=>this.sortPredicate(n,s.data,m.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),o._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=o._dropLists.indexOf(this);e>-1&&o._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(Ze(this._dir.value),we(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=zi(this.connectedTo).map(n=>{if(typeof n=="string"){let s=o._dropLists.find(m=>m.id===n);return s}return n});if(this._group&&this._group._items.forEach(n=>{i.indexOf(n)===-1&&i.push(n)}),!this._scrollableParentsResolved){let n=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(s=>s.getElementRef().nativeElement);this._dropListRef.withScrollableParents(n),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let n=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(n)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=st(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(i.filter(n=>n&&n!==this).map(n=>n._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),Qe(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:n,sortingDisabled:s,listAutoScrollDisabled:m,listOrientation:p}=e;this.disabled=n??!1,this.sortingDisabled=s??!1,this.autoScrollDisabled=m??!1,this.orientation=p||"vertical",i&&(this.lockAxis=i)}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ae({type:o,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,n){i&2&&(tt("id",n.id),P("cdk-drop-list-disabled",n.disabled)("cdk-drop-list-dragging",n._dropListRef.isDragging())("cdk-drop-list-receiving",n._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",ge],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",ge],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",ge],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",ge]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[Le([{provide:en,useValue:void 0},{provide:cn,useExisting:o}])]})}return o})();var ht=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=et({type:o});static \u0275inj=Ye({providers:[qt],imports:[Ni]})}return o})();var Te=class o{storage=x(Ii);uploadFile(t,e){return S(this,null,function*(){try{let i=Pt(this.storage,e),n=yield Di(i,t);return yield Mi(n.ref)}catch(i){throw console.error("Erro ao fazer upload:",i),i}})}uploadLeadAttachment(t,e,i,n){return S(this,null,function*(){let s=Date.now(),m=`users/${t}/boards/${e}/leads/${i}/attachments/${s}_${n.name}`;try{let p=yield this.uploadFile(n,m);return{name:n.name,url:p}}catch(p){throw console.error("Erro ao fazer upload do anexo:",p),p}})}deleteFile(t){return S(this,null,function*(){try{let e=Pt(this.storage,t);yield Pi(e)}catch(e){throw console.error("Erro ao deletar arquivo:",e),e}})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})};var ft=class o{applyCpfMask(t){if(!t)return"";let e=t.replace(/\D/g,"");return e.length<=11?e.replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"):e.slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}applyCnpjMask(t){if(!t)return"";let e=t.replace(/\D/g,"");return e.length<=14?e.replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2"):e.slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2")}applyPhoneMask(t){if(!t)return"";let e=t.replace(/\D/g,"");if(e.length===11)return e.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d{4})$/,"$1-$2");if(e.length===10)return e.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d{4})$/,"$1-$2");if(e.length<=11){let i=e;return e.length>=2&&(i=e.replace(/(\d{2})(\d)/,"($1) $2")),e.length>=7&&(i=i.replace(/(\d{4,5})(\d{4})$/,"$1-$2")),i}return this.applyPhoneMask(e.slice(0,11))}isValidCpf(t){if(!t)return!1;let e=t.replace(/\D/g,"");if(e.length!==11||/^(\d)\1+$/.test(e))return!1;let i=0;for(let m=0;m<9;m++)i+=parseInt(e.charAt(m))*(10-m);let n=11-i%11;n>9&&(n=0),i=0;for(let m=0;m<10;m++)i+=parseInt(e.charAt(m))*(11-m);let s=11-i%11;return s>9&&(s=0),parseInt(e.charAt(9))===n&&parseInt(e.charAt(10))===s}isValidCnpj(t){if(!t)return!1;let e=t.replace(/\D/g,"");if(e.length!==14||/^(\d)\1+$/.test(e))return!1;let i=0,n=[5,4,3,2,9,8,7,6,5,4,3,2];for(let v=0;v<12;v++)i+=parseInt(e.charAt(v))*n[v];let s=11-i%11;s<2&&(s=0),i=0;let m=[6,5,4,3,2,9,8,7,6,5,4,3,2];for(let v=0;v<13;v++)i+=parseInt(e.charAt(v))*m[v];let p=11-i%11;return p<2&&(p=0),parseInt(e.charAt(12))===s&&parseInt(e.charAt(13))===p}isValidEmail(t){return t?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t):!1}removeFormatting(t){return t?t.replace(/\D/g,""):""}getTemperatureColor(t){switch(t?.toLowerCase()){case"quente":return"#EF4444";case"morno":return"#EAB308";case"frio":return"#3B82F6";default:return"#6B7280"}}getTemperatureClass(t){switch(t?.toLowerCase()){case"quente":return"bg-red-500 text-white";case"morno":return"bg-yellow-500 text-white";case"frio":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}}maskPhone(t){let e=t.target,i=e.value,n=this.applyPhoneMask(i);e.value=n;let s=new Event("input",{bubbles:!0});e.dispatchEvent(s)}maskCPF(t){let e=t.target,i=e.value,n=this.applyCpfMask(i);e.value=n;let s=new Event("input",{bubbles:!0});e.dispatchEvent(s)}maskCNPJ(t){let e=t.target,i=e.value,n=this.applyCnpjMask(i);e.value=n;let s=new Event("input",{bubbles:!0});e.dispatchEvent(s)}validateCPF(t){return this.isValidCpf(t)}validateCNPJ(t){return this.isValidCnpj(t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})};var Rn=()=>["Quente","Morno","Frio"];function Vn(o,t){o&1&&(r(0,"span",27),d(1,"*"),a())}function Nn(o,t){if(o&1&&g(0,"input",28),o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("type",i.type)("id",i.name)("formControlName",i.name)("placeholder",i.placeholder||"")("disabled",n.isLoading)}}function Bn(o,t){if(o&1){let e=C();r(0,"input",29),h("input",function(n){f(e);let s=u(3);return _(s.maskHelper.maskPhone(n))})("keyup",function(n){f(e);let s=u(3);return _(s.maskHelper.maskPhone(n))}),a()}if(o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("placeholder",i.placeholder||"(11) 99999-9999")("disabled",n.isLoading)}}function zn(o,t){if(o&1){let e=C();r(0,"input",30),h("input",function(n){f(e);let s=u(3);return _(s.maskHelper.maskCNPJ(n))})("keyup",function(n){f(e);let s=u(3);return _(s.maskHelper.maskCNPJ(n))}),a()}if(o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function $n(o,t){if(o&1){let e=C();r(0,"input",31),h("input",function(n){f(e);let s=u(3);return _(s.maskHelper.maskCPF(n))})("keyup",function(n){f(e);let s=u(3);return _(s.maskHelper.maskCPF(n))}),a()}if(o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function jn(o,t){if(o&1&&(r(0,"option",35),d(1),a()),o&2){let e=t.$implicit;c("value",e),l(),y(" ",e," ")}}function Hn(o,t){if(o&1&&(r(0,"select",32)(1,"option",33),d(2,"Selecione..."),a(),b(3,jn,2,2,"option",34),a()),o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("disabled",n.isLoading),l(3),c("ngForOf",i.options)}}function Un(o,t){if(o&1&&(r(0,"option",35),d(1),a()),o&2){let e=t.$implicit;c("value",e),l(),y(" ",e," ")}}function qn(o,t){if(o&1&&(r(0,"select",32)(1,"option",33),d(2,"Selecione a temperatura"),a(),b(3,Un,2,2,"option",34),a()),o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("disabled",n.isLoading),l(3),c("ngForOf",i.options||W(6,Rn))}}function Gn(o,t){if(o&1&&(r(0,"div",38),g(1,"input",39),r(2,"label",40),d(3),a()()),o&2){let e=t.$implicit,i=t.index,n=u(2).$implicit,s=u(2);l(),c("id",n.name+"_radio_"+i)("formControlName",n.name)("value",e)("disabled",s.isLoading),l(),c("for",n.name+"_radio_"+i),l(),y(" ",e," ")}}function Kn(o,t){if(o&1&&(r(0,"div",36),b(1,Gn,4,6,"div",37),a()),o&2){let e=u().$implicit;l(),c("ngForOf",e.options)}}function Wn(o,t){if(o&1&&(r(0,"label",41),g(1,"input",42),r(2,"span",43),d(3),a()()),o&2){let e=u().$implicit,i=u(2);l(),c("id",e.name)("formControlName",e.name)("disabled",i.isLoading),l(2),E(e.placeholder||e.label)}}function Qn(o,t){if(o&1&&g(0,"textarea",44),o&2){let e,i=u().$implicit,n=u(2);P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function Zn(o,t){if(o&1){let e=C();r(0,"div")(1,"input",45),h("change",function(n){f(e);let s=u().$implicit,m=u(2);return _(m.onFileSelected(n,s.name))}),a(),r(2,"p",46),d(3),a()()}if(o&2){let e,i=u().$implicit,n=u(2);l(),P("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),c("id",i.name)("multiple",i.placeholder==="multiple")("disabled",n.isLoading),l(2),y(" ",i.placeholder||"Voc\xEA pode anexar arquivos como documentos, imagens, etc."," ")}}function Yn(o,t){if(o&1&&(r(0,"div",47),d(1),a()),o&2){let e=u().$implicit,i=u(2);l(),y(" ",i.getFieldError(e.name)," ")}}function Jn(o,t){if(o&1&&(r(0,"div",14)(1,"label",15),d(2),b(3,Vn,2,0,"span",16),a(),b(4,Nn,1,7,"input",17)(5,Bn,1,6,"input",18)(6,zn,1,5,"input",19)(7,$n,1,5,"input",20)(8,Hn,4,6,"select",21)(9,qn,4,7,"select",21)(10,Kn,2,1,"div",22)(11,Wn,4,4,"label",23)(12,Qn,1,5,"textarea",24)(13,Zn,4,6,"div",25)(14,Yn,2,1,"div",26),a()),o&2){let e=t.$implicit,i=u(2);l(),c("for",e.name),l(),y(" ",e.label," "),l(),c("ngIf",e.required),l(),c("ngIf",e.type==="text"||e.type==="email"||e.type==="date"||e.type==="time"||e.type==="number"),l(),c("ngIf",e.type==="tel"),l(),c("ngIf",e.type==="cnpj"),l(),c("ngIf",e.type==="cpf"),l(),c("ngIf",e.type==="select"),l(),c("ngIf",e.type==="temperatura"),l(),c("ngIf",e.type==="radio"),l(),c("ngIf",e.type==="checkbox"),l(),c("ngIf",e.type==="textarea"),l(),c("ngIf",e.type==="file"),l(),c("ngIf",i.getFieldError(e.name))}}function Xn(o,t){if(o&1&&(r(0,"div",48),d(1),a()),o&2){let e=u(2);l(),y(" ",e.errorMessage," ")}}function eo(o,t){o&1&&g(0,"div",49)}function to(o,t){if(o&1){let e=C();r(0,"div",1),h("click",function(n){f(e);let s=u();return _(s.onBackdropClick(n))}),r(1,"div",2)(2,"div",3)(3,"h2",4),d(4),a(),r(5,"button",5),h("click",function(){f(e);let n=u();return _(n.hide())}),d(6," \xD7 "),a()(),r(7,"form",6),h("ngSubmit",function(){f(e);let n=u();return _(n.saveLead())}),r(8,"div",7),b(9,Jn,15,14,"div",8)(10,Xn,2,1,"div",9),a(),r(11,"div",10)(12,"button",11),h("click",function(){f(e);let n=u();return _(n.hide())}),d(13," Cancelar "),a(),r(14,"button",12),b(15,eo,1,0,"div",13),d(16),a()()()()()}if(o&2){let e=u();l(4),y(" ",e.isEditing?"Editar Registro":"Novo Registro"," "),l(),c("disabled",e.isLoading),l(2),c("formGroup",e.leadForm),l(2),c("ngForOf",e.formFields),l(),c("ngIf",e.errorMessage),l(2),c("disabled",e.isLoading),l(2),c("disabled",e.isLoading||!e.leadForm.valid),l(),c("ngIf",e.isLoading),l(),y(" ",e.isLoading?"Salvando...":e.isEditing?"Atualizar Registro":"Salvar Registro"," ")}}var $e=class o{authService=x(fe);firestoreService=x(V);storageService=x(Te);fb=x(te);maskService=x(ft);ownerId="";boardId="";columns=[];leadCreated=new I;leadUpdated=new I;closeModal=new I;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentLead=null;leadForm=this.fb.group({});formFields=[];selectedFiles=[];ngOnInit(){this.initializeForm()}initializeForm(){return S(this,null,function*(){yield this.loadFormFieldsFromInitialPhase(),this.formFields.length===0&&(this.formFields=[{name:"companyName",label:"Nome da Empresa",type:"text",required:!0,order:0,includeInApi:!0,showInCard:!1},{name:"cnpj",label:"CNPJ",type:"cnpj",required:!0,order:1,includeInApi:!0,showInCard:!1},{name:"contactName",label:"Nome do Contato",type:"text",required:!0,order:2,includeInApi:!0,showInCard:!1},{name:"contactEmail",label:"Email do Contato",type:"email",required:!0,order:3,includeInApi:!0,showInCard:!1},{name:"contactPhone",label:"Telefone do Contato",type:"tel",required:!0,order:4,includeInApi:!0,showInCard:!1},{name:"temperature",label:"Temperatura",type:"temperatura",required:!1,order:5,options:["Quente","Morno","Frio"],includeInApi:!0,showInCard:!1},{name:"description",label:"Observa\xE7\xF5es",type:"textarea",required:!1,order:6,includeInApi:!0,showInCard:!1}]),this.buildForm()})}loadFormFieldsFromInitialPhase(){return S(this,null,function*(){try{if(this.boardId&&this.ownerId){console.log("\u{1F50D} Carregando campos do formul\xE1rio da fase inicial...",{boardId:this.boardId,ownerId:this.ownerId});let t=yield this.firestoreService.getColumns(this.ownerId,this.boardId);console.log("\u{1F4CB} Colunas encontradas:",t);let e=t.find(i=>i.isInitialPhase)||t.sort((i,n)=>(i.order||0)-(n.order||0))[0];if(e){console.log("\u{1F3AF} Fase inicial encontrada:",e);let i=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,e.id);console.log("\u2699\uFE0F Configura\xE7\xE3o da fase encontrada:",i),i&&i.fields?(this.formFields=i.fields.map(n=>(n.type==="temperatura"&&((!n.options||n.options.length===0)&&(n.options=["Quente","Morno","Frio"]),console.log("\u{1F321}\uFE0F Campo temperatura reconstru\xEDdo:",n)),oe(F({},n),{includeInApi:n.includeInApi!==!1,order:n.order||0}))).sort((n,s)=>(n.order||0)-(s.order||0)),console.log("\u2705 Formul\xE1rio carregado da fase inicial:",this.formFields)):console.log("\u26A0\uFE0F Nenhuma configura\xE7\xE3o de formul\xE1rio encontrada para a fase")}else console.log("\u26A0\uFE0F Nenhuma coluna encontrada no quadro")}else console.log("\u26A0\uFE0F BoardId ou OwnerId n\xE3o definidos:",{boardId:this.boardId,ownerId:this.ownerId})}catch(t){console.error("\u274C Erro ao carregar campos do formul\xE1rio da fase:",t)}})}buildForm(){let t={};this.formFields.forEach(e=>{let i=e.required?[A.required]:[];switch(e.type){case"email":i.push(A.email);break;case"cnpj":i.push(n=>{let s=n.value;return s?this.maskService.validateCNPJ(s)?null:{cnpj:!0}:null});break;case"cpf":i.push(n=>{let s=n.value;return s?this.maskService.validateCPF(s)?null:{cpf:!0}:null});break}t[e.name]=["",i]}),this.leadForm=this.fb.group(t)}showCreateModal(){this.isEditing=!1,this.currentLead=null,this.isVisible=!0,this.resetForm()}showEditModal(t){this.isEditing=!0,this.currentLead=t,this.isVisible=!0,this.populateForm(t)}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){this.leadForm.reset(),this.errorMessage="",this.selectedFiles=[],this.isLoading=!1}populateForm(t){t.fields&&Object.keys(t.fields).forEach(e=>{this.leadForm.controls[e]&&this.leadForm.patchValue({[e]:t.fields[e]})})}saveLead(){return S(this,null,function*(){if(!this.leadForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.leadForm.value,e=this.authService.getCurrentUser();if(!e)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.isEditing&&this.currentLead)yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,{fields:t}),yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"update",text:"Lead atualizado",user:e.displayName||e.email}),this.leadUpdated.emit();else{let i=this.columns.find(m=>m.order===0);if(!i)throw new Error("Nenhuma coluna inicial encontrada");let n={fields:t,columnId:i.id,companyId:"",boardId:this.boardId,createdAt:null,movedToCurrentColumnAt:null,responsibleUserId:e.uid,responsibleUserName:e.displayName||"",responsibleUserEmail:e.email||"",phaseHistory:{},executedAutomations:{}},s=yield this.firestoreService.createLead(this.ownerId,this.boardId,n);yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,s.id,{type:"creation",text:`Lead criado na fase <b>${i.name}</b>`,user:e.displayName||e.email}),this.leadCreated.emit()}this.hide()}catch(t){console.error("Erro ao salvar lead:",t),this.errorMessage="Erro ao salvar lead. Tente novamente."}finally{this.isLoading=!1}})}onFileSelected(t,e){let i=t.target.files;i&&(e?this.leadForm.patchValue({[e]:Array.from(i)}):this.selectedFiles=Array.from(i))}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}getFieldError(t){let e=this.leadForm.get(t);if(e?.errors&&e.touched){if(e.errors.required)return`${this.getFieldLabel(t)} \xE9 obrigat\xF3rio`;if(e.errors.email)return"Email inv\xE1lido";if(e.errors.cnpj)return"CNPJ inv\xE1lido";if(e.errors.cpf)return"CPF inv\xE1lido"}return""}getFieldLabel(t){return this.formFields.find(i=>i.name===t)?.label||t}get maskHelper(){return this.maskService}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-lead-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns"},outputs:{leadCreated:"leadCreated",leadUpdated:"leadUpdated",closeModal:"closeModal"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-y-auto"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"space-y-4"],["class","form-group",4,"ngFor","ngForOf"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"flex","justify-end","gap-3","mt-6","pt-4","border-t","border-gray-200"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-2","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-700","mb-1",3,"for"],["class","text-red-500",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"type","id","formControlName","placeholder","border-red-500","disabled",4,"ngIf"],["type","tel","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","placeholder","border-red-500","disabled","input","keyup",4,"ngIf"],["type","text","placeholder","00.000.000/0000-00","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled","input","keyup",4,"ngIf"],["type","text","placeholder","000.000.000-00","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled","input","keyup",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled",4,"ngIf"],["class","space-y-2",4,"ngIf"],["class","flex items-center cursor-pointer",4,"ngIf"],["rows","3","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none",3,"id","formControlName","border-red-500","disabled",4,"ngIf"],[4,"ngIf"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"text-red-500"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"type","id","formControlName","placeholder","disabled"],["type","tel",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","placeholder","disabled"],["type","text","placeholder","00.000.000/0000-00",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","disabled"],["type","text","placeholder","000.000.000-00",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","disabled"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"id","formControlName","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"space-y-2"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["type","radio",1,"mr-2","text-blue-600","focus:ring-blue-500","border-gray-300",3,"id","formControlName","value","disabled"],[1,"text-gray-700","cursor-pointer",3,"for"],[1,"flex","items-center","cursor-pointer"],["type","checkbox",1,"mr-2","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"id","formControlName","disabled"],[1,"text-gray-700"],["rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","resize-none",3,"id","formControlName","disabled"],["type","file",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"change","id","multiple","disabled"],[1,"text-xs","text-gray-500","mt-1"],[1,"text-red-500","text-sm","mt-1"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,to,17,9,"div",0),e&2&&c("ngIf",i.isVisible)},dependencies:[O,R,j,le,J,ae,se,Q,Ie,he,Ti,Z,Y,H,X,ee],styles:[`.fixed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.bg-white[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.form-group[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #3b82f61a}.border-red-500[_ngcontent-%COMP%]{border-color:#ef4444!important}select[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}`]})};function io(o,t){if(o&1&&(r(0,"div",42),d(1),a()),o&2){let e=u(2);l(),y(" ",e.getFieldError("name")," ")}}function no(o,t){o&1&&(r(0,"div",45),g(1,"i",46),a())}function oo(o,t){if(o&1){let e=C();r(0,"div",43),h("click",function(){let n=f(e).$implicit,s=u(2);return _(!s.isLoading&&s.columnForm.patchValue({color:n}))}),b(1,no,2,0,"div",44),a()}if(o&2){let e,i,n,s,m,p=t.$implicit,v=t.index,w=u(2);mi("background-color: "+p+" !important;"),P("border-gray-800",((e=w.columnForm.get("color"))==null?null:e.value)===p)("border-gray-300",((i=w.columnForm.get("color"))==null?null:i.value)!==p)("ring-2",((n=w.columnForm.get("color"))==null?null:n.value)===p)("ring-blue-500",((s=w.columnForm.get("color"))==null?null:s.value)===p),c("title",p),tt("data-color",p)("data-index",v),l(),c("ngIf",((m=w.columnForm.get("color"))==null?null:m.value)===p)}}function ro(o,t){if(o&1&&(r(0,"option",47),d(1),a()),o&2){let e=t.$implicit;c("value",e.value),l(),y(" ",e.label," ")}}function ao(o,t){if(o&1&&(r(0,"div",42),d(1),a()),o&2){let e=u(2);l(),y(" ",e.getFieldError("slaDays")," ")}}function so(o,t){if(o&1&&(r(0,"div",48),d(1),a()),o&2){let e=u(2);l(),y(" ",e.errorMessage," ")}}function lo(o,t){if(o&1){let e=C();r(0,"button",49),h("click",function(){f(e);let n=u(2);return _(n.deleteColumn())}),g(1,"i",50),d(2," Excluir Fase "),a()}if(o&2){let e=u(2);c("disabled",e.isLoading)}}function co(o,t){o&1&&g(0,"div")}function mo(o,t){o&1&&g(0,"div",51)}function uo(o,t){if(o&1){let e=C();r(0,"div",1),h("click",function(n){f(e);let s=u();return _(s.onBackdropClick(n))}),r(1,"div",2)(2,"div",3)(3,"h2",4),d(4),a(),r(5,"button",5),h("click",function(){f(e);let n=u();return _(n.hide())}),d(6," \xD7 "),a()(),r(7,"form",6),h("ngSubmit",function(){f(e);let n=u();return _(n.saveColumn())}),r(8,"div",7)(9,"div",8)(10,"label",9),d(11," Nome da Fase "),r(12,"span",10),d(13,"*"),a()(),g(14,"input",11),b(15,io,2,1,"div",12),a(),r(16,"div",8)(17,"label",13),d(18," Cor da Fase "),a(),r(19,"div",14),b(20,oo,2,14,"div",15),a(),r(21,"div",16)(22,"label",17),d(23,"Cor personalizada:"),a(),g(24,"input",18),r(25,"span",19),d(26),a()()(),r(27,"div",8)(28,"label",20),d(29," Tipo de Finaliza\xE7\xE3o "),a(),r(30,"select",21),b(31,ro,2,2,"option",22),a(),r(32,"p",23),d(33," Fases de finaliza\xE7\xE3o n\xE3o permitem que leads sejam movidos para outras fases. "),a()(),r(34,"div",8)(35,"label",24),d(36," SLA (dias) "),a(),g(37,"input",25),b(38,ao,2,1,"div",12),r(39,"p",23),d(40," Defina um prazo em dias para esta fase. Use 0 para desabilitar o SLA. "),a()(),r(41,"div",8)(42,"label",26),g(43,"input",27),r(44,"span",28),d(45," Esta \xE9 a fase inicial "),a()(),r(46,"p",23),d(47," A fase inicial ser\xE1 usada automaticamente ao criar novos registros. "),a()(),b(48,so,2,1,"div",29),r(49,"div",30)(50,"div",31),g(51,"i",32),r(52,"div",33)(53,"strong"),d(54,"Dica:"),a(),r(55,"ul",34)(56,"li"),d(57,"Organize suas fases na ordem do seu funil de vendas"),a(),r(58,"li"),d(59,"Use cores diferentes para facilitar a identifica\xE7\xE3o"),a(),r(60,"li"),d(61,"Fases de "),r(62,"strong"),d(63,"Sucesso"),a(),d(64," indicam leads convertidos"),a(),r(65,"li"),d(66,"Fases de "),r(67,"strong"),d(68,"Fracasso"),a(),d(69," indicam leads perdidos"),a()()()()()(),r(70,"div",35),b(71,lo,3,1,"button",36)(72,co,1,0,"div",37),r(73,"div",38)(74,"button",39),h("click",function(){f(e);let n=u();return _(n.hide())}),d(75," Cancelar "),a(),r(76,"button",40),b(77,mo,1,0,"div",41),d(78),a()()()()()()}if(o&2){let e,i,n,s=u();l(4),y(" ",s.isEditing?"Editar Fase":"Nova Fase"," "),l(),c("disabled",s.isLoading),l(2),c("formGroup",s.columnForm),l(7),P("border-red-500",((e=s.columnForm.get("name"))==null?null:e.invalid)&&((e=s.columnForm.get("name"))==null?null:e.touched)),c("disabled",s.isLoading),l(),c("ngIf",s.getFieldError("name")),l(5),c("ngForOf",s.predefinedColors),l(4),c("disabled",s.isLoading),l(2),E((i=s.columnForm.get("color"))==null?null:i.value),l(4),c("disabled",s.isLoading),l(),c("ngForOf",s.endStageTypes),l(6),P("border-red-500",((n=s.columnForm.get("slaDays"))==null?null:n.invalid)&&((n=s.columnForm.get("slaDays"))==null?null:n.touched)),c("disabled",s.isLoading),l(),c("ngIf",s.getFieldError("slaDays")),l(5),c("disabled",s.isLoading),l(5),c("ngIf",s.errorMessage),l(23),c("ngIf",s.isEditing),l(),c("ngIf",!s.isEditing),l(2),c("disabled",s.isLoading),l(2),c("disabled",s.isLoading||!s.columnForm.valid),l(),c("ngIf",s.isLoading),l(),y(" ",s.isLoading?"Salvando...":s.isEditing?"Atualizar Fase":"Criar Fase"," ")}}var He=class o{authService=x(fe);firestoreService=x(V);fb=x(te);ownerId="";boardId="";columns=[];columnCreated=new I;columnUpdated=new I;columnDeleted=new I;closeModal=new I;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentColumn=null;predefinedColors=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#6B7280","#F97316","#06B6D4","#84CC16","#14B8A6","#F43F5E","#A855F7","#EAB308","#059669","#DC2626"];columnForm=this.fb.group({name:["",[A.required]],color:[this.predefinedColors[0]],endStageType:["none"],slaDays:[0,[A.min(0)]],isInitialPhase:[!1]});endStageTypes=[{value:"none",label:"Nenhuma (fase normal)"},{value:"success",label:"Sucesso (lead convertido)"},{value:"fail",label:"Fracasso (lead perdido)"}];showCreateModal(){this.isEditing=!1,this.currentColumn=null,this.isVisible=!0,this.resetForm()}showEditModal(t){this.isEditing=!0,this.currentColumn=t,this.isVisible=!0,this.populateForm(t)}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){let t=this.getNextAvailableColor();this.columnForm.reset({name:"",color:t,endStageType:"none",slaDays:0,isInitialPhase:!1}),this.errorMessage="",this.isLoading=!1}getNextAvailableColor(){let t=this.columns.map(i=>i.color).filter(i=>i);for(let i of this.predefinedColors)if(!t.includes(i))return i;let e=this.columns.length%this.predefinedColors.length;return this.predefinedColors[e]}populateForm(t){this.columnForm.patchValue({name:t.name,color:t.color||"#3B82F6",endStageType:t.endStageType||"none",slaDays:t.slaDays||0,isInitialPhase:t.isInitialPhase||!1})}saveColumn(){return S(this,null,function*(){if(!this.columnForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.columnForm.value;if(!this.authService.getCurrentUser())throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.isEditing&&this.currentColumn)yield this.firestoreService.updateColumn(this.ownerId,this.boardId,this.currentColumn.id,{name:t.name,color:t.color,endStageType:t.endStageType,slaDays:t.slaDays,isInitialPhase:t.isInitialPhase,updatedAt:new Date}),this.columnUpdated.emit();else{let i=Math.max(...this.columns.map(s=>s.order||0),-1)+1,n={name:t.name,color:t.color,order:i,endStageType:t.endStageType,slaDays:t.slaDays,isInitialPhase:t.isInitialPhase,boardId:this.boardId,companyId:"",createdAt:new Date,updatedAt:new Date};yield this.firestoreService.createColumn(this.ownerId,this.boardId,n),this.columnCreated.emit()}this.hide()}catch(t){console.error("Erro ao salvar coluna:",t),this.errorMessage="Erro ao salvar fase. Tente novamente."}finally{this.isLoading=!1}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}getFieldError(t){let e=this.columnForm.get(t);return e?.errors&&e.touched&&e.errors.required?`${this.getFieldLabel(t)} \xE9 obrigat\xF3rio`:""}getFieldLabel(t){return{name:"Nome da Fase",color:"Cor",endStageType:"Tipo de Finaliza\xE7\xE3o",slaDays:"SLA (dias)"}[t]||t}deleteColumn(){return S(this,null,function*(){if(!(!this.currentColumn||!this.currentColumn.id||!confirm(`Deseja excluir a fase "${this.currentColumn.name}"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.`))){this.isLoading=!0,this.errorMessage="";try{yield this.firestoreService.deleteColumn(this.ownerId,this.boardId,this.currentColumn.id),this.columnDeleted.emit(),this.hide()}catch(e){console.error("Erro ao excluir coluna:",e),this.errorMessage="Erro ao excluir fase. Tente novamente."}finally{this.isLoading=!1}}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-column-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns"},outputs:{columnCreated:"columnCreated",columnUpdated:"columnUpdated",columnDeleted:"columnDeleted",closeModal:"closeModal"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","overflow-y-auto"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"space-y-4"],[1,"form-group"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","id","name","formControlName","name","placeholder","Digite o nome da fase",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"grid","grid-cols-8","gap-2","mb-3","p-3","bg-gray-50","rounded-lg"],["class","color-swatch w-10 h-10 rounded-lg border-2 transition-all duration-200 hover:scale-105 hover:shadow-md relative cursor-pointer",3,"style","border-gray-800","border-gray-300","ring-2","ring-blue-500","title","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-600"],["type","color","formControlName","color","title","Escolher cor personalizada",1,"w-12","h-8","border","border-gray-300","rounded","cursor-pointer",3,"disabled"],[1,"text-xs","text-gray-500","ml-1"],["for","endStageType",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","endStageType","formControlName","endStageType",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500","mt-1"],["for","slaDays",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","number","id","slaDays","formControlName","slaDays","min","0","placeholder","Ex: 3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","isInitialPhase",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"flex","items-start"],[1,"fas","fa-info-circle","text-blue-500","mt-0.5","mr-2"],[1,"text-sm","text-blue-700"],[1,"mt-1","ml-2","list-disc"],[1,"flex","justify-between","mt-6","pt-4","border-t","border-gray-200"],["type","button","class","px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg font-medium transition-colors flex items-center",3,"disabled","click",4,"ngIf"],[4,"ngIf"],[1,"flex","gap-3"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-2","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],[1,"color-swatch","w-10","h-10","rounded-lg","border-2","transition-all","duration-200","hover:scale-105","hover:shadow-md","relative","cursor-pointer",3,"click","title"],["class","absolute inset-0 flex items-center justify-center",4,"ngIf"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"fas","fa-check","text-white","text-sm","drop-shadow-md"],[3,"value"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],["type","button",1,"px-4","py-2","text-red-700","bg-red-100","hover:bg-red-200","rounded-lg","font-medium","transition-colors","flex","items-center",3,"click","disabled"],[1,"fas","fa-trash","mr-2"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,uo,79,24,"div",0),e&2&&c("ngIf",i.isVisible)},dependencies:[O,R,j,le,J,ae,se,Q,Pe,Ie,he,Z,Y,ot,H,X,ee],styles:[`.fixed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.bg-white[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.form-group[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #3b82f61a}.border-red-500[_ngcontent-%COMP%]{border-color:#ef4444!important}select[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.color-swatch[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a;background-clip:padding-box!important}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #00000026}.color-swatch[_ngcontent-%COMP%]:active{transform:scale(.98)}.color-swatch[_ngcontent-%COMP%]   .fa-check[_ngcontent-%COMP%]{text-shadow:0 1px 2px rgba(0,0,0,.5)}.grid[_ngcontent-%COMP%]   .color-swatch[_ngcontent-%COMP%]{background:none!important}input[type=color][_ngcontent-%COMP%]{appearance:none;border:none;cursor:pointer}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch-wrapper{padding:0;border:1px solid #d1d5db;border-radius:4px}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch{border:none;border-radius:3px}input[type=color][_ngcontent-%COMP%]::-moz-color-swatch{border:none;border-radius:3px}`]})};var po=()=>["radio","checkbox","temperatura","file"],go=()=>["text","email","tel","number","date","time","cnpj","cpf"],ho=()=>["Quente","Morno","Frio"];function fo(o,t){if(o&1){let e=C();r(0,"div",16),h("click",function(){let n=f(e).$implicit,s=u();return _(s.selectFieldType(n.value))}),r(1,"div",17)(2,"div",18),g(3,"i",19),a(),r(4,"div")(5,"div",20),d(6),a(),r(7,"div",21),d(8),a()()()()}if(o&2){let e=t.$implicit,i=u();P("selected",i.selectedFieldType===e.value),l(3),re(i.getFieldTypeIcon(e.value)),l(3),E(e.label),l(2),E(i.getFieldTypeDescription(e.value))}}function _o(o,t){if(o&1&&(r(0,"div")(1,"label",23),d(2," Placeholder "),a(),g(3,"input",38),a()),o&2){let e=u(2);l(3),c("placeholder",e.getPlaceholderExample(e.selectedFieldType))}}function bo(o,t){if(o&1){let e=C();r(0,"div")(1,"label",23),d(2," Configura\xE7\xF5es do Arquivo "),a(),r(3,"label",30)(4,"input",39),h("change",function(n){f(e);let s=u(2);return _(s.fieldsForm.patchValue({placeholder:n.target.checked?"multiple":""}))}),a(),r(5,"span",32),d(6,"Permitir m\xFAltiplos arquivos"),a()()()}if(o&2){let e,i=u(2);l(4),c("checked",((e=i.fieldsForm.get("placeholder"))==null?null:e.value)==="multiple")}}function vo(o,t){o&1&&(r(0,"div")(1,"label",23),d(2," Op\xE7\xF5es * "),a(),g(3,"textarea",40),r(4,"div",41),d(5,"Uma op\xE7\xE3o por linha"),a()())}function xo(o,t){o&1&&(r(0,"div",42)(1,"div",43),g(2,"i",44),r(3,"div",45)(4,"strong"),d(5,"Campo Temperatura:"),a(),g(6,"br"),d(7," Este campo criar\xE1 automaticamente uma lista suspensa com: "),r(8,"ul",46)(9,"li"),d(10,"\u{1F525} "),r(11,"strong"),d(12,"Quente"),a(),d(13," - Para leads com alta probabilidade"),a(),r(14,"li"),d(15,"\u{1F324}\uFE0F "),r(16,"strong"),d(17,"Morno"),a(),d(18," - Para leads com m\xE9dia probabilidade"),a(),r(19,"li"),d(20,"\u2744\uFE0F "),r(21,"strong"),d(22,"Frio"),a(),d(23," - Para leads com baixa probabilidade"),a()()()()())}function yo(o,t){o&1&&(r(0,"div")(1,"label",23),d(2," Nome na API (opcional) "),a(),g(3,"input",47),r(4,"div",41),d(5,"Deixe vazio para usar o nome do campo"),a()())}function Co(o,t){if(o&1){let e=C();r(0,"button",48),h("click",function(){f(e);let n=u(2);return _(n.cancelEdit())}),d(1," Cancelar "),a()}}function wo(o,t){if(o&1){let e=C();r(0,"form",22)(1,"div")(2,"label",23),d(3," Nome do Campo * "),a(),g(4,"input",24),a(),r(5,"div")(6,"label",23),d(7," R\xF3tulo do Campo * "),a(),g(8,"input",25),a(),b(9,_o,4,1,"div",26)(10,bo,7,1,"div",26)(11,vo,6,0,"div",26)(12,xo,24,0,"div",27),r(13,"div",28)(14,"h4",29),d(15,"Valida\xE7\xF5es"),a(),r(16,"label",30),g(17,"input",31),r(18,"span",32),d(19,"Campo obrigat\xF3rio"),a()()(),r(20,"div",28)(21,"h4",29),d(22,"Integra\xE7\xE3o API"),a(),r(23,"label",30),g(24,"input",33),r(25,"span",32),d(26,"Incluir este campo na API"),a()(),r(27,"label",30),g(28,"input",34),r(29,"span",32),d(30,"Exibir no card do registro"),a()(),b(31,yo,6,0,"div",26),a(),r(32,"div",35)(33,"button",36),h("click",function(){f(e);let n=u();return _(n.addField())}),d(34),a(),b(35,Co,2,0,"button",37),a()()}if(o&2){let e,i=u();c("formGroup",i.fieldsForm),l(9),c("ngIf",!W(11,po).includes(i.selectedFieldType)),l(),c("ngIf",i.selectedFieldType==="file"),l(),c("ngIf",i.selectedFieldType==="select"||i.selectedFieldType==="radio"),l(),c("ngIf",i.selectedFieldType==="temperatura"),l(19),c("ngIf",(e=i.fieldsForm.get("includeInApi"))==null?null:e.value),l(2),$("background-color",i.getPrimaryColor()),c("disabled",i.fieldsForm.invalid),l(),y(" ",i.editingIndex>=0?"Atualizar Campo":"Adicionar Campo"," "),l(),c("ngIf",i.editingIndex>=0)}}function So(o,t){o&1&&(r(0,"div",49),g(1,"i",50),r(2,"p",51),d(3,"Selecione um tipo de campo \xE0 esquerda para come\xE7ar"),a()())}function Eo(o,t){if(o&1){let e=C();r(0,"button",59),h("click",function(){f(e);let n=u(2);return _(n.showApiSchema())}),g(1,"i",60),r(2,"span"),d(3,"API"),a()()}}function Io(o,t){o&1&&(r(0,"span",74),d(1,"*"),a())}function Po(o,t){o&1&&(r(0,"span",75),g(1,"i",76),a())}function Mo(o,t){if(o&1){let e=C();r(0,"div",61)(1,"div",62)(2,"div",63),g(3,"i",64),a(),g(4,"i",65),r(5,"span",66),d(6),a(),b(7,Io,2,0,"span",67)(8,Po,2,0,"span",68),a(),r(9,"div",69)(10,"button",70),h("click",function(){let n=f(e).index,s=u(2);return _(s.editField(n))}),g(11,"i",71),a(),r(12,"button",72),h("click",function(){let n=f(e).index,s=u(2);return _(s.removeField(n))}),g(13,"i",73),a()()()}if(o&2){let e=t.$implicit,i=u(2);l(4),re(i.getFieldTypeIcon(e.type)),l(2),E(e.label),l(),c("ngIf",e.required),l(),c("ngIf",e.includeInApi!==!1)}}function Do(o,t){if(o&1){let e=C();r(0,"div",52)(1,"div",53)(2,"div",54)(3,"div",55),d(4),a(),b(5,Eo,4,0,"button",56),a(),r(6,"div",57),h("cdkDropListDropped",function(n){f(e);let s=u();return _(s.onDrop(n))}),b(7,Mo,14,5,"div",58),a()()()}if(o&2){let e=u();l(4),y(" Campos (",e.fields.length,") "),l(),c("ngIf",e.fields.length>0),l(2),c("ngForOf",e.fields)}}function To(o,t){o&1&&(r(0,"div",77)(1,"div",78),g(2,"i",79),a(),r(3,"h4",80),d(4,"Formul\xE1rio Vazio"),a(),r(5,"p",81),d(6,"Adicione campos \xE0 esquerda para ver a visualiza\xE7\xE3o aqui"),a()())}function ko(o,t){o&1&&(r(0,"span",95),d(1,"*"),a())}function Fo(o,t){if(o&1&&g(0,"input",96),o&2){let e=u().$implicit,i=u(2);c("type",e.type==="cnpj"||e.type==="cpf"?"text":e.type)("placeholder",e.placeholder||i.getPlaceholderExample(e.type))("required",e.required)}}function Oo(o,t){if(o&1&&(r(0,"textarea",97),d(1,"              "),a()),o&2){let e=u().$implicit;c("placeholder",e.placeholder||"")("required",e.required)}}function Ao(o,t){if(o&1&&(r(0,"option",101),d(1),a()),o&2){let e=t.$implicit;c("value",e),l(),y(" ",e," ")}}function Lo(o,t){if(o&1&&(r(0,"select",98)(1,"option",99),d(2,"Selecione uma op\xE7\xE3o"),a(),b(3,Ao,2,2,"option",100),a()),o&2){let e=u().$implicit;c("required",e.required),l(3),c("ngForOf",e.options)}}function Ro(o,t){o&1&&(r(0,"span"),d(1,"\u{1F525}"),a())}function Vo(o,t){o&1&&(r(0,"span"),d(1,"\u{1F324}\uFE0F"),a())}function No(o,t){o&1&&(r(0,"span"),d(1,"\u2744\uFE0F"),a())}function Bo(o,t){if(o&1&&(r(0,"option",101),d(1),b(2,Ro,2,0,"span",26)(3,Vo,2,0,"span",26)(4,No,2,0,"span",26),a()),o&2){let e=t.$implicit;c("value",e),l(),y(" \u{1F321}\uFE0F ",e," "),l(),c("ngIf",e==="Quente"),l(),c("ngIf",e==="Morno"),l(),c("ngIf",e==="Frio")}}function zo(o,t){if(o&1&&(r(0,"select",98)(1,"option",99),d(2,"Selecione a temperatura"),a(),b(3,Bo,5,5,"option",100),a()),o&2){let e=u().$implicit;c("required",e.required),l(3),c("ngForOf",e.options||W(2,ho))}}function $o(o,t){if(o&1&&(r(0,"label",104),g(1,"input",105),r(2,"span",106),d(3),a()()),o&2){let e=t.$implicit,i=u(2).$implicit;l(),c("name",i.name+"_preview")("value",e)("required",i.required),l(2),E(e)}}function jo(o,t){if(o&1&&(r(0,"div",102),b(1,$o,4,4,"label",103),a()),o&2){let e=u().$implicit;l(),c("ngForOf",e.options)}}function Ho(o,t){if(o&1&&(r(0,"label",104),g(1,"input",107),r(2,"span",106),d(3),a()()),o&2){let e=u().$implicit;l(),c("required",e.required),l(2),E(e.placeholder||"Aceitar termos")}}function Uo(o,t){if(o&1&&(r(0,"div"),g(1,"input",108),r(2,"div",41),d(3),a()()),o&2){let e=u().$implicit;l(),c("multiple",e.placeholder==="multiple")("required",e.required),l(2),y(" ",e.placeholder==="multiple"?"M\xFAltiplos arquivos permitidos":"Upload de arquivo"," ")}}function qo(o,t){if(o&1){let e=C();r(0,"div",87),h("click",function(){let n=f(e),s=n.$implicit,m=n.index,p=u(2);return _(p.selectField(s,m))}),r(1,"label",88),d(2),b(3,ko,2,0,"span",89),a(),b(4,Fo,1,3,"input",90)(5,Oo,2,2,"textarea",91)(6,Lo,4,2,"select",92)(7,zo,4,3,"select",92)(8,jo,2,1,"div",93)(9,Ho,4,2,"label",94)(10,Uo,4,3,"div",26),a()}if(o&2){let e=t.$implicit,i=u(2);P("bg-blue-50",i.selectedField===e)("border-blue-200",i.selectedField===e)("border",i.selectedField===e)("p-3",i.selectedField===e)("rounded",i.selectedField===e),l(2),y(" ",e.label," "),l(),c("ngIf",e.required),l(),c("ngIf",W(19,go).includes(e.type)),l(),c("ngIf",e.type==="textarea"),l(),c("ngIf",e.type==="select"),l(),c("ngIf",e.type==="temperatura"),l(),c("ngIf",e.type==="radio"),l(),c("ngIf",e.type==="checkbox"),l(),c("ngIf",e.type==="file")}}function Go(o,t){if(o&1&&(r(0,"div",82)(1,"div",83)(2,"h4",84),d(3,"Pr\xE9-visualiza\xE7\xE3o"),a(),r(4,"form",85),b(5,qo,11,20,"div",86),a()()()),o&2){let e=u();l(5),c("ngForOf",e.fields)}}var _t=class o{fields=[];fieldsChanged=new I;fb=x(te);subdomainService=x(de);fieldsForm;editingField=null;editingIndex=-1;selectedFieldType="";selectedField=null;fieldTypes=[{value:"text",label:"Texto"},{value:"email",label:"E-mail"},{value:"tel",label:"Telefone"},{value:"number",label:"N\xFAmero"},{value:"cnpj",label:"CNPJ"},{value:"cpf",label:"CPF"},{value:"temperatura",label:"Temperatura"},{value:"textarea",label:"\xC1rea de Texto"},{value:"select",label:"Lista Suspensa"},{value:"checkbox",label:"Checkbox"},{value:"radio",label:"Bot\xE3o de R\xE1dio"},{value:"date",label:"Data"},{value:"time",label:"Hora"},{value:"file",label:"Upload de Arquivo"}];constructor(){this.fieldsForm=this.fb.group({name:["",A.required],label:["",A.required],type:["text",A.required],required:[!1],placeholder:[""],options:[""],includeInApi:[!0],apiFieldName:[""],showInCard:[!1]})}ngOnInit(){this.fields&&this.fields.length>0&&this.emitFieldsChange()}removeField(t){confirm("Tem certeza que deseja remover este campo?")&&(this.fields.splice(t,1),this.selectedField===this.fields[t]&&(this.selectedField=null,this.selectedFieldType=""),this.emitFieldsChange())}moveFieldUp(t){if(t>0){let e=this.fields[t];this.fields[t]=this.fields[t-1],this.fields[t-1]=e,this.updateFieldOrders(),this.emitFieldsChange()}}moveFieldDown(t){if(t<this.fields.length-1){let e=this.fields[t];this.fields[t]=this.fields[t+1],this.fields[t+1]=e,this.updateFieldOrders(),this.emitFieldsChange()}}onDrop(t){De(this.fields,t.previousIndex,t.currentIndex),this.updateFieldOrders(),this.emitFieldsChange()}resetForm(){this.fieldsForm.reset({type:"text",required:!1})}updateFieldOrders(){this.fields.forEach((t,e)=>{t.order=e})}emitFieldsChange(){this.fieldsChanged.emit([...this.fields])}getFieldTypeLabel(t){let e=this.fieldTypes.find(i=>i.value===t);return e?e.label:t}selectFieldType(t){if(this.selectedFieldType=t,this.fieldsForm.patchValue({type:t}),!this.fieldsForm.get("name")?.value){let e=t+(this.fields.length+1);this.fieldsForm.patchValue({name:e})}}selectField(t,e){this.selectedField=t,this.editField(e)}getFieldTypeIcon(t){return{text:"fas fa-font",email:"fas fa-envelope",tel:"fas fa-phone",number:"fas fa-hashtag",cnpj:"fas fa-building",cpf:"fas fa-id-card",temperatura:"fas fa-thermometer-half",textarea:"fas fa-align-left",select:"fas fa-list",checkbox:"fas fa-check-square",radio:"fas fa-dot-circle",date:"fas fa-calendar",time:"fas fa-clock",file:"fas fa-upload"}[t]||"fas fa-question"}getFieldTypeDescription(t){return{text:"Campo de texto simples",email:"Campo de e-mail com valida\xE7\xE3o",tel:"Telefone com m\xE1scara DDD Brasil",number:"Campo num\xE9rico",cnpj:"CNPJ com m\xE1scara e valida\xE7\xE3o",cpf:"CPF com m\xE1scara e valida\xE7\xE3o",temperatura:"Lista suspensa (Quente, Morno, Frio)",textarea:"\xC1rea de texto multilinha",select:"Lista suspensa",checkbox:"Caixa de sele\xE7\xE3o",radio:"Bot\xF5es de sele\xE7\xE3o \xFAnica",date:"Seletor de data",time:"Seletor de hora",file:"Upload de arquivos"}[t]||"Campo personalizado"}addField(){let t=this.fieldsForm.value;if(!t.name||!t.label){alert("Nome e r\xF3tulo s\xE3o obrigat\xF3rios");return}if(this.fields.some(i=>i.name===t.name&&this.editingIndex===-1)){alert("J\xE1 existe um campo com este nome");return}let e=F(F({name:t.name,label:t.label,type:t.type||this.selectedFieldType,required:t.required||!1,order:this.editingIndex>=0?this.fields[this.editingIndex].order:this.fields.length,includeInApi:t.includeInApi!==!1,showInCard:t.showInCard||!1},t.placeholder&&t.placeholder.trim()&&{placeholder:t.placeholder.trim()}),t.apiFieldName&&t.apiFieldName.trim()&&{apiFieldName:t.apiFieldName.trim()});(e.type==="select"||e.type==="radio")&&t.options&&(e.options=t.options.split(`
`).map(i=>i.trim()).filter(i=>i)),e.type==="temperatura"&&(e.options=["Quente","Morno","Frio"]),this.editingIndex>=0?(this.fields[this.editingIndex]=e,this.editingIndex=-1,this.selectedField=null):this.fields.push(e),this.resetForm(),this.emitFieldsChange()}editField(t){let e=this.fields[t];this.editingIndex=t,this.editingField=F({},e),this.selectedFieldType=e.type,this.selectedField=e,this.fieldsForm.patchValue({name:e.name,label:e.label,type:e.type,required:e.required,placeholder:e.placeholder||"",options:e.options?e.options.join(`
`):"",includeInApi:e.includeInApi!==!1,apiFieldName:e.apiFieldName||"",showInCard:e.showInCard||!1})}cancelEdit(){this.editingIndex=-1,this.editingField=null,this.selectedField=null,this.selectedFieldType="",this.resetForm()}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}getPlaceholderExample(t){return{text:"Ex: Digite seu nome",email:"Ex: usuario@exemplo.com",tel:"Ex: (11) 99999-9999",number:"Ex: 123",cnpj:"Ex: 00.000.000/0000-00",cpf:"Ex: 000.000.000-00",textarea:"Ex: Digite suas observa\xE7\xF5es...",date:"",time:""}[t]||"Ex: Digite aqui"}generateApiSchema(){let t=this.fields.filter(i=>i.includeInApi!==!1);return{fields:t.map(i=>F({name:i.apiFieldName||i.name,originalName:i.name,label:i.label,type:this.mapFieldTypeForApi(i.type),required:i.required,validation:this.getValidationRules(i)},i.options&&{options:i.options})),totalFields:t.length,generatedAt:new Date().toISOString()}}mapFieldTypeForApi(t){return{text:"string",email:"email",tel:"phone",number:"number",cnpj:"cnpj",cpf:"cpf",temperatura:"enum",textarea:"text",select:"enum",checkbox:"boolean",radio:"enum",date:"date",time:"time",file:"file"}[t]||"string"}getValidationRules(t){let e={};switch(t.required&&(e.required=!0),t.type){case"email":e.format="email";break;case"cnpj":e.format="cnpj",e.mask="00.000.000/0000-00";break;case"cpf":e.format="cpf",e.mask="000.000.000-00";break;case"tel":e.format="phone",e.mask="(00) 00000-0000";break;case"temperatura":case"select":case"radio":t.options&&(e.enum=t.options);break;case"file":e.type="file",t.placeholder==="multiple"&&(e.multiple=!0);break}return e}showApiSchema(){let t=this.generateApiSchema(),e=JSON.stringify(t,null,2);console.log("\u{1F4CB} Schema da API gerado:",t),console.log("\u{1F4CB} JSON Schema:",e);let i=`
\u{1F4CB} Schema da API - Resumo:

\u2705 Campos na API: ${t.totalFields}/${this.fields.length}
\u{1F4C5} Gerado em: ${new Date().toLocaleString("pt-BR")}

\u{1F517} Campos inclu\xEDdos na API:
${t.fields.map(n=>`\u2022 ${n.label} (${n.name}) - Tipo: ${n.type}${n.required?" *":""}`).join(`
`)}

\u{1F4CB} Schema completo salvo no console para c\xF3pia.
    `;alert(i)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-visual-form-builder"]],inputs:{fields:"fields"},outputs:{fieldsChanged:"fieldsChanged"},decls:22,vars:7,consts:[[1,"form-builder","h-full","flex","bg-gray-50"],[1,"w-64","bg-white","border-r","border-gray-200","flex","flex-col"],[1,"p-4","border-b","border-gray-200"],[1,"text-sm","font-semibold","text-gray-900","uppercase","tracking-wide"],[1,"flex-1","p-3","space-y-2","overflow-y-auto"],["class","field-type-item p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors",3,"selected","click",4,"ngFor","ngForOf"],[1,"w-80","bg-white","border-r","border-gray-200","flex","flex-col"],[1,"flex-1","p-4","overflow-y-auto"],["class","space-y-4",3,"formGroup",4,"ngIf"],["class","text-center py-8",4,"ngIf"],[1,"flex-1","bg-gray-50","flex","flex-col"],[1,"p-4","bg-white","border-b","border-gray-200"],["class","bg-white border-b border-gray-200 flex-shrink-0",4,"ngIf"],[1,"flex-1","p-6","overflow-y-auto"],["class","text-center py-16",4,"ngIf"],["class","max-w-2xl mx-auto",4,"ngIf"],[1,"field-type-item","p-3","border","border-gray-300","rounded-lg","cursor-pointer","hover:border-blue-400","hover:bg-blue-50","transition-colors",3,"click"],[1,"flex","items-center","space-x-3"],[1,"w-8","h-8","bg-gray-100","rounded-md","flex","items-center","justify-center"],[1,"text-gray-600","text-sm"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"space-y-4",3,"formGroup"],[1,"block","text-xs","font-medium","text-gray-700","mb-2","uppercase","tracking-wide"],["type","text","formControlName","name","placeholder","Ex: nomeCompleto",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["type","text","formControlName","label","placeholder","Ex: Nome Completo",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],[4,"ngIf"],["class","p-3 bg-blue-50 border border-blue-200 rounded-md",4,"ngIf"],[1,"space-y-3"],[1,"text-xs","font-medium","text-gray-700","uppercase","tracking-wide"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","required",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],[1,"text-sm","text-gray-700"],["type","checkbox","formControlName","includeInApi",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],["type","checkbox","formControlName","showInCard",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],[1,"pt-4","border-t","border-gray-200","space-y-3"],["type","button",1,"w-full","px-4","py-2","text-white","text-sm","rounded-lg","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["type","button","class","w-full px-4 py-2 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50 transition-colors",3,"click",4,"ngIf"],["type","text","formControlName","placeholder",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"placeholder"],["type","checkbox",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"change","checked"],["formControlName","options","rows","4","placeholder",`Digite uma op\xE7\xE3o por linha:
Op\xE7\xE3o 1
Op\xE7\xE3o 2
Op\xE7\xE3o 3`,1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],[1,"text-xs","text-gray-500","mt-1"],[1,"p-3","bg-blue-50","border","border-blue-200","rounded-md"],[1,"flex","items-start"],[1,"fas","fa-info-circle","text-blue-500","mr-2","mt-0.5"],[1,"text-sm","text-blue-700"],[1,"mt-2","space-y-1"],["type","text","formControlName","apiFieldName","placeholder","Se vazio, usar\xE1 o nome do campo",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["type","button",1,"w-full","px-4","py-2","border","border-gray-300","text-gray-700","text-sm","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-center","py-8"],[1,"fas","fa-mouse-pointer","text-gray-300","text-3xl","mb-3"],[1,"text-sm","text-gray-500"],[1,"bg-white","border-b","border-gray-200","flex-shrink-0"],[1,"px-4","py-2"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","text-gray-500","uppercase","tracking-wide"],["class","text-xs text-blue-500 hover:text-blue-700 flex items-center space-x-1","title","Ver Schema da API",3,"click",4,"ngIf"],["cdkDropList","",1,"space-y-1","max-h-32","overflow-y-auto",3,"cdkDropListDropped"],["cdkDrag","","class","field-item flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded text-xs hover:bg-gray-100 transition-colors",4,"ngFor","ngForOf"],["title","Ver Schema da API",1,"text-xs","text-blue-500","hover:text-blue-700","flex","items-center","space-x-1",3,"click"],[1,"fas","fa-code"],["cdkDrag","",1,"field-item","flex","items-center","justify-between","p-2","bg-gray-50","border","border-gray-200","rounded","text-xs","hover:bg-gray-100","transition-colors"],[1,"flex","items-center","space-x-2","flex-1"],["cdkDragHandle","",1,"cursor-move","text-gray-400"],[1,"fas","fa-grip-vertical"],[1,"text-gray-500"],[1,"font-medium","text-gray-900","truncate"],["class","text-red-500 text-xs",4,"ngIf"],["class","text-blue-500 text-xs","title","Inclu\xEDdo na API",4,"ngIf"],[1,"flex","items-center","space-x-1","flex-shrink-0"],["title","Editar",1,"p-1","text-gray-400","hover:text-blue-500",3,"click"],[1,"fas","fa-edit"],["title","Remover",1,"p-1","text-gray-400","hover:text-red-500",3,"click"],[1,"fas","fa-trash"],[1,"text-red-500","text-xs"],["title","Inclu\xEDdo na API",1,"text-blue-500","text-xs"],[1,"fas","fa-plug"],[1,"text-center","py-16"],[1,"w-16","h-16","bg-gray-200","rounded-full","mx-auto","mb-4","flex","items-center","justify-center"],[1,"fas","fa-wpforms","text-gray-400","text-2xl"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],[1,"max-w-2xl","mx-auto"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-6"],[1,"space-y-6"],["class","form-field",3,"bg-blue-50","border-blue-200","border","p-3","rounded","click",4,"ngFor","ngForOf"],[1,"form-field",3,"click"],[1,"block","text-sm","font-medium","text-gray-900","mb-2"],["class","text-red-500 ml-1",4,"ngIf"],["disabled","","class","w-full px-3 py-2 border border-gray-300 rounded-md text-gray-500 bg-gray-50",3,"type","placeholder","required",4,"ngIf"],["disabled","","rows","3","class","w-full px-3 py-2 border border-gray-300 rounded-md resize-none text-gray-500 bg-gray-50",3,"placeholder","required",4,"ngIf"],["disabled","","class","w-full px-3 py-2 border border-gray-300 rounded-md text-gray-500 bg-gray-50",3,"required",4,"ngIf"],["class","space-y-2",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"text-red-500","ml-1"],["disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"type","placeholder","required"],["disabled","","rows","3",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","resize-none","text-gray-500","bg-gray-50",3,"placeholder","required"],["disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"required"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"space-y-2"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["type","radio","disabled","",1,"mr-2","text-gray-400",3,"name","value","required"],[1,"text-gray-700"],["type","checkbox","disabled","",1,"mr-2","text-gray-400",3,"required"],["type","file","disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"multiple","required"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),d(4,"Tipos de Campo"),a()(),r(5,"div",4),b(6,fo,9,6,"div",5),a()(),r(7,"div",6)(8,"div",2)(9,"h3",3),d(10),a()(),r(11,"div",7),b(12,wo,36,12,"form",8)(13,So,4,0,"div",9),a()(),r(14,"div",10)(15,"div",11)(16,"h3",3),d(17," Visualiza\xE7\xE3o do Formul\xE1rio "),a()(),b(18,Do,8,3,"div",12),r(19,"div",13),b(20,To,7,0,"div",14)(21,Go,6,1,"div",15),a()()()),e&2&&(l(6),c("ngForOf",i.fieldTypes),l(4),y(" ",i.selectedField?"Propriedades do Campo":"Configura\xE7\xF5es"," "),l(2),c("ngIf",i.selectedFieldType),l(),c("ngIf",!i.selectedFieldType),l(5),c("ngIf",i.fields.length>0),l(2),c("ngIf",i.fields.length===0),l(),c("ngIf",i.fields.length>0))},dependencies:[O,R,j,H,J,ae,se,Q,Ie,Z,Y,X,ee,ht,gt,pt,ln],styles:[".form-builder[_ngcontent-%COMP%]{height:600px}.form-builder[_ngcontent-%COMP%]   .field-type-item[_ngcontent-%COMP%]{transition:all .2s ease}.form-builder[_ngcontent-%COMP%]   .field-type-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}.form-builder[_ngcontent-%COMP%]   .field-type-item.selected[_ngcontent-%COMP%]{border-color:#3b82f6;background-color:#ebf4ff;box-shadow:0 0 0 3px #3b82f61a}.form-builder[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]{transition:all .2s ease}.form-builder[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;border-color:#d1d5db}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{transition:all .2s ease;cursor:pointer}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]:hover{background-color:#3b82f605}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled, .form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{cursor:pointer}.form-builder[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:6px;box-shadow:0 10px 25px #00000026;background:#fff;transform:rotate(5deg)}.form-builder[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#e5e7eb;border:2px dashed #9CA3AF}.form-builder[_ngcontent-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.form-builder[_ngcontent-%COMP%]   .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.form-builder[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]{transition:color .2s ease}.form-builder[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]:hover{color:#3b82f6!important}.form-builder[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{background:linear-gradient(to right,#f9fafb,#f3f4f6)}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:2px}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}button[_ngcontent-%COMP%]{transition:all .2s ease}button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.selected-field[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-blue 2s infinite}@keyframes _ngcontent-%COMP%_pulse-blue{0%,to{box-shadow:0 0 #3b82f666}50%{box-shadow:0 0 0 8px #3b82f600}}@media (max-width: 1024px){.form-builder[_ngcontent-%COMP%]   .w-64[_ngcontent-%COMP%]{width:200px}.form-builder[_ngcontent-%COMP%]   .w-80[_ngcontent-%COMP%]{width:240px}}@media (max-width: 768px){.form-builder[_ngcontent-%COMP%]{flex-direction:column;height:auto}.form-builder[_ngcontent-%COMP%]   .w-64[_ngcontent-%COMP%], .form-builder[_ngcontent-%COMP%]   .w-80[_ngcontent-%COMP%]{width:100%;max-height:300px}}"]})};var Ko=["formBuilder"],Ue=class o{firestoreService=x(V);subdomainService=x(de);ownerId="";boardId="";formConfigSaved=new I;closeModal=new I;formBuilderComponent;isVisible=!1;isSaving=!1;currentColumn=null;currentConfig=null;formFields=[];showModal(t,e){this.currentColumn=t,this.currentConfig=e,this.isVisible=!0,e&&e.fields?this.formFields=e.fields.map(i=>(i.type==="temperatura"&&(!i.options||i.options.length===0)&&(i.options=["Quente","Morno","Frio"]),oe(F({},i),{includeInApi:i.includeInApi!==!1,showInCard:i.showInCard||!1,order:i.order||0}))).sort((i,n)=>(i.order||0)-(n.order||0)):this.formFields=[{name:"companyName",label:"Nome da Empresa",type:"text",required:!0,order:0},{name:"cnpj",label:"CNPJ",type:"text",required:!0,order:1},{name:"contactName",label:"Nome do Contato",type:"text",required:!0,order:2},{name:"phone",label:"Telefone",type:"tel",required:!0,order:3},{name:"email",label:"E-mail",type:"email",required:!0,order:4},{name:"segmentOrService",label:"Segmento/Servi\xE7o",type:"text",required:!1,order:5},{name:"description",label:"Observa\xE7\xF5es",type:"textarea",required:!1,order:6}]}onFieldsChanged(t){this.formFields=t}saveFormConfig(){return S(this,null,function*(){if(!this.currentColumn||!this.ownerId||!this.boardId){console.error("Dados necess\xE1rios n\xE3o fornecidos");return}this.isSaving=!0;try{let t={columnId:this.currentColumn.id,columnName:this.currentColumn.name,fields:this.formFields.map((e,i)=>{let n={name:e.name||"",label:e.label||"",type:e.type||"text",required:e.required||!1,order:i,includeInApi:e.includeInApi!==!1,showInCard:e.showInCard||!1};return e.placeholder&&e.placeholder.trim()&&(n.placeholder=e.placeholder.trim()),e.apiFieldName&&e.apiFieldName.trim()&&(n.apiFieldName=e.apiFieldName.trim()),e.options&&Array.isArray(e.options)&&e.options.length>0&&(n.options=e.options),e.type==="temperatura"&&(!e.options||e.options.length===0)&&(n.options=["Quente","Morno","Frio"]),n}),createdAt:this.currentConfig?this.currentConfig.createdAt:new Date,updatedAt:new Date};this.currentConfig&&this.currentConfig.id?yield this.firestoreService.updatePhaseFormConfig(this.ownerId,this.boardId,this.currentConfig.id,t):yield this.firestoreService.createPhaseFormConfig(this.ownerId,this.boardId,t),console.log("\u2705 Configura\xE7\xE3o do formul\xE1rio salva com sucesso"),this.formConfigSaved.emit(),this.hideModal()}catch(t){console.error("\u274C Erro ao salvar configura\xE7\xE3o do formul\xE1rio:",t),alert("Erro ao salvar configura\xE7\xE3o. Tente novamente.")}finally{this.isSaving=!1}})}hideModal(){this.isVisible=!1,this.currentColumn=null,this.currentConfig=null,this.formFields=[]}onCloseModal(){this.hideModal(),this.closeModal.emit()}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-phase-form-modal"]],viewQuery:function(e,i){if(e&1&&U(Ko,5),e&2){let n;q(n=G())&&(i.formBuilderComponent=n.first)}},inputs:{ownerId:"ownerId",boardId:"boardId"},outputs:{formConfigSaved:"formConfigSaved",closeModal:"closeModal"},decls:14,vars:8,consts:[["formBuilder",""],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-white","rounded-lg","p-6","w-full","max-w-7xl","max-h-[95vh]","overflow-hidden",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"fas","fa-times","text-xl"],[3,"fieldsChanged","fields"],[1,"flex","justify-end","space-x-3","mt-6","pt-4","border-t"],["type","button",1,"px-4","py-2","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,i){if(e&1){let n=C();r(0,"div",1),h("click",function(){return f(n),_(i.onCloseModal())}),r(1,"div",2),h("click",function(m){return f(n),_(m.stopPropagation())}),r(2,"div",3)(3,"h2",4),d(4),a(),r(5,"button",5),h("click",function(){return f(n),_(i.onCloseModal())}),g(6,"i",6),a()(),r(7,"app-visual-form-builder",7,0),h("fieldsChanged",function(m){return f(n),_(i.onFieldsChanged(m))}),a(),r(9,"div",8)(10,"button",9),h("click",function(){return f(n),_(i.onCloseModal())}),d(11," Cancelar "),a(),r(12,"button",10),h("click",function(){return f(n),_(i.saveFormConfig())}),d(13),a()()()()}e&2&&(P("hidden",!i.isVisible),l(4),y(" Configurar Formul\xE1rio da Fase: ",i.currentColumn==null?null:i.currentColumn.name," "),l(3),c("fields",i.formFields),l(5),$("background-color",i.getPrimaryColor()),c("disabled",i.isSaving),l(),y(" ",i.isSaving?"Salvando...":"Salvar Configura\xE7\xE3o"," "))},dependencies:[O,H,_t],styles:["[_nghost-%COMP%]{display:block}"]})};function Wo(o,t){if(o&1&&(r(0,"div",12)(1,"strong",13),d(2),a(),r(3,"span",14),d(4),a()()),o&2){let e=t.$implicit;l(2),y("",e.label,":"),l(2),E(e.value)}}function Qo(o,t){if(o&1&&(r(0,"div",53),d(1),a()),o&2){let e=u().$implicit;l(),y("Sa\xEDda: ",e.exitedAt)}}function Zo(o,t){if(o&1&&(r(0,"div",51)(1,"div",52),d(2),a(),r(3,"div",53),d(4),a(),b(5,Qo,2,1,"div",54),r(6,"div",53),d(7),a()()),o&2){let e=t.$implicit;$("border-left-color",e.phaseColor),l(2),E(e.phaseName),l(2),y("Entrada: ",e.enteredAt),l(),c("ngIf",e.exitedAt!=="Atual"),l(2),y("Dura\xE7\xE3o: ",e.duration)}}function Yo(o,t){if(o&1&&(r(0,"div",62)(1,"a",63),g(2,"i",64),d(3),a()()),o&2){let e=u().$implicit;l(),c("href",e.attachment.url,Xe),l(2),y(" ",e.attachment.name," ")}}function Jo(o,t){if(o&1&&(r(0,"div",55)(1,"div",56),g(2,"i",57),r(3,"span",58),d(4),a(),r(5,"span",59),d(6),a()(),g(7,"div",60),b(8,Yo,4,2,"div",61),a()),o&2){let e=t.$implicit,i=u(2);l(2),re(i.getActivityIcon(e.type)),l(2),E(e.user),l(2),E(i.formatDateTime(e.timestamp)),l(),c("innerHTML",e.text,Je),l(),c("ngIf",e.attachment)}}function Xo(o,t){if(o&1&&(r(0,"option",65),d(1),a()),o&2){let e=t.$implicit;c("value",e.uid),l(),y(" ",e.displayName||e.email," ")}}function er(o,t){o&1&&(r(0,"span",72),d(1,"*"),a())}function tr(o,t){if(o&1&&g(0,"input",73),o&2){let e=u().$implicit;c("type",e.type)("formControlName",e.name)("placeholder",e.placeholder||"")}}function ir(o,t){if(o&1&&(r(0,"textarea",74),d(1,"                "),a()),o&2){let e=u().$implicit;c("formControlName",e.name)("placeholder",e.placeholder||"")}}function nr(o,t){if(o&1&&g(0,"input",75),o&2){let e=u().$implicit;c("formControlName",e.name)("placeholder",e.placeholder||"")}}function or(o,t){if(o&1&&g(0,"input",76),o&2){let e=u().$implicit;c("formControlName",e.name)}}function rr(o,t){if(o&1&&(r(0,"option",65),d(1),a()),o&2){let e=t.$implicit;c("value",e),l(),E(e)}}function ar(o,t){if(o&1&&(r(0,"select",77)(1,"option",25),d(2,"Selecione..."),a(),b(3,rr,2,2,"option",26),a()),o&2){let e=u().$implicit;c("formControlName",e.name),l(3),c("ngForOf",e.options)}}function sr(o,t){if(o&1&&(li(0),r(1,"div",22)(2,"label",23),d(3),b(4,er,2,0,"span",66),a(),b(5,tr,1,3,"input",67)(6,ir,2,2,"textarea",68)(7,nr,1,2,"input",69)(8,or,1,1,"input",70)(9,ar,4,2,"select",71),a(),di()),o&2){let e=t.$implicit;l(3),y(" ",e.label," "),l(),c("ngIf",e.required),l(),c("ngIf",e.type==="text"||e.type==="email"||e.type==="tel"||e.type==="url"),l(),c("ngIf",e.type==="textarea"),l(),c("ngIf",e.type==="number"),l(),c("ngIf",e.type==="date"),l(),c("ngIf",e.type==="select")}}function lr(o,t){if(o&1){let e=C();r(0,"div",78)(1,"span"),d(2),a(),r(3,"button",79),h("click",function(){f(e);let n=u(2);return _(n.clearAttachment())}),g(4,"i",80),a()()}if(o&2){let e=u(2);l(2),E(e.attachmentPreview)}}function dr(o,t){o&1&&g(0,"div",81)}function cr(o,t){if(o&1){let e=C();r(0,"button",86),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.moveLead(n.id))}),g(1,"div",87),r(2,"span",58),d(3),a()()}if(o&2){let e=t.$implicit,i=u(3);c("disabled",i.isLoading),l(),$("background-color",e.color),l(2),E(e.name)}}function mr(o,t){if(o&1&&(r(0,"div",82)(1,"h4",83),d(2,"\u{1F680} Avan\xE7ar para:"),a(),r(3,"div",84),b(4,cr,4,4,"button",85),a()()),o&2){let e=u(2);l(4),c("ngForOf",e.getAdvancePhases())}}function ur(o,t){if(o&1){let e=C();r(0,"button",91),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.moveLead(n.id))}),g(1,"div",92),r(2,"span"),d(3),a()()}if(o&2){let e=t.$implicit,i=u(3);c("disabled",i.isLoading),l(),$("background-color",e.color),l(2),E(e.name)}}function pr(o,t){if(o&1&&(r(0,"div",82)(1,"h4",88),d(2,"\u{1F504} Retornar para:"),a(),r(3,"div",89),b(4,ur,4,4,"button",90),a()()),o&2){let e=u(2);l(4),c("ngForOf",e.getRetreatPhases())}}function gr(o,t){o&1&&(r(0,"div",93),d(1," Lead em fase final. N\xE3o \xE9 poss\xEDvel movimentar. "),a())}function hr(o,t){if(o&1){let e=C();r(0,"div",11)(1,"p",94),d(2,"Compartilhe este link para permitir edi\xE7\xE3o externa:"),a(),r(3,"div",95),g(4,"input",96),r(5,"button",97),h("click",function(){f(e);let n=u(2);return _(n.copyPublicLink())}),g(6,"i",98),a()()()}if(o&2){let e=u(2);l(4),c("value",e.publicLink)}}function fr(o,t){if(o&1&&(r(0,"div",99),d(1),a()),o&2){let e=u(2);l(),y(" ",e.errorMessage," ")}}function _r(o,t){o&1&&g(0,"div",81)}function br(o,t){if(o&1){let e=C();r(0,"div",2),h("click",function(n){f(e);let s=u();return _(s.onBackdropClick(n))}),r(1,"div",3)(2,"div",4)(3,"h2",5),d(4),a(),r(5,"button",6),h("click",function(){f(e);let n=u();return _(n.hide())}),d(6," \xD7 "),a()(),r(7,"div",7)(8,"div",8)(9,"div",9)(10,"h3",10),d(11,"Dados do Lead"),a(),r(12,"div",11)(13,"div",12)(14,"strong",13),d(15,"Respons\xE1vel:"),a(),r(16,"span",14),d(17),a()(),b(18,Wo,5,2,"div",15),a()(),r(19,"div",9)(20,"h3",10),d(21,"Hist\xF3rico de Fases"),a(),r(22,"div",16),b(23,Zo,8,6,"div",17),a()(),r(24,"div")(25,"h3",10),d(26,"Atividades Recentes"),a(),r(27,"div",18),b(28,Jo,9,6,"div",19),a()()(),r(29,"div",20)(30,"div",9)(31,"h3",10),d(32,"Formul\xE1rio da Fase Atual"),a(),r(33,"form",21)(34,"div",22)(35,"label",23),d(36," Respons\xE1vel "),a(),r(37,"select",24)(38,"option",25),d(39,"Ningu\xE9m"),a(),b(40,Xo,2,2,"option",26),a()(),r(41,"div",22)(42,"label",23),d(43," Temperatura "),r(44,"span",27),d(45,"(Qualifica\xE7\xE3o do lead)"),a()(),r(46,"select",28)(47,"option",25),d(48,"Selecione..."),a(),r(49,"option",29),d(50,"\u2744\uFE0F Frio - Pouco interesse"),a(),r(51,"option",30),d(52,"\u{1F321}\uFE0F Morno - Interesse moderado"),a(),r(53,"option",31),d(54,"\u{1F525} Quente - Muito interessado"),a(),r(55,"option",32),d(56,"\u2B50 Cliente - J\xE1 convertido"),a()()(),b(57,sr,10,7,"ng-container",33),a()(),r(58,"div")(59,"h3",10),d(60,"Coment\xE1rios"),a(),r(61,"div",34)(62,"div")(63,"textarea",35),pe("ngModelChange",function(n){f(e);let s=u();return ue(s.commentText,n)||(s.commentText=n),_(n)}),d(64,"              "),a(),b(65,lr,5,1,"div",36),r(66,"div",37)(67,"div")(68,"button",38),h("click",function(){f(e);let n=ci(72);return _(n.click())}),g(69,"i",39),d(70,"Anexar Arquivo "),a(),r(71,"input",40,0),h("change",function(n){f(e);let s=u();return _(s.onFileSelected(n))}),a()(),r(73,"button",41),h("click",function(){f(e);let n=u();return _(n.addComment())}),b(74,dr,1,0,"div",42),g(75,"i",43),d(76),a()()()()()(),r(77,"div",44)(78,"div")(79,"div",9)(80,"h3",10),d(81,"Mover Lead"),a(),b(82,mr,5,1,"div",45)(83,pr,5,1,"div",45)(84,gr,2,0,"div",46),a(),r(85,"div",9)(86,"h3",10),d(87,"Link P\xFAblico"),a(),b(88,hr,7,1,"div",47),a()(),r(89,"div",16),b(90,fr,2,1,"div",48),r(91,"button",49),h("click",function(){f(e);let n=u();return _(n.saveChanges())}),b(92,_r,1,0,"div",42),d(93),a(),r(94,"button",50),h("click",function(){f(e);let n=u();return _(n.deleteLead())}),d(95," Apagar Lead "),a()()()()()()}if(o&2){let e,i=u();l(4),y(" ",((e=i.getCurrentColumn())==null?null:e.order)===0?(i.currentLead==null||i.currentLead.fields==null?null:i.currentLead.fields.companyName)||"Lead":(i.currentLead==null||i.currentLead.fields==null?null:i.currentLead.fields.title)||"Editar Lead"," "),l(),c("disabled",i.isLoading),l(12),y(" ",(i.currentLead==null?null:i.currentLead.responsibleUserName)||"Ningu\xE9m"," "),l(),c("ngForOf",i.getInitialFields()),l(5),c("ngForOf",i.getPhaseHistoryItems()),l(5),c("ngForOf",i.getActivityLog()),l(5),c("formGroup",i.leadForm),l(7),c("ngForOf",i.users),l(17),c("ngForOf",i.currentFormFields),l(6),me("ngModel",i.commentText),l(2),c("ngIf",i.attachmentPreview),l(8),c("disabled",i.isUploadingComment||!i.commentText.trim()&&!i.selectedFile),l(),c("ngIf",i.isUploadingComment),l(2),y(" ",i.isUploadingComment?"Enviando...":"Enviar"," "),l(6),c("ngIf",i.getAdvancePhases().length>0),l(),c("ngIf",i.getRetreatPhases().length>0),l(),c("ngIf",i.getAdvancePhases().length===0&&i.getRetreatPhases().length===0),l(4),c("ngIf",i.publicLink),l(2),c("ngIf",i.errorMessage),l(),c("disabled",i.isSaving||i.isLoading),l(),c("ngIf",i.isSaving),l(),y(" ",i.isSaving?"Salvando...":"Salvar Altera\xE7\xF5es"," "),l(),c("disabled",i.isLoading||i.isSaving)}}var qe=class o{authService=x(fe);firestoreService=x(V);storageService=x(Te);subdomainService=x(de);fb=x(te);ownerId="";boardId="";columns=[];users=[];leadUpdated=new I;leadDeleted=new I;closeModal=new I;isVisible=!1;isLoading=!1;isSaving=!1;errorMessage="";currentLead=null;leadHistory=[];phaseHistory={};leadForm=this.fb.group({});commentText="";selectedFile=null;attachmentPreview="";isUploadingComment=!1;publicLink="";show(t){return S(this,null,function*(){this.currentLead=t,this.isVisible=!0,this.resetForm(),yield this.loadLeadData()})}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){this.leadForm=this.fb.group({}),this.commentText="",this.selectedFile=null,this.attachmentPreview="",this.errorMessage="",this.publicLink="",this.leadHistory=[],this.phaseHistory={}}loadLeadData(){return S(this,null,function*(){if(this.currentLead)try{let t=yield this.firestoreService.getLeadHistory(this.ownerId,this.boardId,this.currentLead.id);this.leadHistory=t,this.phaseHistory=this.currentLead.phaseHistory||{},yield this.buildDynamicForm(),this.generatePublicLink()}catch(t){console.error("Erro ao carregar dados do lead:",t),this.errorMessage="Erro ao carregar dados do lead."}})}buildDynamicForm(){return S(this,null,function*(){if(!this.currentLead)return;let t={};t.responsibleUserId=[this.currentLead.responsibleUserId||""],t.temperature=[this.currentLead.fields?.temperature||""],this.currentFormFields.forEach(e=>{let i=this.currentLead.fields?.[e.name]||"";t[e.name]=[i]}),this.leadForm=this.fb.group(t)})}getCurrentColumn(){return this.currentLead&&this.columns.find(t=>t.id===this.currentLead.columnId)||null}getInitialColumn(){return this.columns.find(t=>t.order===0)||null}getInitialFields(){return this.getInitialColumn()?[{name:"companyName",label:"Empresa"},{name:"cnpj",label:"CNPJ"},{name:"contactName",label:"Contato"},{name:"contactEmail",label:"Email"},{name:"contactPhone",label:"Telefone"},{name:"temperature",label:"Temperatura"}].map(i=>oe(F({},i),{value:this.currentLead?.fields?.[i.name]||"N\xE3o informado"})):[]}currentFormFields=[];getPhaseHistoryItems(){let t=[];return Object.values(this.phaseHistory).forEach(e=>{let i=this.columns.find(n=>n.id===e.phaseId);if(i){let n=e.enteredAt?.toDate?e.enteredAt.toDate():new Date(e.enteredAt),s=e.exitedAt?.toDate?e.exitedAt.toDate():e.exitedAt?new Date(e.exitedAt):null,m="";if(e.duration){let p=Math.floor(e.duration/864e5),v=Math.floor(e.duration%(1e3*60*60*24)/(1e3*60*60));p>0?m=`${p}d ${v}h`:m=`${v}h`}t.push({phaseName:i.name,phaseColor:i.color,enteredAt:n.toLocaleString("pt-BR"),exitedAt:s?.toLocaleString("pt-BR")||"Atual",duration:m||"Em andamento"})}}),t.sort((e,i)=>new Date(e.enteredAt).getTime()-new Date(i.enteredAt).getTime())}getActivityLog(){return this.leadHistory.sort((t,e)=>{let i=t.timestamp?.toDate?t.timestamp.toDate():new Date(t.timestamp);return(e.timestamp?.toDate?e.timestamp.toDate():new Date(e.timestamp)).getTime()-i.getTime()})}getAvailablePhases(){let t=this.getCurrentColumn();return t?t.endStageType&&t.endStageType!=="none"?[]:this.columns.filter(e=>e.id!==t.id):[]}getAdvancePhases(){let t=this.getCurrentColumn();return t?t.endStageType&&t.endStageType!=="none"?[]:this.columns.filter(e=>e.id!==t.id&&e.order>t.order).sort((e,i)=>e.order-i.order):[]}getRetreatPhases(){let t=this.getCurrentColumn();return t?t.order===0?[]:this.columns.filter(e=>e.id!==t.id&&e.order<t.order).sort((e,i)=>i.order-e.order):[]}saveChanges(){return S(this,null,function*(){if(!(!this.currentLead||!this.leadForm.valid)){this.isSaving=!0,this.errorMessage="";try{let t=this.leadForm.value,e=this.authService.getCurrentUser();if(!e)throw new Error("Usu\xE1rio n\xE3o autenticado");let i={fields:F(F({},this.currentLead.fields),t)};if(t.responsibleUserId!==this.currentLead.responsibleUserId){let n=this.users.find(s=>s.uid===t.responsibleUserId);i.responsibleUserId=t.responsibleUserId,i.responsibleUserName=n?.displayName||"",i.responsibleUserEmail=n?.email||"",yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"update",text:`Respons\xE1vel alterado para <strong>${n?.displayName||"Ningu\xE9m"}</strong>`,user:e.displayName||e.email})}yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,i),this.leadUpdated.emit(),yield this.loadLeadData()}catch(t){console.error("Erro ao salvar altera\xE7\xF5es:",t),this.errorMessage="Erro ao salvar altera\xE7\xF5es. Tente novamente."}finally{this.isSaving=!1}}})}moveLead(t){return S(this,null,function*(){if(this.currentLead){this.isLoading=!0;try{let e=this.getCurrentColumn(),i=this.columns.find(p=>p.id===t),n=this.authService.getCurrentUser();if(!e||!i||!n)return;let s=new Date,m=F({},this.phaseHistory);if(m[e.id]){let p=m[e.id].enteredAt?.toDate()||new Date;m[e.id].exitedAt=s,m[e.id].duration=s.getTime()-p.getTime()}m[t]={phaseId:t,enteredAt:s,exitedAt:void 0,duration:void 0},yield this.firestoreService.moveLead(this.ownerId,this.boardId,this.currentLead.id,t),yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"move",text:`Moveu de <strong>${e.name}</strong> para <strong>${i.name}</strong>`,user:n.displayName||n.email}),yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,{phaseHistory:m}),this.leadUpdated.emit(),this.hide()}catch(e){console.error("Erro ao mover lead:",e),this.errorMessage="Erro ao mover lead. Tente novamente."}finally{this.isLoading=!1}}})}onFileSelected(t){let e=t.target.files[0];if(e){if(e.size>10485760){this.errorMessage="Arquivo muito grande. O tamanho m\xE1ximo \xE9 10MB.",t.target.value="";return}if(!["image/jpeg","image/jpg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/zip","application/x-rar-compressed"].includes(e.type)){this.errorMessage="Tipo de arquivo n\xE3o permitido. Use: PDF, DOC, DOCX, JPG, PNG, GIF, TXT, ZIP, RAR.",t.target.value="";return}this.selectedFile=e,this.attachmentPreview=`\u{1F4CE} ${e.name} (${(e.size/1024/1024).toFixed(2)} MB)`,this.errorMessage=""}}clearAttachment(){this.selectedFile=null,this.attachmentPreview=""}addComment(){return S(this,null,function*(){if(!this.currentLead||!this.commentText.trim()&&!this.selectedFile){this.errorMessage="Digite um coment\xE1rio ou anexe um arquivo.";return}this.isUploadingComment=!0,this.errorMessage="";try{let t=this.authService.getCurrentUser();if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado");let e=null;if(this.selectedFile){console.log("Iniciando upload do arquivo:",this.selectedFile.name);let n=`leads/${this.currentLead.id}/comments/${Date.now()}_${this.selectedFile.name}`;try{let s=yield this.storageService.uploadFile(this.selectedFile,n);console.log("Upload conclu\xEDdo:",s),e={name:this.selectedFile.name,url:s,type:this.selectedFile.type,size:this.selectedFile.size}}catch(s){throw console.error("Erro no upload:",s),new Error("Falha no upload do arquivo. Verifique sua conex\xE3o.")}}let i={type:"comment",text:this.commentText.trim()||"Anexou um arquivo",user:t.displayName||t.email,timestamp:new Date,attachment:e};console.log("Adicionando ao hist\xF3rico:",i),yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,i),console.log("Coment\xE1rio adicionado com sucesso"),this.commentText="",this.clearAttachment(),yield this.loadLeadData()}catch(t){console.error("Erro ao adicionar coment\xE1rio:",t),this.errorMessage=t.message||"Erro ao adicionar coment\xE1rio. Tente novamente."}finally{this.isUploadingComment=!1}})}generatePublicLink(){if(!this.currentLead)return;let t=this.getCurrentColumn();if(!t)return;let e=this.subdomainService.getCurrentCompany();if(e)if(this.subdomainService.isDevelopment()){let n=this.subdomainService.getBaseUrl();this.publicLink=`${n}/form?subdomain=${e.subdomain}&userId=${this.ownerId}&boardId=${this.boardId}&leadId=${this.currentLead.id}&columnId=${t.id}`}else this.publicLink=`https://${e.subdomain}.taskboard.com.br/form?userId=${this.ownerId}&boardId=${this.boardId}&leadId=${this.currentLead.id}&columnId=${t.id}`}copyPublicLink(){this.publicLink&&navigator.clipboard.writeText(this.publicLink)}deleteLead(){return S(this,null,function*(){if(!(!this.currentLead||!confirm("Tem certeza que deseja apagar este lead? Esta a\xE7\xE3o n\xE3o pode ser desfeita."))){this.isLoading=!0;try{yield this.firestoreService.deleteLead(this.ownerId,this.boardId,this.currentLead.id),this.leadDeleted.emit(),this.hide()}catch(e){console.error("Erro ao excluir lead:",e),this.errorMessage="Erro ao excluir lead. Tente novamente."}finally{this.isLoading=!1}}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}formatDateTime(t){return(t?.toDate?t.toDate():new Date(t)).toLocaleString("pt-BR")}getActivityIcon(t){switch(t){case"move":return"fas fa-arrow-right";case"comment":return"fas fa-comment";case"update":return"fas fa-edit";default:return"fas fa-info-circle"}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-lead-detail-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns",users:"users"},outputs:{leadUpdated:"leadUpdated",leadDeleted:"leadDeleted",closeModal:"closeModal"},decls:1,vars:1,consts:[["fileInput",""],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-7xl","max-h-[95vh]","overflow-hidden"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"grid","grid-cols-12","gap-6","p-6","max-h-[calc(95vh-120px)]","overflow-y-auto"],[1,"col-span-12","md:col-span-3","border-r","border-gray-200","pr-6"],[1,"mb-8"],[1,"font-bold","text-lg","mb-3","text-gray-800"],[1,"space-y-2"],[1,"grid","grid-cols-3","gap-2"],[1,"col-span-1","text-sm","text-gray-600"],[1,"col-span-2","text-sm","break-all"],["class","grid grid-cols-3 gap-2",4,"ngFor","ngForOf"],[1,"space-y-3"],["class","text-xs p-2 rounded border-l-4",3,"border-left-color",4,"ngFor","ngForOf"],[1,"space-y-3","max-h-64","overflow-y-auto"],["class","text-xs p-2 bg-gray-50 rounded",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-6"],[1,"space-y-4",3,"formGroup"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["formControlName","responsibleUserId",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500"],["formControlName","temperature",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["value","frio"],["value","morno"],["value","quente"],["value","cliente"],[4,"ngFor","ngForOf"],[1,"space-y-4"],["placeholder","Escreva um coment\xE1rio...","rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["class","mt-2 p-2 bg-gray-50 rounded text-sm text-gray-600 flex items-center justify-between",4,"ngIf"],[1,"flex","justify-between","items-center","mt-3"],["type","button",1,"bg-gray-200","hover:bg-gray-300","text-gray-700","font-semibold","py-2","px-4","rounded-lg","text-sm","mr-2",3,"click"],[1,"fas","fa-paperclip","mr-2"],["type","file","accept",".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.txt,.zip,.rar",1,"hidden",3,"change"],[1,"bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","font-semibold","py-2","px-4","rounded-lg","flex","items-center",3,"click","disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"fas","fa-paper-plane","mr-2"],[1,"col-span-12","md:col-span-3","border-l","border-gray-200","pl-6","flex","flex-col","justify-between"],["class","mb-4",4,"ngIf"],["class","text-gray-500 text-sm italic p-3 bg-gray-50 rounded-lg",4,"ngIf"],["class","space-y-2",4,"ngIf"],["class","bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-sm",4,"ngIf"],[1,"w-full","bg-green-500","hover:bg-green-600","disabled:bg-green-300","text-white","font-bold","py-3","px-4","rounded-lg","flex","items-center","justify-center",3,"click","disabled"],[1,"w-full","bg-red-500","hover:bg-red-600","disabled:bg-red-300","text-white","font-bold","py-3","px-4","rounded-lg",3,"click","disabled"],[1,"text-xs","p-2","rounded","border-l-4"],[1,"font-medium","text-gray-800"],[1,"text-gray-600"],["class","text-gray-600",4,"ngIf"],[1,"text-xs","p-2","bg-gray-50","rounded"],[1,"flex","items-center","mb-1"],[1,"mr-2","text-blue-500"],[1,"font-medium"],[1,"ml-auto","text-gray-500"],[1,"text-gray-700",3,"innerHTML"],["class","mt-2",4,"ngIf"],[1,"mt-2"],["target","_blank",1,"text-blue-600","hover:underline","flex","items-center",3,"href"],[1,"fas","fa-paperclip","mr-1"],[3,"value"],["class","text-red-500",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"type","formControlName","placeholder",4,"ngIf"],["rows","3","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","number","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","date","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],[1,"text-red-500"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"type","formControlName","placeholder"],["rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","number",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","date",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"mt-2","p-2","bg-gray-50","rounded","text-sm","text-gray-600","flex","items-center","justify-between"],[1,"text-red-500","hover:text-red-700",3,"click"],[1,"fas","fa-times"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"],[1,"mb-4"],[1,"text-sm","font-semibold","text-green-700","mb-2"],[1,"grid","grid-cols-1","gap-2"],["class","text-left p-2 border border-green-200 rounded-md hover:bg-green-50 transition-colors flex items-center text-sm bg-white",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-left","p-2","border","border-green-200","rounded-md","hover:bg-green-50","transition-colors","flex","items-center","text-sm","bg-white",3,"click","disabled"],[1,"w-3","h-3","rounded-full","mr-2"],[1,"text-sm","font-medium","text-orange-600","mb-2"],[1,"grid","grid-cols-1","gap-1"],["class","text-left p-2 border border-orange-100 rounded-md hover:bg-orange-50 transition-colors flex items-center text-xs bg-orange-25 opacity-75",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-left","p-2","border","border-orange-100","rounded-md","hover:bg-orange-50","transition-colors","flex","items-center","text-xs","bg-orange-25","opacity-75",3,"click","disabled"],[1,"w-2","h-2","rounded-full","mr-2"],[1,"text-gray-500","text-sm","italic","p-3","bg-gray-50","rounded-lg"],[1,"text-xs","text-gray-600"],[1,"flex"],["type","text","readonly","",1,"flex-1","p-2","border","border-gray-300","rounded-l-lg","bg-gray-50","text-xs",3,"value"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-3","rounded-r-lg",3,"click"],[1,"fas","fa-copy"],[1,"bg-red-50","border","border-red-200","text-red-700","px-3","py-2","rounded-lg","text-sm"]],template:function(e,i){e&1&&b(0,br,96,23,"div",1),e&2&&c("ngIf",i.isVisible)},dependencies:[O,R,j,le,J,ae,se,Q,Pe,he,Z,Y,nt,H,X,ee],styles:[".modal-body[_ngcontent-%COMP%]{max-height:calc(95vh - 120px)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#374151;margin-bottom:.25rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{transition:border-color .2s ease,box-shadow .2s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.activity-item[_ngcontent-%COMP%]{padding:.75rem;background:#f9fafb;border-radius:.5rem;border-left:3px solid #e5e7eb}.phase-item[_ngcontent-%COMP%]{padding:.5rem;border-radius:.25rem;border-left:4px solid}.phase-item.current[_ngcontent-%COMP%]{background-color:#eff6ff;border-left-color:#3b82f6}.action-button[_ngcontent-%COMP%]{transition:all .2s ease;border:1px solid #d1d5db}.action-button[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#9ca3af}.public-link-container[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:.5rem;padding:1rem}.attachment-preview[_ngcontent-%COMP%]{background:#f1f5f9;border:1px solid #cbd5e1;padding:.5rem;border-radius:.375rem;font-size:.875rem;color:#475569}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-track, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}"]})};var vr=["visualEditor"],xr=["htmlEditor"];function yr(o,t){if(o&1){let e=C();r(0,"button",37),h("click",function(){let n=f(e).$implicit,s=u(2);return _(s.insertVariable(n.value))}),d(1),a()}if(o&2){let e=t.$implicit,i=u(2);c("disabled",i.isLoading),l(),y(" ",e.value," ")}}function Cr(o,t){if(o&1){let e=C();r(0,"div",38)(1,"div",39)(2,"button",40),h("click",function(){f(e);let n=u(2);return _(n.execCommand("bold"))}),r(3,"strong"),d(4,"B"),a()(),r(5,"button",41),h("click",function(){f(e);let n=u(2);return _(n.execCommand("italic"))}),r(6,"em"),d(7,"I"),a()(),r(8,"button",42),h("click",function(){f(e);let n=u(2);return _(n.execCommand("underline"))}),r(9,"u"),d(10,"U"),a()(),g(11,"div",43),r(12,"button",44),h("click",function(){f(e);let n=u(2);return _(n.execCommand("insertUnorderedList"))}),d(13," \u2022 "),a(),r(14,"button",45),h("click",function(){f(e);let n=u(2);return _(n.execCommand("insertOrderedList"))}),d(15," 1. "),a(),g(16,"div",43),r(17,"button",46),h("click",function(){f(e);let n=u(2);return _(n.createLink())}),d(18," \u{1F517} "),a()()()}}function wr(o,t){if(o&1){let e=C();r(0,"div",47,0),h("input",function(n){f(e);let s=u(2);return _(s.onVisualEditorInput(n))}),a()}if(o&2){let e=u(2);c("innerHTML",e.editorContent,Je)}}function Sr(o,t){if(o&1){let e=C();r(0,"textarea",48,1),h("input",function(n){f(e);let s=u(2);return _(s.onHtmlEditorInput(n))}),d(2,"            "),a()}if(o&2){let e=u(2);c("value",e.editorContent)}}function Er(o,t){if(o&1&&(r(0,"div",49),d(1),a()),o&2){let e=u(2);l(),y(" ",e.errorMessage," ")}}function Ir(o,t){o&1&&g(0,"div",50)}function Pr(o,t){if(o&1){let e=C();r(0,"div",3),h("click",function(n){f(e);let s=u();return _(s.onBackdropClick(n))}),r(1,"div",4)(2,"div",5)(3,"h2",6),d(4),a(),r(5,"button",7),h("click",function(){f(e);let n=u();return _(n.hide())}),d(6," \xD7 "),a()(),r(7,"form",8),h("ngSubmit",function(){f(e);let n=u();return _(n.saveTemplate())}),r(8,"div",9)(9,"div",10)(10,"label",11),d(11," Nome do Template "),r(12,"span",12),d(13,"*"),a()(),g(14,"input",13),a(),r(15,"div",10)(16,"label",14),d(17," Destinat\xE1rios "),a(),g(18,"input",15),a()(),r(19,"div",16)(20,"label",17),d(21," Assunto "),r(22,"span",12),d(23,"*"),a()(),g(24,"input",18),a(),r(25,"div",19)(26,"div",20)(27,"label",21),d(28," Corpo do Email "),r(29,"span",12),d(30,"*"),a()()(),r(31,"div",22)(32,"p",23),d(33,"Clique para inserir vari\xE1veis:"),a(),r(34,"div",24),b(35,yr,2,2,"button",25),a(),r(36,"p",26),d(37," As vari\xE1veis ser\xE3o substitu\xEDdas automaticamente pelos dados reais do lead quando o email for enviado. "),a()(),r(38,"div",19)(39,"div",20)(40,"label",21),d(41," Corpo do E-mail "),r(42,"span",12),d(43,"*"),a()(),r(44,"button",27),h("click",function(){f(e);let n=u();return _(n.toggleHtmlMode())}),d(45),a()(),r(46,"div",28),b(47,Cr,19,0,"div",29)(48,wr,2,1,"div",30)(49,Sr,3,1,"textarea",31),a()()(),b(50,Er,2,1,"div",32),r(51,"div",33)(52,"button",34),h("click",function(){f(e);let n=u();return _(n.hide())}),d(53," Cancelar "),a(),r(54,"button",35),b(55,Ir,1,0,"div",36),d(56),a()()()()()}if(o&2){let e=u();l(4),y(" ",e.isEditing?"Editar Template":"Criar Novo Template"," "),l(),c("disabled",e.isLoading),l(2),c("formGroup",e.templateForm),l(7),c("disabled",e.isLoading),l(4),c("placeholder",hi("Ex: ","{{","contactEmail","}}"))("disabled",e.isLoading),l(6),c("disabled",e.isLoading),l(11),c("ngForOf",e.variables),l(10),y(" ",e.showHtmlMode?"Editor Visual":"Ver HTML"," "),l(2),c("ngIf",!e.showHtmlMode),l(),c("ngIf",!e.showHtmlMode),l(),c("ngIf",e.showHtmlMode),l(),c("ngIf",e.errorMessage),l(2),c("disabled",e.isLoading),l(2),c("disabled",e.isLoading||!e.templateForm.valid),l(),c("ngIf",e.isLoading),l(),y(" ",e.isLoading?"Salvando...":e.isEditing?"Atualizar Template":"Criar Template"," ")}}var Ge=class o{firestoreService=x(V);fb=x(te);ownerId="";boardId="";templateSaved=new I;closeModal=new I;visualEditor;htmlEditor;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentTemplate=null;showHtmlMode=!1;editorContent="";templateForm=this.fb.group({name:["",[A.required]],subject:["",[A.required]],recipients:[""],body:["",[A.required]]});variables=[{name:"Nome da Empresa",value:"{{companyName}}"},{name:"CNPJ",value:"{{cnpj}}"},{name:"Nome do Contato",value:"{{contactName}}"},{name:"Email do Contato",value:"{{contactEmail}}"},{name:"Telefone do Contato",value:"{{contactPhone}}"},{name:"Nome do Respons\xE1vel",value:"{{nomeResponsavel}}"},{name:"Email do Respons\xE1vel",value:"{{emailResponsavel}}"},{name:"Nome da Fase Atual",value:"{{currentPhaseName}}"},{name:"Data Atual",value:"{{currentDate}}"},{name:"Link do Lead",value:"{{leadLink}}"}];ngAfterViewInit(){console.log("Template modal inicializado")}execCommand(t){document.execCommand(t,!1)}createLink(){let t=window.prompt("Digite a URL:");t&&document.execCommand("createLink",!1,t)}onVisualEditorChange(t){this.editorContent=t.target.innerHTML,console.log("Visual editor changed:",this.editorContent)}onHtmlEditorChange(t){this.editorContent=t,console.log("HTML editor changed:",this.editorContent)}showCreateModal(){this.isEditing=!1,this.currentTemplate=null,this.isVisible=!0,this.resetForm()}showEditModal(t){this.isEditing=!0,this.currentTemplate=t,this.isVisible=!0,this.populateForm(t)}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){this.templateForm.reset({name:"",subject:"",recipients:"",body:""}),this.errorMessage="",this.isLoading=!1,this.editorContent=""}populateForm(t){console.log("Carregando template:",t),this.templateForm.patchValue({name:t.name||"",subject:t.subject||"",recipients:t.recipients||"",body:t.body||""}),this.editorContent=t.body||"",console.log("Conte\xFAdo do editor definido:",this.editorContent),setTimeout(()=>{this.visualEditor&&this.editorContent&&(this.visualEditor.nativeElement.innerHTML=this.editorContent)},100)}toggleHtmlMode(){this.showHtmlMode=!this.showHtmlMode,this.showHtmlMode?setTimeout(()=>{this.htmlEditor&&(this.htmlEditor.nativeElement.value=this.editorContent)},100):this.htmlEditor&&(this.editorContent=this.htmlEditor.nativeElement.value,setTimeout(()=>{this.visualEditor&&(this.visualEditor.nativeElement.innerHTML=this.editorContent)},100))}insertVariable(t){if(this.showHtmlMode&&this.htmlEditor){let e=this.htmlEditor.nativeElement,i=e.selectionStart,n=e.selectionEnd,s=e.value,m=s.substring(0,i)+t+s.substring(n);e.value=m,e.selectionStart=e.selectionEnd=i+t.length,this.editorContent=m}else!this.showHtmlMode&&this.visualEditor&&(this.editorContent+=t,this.visualEditor.nativeElement.innerHTML=this.editorContent)}onVisualEditorInput(t){this.editorContent=t.target.innerHTML}onHtmlEditorInput(t){this.editorContent=t.target.value}saveTemplate(){return S(this,null,function*(){if(!this.templateForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.templateForm.value,e=this.editorContent||"";console.log("Salvando template, conte\xFAdo:",e),console.log("Salvando template com body final:",e),this.templateForm.patchValue({body:e});let i={name:t.name,subject:t.subject,recipients:t.recipients||"",body:e};this.isEditing&&this.currentTemplate?yield this.firestoreService.updateEmailTemplate(this.ownerId,this.boardId,this.currentTemplate.id,i):yield this.firestoreService.createEmailTemplate(this.ownerId,this.boardId,i),this.templateSaved.emit(),this.hide()}catch(t){console.error("Erro ao salvar template:",t),this.errorMessage="Erro ao salvar template. Tente novamente."}finally{this.isLoading=!1}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-template-modal"]],viewQuery:function(e,i){if(e&1&&(U(vr,5),U(xr,5)),e&2){let n;q(n=G())&&(i.visualEditor=n.first),q(n=G())&&(i.htmlEditor=n.first)}},inputs:{ownerId:"ownerId",boardId:"boardId"},outputs:{templateSaved:"templateSaved",closeModal:"closeModal"},decls:1,vars:1,consts:[["visualEditor",""],["htmlEditor",""],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-6xl","max-h-[95vh]","overflow-hidden"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6","max-h-[calc(95vh-120px)]","overflow-y-auto",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"form-group"],["for","templateName",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","id","templateName","formControlName","name","placeholder","Ex: Template de boas-vindas, email promocional, etc.",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled"],["for","templateRecipients",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","templateRecipients","formControlName","recipients",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled","placeholder"],[1,"form-group","mb-4"],["for","templateSubject",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","templateSubject","formControlName","subject","placeholder","Ex: Obrigado por entrar em contato",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled"],[1,"mb-4"],[1,"flex","justify-between","items-center","mb-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"bg-gray-50","p-3","rounded-md","mb-3"],[1,"text-xs","text-gray-600","mb-2"],[1,"flex","flex-wrap","gap-1"],["type","button","class","variable-tag px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded hover:bg-blue-200 transition-colors",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500","mt-2"],["type","button",1,"px-3","py-1","text-xs","bg-gray-200","hover:bg-gray-300","rounded","transition-colors",3,"click"],[1,"border","border-gray-300","rounded-lg","overflow-hidden"],["class","border-b border-gray-300 p-2 bg-gray-50",4,"ngIf"],["contenteditable","true","class","min-h-[300px] p-4 focus:outline-none","style","max-height: 400px; overflow-y: auto;",3,"innerHTML","input",4,"ngIf"],["class","w-full min-h-[300px] max-h-[400px] p-4 font-mono text-sm focus:outline-none resize-none","placeholder","Digite o HTML aqui...",3,"value","input",4,"ngIf"],["class","mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200"],["type","button",1,"px-6","py-3","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-3","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],["type","button",1,"variable-tag","px-2","py-1","bg-blue-100","text-blue-800","text-xs","rounded","hover:bg-blue-200","transition-colors",3,"click","disabled"],[1,"border-b","border-gray-300","p-2","bg-gray-50"],[1,"flex","gap-1","flex-wrap"],["type","button","title","Negrito",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],["type","button","title","It\xE1lico",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],["type","button","title","Sublinhado",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],[1,"border-l","border-gray-300","mx-1"],["type","button","title","Lista",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],["type","button","title","Lista Numerada",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],["type","button","title","Link",1,"px-2","py-1","text-sm","bg-white","border","rounded","hover:bg-gray-100",3,"click"],["contenteditable","true",1,"min-h-[300px]","p-4","focus:outline-none",2,"max-height","400px","overflow-y","auto",3,"input","innerHTML"],["placeholder","Digite o HTML aqui...",1,"w-full","min-h-[300px]","max-h-[400px]","p-4","font-mono","text-sm","focus:outline-none","resize-none",3,"input","value"],[1,"mb-4","bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,Pr,57,19,"div",2),e&2&&c("ngIf",i.isVisible)},dependencies:[O,R,j,le,J,Q,Z,Y,H,X,ee],styles:[".form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{transition:border-color .2s ease,box-shadow .2s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.variable-tag[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.variable-tag[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}[_nghost-%COMP%]     .ql-editor{min-height:300px;font-size:14px;line-height:1.6}[_nghost-%COMP%]     .ql-toolbar{border-top:1px solid #d1d5db;border-left:1px solid #d1d5db;border-right:1px solid #d1d5db;background-color:#f9fafb}[_nghost-%COMP%]     .ql-container{border-bottom:1px solid #d1d5db;border-left:1px solid #d1d5db;border-right:1px solid #d1d5db}[_nghost-%COMP%]     .ql-editor.ql-blank:before{color:#9ca3af;content:attr(data-placeholder);font-style:italic}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};var We=()=>({standalone:!0});function Mr(o,t){if(o&1&&(r(0,"option",27),d(1),a()),o&2){let e=t.$implicit;c("value",e.id),l(),E(e.name)}}function Dr(o,t){if(o&1&&(r(0,"option",27),d(1),a()),o&2){let e=t.$implicit;c("value",e.id),l(),E(e.name)}}function Tr(o,t){if(o&1){let e=C();r(0,"div")(1,"select",39),pe("ngModelChange",function(n){f(e);let s=u().$implicit;return ue(s.templateId,n)||(s.templateId=n),_(n)}),r(2,"option",40),d(3,"Selecione um template"),a(),b(4,Dr,2,2,"option",16),a()()}if(o&2){let e=u().$implicit,i=u();l(),me("ngModel",e.templateId),c("ngModelOptions",W(3,We)),l(3),c("ngForOf",i.emailTemplates)}}function kr(o,t){if(o&1&&(r(0,"option",27),d(1),a()),o&2){let e=t.$implicit;c("value",e.id),l(),E(e.name)}}function Fr(o,t){if(o&1){let e=C();r(0,"div")(1,"select",39),pe("ngModelChange",function(n){f(e);let s=u().$implicit;return ue(s.phaseId,n)||(s.phaseId=n),_(n)}),r(2,"option",40),d(3,"Selecione uma fase"),a(),b(4,kr,2,2,"option",16),a()()}if(o&2){let e=u().$implicit,i=u();l(),me("ngModel",e.phaseId),c("ngModelOptions",W(3,We)),l(3),c("ngForOf",i.phases)}}function Or(o,t){if(o&1&&(r(0,"option",27),d(1),a()),o&2){let e=t.$implicit;c("value",e.id),l(),E(e.name)}}function Ar(o,t){if(o&1){let e=C();r(0,"div")(1,"select",39),pe("ngModelChange",function(n){f(e);let s=u().$implicit;return ue(s.userId,n)||(s.userId=n),_(n)}),r(2,"option",40),d(3,"Selecione um usu\xE1rio"),a(),b(4,Or,2,2,"option",16),a()()}if(o&2){let e=u().$implicit,i=u();l(),me("ngModel",e.userId),c("ngModelOptions",W(3,We)),l(3),c("ngForOf",i.users)}}function Lr(o,t){if(o&1){let e=C();r(0,"div")(1,"textarea",41),pe("ngModelChange",function(n){f(e);let s=u().$implicit;return ue(s.note,n)||(s.note=n),_(n)}),a()()}if(o&2){let e=u().$implicit;l(),me("ngModel",e.note),c("ngModelOptions",W(2,We))}}function Rr(o,t){if(o&1){let e=C();r(0,"div",28)(1,"div",29)(2,"select",30),pe("ngModelChange",function(n){let s=f(e).$implicit;return ue(s.type,n)||(s.type=n),_(n)}),r(3,"option",31),d(4,"Enviar e-mail"),a(),r(5,"option",32),d(6,"Mover para fase"),a(),r(7,"option",33),d(8,"Atribuir usu\xE1rio"),a(),r(9,"option",34),d(10,"Adicionar nota"),a()(),r(11,"button",35),h("click",function(){let n=f(e).index,s=u();return _(s.removeAction(n))}),g(12,"i",36),a()(),r(13,"div",37),b(14,Tr,5,4,"div",38)(15,Fr,5,4,"div",38)(16,Ar,5,4,"div",38)(17,Lr,2,3,"div",38),a()()}if(o&2){let e=t.$implicit;l(2),me("ngModel",e.type),c("ngModelOptions",W(7,We)),l(11),c("ngSwitch",e.type),l(),c("ngSwitchCase","send-email"),l(),c("ngSwitchCase","move-to-phase"),l(),c("ngSwitchCase","assign-user"),l(),c("ngSwitchCase","add-note")}}var Ke=class o{constructor(t){this.fb=t;this.automationForm=this.createForm()}isVisible=!1;automation=null;phases=[];emailTemplates=[];users=[];closeModalEvent=new I;saveAutomation=new I;automationForm;modalTitle="Criar Automa\xE7\xE3o";isEditing=!1;showTriggerPhase=!1;showTriggerTime=!1;ngOnInit(){this.automation&&(this.isEditing=!0,this.modalTitle="Editar Automa\xE7\xE3o",this.loadAutomationData())}createForm(){return this.fb.group({id:[""],name:["",A.required],triggerType:["new-lead-created",A.required],triggerPhase:[""],triggerDays:[1],actions:this.fb.array([])})}loadAutomationData(){if(this.automation){this.automationForm.patchValue({id:this.automation.id,name:this.automation.name,triggerType:this.automation.triggerType,triggerPhase:this.automation.triggerPhase,triggerDays:this.automation.triggerDays});let t=this.automationForm.get("actions");t.clear(),this.automation.actions&&this.automation.actions.forEach(e=>{t.push(this.fb.group(e))}),this.onTriggerTypeChange()}}onTriggerTypeChange(){let t=this.automationForm.get("triggerType")?.value;this.showTriggerPhase=t==="card-enters-phase"||t==="card-in-phase-for-time"||t==="form-not-answered",this.showTriggerTime=t==="card-in-phase-for-time",this.showTriggerPhase||this.automationForm.get("triggerPhase")?.setValue(""),this.showTriggerTime||this.automationForm.get("triggerDays")?.setValue(1)}get actionsFormArray(){return this.automationForm.get("actions")}addAction(){let t=this.fb.group({type:["send-email"],templateId:[""],phaseId:[""],userId:[""],note:[""]});this.actionsFormArray.push(t)}removeAction(t){this.actionsFormArray.removeAt(t)}onSubmit(){if(this.automationForm.valid){let t=this.automationForm.value,e=oe(F({},t),{name:t.name||`Automa\xE7\xE3o ${this.getAutomationTypeName(t.triggerType)}`,actions:t.actions.filter(i=>this.isValidAction(i))});this.saveAutomation.emit(e),this.closeModal()}}isValidAction(t){switch(t.type){case"send-email":return!!t.templateId;case"move-to-phase":return!!t.phaseId;case"assign-user":return!!t.userId;case"add-note":return!!t.note&&t.note.trim().length>0;default:return!1}}getAutomationTypeName(t){return{"new-lead-created":"Novo Registro","card-enters-phase":"Entrada em Fase","card-in-phase-for-time":"Tempo em Fase","form-not-answered":"Formul\xE1rio Pendente","sla-overdue":"SLA Vencido"}[t]||"Sem Nome"}closeModal(){this.automationForm.reset(),this.actionsFormArray.clear(),this.isEditing=!1,this.modalTitle="Criar Automa\xE7\xE3o",this.showTriggerPhase=!1,this.showTriggerTime=!1,this.closeModalEvent.emit()}static \u0275fac=function(e){return new(e||o)(ri(te))};static \u0275cmp=T({type:o,selectors:[["app-automation-modal"]],inputs:{isVisible:"isVisible",automation:"automation",phases:"phases",emailTemplates:"emailTemplates",users:"users"},outputs:{closeModalEvent:"closeModalEvent",saveAutomation:"saveAutomation"},decls:44,vars:10,consts:[[1,"modal-overlay",3,"click"],[1,"modal-content","modal-content-md","p-6",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold"],[1,"text-gray-500","hover:text-gray-800","text-2xl",3,"click"],[1,"modal-body","space-y-6",3,"ngSubmit","formGroup"],[1,"border","rounded-lg","p-4"],[1,"font-semibold","text-md","mb-3","text-gray-700"],["formControlName","triggerType",1,"w-full","p-2","border","rounded-md","mb-2","bg-white",3,"change"],["value","new-lead-created"],["value","card-enters-phase"],["value","card-in-phase-for-time"],["value","form-not-answered"],["value","sla-overdue"],["for","triggerPhase",1,"text-sm","font-medium","text-gray-700"],["formControlName","triggerPhase",1,"w-full","p-2","border","rounded-md","mt-1","bg-white"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-2"],["for","triggerDays",1,"text-sm","font-medium","text-gray-700"],["type","number","formControlName","triggerDays","min","1","placeholder","Ex: 3",1,"w-full","p-2","border","rounded-md","mt-1"],[1,"space-y-3"],["class","border rounded-lg p-3 bg-gray-50",4,"ngFor","ngForOf"],["type","button",1,"mt-4","bg-gray-200","hover:bg-gray-300","text-gray-700","font-semibold","py-2","px-4","rounded-lg","text-sm",3,"click"],[1,"fas","fa-plus","mr-2"],[1,"mt-6","flex","justify-end","gap-4"],["type","button",1,"bg-gray-200","hover:bg-gray-300","text-gray-800","font-bold","py-2","px-4","rounded-lg",3,"click"],["type","submit",1,"bg-blue-500","hover:bg-blue-600","text-white","font-bold","py-2","px-4","rounded-lg","disabled:bg-gray-400",3,"disabled"],[3,"value"],[1,"border","rounded-lg","p-3","bg-gray-50"],[1,"flex","justify-between","items-start","mb-2"],[1,"p-2","border","rounded-md","bg-white","flex-1","mr-2",3,"ngModelChange","ngModel","ngModelOptions"],["value","send-email"],["value","move-to-phase"],["value","assign-user"],["value","add-note"],["type","button",1,"text-red-500","hover:text-red-700",3,"click"],[1,"fas","fa-trash"],[1,"mt-2",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"w-full","p-2","border","rounded-md","bg-white",3,"ngModelChange","ngModel","ngModelOptions"],["value",""],["rows","3","placeholder","Digite a nota...",1,"w-full","p-2","border","rounded-md",3,"ngModelChange","ngModel","ngModelOptions"]],template:function(e,i){if(e&1&&(r(0,"div",0),h("click",function(){return i.closeModal()}),r(1,"div",1),h("click",function(s){return s.stopPropagation()}),r(2,"div",2)(3,"h2",3),d(4),a(),r(5,"button",4),h("click",function(){return i.closeModal()}),d(6,"\xD7"),a()(),r(7,"form",5),h("ngSubmit",function(){return i.onSubmit()}),r(8,"div",6)(9,"h3",7),d(10,"Gatilho (Quando...)"),a(),r(11,"select",8),h("change",function(){return i.onTriggerTypeChange()}),r(12,"option",9),d(13,"Um novo lead \xE9 criado"),a(),r(14,"option",10),d(15,"Um card entra em uma fase"),a(),r(16,"option",11),d(17,"Um card est\xE1 em uma fase por um tempo"),a(),r(18,"option",12),d(19,"Ainda n\xE3o respondeu o formul\xE1rio da fase"),a(),r(20,"option",13),d(21,"O SLA de um card vence"),a()(),r(22,"div")(23,"label",14),d(24,"Fase:"),a(),r(25,"select",15),b(26,Mr,2,2,"option",16),a()(),r(27,"div",17)(28,"label",18),d(29,"Por (dias \xFAteis):"),a(),g(30,"input",19),a()(),r(31,"div",6)(32,"h3",7),d(33,"A\xE7\xF5es (Fa\xE7a isso...)"),a(),r(34,"div",20),b(35,Rr,18,8,"div",21),a(),r(36,"button",22),h("click",function(){return i.addAction()}),g(37,"i",23),d(38,"Adicionar A\xE7\xE3o "),a()(),r(39,"div",24)(40,"button",25),h("click",function(){return i.closeModal()}),d(41,"Cancelar"),a(),r(42,"button",26),d(43),a()()()()()),e&2){let n;l(4),E(i.modalTitle),l(3),c("formGroup",i.automationForm),l(15),P("hidden",!i.showTriggerPhase),l(4),c("ngForOf",i.phases),l(),P("hidden",!i.showTriggerTime),l(8),c("ngForOf",(n=i.automationForm.get("actions"))==null?null:n.value),l(7),c("disabled",!i.automationForm.valid),l(),y(" ",i.isEditing?"Atualizar":"Salvar"," Automa\xE7\xE3o ")}},dependencies:[O,R,xi,yi,H,J,ae,se,Q,Pe,he,Z,Y,ot,X,ee,le,nt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 4px 6px #0000001a;max-height:90vh;overflow-y:auto}.modal-content-md[_ngcontent-%COMP%]{width:90%;max-width:600px}.hidden[_ngcontent-%COMP%]{display:none!important}form[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border:1px solid #e5e7eb}form[_ngcontent-%COMP%]   .rounded-lg[_ngcontent-%COMP%]{border-radius:8px}form[_ngcontent-%COMP%]   .p-4[_ngcontent-%COMP%]{padding:1rem}form[_ngcontent-%COMP%]   .p-6[_ngcontent-%COMP%]{padding:1.5rem}form[_ngcontent-%COMP%]   .space-y-6[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1.5rem}form[_ngcontent-%COMP%]   .space-y-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.75rem}form[_ngcontent-%COMP%]   select.w-full[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.w-full[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.w-full[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   select.p-2[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.p-2[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.p-2[_ngcontent-%COMP%]{padding:.5rem}form[_ngcontent-%COMP%]   select.border[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.border[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.border[_ngcontent-%COMP%]{border:1px solid #d1d5db}form[_ngcontent-%COMP%]   select.rounded-md[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.rounded-md[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.rounded-md[_ngcontent-%COMP%]{border-radius:6px}form[_ngcontent-%COMP%]   select.bg-white[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.bg-white[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.bg-white[_ngcontent-%COMP%]{background-color:#fff}form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}form[_ngcontent-%COMP%]   button.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}form[_ngcontent-%COMP%]   button.hover\\\\[_ngcontent-%COMP%]:bg-gray-300:hover{background-color:#d1d5db}form[_ngcontent-%COMP%]   button.bg-blue-500[_ngcontent-%COMP%]{background-color:#3b82f6}form[_ngcontent-%COMP%]   button.hover\\\\[_ngcontent-%COMP%]:bg-blue-600:hover{background-color:#2563eb}form[_ngcontent-%COMP%]   button.text-gray-700[_ngcontent-%COMP%]{color:#374151}form[_ngcontent-%COMP%]   button.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}form[_ngcontent-%COMP%]   button.text-white[_ngcontent-%COMP%]{color:#fff}form[_ngcontent-%COMP%]   button.font-semibold[_ngcontent-%COMP%]{font-weight:600}form[_ngcontent-%COMP%]   button.font-bold[_ngcontent-%COMP%]{font-weight:700}form[_ngcontent-%COMP%]   button.py-2[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem}form[_ngcontent-%COMP%]   button.px-4[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}form[_ngcontent-%COMP%]   button.rounded-lg[_ngcontent-%COMP%]{border-radius:8px}form[_ngcontent-%COMP%]   button.text-sm[_ngcontent-%COMP%]{font-size:.875rem}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}form[_ngcontent-%COMP%]   button.disabled\\\\[_ngcontent-%COMP%]:bg-gray-400:disabled{background-color:#9ca3af}.text-red-500[_ngcontent-%COMP%]{color:#ef4444}.hover\\\\[_ngcontent-%COMP%]:text-red-700:hover{color:#b91c1c}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.flex[_ngcontent-%COMP%]{display:flex}.justify-between[_ngcontent-%COMP%]{justify-content:space-between}.justify-end[_ngcontent-%COMP%]{justify-content:flex-end}.items-center[_ngcontent-%COMP%]{align-items:center}.items-start[_ngcontent-%COMP%]{align-items:flex-start}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mb-3[_ngcontent-%COMP%]{margin-bottom:.75rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.mt-1[_ngcontent-%COMP%]{margin-top:.25rem}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}.mt-4[_ngcontent-%COMP%]{margin-top:1rem}.mt-6[_ngcontent-%COMP%]{margin-top:1.5rem}.gap-4[_ngcontent-%COMP%]{gap:1rem}.flex-1[_ngcontent-%COMP%]{flex:1 1 0%}.text-2xl[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}.text-md[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.hover\\\\[_ngcontent-%COMP%]:text-gray-800:hover{color:#1f2937}"]})};function Vr(o,t){o&1&&(r(0,"tr")(1,"td",14),g(2,"i",15),d(3,"Carregando hist\xF3rico... "),a()())}function Nr(o,t){o&1&&(r(0,"tr")(1,"td",14),d(2,"Nenhuma execu\xE7\xE3o registrada."),a()())}function Br(o,t){if(o&1&&(r(0,"tr",16)(1,"td",17),d(2),a(),r(3,"td",17),d(4),a(),r(5,"td",17)(6,"span",18),d(7),a()(),r(8,"td",17),d(9),a()()),o&2){let e=t.$implicit,i=u(2);l(2),E(i.formatDate(e.timestamp)),l(2),E(i.getLeadName(e.leadId)),l(2),P("bg-green-100",e.status==="success")("text-green-800",e.status==="success")("bg-red-100",e.status==="error")("text-red-800",e.status==="error")("bg-yellow-100",e.status==="pending")("text-yellow-800",e.status==="pending"),l(),y(" ",i.getStatusText(e.status)," "),l(2),E(e.text||e.action||"A\xE7\xE3o executada")}}function zr(o,t){if(o&1){let e=C();r(0,"div",19)(1,"button",20),h("click",function(){f(e);let n=u(2);return _(n.previousPage())}),g(2,"i",21),d(3,"Anterior "),a(),r(4,"span",22),d(5),a(),r(6,"button",20),h("click",function(){f(e);let n=u(2);return _(n.nextPage())}),d(7," Pr\xF3xima"),g(8,"i",23),a()()}if(o&2){let e=u(2);l(),c("disabled",e.currentPage===1),l(4),pi(" P\xE1gina ",e.currentPage," de ",e.totalPages," (",e.historyItems.length," registros) "),l(),c("disabled",e.currentPage===e.totalPages)}}function $r(o,t){if(o&1){let e=C();r(0,"div",1),h("click",function(){f(e);let n=u();return _(n.closeModal())}),r(1,"div",2),h("click",function(n){return f(e),_(n.stopPropagation())}),r(2,"div",3)(3,"h2",4),d(4),a(),r(5,"button",5),h("click",function(){f(e);let n=u();return _(n.closeModal())}),d(6,"\xD7"),a()(),r(7,"div",6)(8,"table",7)(9,"thead",8)(10,"tr")(11,"th",9),d(12,"Data"),a(),r(13,"th",9),d(14,"Lead Afetado"),a(),r(15,"th",9),d(16,"Status"),a(),r(17,"th",9),d(18,"A\xE7\xE3o Executada"),a()()(),r(19,"tbody",10),b(20,Vr,4,0,"tr",11)(21,Nr,3,0,"tr",11)(22,Br,10,16,"tr",12),a()()(),b(23,zr,9,5,"div",13),a()()}if(o&2){let e=u();l(4),y("Hist\xF3rico: ",e.automationName),l(16),c("ngIf",e.isLoading),l(),c("ngIf",!e.isLoading&&e.historyItems.length===0),l(),c("ngForOf",e.paginatedItems),l(),c("ngIf",e.totalPages>1)}}var bt=class o{firestoreService=x(V);isVisible=!1;automationId="";automationName="";ownerId="";boardId="";leads=[];closeModalEvent=new I;historyItems=[];paginatedItems=[];isLoading=!1;currentPage=1;itemsPerPage=10;totalPages=0;subscription;ngOnInit(){this.isVisible&&this.automationId&&this.loadHistory()}ngOnDestroy(){this.unsubscribe()}ngOnChanges(){this.isVisible&&this.automationId?this.loadHistory():this.isVisible||this.unsubscribe()}unsubscribe(){this.subscription&&(this.subscription(),this.subscription=void 0)}loadHistory(){return S(this,null,function*(){this.isLoading=!0,this.unsubscribe();try{this.subscription=this.firestoreService.subscribeToAutomationHistory(this.ownerId,this.boardId,this.automationId,t=>{this.historyItems=t.sort((e,i)=>{let n=e.timestamp?.toMillis?e.timestamp.toMillis():0;return(i.timestamp?.toMillis?i.timestamp.toMillis():0)-n}),this.currentPage=1,this.updatePagination(),this.isLoading=!1})}catch(t){console.error("Erro ao carregar hist\xF3rico de automa\xE7\xE3o:",t),this.isLoading=!1}})}updatePagination(){this.totalPages=Math.ceil(this.historyItems.length/this.itemsPerPage);let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;this.paginatedItems=this.historyItems.slice(t,e)}previousPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updatePagination())}getLeadName(t){let e=this.leads.find(i=>i.id===t);return e?e.fields?.companyName||e.fields?.title||"Lead sem nome":"Lead removido"}formatDate(t){if(!t)return"N/A";let e;if(t.toDate)e=t.toDate();else if(t instanceof Date)e=t;else return"N/A";return e.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getStatusText(t){return{success:"Sucesso",error:"Erro",pending:"Pendente",scheduled:"Agendada"}[t]||"Desconhecido"}closeModal(){this.unsubscribe(),this.closeModalEvent.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-automation-history-modal"]],inputs:{isVisible:"isVisible",automationId:"automationId",automationName:"automationName",ownerId:"ownerId",boardId:"boardId",leads:"leads"},outputs:{closeModalEvent:"closeModalEvent"},features:[Oe],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content","modal-content-lg","p-6",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold"],[1,"text-gray-500","hover:text-gray-800","text-2xl",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white"],[1,"bg-gray-50"],[1,"text-left","py-3","px-4","uppercase","font-semibold","text-sm","text-gray-600"],[1,"text-gray-700","divide-y","divide-gray-200"],[4,"ngIf"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],["class","p-4 flex justify-between items-center",4,"ngIf"],["colspan","4",1,"text-center","p-6","text-gray-500"],[1,"fas","fa-spinner","fa-spin","mr-2"],[1,"hover:bg-gray-50"],[1,"py-3","px-4"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"p-4","flex","justify-between","items-center"],[1,"bg-gray-200","hover:bg-gray-300","disabled:bg-gray-100","disabled:text-gray-400","text-gray-700","font-medium","py-2","px-4","rounded-lg",3,"click","disabled"],[1,"fas","fa-chevron-left","mr-1"],[1,"text-sm","text-gray-600"],[1,"fas","fa-chevron-right","ml-1"]],template:function(e,i){e&1&&b(0,$r,24,5,"div",0),e&2&&c("ngIf",i.isVisible)},dependencies:[O,R,j],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 4px 6px #0000001a;max-height:90vh;overflow-y:auto}.modal-content-lg[_ngcontent-%COMP%]{width:95%;max-width:900px}.overflow-x-auto[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{min-width:100%;background-color:#fff}thead[_ngcontent-%COMP%]{background-color:#f9fafb}th[_ngcontent-%COMP%]{text-align:left;padding:.75rem 1rem;text-transform:uppercase;font-weight:600;font-size:.875rem;color:#4b5563}td[_ngcontent-%COMP%]{padding:.75rem 1rem}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{color:#374151}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e5e7eb}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.text-center[_ngcontent-%COMP%]{text-align:center}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-600[_ngcontent-%COMP%]{color:#4b5563}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}.text-2xl[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}.font-bold[_ngcontent-%COMP%]{font-weight:700}.font-medium[_ngcontent-%COMP%]{font-weight:500}.text-sm[_ngcontent-%COMP%]{font-size:.875rem}.text-xs[_ngcontent-%COMP%]{font-size:.75rem}.px-2[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}.py-1[_ngcontent-%COMP%]{padding-top:.25rem;padding-bottom:.25rem}.py-2[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem}.px-4[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.p-6[_ngcontent-%COMP%]{padding:1.5rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mr-1[_ngcontent-%COMP%]{margin-right:.25rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.ml-1[_ngcontent-%COMP%]{margin-left:.25rem}.rounded-full[_ngcontent-%COMP%]{border-radius:9999px}.rounded-lg[_ngcontent-%COMP%]{border-radius:.5rem}.bg-green-100[_ngcontent-%COMP%]{background-color:#dcfce7}.text-green-800[_ngcontent-%COMP%]{color:#166534}.bg-red-100[_ngcontent-%COMP%]{background-color:#fee2e2}.text-red-800[_ngcontent-%COMP%]{color:#991b1b}.bg-yellow-100[_ngcontent-%COMP%]{background-color:#fef3c7}.text-yellow-800[_ngcontent-%COMP%]{color:#92400e}.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}.bg-gray-100[_ngcontent-%COMP%]{background-color:#f3f4f6}button[_ngcontent-%COMP%]:hover.hover\\\\:bg-gray-300{background-color:#d1d5db}button[_ngcontent-%COMP%]:hover.hover\\\\:text-gray-800{color:#1f2937}button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}button[_ngcontent-%COMP%]:disabled.disabled\\\\:bg-gray-100{background-color:#f3f4f6}button[_ngcontent-%COMP%]:disabled.disabled\\\\:text-gray-400{color:#9ca3af}.flex[_ngcontent-%COMP%]{display:flex}.justify-between[_ngcontent-%COMP%]{justify-content:space-between}.items-center[_ngcontent-%COMP%]{align-items:center}.space-x-2[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}"]})};function jr(o,t){o&1&&(r(0,"div",12),g(1,"div",13),a())}function Hr(o,t){if(o&1&&g(0,"img",20),o&2){let e=u(2);c("src",e.getCompanyLogo(),Xe)}}function Ur(o,t){if(o&1&&(r(0,"div",29),d(1),a()),o&2){let e=u(2);$("background-color",e.getPrimaryColor()),l(),y(" ",e.getCompanyInitials()," ")}}function qr(o,t){if(o&1){let e=C();r(0,"button",30),h("click",function(){let n=f(e).$implicit,s=u(2);return _(s.switchTab(n.id))}),g(1,"i"),d(2),a()}if(o&2){let e=t.$implicit,i=u(2);P("border-blue-500",i.activeTab===e.id)("text-blue-600",i.activeTab===e.id)("border-transparent",i.activeTab!==e.id)("text-gray-500",i.activeTab!==e.id)("hover:text-gray-700",i.activeTab!==e.id),l(),re(gi("fas ",e.icon," mr-2")),l(),y(" ",e.name," ")}}function Gr(o,t){if(o&1){let e=C();r(0,"button",31),h("click",function(){f(e);let n=u(2);return _(n.showCreateColumnModal())}),g(1,"i",27),d(2," Nova Fase "),a()}}function Kr(o,t){if(o&1){let e=C();r(0,"nav",14)(1,"div",15)(2,"div",16)(3,"div",17)(4,"button",18),h("click",function(){f(e);let n=u();return _(n.goToDashboard())}),g(5,"i",19),a(),r(6,"div"),ai(7,Hr,1,1,"img",20)(8,Ur,2,3,"div",21),a(),r(9,"div")(10,"h1",22),d(11),a()()()(),r(12,"div",23),b(13,qr,3,14,"button",24),a(),r(14,"div",25)(15,"button",26),h("click",function(){f(e);let n=u();return _(n.showCreateLeadModal())}),g(16,"i",27),d(17," Novo Registro "),a(),b(18,Gr,3,0,"button",28),a()()()}if(o&2){let e=u();l(7),si(e.hasCompanyLogo()?7:8),l(4),y(" ",(e.board==null?null:e.board.name)||"Quadro Kanban"," "),l(2),c("ngForOf",e.tabs),l(5),c("ngIf",e.activeTab==="kanban")}}function Wr(o,t){if(o&1&&(r(0,"div",62),d(1),a()),o&2){let e=u().$implicit;l(),y(" CNPJ: ",e.fields.cnpj," ")}}function Qr(o,t){if(o&1&&(r(0,"div",63),d(1),fi(2,"titlecase"),a()),o&2){let e=u().$implicit,i=u(3);re(i.getLeadStatusColor(e)),l(),y(" ",_i(2,3,e.fields.temperature)," ")}}function Zr(o,t){if(o&1&&(r(0,"div",64),g(1,"i",65),r(2,"span",66),d(3),a()()),o&2){let e=u().$implicit;l(3),E(e.fields.contactName)}}function Yr(o,t){if(o&1&&(r(0,"div",67),g(1,"i",68),r(2,"span",66),d(3),a()()),o&2){let e=u().$implicit;l(3),E(e.fields.contactEmail)}}function Jr(o,t){if(o&1&&(r(0,"div",67),g(1,"i",69),r(2,"span",66),d(3),a()()),o&2){let e=u().$implicit;l(3),E(e.fields.contactPhone)}}function Xr(o,t){if(o&1&&(r(0,"div",70)(1,"div",71),g(2,"i",72),r(3,"span"),d(4),a()()()),o&2){let e=u().$implicit,i=u(3);l(),re(i.getSlaStatus(e).colorClass),l(3),E(i.getSlaStatus(e).text)}}function ea(o,t){if(o&1&&(r(0,"div",73)(1,"p",74),d(2),a()()),o&2){let e=u().$implicit;l(2),y(" ",e.fields.description," ")}}function ta(o,t){if(o&1){let e=C();r(0,"div",48),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.showLeadDetailModal(n))}),r(1,"div",49)(2,"div",50)(3,"h4",51),d(4),a(),b(5,Wr,2,1,"div",52),a(),b(6,Qr,3,5,"div",53),a(),r(7,"div",54),b(8,Zr,4,1,"div",55)(9,Yr,4,1,"div",56)(10,Jr,4,1,"div",56),a(),b(11,Xr,5,3,"div",57),r(12,"div",36)(13,"div",58),g(14,"i",59),r(15,"span"),d(16),a()(),r(17,"div",60),d(18),a()(),b(19,ea,3,1,"div",61),a()}if(o&2){let e=t.$implicit,i=u(3);re(i.getSlaStatus(e).borderClass||i.getLeadPriorityClass(e)),c("cdkDragData",e.id),l(4),y(" ",e.fields.companyName||"Empresa n\xE3o informada"," "),l(),c("ngIf",e.fields==null?null:e.fields.cnpj),l(),c("ngIf",e.fields==null?null:e.fields.temperature),l(2),c("ngIf",e.fields==null?null:e.fields.contactName),l(),c("ngIf",e.fields==null?null:e.fields.contactEmail),l(),c("ngIf",e.fields==null?null:e.fields.contactPhone),l(),c("ngIf",i.getSlaStatus(e).text),l(5),E(i.formatDate(e.createdAt)),l(2),y(" ",i.getLeadInitials(e)," "),l(),c("ngIf",e.fields==null?null:e.fields.description)}}function ia(o,t){o&1&&(r(0,"div",75),g(1,"i",76),r(2,"p",77),d(3,"Nenhum lead nesta fase"),a()())}function na(o,t){if(o&1){let e=C();r(0,"div",34)(1,"div",35)(2,"div",36)(3,"div",37)(4,"h3",38),d(5),a(),r(6,"span",39),d(7),a()(),r(8,"div",40)(9,"button",41),h("click",function(){let n=f(e).$implicit,s=u(2);return _(s.showColumnForm(n))}),g(10,"i",42),a(),r(11,"button",43),h("click",function(){let n=f(e).$implicit,s=u(2);return _(s.editColumn(n))}),g(12,"i",44),a()()()(),r(13,"div",45),h("cdkDropListDropped",function(n){f(e);let s=u(2);return _(s.onLeadDrop(n))}),b(14,ta,20,13,"div",46)(15,ia,4,0,"div",47),a()()}if(o&2){let e=t.$implicit,i=u(2);$("background-color","#e2e8f0"),l(),$("border-top-color",i.getColumnBorderColor(e)),l(4),E(e.name),l(2),y(" ",i.getLeadsForColumn(e.id).length," "),l(6),c("id","column-"+e.id)("cdkDropListData",i.getLeadsForColumn(e.id))("cdkDropListConnectedTo",i.getColumnConnectedTo()),l(),c("ngForOf",i.getLeadsForColumn(e.id)),l(),c("ngIf",i.getLeadsForColumn(e.id).length===0)}}function oa(o,t){if(o&1&&(r(0,"div",32),b(1,na,16,11,"div",33),a()),o&2){let e=u();l(),c("ngForOf",e.columns)}}function ra(o,t){o&1&&(r(0,"div",78)(1,"div",79),g(2,"i",80),r(3,"h3",81),d(4,"Nenhuma coluna encontrada"),a(),r(5,"p",82),d(6," Este quadro ainda n\xE3o possui colunas configuradas. "),a()()())}function aa(o,t){if(o&1&&(r(0,"span"),g(1,"i",104),d(2),a()),o&2){let e=u().$implicit,i=u(3);l(2),y(" Atualizado em ",i.formatDate(e.updatedAt)," ")}}function sa(o,t){if(o&1){let e=C();r(0,"div",93)(1,"div",94)(2,"div",95)(3,"h3",96),d(4),a(),r(5,"p",97)(6,"strong"),d(7,"Assunto:"),a(),d(8),a(),r(9,"p",98)(10,"strong"),d(11,"Para:"),a(),d(12),a(),r(13,"div",99)(14,"span"),g(15,"i",100),d(16),a(),b(17,aa,3,1,"span",101),a()(),r(18,"div",102)(19,"button",103),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.editTemplate(n))}),g(20,"i",104),d(21," Editar "),a(),r(22,"button",105),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.deleteTemplate(n))}),g(23,"i",106),d(24," Excluir "),a()()()()}if(o&2){let e=t.$implicit,i=u(3);l(4),y(" ",e.name||"Template sem nome"," "),l(4),y(" ",e.subject||"Sem assunto"," "),l(4),y(" ",e.recipients||"N\xE3o especificado"," "),l(4),y(" Criado em ",i.formatDate(e.createdAt)," "),l(),c("ngIf",e.updatedAt)}}function la(o,t){if(o&1&&(r(0,"div",91),b(1,sa,25,5,"div",92),a()),o&2){let e=u(2);l(),c("ngForOf",e.emailTemplates)}}function da(o,t){o&1&&(r(0,"div",107)(1,"div",108),g(2,"i",109),r(3,"h3",110),d(4,"Nenhum template encontrado"),a(),r(5,"p"),d(6,"Crie templates personalizados para automa\xE7\xF5es de email"),a()()())}function ca(o,t){if(o&1){let e=C();r(0,"div",83)(1,"div",84)(2,"div",85)(3,"h2",86),d(4,"Templates de Email"),a(),r(5,"button",87),h("click",function(){f(e);let n=u();return _(n.createTemplate())}),g(6,"i",88),d(7," Novo Template "),a()(),b(8,la,2,1,"div",89)(9,da,7,0,"div",90),a()()}if(o&2){let e=u();l(8),c("ngIf",e.emailTemplates.length>0),l(),c("ngIf",e.emailTemplates.length===0)}}function ma(o,t){if(o&1&&(r(0,"span"),g(1,"i",123),d(2),a()),o&2){let e=u().$implicit,i=u(3);l(2),y(" \xDAltima execu\xE7\xE3o: ",i.formatDate(e.lastExecuted)," ")}}function ua(o,t){if(o&1){let e=C();r(0,"div",93)(1,"div",94)(2,"div",95)(3,"div",112)(4,"h3",113),d(5),a(),r(6,"span",114),d(7),a()(),r(8,"div",115)(9,"p",116),g(10,"i",117),r(11,"strong"),d(12,"Gatilho:"),a(),d(13),a(),r(14,"p",116),g(15,"i",118),r(16,"strong"),d(17,"A\xE7\xF5es:"),a(),d(18),a()(),r(19,"div",99)(20,"span"),g(21,"i",100),d(22),a(),b(23,ma,3,1,"span",101),a()(),r(24,"div",102)(25,"button",119),h("click",function(n){let s=f(e).$implicit,m=u(3);return _(m.showAutomationHistory(s,n))}),g(26,"i",120),d(27," Hist\xF3rico "),a(),r(28,"button",103),h("click",function(n){let s=f(e).$implicit,m=u(3);return _(m.editAutomation(s,n))}),g(29,"i",104),d(30," Editar "),a(),r(31,"button",121),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.toggleAutomation(n))}),g(32,"i",122),d(33),a(),r(34,"button",105),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.deleteAutomation(n))}),g(35,"i",106),d(36," Excluir "),a()()()()}if(o&2){let e=t.$implicit,i=u(3);l(5),y(" ",e.name," "),l(),P("bg-green-100",e.active)("text-green-800",e.active)("bg-red-100",!e.active)("text-red-800",!e.active),l(),y(" ",e.active?"Ativa":"Inativa"," "),l(6),y(" ",i.getTriggerDescription(e.trigger)," "),l(5),y(" ",i.getActionsCount(e.actions)," a\xE7\xE3o(\xF5es) configurada(s) "),l(4),y(" Criada em ",i.formatDate(e.createdAt)," "),l(),c("ngIf",e.lastExecuted),l(8),P("text-red-600",e.active)("hover:text-red-800",e.active)("text-green-600",!e.active)("hover:text-green-800",!e.active),l(),P("fa-pause",e.active)("fa-play",!e.active),l(),y(" ",e.active?"Pausar":"Ativar"," ")}}function pa(o,t){if(o&1&&(r(0,"div",91),b(1,ua,37,27,"div",92),a()),o&2){let e=u(2);l(),c("ngForOf",e.getValidAutomations())}}function ga(o,t){o&1&&(r(0,"div",107)(1,"div",108),g(2,"i",124),r(3,"h3",110),d(4,"Nenhuma automa\xE7\xE3o encontrada"),a(),r(5,"p"),d(6,"Configure automa\xE7\xF5es para disparar a\xE7\xF5es quando leads mudarem de fase"),a()()())}function ha(o,t){if(o&1){let e=C();r(0,"div",83)(1,"div",84)(2,"div",85)(3,"h2",86),d(4,"Automa\xE7\xF5es"),a(),r(5,"button",111),h("click",function(n){f(e);let s=u();return _(s.createAutomation(n))}),g(6,"i",88),d(7," Nova Automa\xE7\xE3o "),a()(),b(8,pa,2,1,"div",89)(9,ga,7,0,"div",90),a()()}if(o&2){let e=u();l(8),c("ngIf",e.getValidAutomations().length>0),l(),c("ngIf",e.getValidAutomations().length===0)}}function fa(o,t){if(o&1&&(r(0,"div",36)(1,"div",37),g(2,"div",138),r(3,"span",139),d(4),a()(),r(5,"span",82),d(6),a()()),o&2){let e=t.$implicit,i=u(2);l(2),$("background-color",e.color||"#4A90E2"),l(2),E(e.name),l(2),y("",i.getLeadsForColumn(e.id).length," leads")}}function _a(o,t){if(o&1&&(r(0,"div",83)(1,"div",84)(2,"div",85)(3,"h2",86),d(4,"Relat\xF3rios"),a(),r(5,"button",125),g(6,"i",126),d(7," Exportar Relat\xF3rio "),a()(),r(8,"div",127)(9,"div",107)(10,"div",36)(11,"div")(12,"p",128),d(13,"Total de Leads"),a(),r(14,"p",86),d(15),a()(),r(16,"div",129),g(17,"i",130),a()()(),r(18,"div",107)(19,"div",36)(20,"div")(21,"p",128),d(22,"Leads Ativos"),a(),r(23,"p",86),d(24),a()(),r(25,"div",131),g(26,"i",132),a()()(),r(27,"div",107)(28,"div",36)(29,"div")(30,"p",128),d(31,"Total de Colunas"),a(),r(32,"p",86),d(33),a()(),r(34,"div",133),g(35,"i",134),a()()()(),r(36,"div",107)(37,"h3",135),d(38,"Leads por Fase"),a(),r(39,"div",136),b(40,fa,7,4,"div",137),a()()()()),o&2){let e=u();l(15),E(e.leads.length),l(9),E(e.getActiveLeads().length),l(9),E(e.columns.length),l(7),c("ngForOf",e.columns)}}function ba(o,t){if(o&1){let e=C();r(0,"button",30),h("click",function(){let n=f(e).$implicit,s=u(2);return _(s.activeEmailStatus=n.id)}),d(1),r(2,"span",39),d(3),a()()}if(o&2){let e=t.$implicit,i=u(2);P("border-blue-500",i.activeEmailStatus===e.id)("text-blue-600",i.activeEmailStatus===e.id)("border-transparent",i.activeEmailStatus!==e.id)("text-gray-500",i.activeEmailStatus!==e.id),l(),y(" ",e.name," "),l(2),y(" ",e.count," ")}}function va(o,t){o&1&&(r(0,"div",108),g(1,"i",155),r(2,"h3",110),d(3,"Nenhum email encontrado"),a(),r(4,"p"),d(5,"Emails enviados aparecer\xE3o aqui"),a()())}function xa(o,t){if(o&1){let e=C();r(0,"button",169),h("click",function(){f(e);let n=u().$implicit,s=u(3);return _(s.retryEmail(n))}),g(1,"i",170),a()}}function ya(o,t){if(o&1){let e=C();r(0,"div",157)(1,"div",36)(2,"div",95)(3,"div",17),g(4,"div",158),r(5,"h4",159),d(6),a(),r(7,"span",160),d(8),a()(),r(9,"div",161)(10,"span"),g(11,"i",162),d(12),a(),r(13,"span"),g(14,"i",163),d(15),a()()(),r(16,"div",25)(17,"button",164),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.viewEmail(n))}),g(18,"i",165),a(),b(19,xa,2,0,"button",166),r(20,"button",167),h("click",function(){let n=f(e).$implicit,s=u(3);return _(s.deleteEmail(n))}),g(21,"i",168),a()()()()}if(o&2){let e=t.$implicit,i=u(3);l(4),P("bg-yellow-400",!e.delivery||e.delivery.state==="PENDING")("bg-green-400",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("bg-red-400",(e.delivery==null?null:e.delivery.state)==="ERROR"),l(2),E(e.subject||"Sem assunto"),l(),P("bg-yellow-100",!e.delivery||e.delivery.state==="PENDING")("text-yellow-800",!e.delivery||e.delivery.state==="PENDING")("bg-green-100",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("text-green-800",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("bg-red-100",(e.delivery==null?null:e.delivery.state)==="ERROR")("text-red-800",(e.delivery==null?null:e.delivery.state)==="ERROR"),l(),y(" ",i.getEmailStatusLabel(e)," "),l(4),y("Para: ",e.to),l(3),E(i.formatDate(e.createdAt)),l(4),c("ngIf",(e.delivery==null?null:e.delivery.state)==="ERROR"||!e.delivery)}}function Ca(o,t){if(o&1&&(r(0,"div",136),b(1,ya,22,23,"div",156),a()),o&2){let e=u(2);l(),c("ngForOf",e.getFilteredEmails())}}function wa(o,t){if(o&1){let e=C();r(0,"div",83)(1,"div",140)(2,"div",85)(3,"h2",86),d(4,"Caixa de Sa\xEDda"),a(),r(5,"div",141)(6,"button",142),g(7,"i",143),d(8," Atualizar "),a(),r(9,"button",144),g(10,"i",145),d(11," Novo Email "),a(),r(12,"button",146),h("click",function(){f(e);let n=u();return _(n.clearOutbox())}),g(13,"i",147),d(14," Limpar "),a()()(),r(15,"div",148)(16,"div",149)(17,"nav",150),b(18,ba,4,10,"button",151),a()(),r(19,"div",152),b(20,va,6,0,"div",153)(21,Ca,2,1,"div",154),a()()()()}if(o&2){let e=u();l(18),c("ngForOf",e.emailStatuses),l(2),c("ngIf",e.getFilteredEmails().length===0),l(),c("ngIf",e.getFilteredEmails().length>0)}}function Sa(o,t){if(o&1){let e=C();r(0,"div",83)(1,"div",84)(2,"div",85)(3,"h2",86),d(4,"Configura\xE7\xE3o da API"),a(),r(5,"div",25)(6,"span",116),d(7,"Status:"),a(),r(8,"span",171),g(9,"i",172),d(10,"Ativa "),a()()(),r(11,"div",173)(12,"div",174)(13,"h3",96),g(14,"i",175),d(15,"Endpoint para Novos Leads "),a(),r(16,"p",176),d(17," Use este endpoint para enviar novos leads diretamente para o seu kanban via API REST. "),a(),r(18,"div",177)(19,"div",178)(20,"span",179),d(21,"URL do Endpoint:"),a(),r(22,"button",180),h("click",function(){f(e);let n=u();return _(n.copyToClipboard(n.apiEndpoint))}),g(23,"i",181),d(24,"Copiar "),a()(),r(25,"code",182),d(26),a()()(),r(27,"div",174)(28,"h4",183),g(29,"i",184),d(30,"Token de Autentica\xE7\xE3o "),a(),r(31,"p",97),d(32," Inclua este token no header "),r(33,"code",185),d(34,"Authorization"),a(),d(35," de suas requisi\xE7\xF5es. "),a(),r(36,"div",177)(37,"div",178)(38,"span",179),d(39,"Bearer Token:"),a(),r(40,"button",180),h("click",function(){f(e);let n=u();return _(n.copyToClipboard(n.apiToken))}),g(41,"i",181),d(42,"Copiar "),a()(),r(43,"code",186),d(44),a()()(),r(45,"div",152)(46,"h4",183),g(47,"i",187),d(48,"Exemplo de Requisi\xE7\xE3o "),a(),r(49,"p",97),d(50," Exemplo de como enviar um novo lead via POST request: "),a(),r(51,"div",188)(52,"pre",77)(53,"code"),d(54),a()()()()(),r(55,"div",173)(56,"div",174)(57,"h3",96),g(58,"i",189),d(59,"Webhooks (Em breve) "),a(),r(60,"p",116),d(61," Receba notifica\xE7\xF5es quando leads mudarem de fase, forem criados ou atualizados. "),a()(),r(62,"div",152)(63,"div",190),g(64,"i",191),r(65,"h4",192),d(66,"Funcionalidade em Desenvolvimento"),a(),r(67,"p",77),d(68,"Webhooks estar\xE3o dispon\xEDveis em breve para integra\xE7\xE3o avan\xE7ada."),a()()()(),r(69,"div",193)(70,"h3",194),g(71,"i",195),d(72,"Documenta\xE7\xE3o da API "),a(),r(73,"div",196)(74,"div",197),g(75,"i",198),r(76,"div")(77,"strong"),d(78,"M\xE9todo:"),a(),d(79," POST para criar novos leads "),a()(),r(80,"div",197),g(81,"i",198),r(82,"div")(83,"strong"),d(84,"Content-Type:"),a(),d(85," application/json obrigat\xF3rio "),a()(),r(86,"div",197),g(87,"i",198),r(88,"div")(89,"strong"),d(90,"Autentica\xE7\xE3o:"),a(),d(91," Bearer token no header Authorization "),a()(),r(92,"div",197),g(93,"i",198),r(94,"div")(95,"strong"),d(96,"Campos obrigat\xF3rios:"),a(),d(97," companyName, contactName, contactEmail "),a()(),r(98,"div",197),g(99,"i",198),r(100,"div")(101,"strong"),d(102,"Resposta de sucesso:"),a(),d(103," Status 201 com dados do lead criado "),a()()()()()()}if(o&2){let e=u();l(26),y(" ",e.apiEndpoint," "),l(18),y(" ",e.apiToken," "),l(10),ui("POST ",e.apiEndpoint,`
Content-Type: application/json
Authorization: Bearer `,e.apiToken,`

{
  "companyName": "Nome da Empresa Exemplo",
  "cnpj": "00.000.000/0001-00",
  "contactName": "Nome do Contato",
  "contactEmail": "email@exemplo.com",
  "contactPhone": "(11) 99999-9999",
  "phaseId": "(Opcional) ID da fase para onde o lead deve ir"
}`)}}function Ea(o,t){if(o&1){let e=C();r(0,"app-automation-modal",199),h("closeModalEvent",function(){f(e);let n=u();return _(n.onCloseAutomationModal())})("saveAutomation",function(n){f(e);let s=u();return _(s.onSaveAutomation(n))}),a()}if(o&2){let e=u();c("isVisible",e.showAutomationModal)("automation",e.selectedAutomation)("phases",e.columns)("emailTemplates",e.emailTemplates)("users",e.users)}}var un=class o{authService=x(fe);firestoreService=x(V);subdomainService=x(de);automationService=x(rt);route=x(Si);router=x(Ei);leadModal;columnModal;phaseFormModal;leadDetailModal;templateModal;automationModal;board=null;columns=[];leads=[];currentUser=null;boardId="";ownerId="";subscriptions=[];isLoading=!0;activeTab="kanban";tabs=[{id:"kanban",name:"Kanban",icon:"fa-columns"},{id:"reports",name:"Relat\xF3rios",icon:"fa-chart-bar"},{id:"outbox",name:"Caixa de Sa\xEDda",icon:"fa-paper-plane"},{id:"templates",name:"Templates",icon:"fa-envelope"},{id:"automations",name:"Automa\xE7\xF5es",icon:"fa-cogs"},{id:"api",name:"API",icon:"fa-code"}];apiEndpoint="";apiToken="KzB47@p!qR9$tW2m&e*J";ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.boardId=this.route.snapshot.paramMap.get("boardId")||"",this.ownerId=this.route.snapshot.queryParamMap.get("ownerId")||this.currentUser?.uid||"",console.log("KanbanComponent - boardId:",this.boardId,"ownerId:",this.ownerId);let t=this.subdomainService.getCurrentCompany();t?(console.log("Definindo contexto da empresa no FirestoreService:",t.name,t.id),this.firestoreService.setCompanyContext(t)):console.warn("Empresa n\xE3o encontrada no contexto"),this.currentUser&&this.boardId&&this.ownerId?(this.loadBoardData(),this.subscribeToRealtimeUpdates(),this.initializeApiEndpoint()):console.error("Par\xE2metros faltando:",{currentUser:!!this.currentUser,boardId:this.boardId,ownerId:this.ownerId})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}initializeApiEndpoint(){let t=this.subdomainService.getCurrentCompany();t&&(this.subdomainService.isDevelopment()?this.apiEndpoint=`http://localhost:5000/api/v1/companies/${t.id}/leads`:this.apiEndpoint=`https://api.taskboard.com.br/v1/companies/${t.id}/leads`)}hasCompanyLogo(){let t=this.subdomainService.getCurrentCompany();return!!(t?.brandingConfig?.logo&&t.brandingConfig.logo.trim()!==""||t?.subdomain==="gobuyer")}getCompanyLogo(){let t=this.subdomainService.getCurrentCompany();return t?.brandingConfig?.logo&&t.brandingConfig.logo.trim()!==""?t.brandingConfig.logo:t?.subdomain==="gobuyer"?"https://apps.gobuyer.com.br/sso/assets/images/logos/logo-gobuyer.png":""}getPrimaryColor(){return this.subdomainService.getCurrentCompany()?.brandingConfig?.primaryColor||"#3B82F6"}getCompanyInitials(){let e=this.subdomainService.getCurrentCompany()?.name||"Task Board";if(!e||e==="Task Board")return"TB";let i=e.split(" ").filter(n=>n.length>0);return i.length===1?i[0].charAt(0).toUpperCase():i.length>=2?i[0].charAt(0).toUpperCase()+i[1].charAt(0).toUpperCase():"TB"}loadBoardData(){return S(this,null,function*(){try{yield this.loadUsers(),yield this.debugFirestoreCollections(),this.isLoading=!1}catch(t){console.error("Erro ao carregar dados do quadro:",t),this.isLoading=!1}})}debugFirestoreCollections(){return S(this,null,function*(){try{console.log("=== DEBUG: Testando acesso \xE0s cole\xE7\xF5es ==="),console.log("ownerId:",this.ownerId,"boardId:",this.boardId),console.log("Testando: users/"+this.ownerId+"/boards/"+this.boardId+"/emailTemplates");let t=yield this.firestoreService.getEmailTemplates(this.ownerId,this.boardId);console.log("Templates encontrados (m\xE9todo direto):",t),console.log("Testando: users/"+this.ownerId+"/boards/"+this.boardId+"/automations");let e=yield this.firestoreService.getAutomations(this.ownerId,this.boardId);console.log("Automa\xE7\xF5es encontradas (m\xE9todo direto):",e),console.log("=== Testando estrutura alternativa ==="),console.log("Testando: boards/"+this.boardId+"/emailTemplates");try{let i=yield this.firestoreService.getEmailTemplates("",this.boardId);console.log("Templates encontrados (estrutura alternativa):",i)}catch(i){console.log("Erro na estrutura alternativa para templates:",i)}}catch(t){console.error("Erro no debug das cole\xE7\xF5es:",t)}})}loadUsers(){return S(this,null,function*(){try{this.users=[{uid:this.currentUser?.uid,displayName:this.currentUser?.displayName,email:this.currentUser?.email}]}catch(t){console.error("Erro ao carregar usu\xE1rios:",t)}})}subscribeToRealtimeUpdates(){console.log("Subscribing to updates with ownerId:",this.ownerId,"boardId:",this.boardId);let t=this.firestoreService.subscribeToColumns(this.ownerId,this.boardId,m=>{console.log("Colunas recebidas:",m),this.columns=m});this.subscriptions.push({unsubscribe:t});let e=this.firestoreService.subscribeToLeads(this.ownerId,this.boardId,m=>{console.log("Leads recebidos:",m),this.leads=m,this.isLoading=!1});this.subscriptions.push({unsubscribe:e});let i=this.firestoreService.subscribeToOutboxEmails(this.ownerId,this.boardId,m=>{console.log("Emails da caixa de sa\xEDda recebidos:",m),this.outboxEmails=m,this.updateEmailStatusCounts()});this.subscriptions.push({unsubscribe:i});let n=this.firestoreService.subscribeToEmailTemplates(this.ownerId,this.boardId,m=>{console.log("Templates recebidos:",m),this.emailTemplates=m});this.subscriptions.push({unsubscribe:n}),console.log("=== SUBSCRI\xC7\xC3O DE AUTOMA\xC7\xD5ES ==="),console.log("ownerId:",this.ownerId,"boardId:",this.boardId),console.log("Iniciando subscri\xE7\xE3o...");let s=this.firestoreService.subscribeToAutomations(this.ownerId,this.boardId,m=>{console.log("=== CALLBACK DE AUTOMA\xC7\xD5ES EXECUTADO ==="),console.log("Automa\xE7\xF5es recebidas:",m),console.log("N\xFAmero de automa\xE7\xF5es:",m.length),console.log("Tipo dos dados:",typeof m,Array.isArray(m)),m&&m.length>0?(console.log("Primeira automa\xE7\xE3o completa:",m[0]),console.log("Campos da primeira automa\xE7\xE3o:",Object.keys(m[0]))):console.log("Nenhuma automa\xE7\xE3o encontrada ou array vazio"),this.automations=m||[],console.log("this.automations definido como:",this.automations),this.cleanupInvalidAutomations(),console.log("=== FIM CALLBACK AUTOMA\xC7\xD5ES ===")});this.subscriptions.push({unsubscribe:s})}getLeadsForColumn(t){return this.leads.filter(e=>e.columnId===t)}getColumnConnectedTo(){return this.columns.map(t=>`column-${t.id}`)}onLeadDrop(t){return S(this,null,function*(){let e=t.item.data,i=t.container.id.replace("column-",""),n=t.previousContainer.id.replace("column-","");if(t.previousContainer===t.container)De(t.container.data,t.previousIndex,t.currentIndex);else{nn(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex);let s=this.leads.find(m=>m.id===e);try{if(yield this.firestoreService.moveLead(this.ownerId,this.boardId,e,i),s){console.log("\u{1F504} Processando automa\xE7\xF5es para mudan\xE7a de fase:",{leadId:s.id,oldColumn:n,newColumn:i});try{yield this.automationService.processPhaseChangeAutomations(s,i,n,this.boardId,this.ownerId)}catch(m){console.error("Erro ao processar automa\xE7\xF5es de mudan\xE7a de fase:",m)}}}catch(m){console.error("Erro ao mover lead:",m),this.subscribeToRealtimeUpdates()}}})}logout(){return S(this,null,function*(){(yield this.authService.logout()).success&&this.router.navigate(["/login"])})}goToDashboard(){this.router.navigate(["/dashboard"])}formatDate(t){if(!t)return console.log("formatDate: timestamp is null/undefined"),"Data n\xE3o dispon\xEDvel";try{return t.seconds?new Date(t.seconds*1e3).toLocaleDateString("pt-BR"):t.toDate?t.toDate().toLocaleDateString("pt-BR"):t instanceof Date?t.toLocaleDateString("pt-BR"):new Date(t).toLocaleDateString("pt-BR")}catch(e){return console.log("formatDate error:",e,"timestamp:",t),"Data inv\xE1lida"}}getColumnBorderColor(t){return t.color||"#e5e7eb"}getLeadPriorityClass(t){let e=t.fields?.temperature;return e==="quente"?"border-l-red-500":e==="morno"?"border-l-yellow-500":"border-l-transparent"}getLeadInitials(t){return(t.fields?.companyName||t.fields?.contactName||"").split(" ").map(i=>i.charAt(0)).join("").substring(0,2).toUpperCase()}showCreateLeadModal(){this.leadModal.showCreateModal()}showEditLeadModal(t){this.leadModal.showEditModal(t)}showLeadDetailModal(t){this.leadDetailModal.show(t)}onLeadCreated(){return S(this,null,function*(){console.log("Novo lead criado!"),setTimeout(()=>S(this,null,function*(){try{yield this.automationService.processNewLeadAutomations(this.leads[this.leads.length-1],this.boardId,this.ownerId)}catch(t){console.error("Erro ao processar automa\xE7\xF5es de novo lead:",t)}}),1e3)})}onLeadUpdated(){console.log("Lead atualizado!")}onLeadDeleted(){console.log("Lead exclu\xEDdo!")}switchTab(t){this.activeTab=t}getActiveLeads(){return this.leads.filter(t=>{let e=this.columns.find(i=>i.id===t.columnId);return e&&(!e.endStageType||e.endStageType==="none")})}outboxEmails=[];activeEmailStatus="all";emailStatuses=[{id:"all",name:"Todos",count:0},{id:"scheduled",name:"Agendados",count:0},{id:"success",name:"Enviados",count:0},{id:"error",name:"Com Erro",count:0}];emailTemplates=[];automations=[];users=[];updateEmailStatusCounts(){let t={all:this.outboxEmails.length,scheduled:this.outboxEmails.filter(e=>!e.delivery||e.delivery.state==="PENDING").length,success:this.outboxEmails.filter(e=>e.delivery?.state==="SUCCESS").length,error:this.outboxEmails.filter(e=>e.delivery?.state==="ERROR").length};this.emailStatuses=[{id:"all",name:"Todos",count:t.all},{id:"scheduled",name:"Na Fila",count:t.scheduled},{id:"success",name:"Enviados",count:t.success},{id:"error",name:"Com Erro",count:t.error}]}getFilteredEmails(){return this.activeEmailStatus==="all"?this.outboxEmails:this.outboxEmails.filter(t=>{switch(this.activeEmailStatus){case"scheduled":return!t.delivery||t.delivery.state==="PENDING";case"success":return t.delivery?.state==="SUCCESS";case"error":return t.delivery?.state==="ERROR";default:return!1}})}getEmailStatusLabel(t){if(!t.delivery)return"Na Fila";switch(t.delivery.state){case"SUCCESS":return"Enviado";case"ERROR":return"Erro";case"PENDING":return"Na Fila";default:return t.delivery.state||"Desconhecido"}}viewEmail(t){console.log("Visualizar email:",t);let e=t.delivery?.endTime?new Date(t.delivery.endTime.seconds*1e3).toLocaleString("pt-BR"):"---",i=t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleString("pt-BR"):"---";alert(`Visualizar Email:

Para: ${t.to||"N\xE3o especificado"}
Assunto: ${t.subject||"Sem assunto"}
Status: ${this.getEmailStatusLabel(t)}
Criado em: ${i}
Enviado em: ${e}

Conte\xFAdo:
${t.html||t.text||"Sem conte\xFAdo dispon\xEDvel"}`)}retryEmail(t){return S(this,null,function*(){try{yield this.firestoreService.updateOutboxEmail(this.ownerId,this.boardId,t.id,{status:"scheduled",scheduledAt:new Date,retryCount:(t.retryCount||0)+1}),console.log("Email reagendado para reenvio")}catch(e){console.error("Erro ao reenviar email:",e),alert("Erro ao reenviar email. Tente novamente.")}})}deleteEmail(t){return S(this,null,function*(){if(confirm("Tem certeza que deseja excluir este email?"))try{yield this.firestoreService.deleteOutboxEmail(this.ownerId,this.boardId,t.id),console.log("Email exclu\xEDdo com sucesso")}catch(e){console.error("Erro ao excluir email:",e),alert("Erro ao excluir email. Tente novamente.")}})}showCreateColumnModal(){this.columnModal.showCreateModal()}editColumn(t){this.columnModal.showEditModal(t)}deleteColumn(t){return S(this,null,function*(){if(confirm(`Tem certeza que deseja excluir a fase "${t.name}"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.`))try{yield this.firestoreService.deleteColumn(this.ownerId,this.boardId,t.id),console.log("Fase exclu\xEDda com sucesso")}catch(e){console.error("Erro ao excluir fase:",e),alert("Erro ao excluir fase. Tente novamente.")}})}onColumnCreated(){console.log("Nova fase criada!")}onColumnUpdated(){console.log("Fase atualizada!")}onColumnDeleted(){console.log("Fase exclu\xEDda!")}showColumnForm(t){return S(this,null,function*(){try{let e=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,t.id);this.phaseFormModal.showModal(t,e||void 0)}catch(e){console.error("Erro ao carregar configura\xE7\xE3o do formul\xE1rio:",e),this.phaseFormModal.showModal(t,void 0)}})}onPhaseFormConfigSaved(){console.log("Configura\xE7\xE3o de formul\xE1rio salva!")}getSlaStatus(t){let e=this.columns.find(v=>v.id===t.columnId);if(!e||!e.slaDays||e.slaDays<=0||!t.movedToCurrentColumnAt)return{status:"none",text:"",colorClass:"",borderClass:""};let i=t.movedToCurrentColumnAt.seconds?new Date(t.movedToCurrentColumnAt.seconds*1e3):new Date(t.movedToCurrentColumnAt),n=new Date,m=new Date(i.getTime()+e.slaDays*24*60*60*1e3).getTime()-n.getTime(),p=m/(1e3*60*60*24);return p<0?{status:"overdue",text:`Atrasado ${Math.abs(Math.floor(p))}d`,colorClass:"text-red-600",borderClass:"border-l-red-500"}:p<e.slaDays*.25?{status:"at-risk",text:`${Math.ceil(m/36e5)}h restantes`,colorClass:"text-yellow-600",borderClass:"border-l-yellow-500"}:{status:"ok",text:`${Math.ceil(p)}d restantes`,colorClass:"text-green-600",borderClass:"border-l-green-500"}}getLeadStatusColor(t){let e=t.fields?.temperature;return e==="quente"?"bg-red-100 text-red-800":e==="morno"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}getTriggerDescription(t){if(!t)return"N\xE3o especificado";let i={"new-lead-created":"Quando um novo lead \xE9 criado","card-enters-phase":"Quando lead entra em uma fase","card-in-phase-for-time":"Quando lead fica muito tempo na fase","form-not-answered":"Quando formul\xE1rio n\xE3o \xE9 respondido","sla-overdue":"Quando SLA da fase vence"}[t.type]||t.type;if(t.phase&&this.columns.length>0){let n=this.columns.find(s=>s.id===t.phase);n&&(i+=` (${n.name})`)}return t.days&&(i+=` (${t.days} dias)`),i}toggleAutomationStatus(t,e){return S(this,null,function*(){try{yield this.firestoreService.updateAutomation(this.ownerId,this.boardId,t,{active:!e}),console.log("Status da automa\xE7\xE3o alterado:",t)}catch(i){console.error("Erro ao alterar status da automa\xE7\xE3o:",i)}})}deleteAutomation(t){return S(this,null,function*(){if(confirm("Tem certeza que deseja excluir esta automa\xE7\xE3o?"))try{yield this.firestoreService.deleteAutomation(this.ownerId,this.boardId,t.id),console.log("Automa\xE7\xE3o exclu\xEDda:",t.id)}catch(e){console.error("Erro ao excluir automa\xE7\xE3o:",e)}})}toggleAutomation(t){this.toggleAutomationStatus(t.id,t.active)}getActionsCount(t){return t?t.length:0}getValidAutomations(){return this.automations.filter(t=>t&&t.name&&t.name.trim()!==""&&t.name!=="Automa\xE7\xE3o sem nome")}cleanupInvalidAutomations(){return S(this,null,function*(){let t=this.automations.filter(e=>!e||!e.name||e.name.trim()===""||e.name==="Automa\xE7\xE3o sem nome");if(t.length>0){console.log("Encontradas automa\xE7\xF5es inv\xE1lidas, removendo:",t);for(let e of t)if(e.id)try{yield this.firestoreService.deleteAutomation(this.ownerId,this.boardId,e.id),console.log("Automa\xE7\xE3o inv\xE1lida removida:",e.id)}catch(i){console.error("Erro ao remover automa\xE7\xE3o inv\xE1lida:",i)}}})}createTemplate(){this.templateModal.showCreateModal()}editTemplate(t){this.templateModal.showEditModal(t)}deleteTemplate(t){return S(this,null,function*(){if(confirm("Tem certeza que deseja excluir este template?"))try{yield this.firestoreService.deleteEmailTemplate(this.ownerId,this.boardId,t.id),console.log("Template exclu\xEDdo com sucesso!")}catch(e){console.error("Erro ao excluir template:",e)}})}onTemplateSaved(){this.templateModal.hide()}showAutomationModal=!1;selectedAutomation=null;showHistoryModal=!1;selectedAutomationForHistory=null;createAutomation(t){t&&(t.preventDefault(),t.stopPropagation()),console.log("=== BOT\xC3O NOVA AUTOMA\xC7\xC3O CLICADO ==="),this.selectedAutomation=null,this.showAutomationModal=!0}editAutomation(t,e){e&&(e.preventDefault(),e.stopPropagation()),console.log("=== EDITAR AUTOMA\xC7\xC3O ===",t),this.selectedAutomation=t,this.showAutomationModal=!0}onCloseAutomationModal(){this.showAutomationModal=!1,this.selectedAutomation=null}onSaveAutomation(t){return S(this,null,function*(){try{t.id?(yield this.firestoreService.updateAutomation(this.ownerId,this.boardId,t.id,t),console.log("Automa\xE7\xE3o atualizada com sucesso:",t.name)):(yield this.firestoreService.createAutomation(this.ownerId,this.boardId,t),console.log("Automa\xE7\xE3o criada com sucesso:",t.name))}catch(e){console.error("Erro ao salvar automa\xE7\xE3o:",e),alert("Erro ao salvar automa\xE7\xE3o. Verifique o console para detalhes.")}})}showAutomationHistory(t,e){e&&(e.preventDefault(),e.stopPropagation()),console.log("=== MOSTRAR HIST\xD3RICO DE AUTOMA\xC7\xC3O ===",t),this.selectedAutomationForHistory=t,this.showHistoryModal=!0}onCloseHistoryModal(){this.showHistoryModal=!1,this.selectedAutomationForHistory=null}clearOutbox(){return S(this,null,function*(){if(confirm("Deseja excluir todos os emails da caixa de sa\xEDda? Esta a\xE7\xE3o n\xE3o pode ser desfeita."))try{yield this.firestoreService.clearOutboxEmails(this.ownerId,this.boardId),console.log("\u2705 Caixa de sa\xEDda limpa com sucesso")}catch(t){console.error("\u274C Erro ao limpar caixa de sa\xEDda:",t),alert("Erro ao limpar caixa de sa\xEDda. Tente novamente.")}})}copyToClipboard(t){navigator.clipboard.writeText(t).then(()=>{console.log("Texto copiado:",t)}).catch(e=>{console.error("Erro ao copiar texto:",e)})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-kanban"]],viewQuery:function(e,i){if(e&1&&(U($e,5),U(He,5),U(Ue,5),U(qe,5),U(Ge,5),U(Ke,5)),e&2){let n;q(n=G())&&(i.leadModal=n.first),q(n=G())&&(i.columnModal=n.first),q(n=G())&&(i.phaseFormModal=n.first),q(n=G())&&(i.leadDetailModal=n.first),q(n=G())&&(i.templateModal=n.first),q(n=G())&&(i.automationModal=n.first)}},decls:17,vars:30,consts:[["class","flex justify-center items-center py-20",4,"ngIf"],["class","bg-white px-8 border-b border-gray-200",4,"ngIf"],["class","kanban-board",4,"ngIf"],["class","text-center py-20",4,"ngIf"],["class","p-8",4,"ngIf"],[3,"leadCreated","leadUpdated","closeModal","ownerId","boardId","columns"],[3,"columnCreated","columnUpdated","columnDeleted","closeModal","ownerId","boardId","columns"],[3,"formConfigSaved","closeModal","ownerId","boardId"],[3,"leadUpdated","leadDeleted","closeModal","ownerId","boardId","columns","users"],[3,"templateSaved","closeModal","ownerId","boardId"],[3,"isVisible","automation","phases","emailTemplates","users","closeModalEvent","saveAutomation",4,"ngIf"],[3,"closeModalEvent","isVisible","automationId","automationName","ownerId","boardId","leads"],[1,"flex","justify-center","items-center","py-20"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"bg-white","px-8","border-b","border-gray-200"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","space-x-4"],[1,"flex","items-center","space-x-3"],[1,"text-gray-500","hover:text-gray-700","p-1","rounded","hover:bg-gray-100","transition-colors",3,"click"],[1,"fas","fa-arrow-left"],["alt","Logo da Empresa",1,"h-8","w-auto","rounded",3,"src"],[1,"h-8","w-8","rounded-lg","flex","items-center","justify-center","text-white","font-bold","text-sm",3,"background-color"],[1,"text-lg","font-semibold","text-gray-900"],[1,"flex","space-x-8"],["class","py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",3,"border-blue-500","text-blue-600","border-transparent","text-gray-500","hover:text-gray-700","click",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"fas","fa-plus","mr-1"],["class","bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",3,"click",4,"ngIf"],[1,"h-8","w-8","rounded-lg","flex","items-center","justify-center","text-white","font-bold","text-sm"],[1,"py-4","px-1","border-b-2","font-medium","text-sm","transition-colors","duration-200",3,"click"],[1,"bg-gray-400","hover:bg-gray-500","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"kanban-board"],["class","kanban-column",3,"background-color",4,"ngFor","ngForOf"],[1,"kanban-column"],[1,"kanban-column-header"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"font-semibold","text-gray-800"],[1,"ml-2","bg-gray-200","text-gray-600","text-xs","px-2","py-1","rounded-full"],[1,"flex","items-center","space-x-1","ml-auto"],["title","Configurar Campos do Formul\xE1rio",1,"p-1","text-blue-600","hover:bg-blue-50","rounded",3,"click"],[1,"fas","fa-list-check","text-sm"],["title","Editar Fase",1,"p-1","text-gray-600","hover:bg-gray-50","rounded",3,"click"],[1,"fas","fa-edit","text-sm"],["cdkDropList","",1,"kanban-cards",3,"cdkDropListDropped","id","cdkDropListData","cdkDropListConnectedTo"],["class","bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 cursor-pointer mb-3 p-4 border-l-4","cdkDrag","",3,"class","cdkDragData","click",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-400",4,"ngIf"],["cdkDrag","",1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","hover:shadow-md","transition-all","duration-200","cursor-pointer","mb-3","p-4","border-l-4",3,"click","cdkDragData"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900","text-sm","truncate","mb-1"],["class","text-xs text-gray-500",4,"ngIf"],["class","px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ml-2",3,"class",4,"ngIf"],[1,"space-y-1","mb-3"],["class","flex items-center text-sm text-gray-700",4,"ngIf"],["class","flex items-center text-xs text-gray-600",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"flex","items-center","text-xs","text-gray-500"],[1,"far","fa-calendar-alt","w-3","h-3","mr-1"],[1,"w-6","h-6","bg-blue-500","text-white","rounded-full","flex","items-center","justify-center","text-xs","font-bold","border-2","border-white","shadow-sm"],["class","mt-2 pt-2 border-t border-gray-100",4,"ngIf"],[1,"text-xs","text-gray-500"],[1,"px-2","py-1","rounded-full","text-xs","font-medium","flex-shrink-0","ml-2"],[1,"flex","items-center","text-sm","text-gray-700"],[1,"fas","fa-user","w-3","h-3","mr-2","text-gray-400"],[1,"truncate"],[1,"flex","items-center","text-xs","text-gray-600"],[1,"fas","fa-envelope","w-3","h-3","mr-2","text-gray-400"],[1,"fas","fa-phone","w-3","h-3","mr-2","text-gray-400"],[1,"mb-3"],[1,"flex","items-center","text-xs","font-medium"],[1,"fas","fa-clock","w-3","h-3","mr-1"],[1,"mt-2","pt-2","border-t","border-gray-100"],[1,"text-xs","text-gray-600","line-clamp-2"],[1,"text-center","py-8","text-gray-400"],[1,"fas","fa-inbox","text-2xl","mb-2"],[1,"text-sm"],[1,"text-center","py-20"],[1,"max-w-md","mx-auto"],[1,"fas","fa-columns","text-6xl","text-gray-300","mb-4"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"p-8"],[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"fas","fa-plus","mr-2"],["class","grid gap-4",4,"ngIf"],["class","bg-white rounded-lg shadow p-6",4,"ngIf"],[1,"grid","gap-4"],["class","bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",4,"ngFor","ngForOf"],[1,"bg-white","border","border-gray-200","rounded-lg","p-6","hover:shadow-md","transition-shadow"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-3"],[1,"text-xs","text-gray-500","mb-4"],[1,"flex","items-center","text-xs","text-gray-500","space-x-4"],[1,"far","fa-calendar-alt","mr-1"],[4,"ngIf"],[1,"flex","items-center","space-x-2","ml-4"],[1,"text-blue-600","hover:text-blue-800","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-edit","mr-1"],[1,"text-red-600","hover:text-red-800","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-trash","mr-1"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-center","py-12","text-gray-500"],[1,"fas","fa-envelope","text-6xl","mb-4"],[1,"text-xl","font-semibold","mb-2"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"flex","items-center","mb-2"],[1,"text-lg","font-semibold","text-gray-900","mr-3"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"space-y-2","mb-4"],[1,"text-sm","text-gray-600"],[1,"fas","fa-bolt","mr-2"],[1,"fas","fa-play","mr-2"],["title","Ver Hist\xF3rico",1,"text-gray-500","hover:text-blue-600","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-history","mr-1"],[1,"px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","mr-1"],[1,"fas","fa-play","mr-1"],[1,"fas","fa-cogs","text-6xl","mb-4"],[1,"bg-purple-500","hover:bg-purple-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors"],[1,"fas","fa-download","mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6","mb-8"],[1,"text-sm","font-medium","text-gray-600"],[1,"bg-blue-100","p-3","rounded-full"],[1,"fas","fa-users","text-blue-500"],[1,"bg-green-100","p-3","rounded-full"],[1,"fas","fa-chart-line","text-green-500"],[1,"bg-purple-100","p-3","rounded-full"],[1,"fas","fa-columns","text-purple-500"],[1,"text-lg","font-semibold","mb-4"],[1,"space-y-4"],["class","flex items-center justify-between",4,"ngFor","ngForOf"],[1,"w-4","h-4","rounded-full","mr-3"],[1,"font-medium"],[1,"max-w-6xl","mx-auto"],[1,"flex","space-x-2"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors"],[1,"fas","fa-sync","mr-2"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors"],[1,"fas","fa-envelope","mr-2"],[1,"bg-red-500","hover:bg-red-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"fas","fa-trash","mr-2"],[1,"bg-white","rounded-lg","shadow"],[1,"border-b","border-gray-200"],[1,"flex","space-x-8","px-6"],["class","py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",3,"border-blue-500","text-blue-600","border-transparent","text-gray-500","click",4,"ngFor","ngForOf"],[1,"p-6"],["class","text-center py-12 text-gray-500",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"fas","fa-paper-plane","text-6xl","mb-4"],["class","border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-gray-900"],[1,"px-2","py-1","text-xs","rounded-full"],[1,"mt-2","flex","items-center","space-x-4","text-sm","text-gray-500"],[1,"fas","fa-envelope","mr-1"],[1,"fas","fa-clock","mr-1"],[1,"text-blue-600","hover:text-blue-800",3,"click"],[1,"fas","fa-eye"],["class","text-green-600 hover:text-green-800",3,"click",4,"ngIf"],[1,"text-red-600","hover:text-red-800",3,"click"],[1,"fas","fa-trash"],[1,"text-green-600","hover:text-green-800",3,"click"],[1,"fas","fa-redo"],[1,"px-2","py-1","bg-green-100","text-green-800","text-xs","font-medium","rounded"],[1,"fas","fa-check-circle","mr-1"],[1,"bg-white","rounded-lg","shadow","mb-6"],[1,"p-6","border-b","border-gray-200"],[1,"fas","fa-link","mr-2","text-blue-500"],[1,"text-sm","text-gray-600","mb-4"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-blue-600","hover:text-blue-800","text-sm",3,"click"],[1,"fas","fa-copy","mr-1"],[1,"bg-blue-50","text-blue-800","text-sm","p-2","rounded","border","block"],[1,"text-md","font-semibold","text-gray-900","mb-2"],[1,"fas","fa-key","mr-2","text-yellow-500"],[1,"bg-gray-100","px-1","rounded"],[1,"bg-yellow-50","text-yellow-800","text-sm","p-2","rounded","border","block","font-mono"],[1,"fas","fa-code","mr-2","text-green-500"],[1,"bg-gray-900","text-gray-100","rounded-lg","p-4","overflow-x-auto"],[1,"fas","fa-broadcast-tower","mr-2","text-purple-500"],[1,"text-center","py-8","text-gray-500"],[1,"fas","fa-construction","text-4xl","mb-3"],[1,"font-semibold","mb-2"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-6"],[1,"text-lg","font-semibold","text-blue-900","mb-3"],[1,"fas","fa-book","mr-2"],[1,"space-y-3","text-sm","text-blue-800"],[1,"flex","items-start","space-x-3"],[1,"fas","fa-check-circle","mt-0.5","text-blue-600"],[3,"closeModalEvent","saveAutomation","isVisible","automation","phases","emailTemplates","users"]],template:function(e,i){e&1&&(r(0,"app-main-layout"),b(1,jr,2,0,"div",0)(2,Kr,19,4,"nav",1)(3,oa,2,1,"div",2)(4,ra,7,0,"div",3)(5,ca,10,2,"div",4)(6,ha,10,2,"div",4)(7,_a,41,4,"div",4)(8,wa,22,3,"div",4)(9,Sa,104,4,"div",4),r(10,"app-lead-modal",5),h("leadCreated",function(){return i.onLeadCreated()})("leadUpdated",function(){return i.onLeadUpdated()})("closeModal",function(){return i.onLeadUpdated()}),a(),r(11,"app-column-modal",6),h("columnCreated",function(){return i.onColumnCreated()})("columnUpdated",function(){return i.onColumnUpdated()})("columnDeleted",function(){return i.onColumnDeleted()})("closeModal",function(){return i.onColumnUpdated()}),a(),r(12,"app-phase-form-modal",7),h("formConfigSaved",function(){return i.onPhaseFormConfigSaved()})("closeModal",function(){return i.onPhaseFormConfigSaved()}),a(),r(13,"app-lead-detail-modal",8),h("leadUpdated",function(){return i.onLeadUpdated()})("leadDeleted",function(){return i.onLeadDeleted()})("closeModal",function(){return i.onLeadUpdated()}),a(),r(14,"app-template-modal",9),h("templateSaved",function(){return i.onTemplateSaved()})("closeModal",function(){return i.onTemplateSaved()}),a(),b(15,Ea,1,5,"app-automation-modal",10),r(16,"app-automation-history-modal",11),h("closeModalEvent",function(){return i.onCloseHistoryModal()}),a()()),e&2&&(l(),c("ngIf",i.isLoading),l(),c("ngIf",!i.isLoading),l(),c("ngIf",!i.isLoading&&i.activeTab==="kanban"),l(),c("ngIf",!i.isLoading&&i.activeTab==="kanban"&&i.columns.length===0),l(),c("ngIf",!i.isLoading&&i.activeTab==="templates"),l(),c("ngIf",!i.isLoading&&i.activeTab==="automations"),l(),c("ngIf",!i.isLoading&&i.activeTab==="reports"),l(),c("ngIf",!i.isLoading&&i.activeTab==="outbox"),l(),c("ngIf",!i.isLoading&&i.activeTab==="api"),l(),c("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns),l(),c("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns),l(),c("ownerId",i.ownerId)("boardId",i.boardId),l(),c("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns)("users",i.users),l(),c("ownerId",i.ownerId)("boardId",i.boardId),l(),c("ngIf",i.showAutomationModal),l(),c("isVisible",i.showHistoryModal)("automationId",(i.selectedAutomationForHistory==null?null:i.selectedAutomationForHistory.id)||"")("automationName",(i.selectedAutomationForHistory==null?null:i.selectedAutomationForHistory.name)||"")("ownerId",i.ownerId)("boardId",i.boardId)("leads",i.leads))},dependencies:[O,R,j,ht,gt,pt,$e,He,Ue,qe,Ge,Ke,bt,Fi,Ci],styles:[".kanban-board[_ngcontent-%COMP%]{display:flex;gap:16px;padding:24px;overflow-x:auto;min-height:calc(100vh - 80px)}.kanban-column[_ngcontent-%COMP%]{min-width:320px;max-width:320px;background-color:#e2e8f0;border-radius:12px;display:flex;flex-direction:column;transition:opacity .2s ease-in-out}.kanban-column-header[_ngcontent-%COMP%]{padding:12px 16px;font-weight:600;display:flex;justify-content:space-between;align-items:center;border-top-width:4px;border-top-style:solid;border-top-left-radius:12px;border-top-right-radius:12px;transition:background-color .3s}.kanban-cards[_ngcontent-%COMP%]{flex-grow:1;padding:8px 16px;overflow-y:auto;min-height:200px}.kanban-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:12px;margin-bottom:12px;cursor:pointer;box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;transition:box-shadow .2s,transform .2s;border-left:5px solid transparent;position:relative}.kanban-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;transform:translateY(-1px)}.card-avatar[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:8px;width:28px;height:28px;background-color:#94a3b8;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;border:2px solid white}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:8px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .kanban-card[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};export{un as KanbanComponent};
