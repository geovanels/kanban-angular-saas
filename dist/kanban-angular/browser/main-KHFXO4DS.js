import{b as j,e as k,h as M,i as O}from"./chunk-TB5PERY5.js";import{a as U}from"./chunk-J5JVRSLK.js";import{a as A,d as F,e as c,f as w}from"./chunk-BZPYHLGH.js";import{a as D}from"./chunk-HLLJH4E5.js";import{c as I}from"./chunk-KJIKDUO6.js";import{a as l}from"./chunk-G33XGYG2.js";import{D as z}from"./chunk-CXGKOLI5.js";import{$ as T,B as H,E,L as N,T as P,v as x,w as R}from"./chunk-3VCHQSRR.js";import{Bb as y,_ as s,bb as b,da as i,f as m,fa as g,i as f,jc as S,sa as v,ta as C,z as h}from"./chunk-CM3JQ4U2.js";var G={production:!1,firebase:{apiKey:"AIzaSyB8wAgN-sgQaBybaaVAw9sXUDs5Z6r7Wcw",authDomain:"kanban-gobuyer.firebaseapp.com",projectId:"kanban-gobuyer",storageBucket:"kanban-gobuyer.appspot.com",messagingSenderId:"269726968959",appId:"1:269726968959:web:6aaf53ba4f7bf6b64d39c9"}};var d=class t{companyService=i(T);intercept(e,n){let r=this.companyService.getCompanySubdomain();if(r&&e.url.includes("/api/")){let o=e.clone({setHeaders:{"X-Company-Subdomain":r}});return n.handle(o)}return n.handle(e)}static \u0275fac=function(n){return new(n||t)};static \u0275prov=s({token:t,factory:t.\u0275fac})};var p=(t,e)=>{let n=i(D),r=i(c);return n.isAuthenticated().pipe(h(o=>o?!0:(r.navigate(["/login"]),!1)))};var a=class t{subdomainService=i(l);router=i(c);canActivate(){return new f(e=>{this.subdomainService.isInitialized$.subscribe(n=>{if(n)if(this.subdomainService.getCurrentCompany())e.next(!0),e.complete();else{let o=this.router.url;o==="/login"||o==="/"?(e.next(!0),e.complete()):(this.handleNoCompany(),e.next(!1),e.complete())}else this.subdomainService.initializeFromSubdomain().then(r=>m(this,null,function*(){if(console.log("CompanyGuard: empresa inicializada:",r),r)e.next(!0);else{let o=this.router.url;console.log("CompanyGuard: URL atual:",o),o==="/login"||o==="/"||o.startsWith("/login?")?(new URLSearchParams(window.location.search).get("subdomain")==="gobuyer"&&console.log("CompanyGuard: detectado subdomain=gobuyer, permitindo acesso"),e.next(!0)):(this.handleNoCompany(),e.next(!1))}e.complete()})).catch(r=>{console.error("Erro ao inicializar guard da empresa:",r);let o=this.router.url;o==="/login"||o==="/"||o.startsWith("/login?")?e.next(!0):(this.handleError(r),e.next(!1)),e.complete()})})})}handleNoCompany(){console.error("Nenhuma empresa encontrada, redirecionando...")}handleError(e){console.error("Erro no guard da empresa:",e)}static \u0275fac=function(n){return new(n||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var B=[{path:"",redirectTo:"/login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-P67ENPH2.js").then(t=>t.LoginComponent),canActivate:[a]},{path:"dashboard",loadComponent:()=>import("./chunk-K7FXEGOQ.js").then(t=>t.DashboardComponent),canActivate:[a,p]},{path:"kanban/:boardId",loadComponent:()=>import("./chunk-4X4RK5XA.js").then(t=>t.KanbanComponent),canActivate:[a,p]},{path:"usuarios",loadComponent:()=>import("./chunk-FLVCDBW3.js").then(t=>t.UserManagementComponent),canActivate:[a,p]},{path:"empresa/branding",loadComponent:()=>import("./chunk-S5R563PP.js").then(t=>t.BrandingConfigComponent),canActivate:[a,p]},{path:"empresa/smtp",loadComponent:()=>import("./chunk-LXW7L4IG.js").then(t=>t.SmtpConfigComponent),canActivate:[a,p]},{path:"empresa/api",loadComponent:()=>import("./chunk-X7BWMAPF.js").then(t=>t.ApiConfigComponent),canActivate:[a,p]},{path:"empresa/links",loadComponent:()=>import("./chunk-PZ6JZA2F.js").then(t=>t.CompanyLinksComponent),canActivate:[a,p]},{path:"form",loadComponent:()=>import("./chunk-HB2NRXVT.js").then(t=>t.PublicFormComponent),canActivate:[a]},{path:"empresa-nao-encontrada",loadComponent:()=>import("./chunk-FINTSI3D.js").then(t=>t.CompanyNotFoundComponent)},{path:"**",redirectTo:"/login"}];var K={providers:[v(),S({eventCoalescing:!0}),w(B),I(),x(()=>R(G.firebase)),H(()=>E()),N(()=>P()),j(()=>k()),{provide:"HTTP_INTERCEPTORS",useClass:d,multi:!0},g(z,M.forRoot({validationMessages:[{name:"required",message:"Este campo \xE9 obrigat\xF3rio"}]}),O)]};var u=class t{subdomainService=i(l);firestoreService=i(U);title=C("Sistema Kanban");ngOnInit(){return m(this,null,function*(){try{console.log("\u{1F680} Inicializando aplica\xE7\xE3o multi-empresa..."),console.log("\u{1F30D} URL atual:",window.location.href);let e=yield this.subdomainService.initializeFromSubdomain();e?(console.log("\u2705 Empresa carregada:",e),this.firestoreService.setCompanyContext(e),this.title.set(`${e.name} - Sistema Kanban`),this.updatePageTitle(e.name)):(console.log("\u2139\uFE0F Nenhuma empresa encontrada - modo login/registro"),this.title.set("Sistema Kanban - Login"))}catch(e){console.error("\u274C Erro ao inicializar aplica\xE7\xE3o:",e)}})}updatePageTitle(e){typeof document<"u"&&(document.title=`${e} - Sistema Kanban`)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=b({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){n&1&&y(0,"router-outlet")},dependencies:[F],encapsulation:2})};A(u,K).catch(t=>console.error(t));
