import{$ as m}from"./chunk-WLUU74ML.js";import{_ as s,da as c,f as r,m as i}from"./chunk-3D7XR5P5.js";var l=class a{companyService=c(m);currentCompanySubject=new i(null);currentCompany$=this.currentCompanySubject.asObservable();isInitializedSubject=new i(!1);isInitialized$=this.isInitializedSubject.asObservable();initializeFromSubdomain(){return r(this,null,function*(){try{let e=this.extractSubdomain();if(!e)return this.isInitializedSubject.next(!0),null;let t=yield this.companyService.getCompanyBySubdomain(e);if(!t&&e==="gobuyer")try{yield this.companyService.seedGobuyerCompany(),t=yield this.companyService.getCompanyBySubdomain(e)}catch{}return t?this.currentCompanySubject.next(t):this.handleInvalidSubdomain(e),this.isInitializedSubject.next(!0),t}catch{return this.isInitializedSubject.next(!0),null}})}extractSubdomain(){if(typeof window>"u")return null;let e=window.location.hostname;if(e==="localhost"||e==="127.0.0.1"){let t=localStorage.getItem("dev-subdomain");if(t)return t;let n=new URLSearchParams(window.location.search).get("subdomain");return n?(localStorage.setItem("dev-subdomain",n),n):(localStorage.setItem("dev-subdomain","gobuyer"),"gobuyer")}if(e.includes("taskboard.com.br")){let t=e.split(".");if(t.length>=3&&t[0]!=="www"&&t[0]!=="taskboard")return t[0]}if(e==="taskboard.com.br"||e==="www.taskboard.com.br")return null;if(e.includes(".")){let t=e.split(".");if(t.length>=2&&t[0]!=="www"&&t[0]!=="taskboard")return t[0]}return null}handleInvalidSubdomain(e){if(typeof window<"u"){if(this.isDevelopment()){console.warn(`Empresa '${e}' n\xE3o encontrada em desenvolvimento. Criando automaticamente...`),this.createDevelopmentCompany(e);return}if(window.location.hostname.includes(`${e}.taskboard.com.br`)){if(console.error(`Empresa '${e}' n\xE3o encontrada no Firebase.`),e==="gobuyer"){this.companyService.seedGobuyerCompany().then(()=>r(this,null,function*(){let o=yield this.companyService.getCompanyBySubdomain("gobuyer");o&&(this.currentCompanySubject.next(o),window.location.reload())})).catch(o=>{console.error("Erro ao criar empresa Gobuyer:",o),alert("Empresa 'gobuyer' n\xE3o p\xF4de ser criada. Entre em contato com o suporte.")});return}alert(`Empresa '${e}' n\xE3o encontrada. Entre em contato com o suporte.`);return}window.location.href="https://taskboard.com.br/empresa-nao-encontrada?subdomain="+encodeURIComponent(e)}}getCurrentCompany(){return this.currentCompanySubject.value}setCurrentCompany(e){this.currentCompanySubject.next(e)}setDevSubdomain(e){typeof window<"u"&&(localStorage.setItem("dev-subdomain",e),window.location.reload())}clearDevSubdomain(){typeof window<"u"&&(localStorage.removeItem("dev-subdomain"),window.location.reload())}isDevelopment(){if(typeof window>"u")return!1;let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"}getBaseUrl(){if(typeof window>"u")return"http://localhost:4200";let{protocol:e,hostname:t,port:o}=window.location,n=o?`:${o}`:"";return`${e}//${t}${n}`}getCompanyUrl(e){return this.isDevelopment()?`${this.getBaseUrl()}?subdomain=${e}`:`https://${e}.taskboard.com.br`}getApiUrl(){let e=this.getCurrentCompany();return e?this.isDevelopment()?`http://localhost:5000/api/v1/companies/${e.id}`:`https://api.taskboard.com.br/v1/companies/${e.id}`:null}getPublicFormUrl(){let e=this.getCurrentCompany();return e?this.isDevelopment()?`${this.getBaseUrl()}/form/${e.subdomain}`:`https://${e.subdomain}.taskboard.com.br/form`:null}createDevelopmentCompany(e){return r(this,null,function*(){try{let t={subdomain:e,name:`Empresa ${e.charAt(0).toUpperCase()+e.slice(1)}`,contactEmail:`contato@${e}.dev`,contactPhone:"+55 11 99999-9999",address:"Desenvolvimento Local",cnpj:"00.000.000/0001-00",plan:"professional",status:"active",ownerId:"dev-user",ownerEmail:`admin@${e}.dev`,maxUsers:50,maxBoards:100,smtpConfig:{host:"smtp.gmail.com",port:587,secure:!1,user:"",password:"",fromName:`Empresa ${e.charAt(0).toUpperCase()+e.slice(1)}`,fromEmail:`contato@${e}.dev`},apiConfig:{enabled:!0,token:"",endpoint:`${this.getBaseUrl()}/api/v1/lead-intake`,webhookUrl:""},features:{maxBoards:10,maxUsers:20,maxLeadsPerMonth:5e3,maxEmailsPerMonth:2500,customBranding:!0,apiAccess:!0,webhooks:!0,advancedReports:!0,whiteLabel:!1}},o=yield this.companyService.createCompany(t),n=yield this.companyService.getCompany(o);n&&this.currentCompanySubject.next(n)}catch(t){console.error("Erro ao criar empresa de desenvolvimento:",t)}})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=s({token:a,factory:a.\u0275fac,providedIn:"root"})};export{l as a};
