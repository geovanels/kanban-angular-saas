import{E as O,F as B,J as G,c as V,e as P,i as L,l as F,m as z,p as j,s as q,t as U}from"./chunk-QT4WKFE7.js";import"./chunk-ZBJHR7UR.js";import{F as R,G as H,I as J}from"./chunk-OUCFDODB.js";import{Eb as m,Fb as n,Gb as i,Hb as b,Ob as I,Oc as k,Pb as y,Rb as p,Va as M,Vc as A,Ya as l,Yb as D,ac as s,bc as E,cc as T,f as h,fa as x,gb as N,la as f,lb as _,ma as v,na as w,oa as C,wa as d}from"./chunk-HM7IHYI7.js";function Q(r,o){if(r&1&&(n(0,"div",13),b(1,"img",14),i()),r&2){let e=p();l(),m("src",e.company().brandingConfig.logo,M)("alt",e.company().name)}}function X(r,o){if(r&1&&(n(0,"p",15),s(1," Voc\xEA foi convidado para participar da "),n(2,"strong"),s(3),i()()),r&2){let e=p();l(3),E(e.company().name)}}function Y(r,o){r&1&&(n(0,"div",2),b(1,"div",16),n(2,"p",17),s(3,"Carregando..."),i()())}function Z(r,o){if(r&1){let e=I();n(0,"div",18)(1,"div",19)(2,"div",20),w(),n(3,"svg",21),b(4,"path",22),i()(),C(),n(5,"div",23)(6,"p",24),s(7),i()()(),n(8,"div",25)(9,"button",26),y("click",function(){f(e);let a=p();return v(a.goToLogin())}),s(10," Ir para Login "),i()()()}if(r&2){let e=p();l(7),E(e.error())}}function $(r,o){r&1&&(n(0,"div",27)(1,"div",19)(2,"div",20),w(),n(3,"svg",28),b(4,"path",29),i()(),C(),n(5,"div",23)(6,"p",30),s(7," Convite aceito com sucesso! Redirecionando para o dashboard... "),i()()()())}function ee(r,o){r&1&&(n(0,"span",45),b(1,"div",46),i())}function te(r,o){if(r&1){let e=I();n(0,"form",31),y("ngSubmit",function(){f(e);let a=p();return v(a.acceptInvite())}),n(1,"div",32)(2,"div")(3,"label",33),s(4," Email "),i(),b(5,"input",34),i(),n(6,"div")(7,"label",35),s(8," Nome completo "),i(),n(9,"input",36),y("ngModelChange",function(a){f(e);let u=p();return v(u.displayName.set(a))}),i()(),n(10,"div")(11,"label",37),s(12," Senha "),i(),n(13,"input",38),y("ngModelChange",function(a){f(e);let u=p();return v(u.password.set(a))}),i(),n(14,"p",39),s(15,"M\xEDnimo de 6 caracteres"),i()(),n(16,"div")(17,"label",40),s(18," Confirmar senha "),i(),n(19,"input",41),y("ngModelChange",function(a){f(e);let u=p();return v(u.confirmPassword.set(a))}),i()()(),n(20,"div")(21,"button",42),_(22,ee,2,0,"span",43),s(23),i()(),n(24,"div",2)(25,"p",15),s(26," J\xE1 possui uma conta? "),n(27,"button",44),y("click",function(){f(e);let a=p();return v(a.goToLogin())}),s(28," Fazer login "),i()()()()}if(r&2){let e=p();l(5),m("value",e.userEmail()),l(4),m("ngModel",e.displayName()),l(4),m("ngModel",e.password()),l(6),m("ngModel",e.confirmPassword()),l(2),D("background-color",e.getPrimaryColor()),m("disabled",e.loading()),l(),m("ngIf",e.loading()),l(),T(" ",e.loading()?"Criando conta...":"Aceitar convite e criar conta"," ")}}var W=class r{route=x(V);router=x(P);companyService=x(J);authService=x(H);subdomainService=x(R);inviteToken=d(null);companyId=d(null);company=d(null);userEmail=d(null);loading=d(!1);error=d(null);success=d(!1);displayName=d("");password=d("");confirmPassword=d("");ngOnInit(){return h(this,null,function*(){let o=this.route.snapshot.queryParamMap.get("token"),e=this.route.snapshot.queryParamMap.get("email"),t=this.route.snapshot.queryParamMap.get("companyId");if(!o||!e||!t){this.error.set("Link de convite inv\xE1lido ou expirado.");return}this.inviteToken.set(o),this.userEmail.set(e),this.companyId.set(t),this.displayName.set(this.extractNameFromEmail(e)),yield this.loadCompanyFromInvite(t)})}extractNameFromEmail(o){return o.split("@")[0].split(/[._-]/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}loadCompanyFromInvite(o){return h(this,null,function*(){this.loading.set(!0);try{console.log("\u{1F50D} Debug - Carregando empresa pelo ID:",o);let e=yield this.companyService.getCompany(o);if(e)console.log("\u{1F3E2} Debug - Empresa encontrada:",e.name),this.company.set(e),this.subdomainService.setCurrentCompany(e),yield this.loadUserNameFromInvite(o);else{console.log("\u274C Debug - Empresa n\xE3o encontrada"),this.error.set("Empresa n\xE3o encontrada. O convite pode estar expirado.");return}console.log("\u2705 Debug - Formul\xE1rio de aceita\xE7\xE3o pronto")}catch(e){console.error("\u274C Debug - Erro ao carregar empresa:",e),this.error.set("Erro ao carregar informa\xE7\xF5es da empresa.")}finally{this.loading.set(!1)}})}loadUserNameFromInvite(o){return h(this,null,function*(){try{let e=this.userEmail();if(!e)return;console.log("\u{1F464} Debug - Tentando carregar nome do usu\xE1rio do convite...");let t=yield this.companyService.getCompanyUser(o,e);t&&t.displayName?(console.log("\u2705 Debug - Nome encontrado no convite:",t.displayName),this.displayName.set(t.displayName)):console.log("\u2139\uFE0F Debug - Nome n\xE3o encontrado no convite, usando extra\xE7\xE3o do email")}catch(e){console.log("\u26A0\uFE0F Debug - Erro ao carregar nome do convite (usando fallback):",e)}})}acceptInvite(){return h(this,null,function*(){let o=this.userEmail(),e=this.displayName().trim(),t=this.password().trim(),a=this.confirmPassword().trim(),u=this.inviteToken();if(console.log("\u{1F50D} Debug Form - Validando campos:",{email:!!o,name:!!e&&e.length>0,pwd:!!t&&t.length>0,confirmPwd:!!a&&a.length>0,token:!!u}),!o||!e||!t||!a||!u){this.error.set("Todos os campos s\xE3o obrigat\xF3rios.");return}if(t.length<6){this.error.set("A senha deve ter pelo menos 6 caracteres.");return}if(t!==a){this.error.set("As senhas n\xE3o conferem.");return}this.loading.set(!0),this.error.set(null);try{console.log("\u{1F510} Debug - Tentando criar conta do usu\xE1rio...");let c=yield this.authService.signUpWithEmail(o,t,e);if(!c.success&&c.error?.includes("email-already-in-use")){if(console.log("\u{1F464} Debug - Email j\xE1 existe, tentando fazer login..."),c=yield this.authService.signInWithEmail(o,t),!c.success)throw new Error("Email j\xE1 cadastrado. Verifique sua senha ou fa\xE7a login normalmente.");console.log("\u2705 Debug - Login realizado com sucesso")}else if(!c.success)throw new Error(c.error);console.log("\u2705 Debug - Conta criada ou login realizado, processando convite...");let g=this.companyId();if(!g)throw new Error("ID da empresa n\xE3o encontrado.");let S=this.company();if(S&&(this.subdomainService.setCurrentCompany(S),console.log("\u2705 Debug - Empresa definida no contexto")),console.log("\u{1F504} Debug - Tentando processar convite imediatamente..."),yield this.authService.processPendingInvite(g,o,u))console.log("\u2705 Debug - Convite processado com sucesso imediatamente");else{console.log("\u{1F4BE} Debug - Salvando convite para processamento posterior...");let K={companyId:g,email:o,token:u,timestamp:Date.now()};localStorage.setItem("pendingInvite",JSON.stringify(K))}console.log("\u{1F389} Debug - Convite aceito com sucesso!"),this.success.set(!0),setTimeout(()=>{this.router.navigate(["/dashboard"])},2e3)}catch(c){console.error("\u274C Debug - Erro ao aceitar convite:",c);let g="Erro ao aceitar convite. Tente novamente.";if(c?.code)switch(c.code){case"auth/email-already-in-use":g="Este email j\xE1 est\xE1 em uso. Fa\xE7a login em vez disso.";break;case"auth/weak-password":g="A senha \xE9 muito fraca. Use pelo menos 6 caracteres.";break;case"auth/invalid-email":g="Email inv\xE1lido.";break;default:g=c.message||g}this.error.set(g)}finally{this.loading.set(!1)}})}goToLogin(){this.router.navigate(["/login"])}getPrimaryColor(){let o=this.company();return o?.primaryColor||o?.brandingConfig?.primaryColor||"#3B82F6"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=N({type:r,selectors:[["app-invite-accept"]],decls:18,vars:6,consts:[[1,"min-h-screen","bg-gray-50","flex","items-center","justify-center","py-12","px-4","sm:px-6","lg:px-8","pb-16"],[1,"max-w-md","w-full","space-y-8"],[1,"text-center"],["class","flex justify-center mb-4",4,"ngIf"],[1,"text-3xl","font-extrabold","text-gray-900","mb-2"],["class","text-sm text-gray-600",4,"ngIf"],["class","text-center",4,"ngIf"],["class","bg-red-50 border border-red-200 rounded-md p-4",4,"ngIf"],["class","bg-green-50 border border-green-200 rounded-md p-4",4,"ngIf"],["class","mt-8 space-y-6",3,"ngSubmit",4,"ngIf"],[1,"fixed","bottom-0","left-0","right-0","bg-white","border-t","border-gray-200","py-3"],[1,"text-xs","text-gray-500"],[1,"text-gray-700"],[1,"flex","justify-center","mb-4"],[1,"h-12","w-auto",3,"src","alt"],[1,"text-sm","text-gray-600"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto"],[1,"mt-2","text-sm","text-gray-600"],[1,"bg-red-50","border","border-red-200","rounded-md","p-4"],[1,"flex"],[1,"flex-shrink-0"],["fill","currentColor","viewBox","0 0 20 20",1,"h-5","w-5","text-red-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"ml-3"],[1,"text-sm","text-red-800"],[1,"mt-4","text-center"],[1,"text-sm","text-red-600","hover:text-red-500","underline",3,"click"],[1,"bg-green-50","border","border-green-200","rounded-md","p-4"],["fill","currentColor","viewBox","0 0 20 20",1,"h-5","w-5","text-green-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-sm","text-green-800"],[1,"mt-8","space-y-6",3,"ngSubmit"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","email","readonly","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","bg-gray-50","text-gray-500","cursor-not-allowed","focus:outline-none",3,"value"],["for","displayName",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","displayName","name","displayName","type","text","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","password","name","password","type","password","required","","minlength","6",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"mt-1","text-sm","text-gray-500"],["for","confirmPassword",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","confirmPassword","name","confirmPassword","type","password","required","","minlength","6",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["type","submit",1,"group","relative","w-full","flex","justify-center","py-2","px-4","border","border-transparent","text-sm","font-medium","rounded-md","text-white","hover:opacity-90","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["class","absolute left-0 inset-y-0 flex items-center pl-3",4,"ngIf"],["type","button",1,"font-medium","text-blue-600","hover:text-blue-500",3,"click"],[1,"absolute","left-0","inset-y-0","flex","items-center","pl-3"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white"]],template:function(e,t){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),_(3,Q,2,2,"div",3),n(4,"h2",4),s(5," Aceitar Convite "),i(),_(6,X,4,1,"p",5),i(),_(7,Y,4,0,"div",6)(8,Z,11,1,"div",7)(9,$,8,0,"div",8)(10,te,29,9,"form",9),i()(),n(11,"div",10)(12,"div",2)(13,"p",11),s(14," Powered by "),n(15,"strong",12),s(16,"TaskBoard"),i(),s(17," - Sistema de Gest\xE3o Kanban "),i()()()),e&2){let a;l(3),m("ngIf",(a=t.company())==null||a.brandingConfig==null?null:a.brandingConfig.logo),l(3),m("ngIf",t.company()),l(),m("ngIf",t.loading()&&!t.error()&&!t.success()),l(),m("ngIf",t.error()),l(),m("ngIf",t.success()),l(),m("ngIf",!t.loading()&&!t.error()&&!t.success()&&t.company())}},dependencies:[A,k,G,U,L,F,z,O,B,q,j],encapsulation:2})};export{W as InviteAcceptComponent};
