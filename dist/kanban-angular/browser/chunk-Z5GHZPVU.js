import{a as J}from"./chunk-BPKZA6YQ.js";import{a as K}from"./chunk-4LBSSPGU.js";import"./chunk-6RWBTKMW.js";import{a as z}from"./chunk-ZSN52DFK.js";import{a as W}from"./chunk-Q7D2ZQ6E.js";import{I as j,J as L,K as V,h as k,i as A,j as p,l as G,m as D,s as O,t as $,u as q,x as I,y as R}from"./chunk-J3PSPDME.js";import"./chunk-7FM7EXI2.js";import{F as B,G as U,I as H}from"./chunk-ZZVDKIU7.js";import{Ab as h,Eb as c,Fb as i,Gb as e,Hb as s,Qb as S,Sb as C,Xc as N,Ya as l,Zb as M,ac as b,bc as t,dc as E,f as x,fa as u,gb as w,gc as _,hc as F,ic as T,nc as P,wa as g,zb as f}from"./chunk-JPAM732G.js";var X=()=>({standalone:!0});function Y(m,r){m&1&&(s(0,"i",54),t(1," Salvando... "))}function Z(m,r){m&1&&(s(0,"i",55),t(1," Salvar Configura\xE7\xF5es "))}function ee(m,r){if(m&1&&(i(0,"div",4),s(1,"i",56),t(2),e()),m&2){let n=C();l(2),E(" ",n.successMessage()," ")}}function te(m,r){if(m&1&&(i(0,"div",5),s(1,"i",57),t(2),e()),m&2){let n=C();l(2),E(" ",n.errorMessage()," ")}}function ie(m,r){m&1&&(s(0,"i",54),t(1," Enviando... "))}function re(m,r){m&1&&(s(0,"i",58),t(1," Testar "))}var Q=class m{fb=u(j);companyService=u(H);subdomainService=u(B);smtpService=u(K);authService=u(U);toast=u(W);smtpForm;currentCompany=g(null);isSaving=g(!1);isTesting=g(!1);testEmail="";successMessage=g(null);errorMessage=g(null);constructor(){this.smtpForm=this.fb.group({host:["smtp.sendgrid.net",p.required],port:[587,[p.required,p.min(1),p.max(65535)]],secure:[!0],user:["apikey",[p.required]],password:["",p.required],fromName:["",p.required],fromEmail:["",[p.required,p.email]]})}ngOnInit(){this.loadCurrentConfiguration(!0)}loadCurrentConfiguration(r=!1){let n=this.subdomainService.getCurrentCompany(),o=a=>{this.currentCompany.set(a),a?.smtpConfig&&this.smtpForm.patchValue({host:a.smtpConfig.host||this.smtpForm.get("host")?.value,port:a.smtpConfig.port||this.smtpForm.get("port")?.value,secure:a.smtpConfig.secure!==void 0?a.smtpConfig.secure:this.smtpForm.get("secure")?.value,user:a.smtpConfig.user||this.smtpForm.get("user")?.value,password:a.smtpConfig.password||this.smtpForm.get("password")?.value||"",fromName:a.smtpConfig.fromName||this.smtpForm.get("fromName")?.value,fromEmail:a.smtpConfig.fromEmail||this.smtpForm.get("fromEmail")?.value},{emitEvent:!1})};if(n&&!r){o(n);return}x(this,null,function*(){let a=n||null;try{let d=this.companyService.getCompanySubdomain();d&&(a=yield this.companyService.getCompanyBySubdomain(d))}catch{}if(!a)try{let d=this.authService.getCurrentUser();d?.email&&(a=yield this.companyService.getCompanyByUserEmail(d.email))}catch{}a&&(this.subdomainService.setCurrentCompany(a),o(a))})}saveConfiguration(){return x(this,null,function*(){if(this.markAllFieldsAsTouched(),this.smtpForm.invalid){this.showError("Por favor, preencha todos os campos obrigat\xF3rios corretamente.");return}let r=this.currentCompany();if(r?.id||(yield new Promise(n=>{this.loadCurrentConfiguration(!0),setTimeout(n,500)}),r=this.currentCompany()),!r?.id){this.showError("Empresa n\xE3o encontrada");return}this.isSaving.set(!0),this.clearMessages();try{let n=this.smtpForm.value,a={smtpConfig:{host:String(n.host||this.currentCompany()?.smtpConfig?.host||""),port:Number(n.port||this.currentCompany()?.smtpConfig?.port||587),secure:!!(n.secure??this.currentCompany()?.smtpConfig?.secure??!0),user:String(n.user||this.currentCompany()?.smtpConfig?.user||""),password:String((n.password??"").toString().trim()||this.currentCompany()?.smtpConfig?.password||""),fromName:String(n.fromName||this.currentCompany()?.smtpConfig?.fromName||""),fromEmail:String(n.fromEmail||this.currentCompany()?.smtpConfig?.fromEmail||"")}};yield this.companyService.updateCompany(r.id,a),this.loadCurrentConfiguration(!0),this.showSuccess("Configura\xE7\xF5es SMTP salvas com sucesso!")}catch(n){console.error("Erro ao salvar configura\xE7\xF5es SMTP:",n),this.showError("Erro ao salvar configura\xE7\xF5es: "+(n?.message||"Tente novamente."))}finally{this.isSaving.set(!1)}})}sendTestEmail(){return x(this,null,function*(){if(!this.testEmail||this.smtpForm.invalid){this.showError("Por favor, preencha um email v\xE1lido e complete todas as configura\xE7\xF5es.");return}this.smtpForm.dirty&&(yield this.saveConfiguration(),yield new Promise(r=>setTimeout(r,1e3))),this.isTesting.set(!0),this.clearMessages();try{let r={to:this.testEmail,subject:`Teste SMTP - ${this.currentCompany()?.name||"Sistema"}`,html:`
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
            <h2 style="color: ${this.getPrimaryColor()};">\u2705 Teste de Configura\xE7\xE3o SMTP</h2>
            <p>Parab\xE9ns! Sua configura\xE7\xE3o SMTP est\xE1 funcionando corretamente.</p>
            <p><strong>Empresa:</strong> ${this.currentCompany()?.name}</p>
            <p><strong>Email enviado para:</strong> ${this.testEmail}</p>
            <p><strong>Data/Hora:</strong> ${new Date().toLocaleString("pt-BR")}</p>
            <div style="background-color: #f8f9fa; padding: 15px; border-left: 4px solid ${this.getPrimaryColor()}; margin: 20px 0;">
              <strong>Configura\xE7\xF5es utilizadas:</strong><br>
              Host: ${this.smtpForm.get("host")?.value}<br>
              Porta: ${this.smtpForm.get("port")?.value}<br>
              Seguro: ${this.smtpForm.get("secure")?.value?"Sim":"N\xE3o"}<br>
              Remetente: ${this.smtpForm.get("fromName")?.value} &lt;${this.smtpForm.get("fromEmail")?.value}&gt;
            </div>
            <p style="color: #28a745; font-weight: bold;">\u{1F389} Sistema de emails configurado com sucesso!</p>
          </div>
        `};console.log("\u{1F9EA} Enviando email de teste via SmtpService...");let n=yield this.smtpService.sendEmail(r).toPromise();if(n?.success)this.showSuccess(`Email de teste enviado com sucesso para ${this.testEmail}.`);else throw new Error(n?.error||"Falha no envio do email")}catch(r){console.error("\u274C Erro ao enviar email de teste:",r);let n="Erro ao enviar email de teste.";r?.error?n=r.error:r?.message&&(r.message.includes("API Key")||r.message.includes("401")?n="API Key do SendGrid inv\xE1lida. Verifique se a chave est\xE1 correta.":r.message.includes("configura\xE7\xE3o")||r.message.includes("incompleta")?n="Configura\xE7\xE3o SMTP incompleta. Preencha todos os campos.":n=`Erro: ${r.message}`),this.showError(n)}finally{this.isTesting.set(!1)}})}showSuccess(r){try{this.toast.success(r)}catch{}this.successMessage.set(null),this.errorMessage.set(null)}showError(r){try{this.toast.error(r)}catch{}this.errorMessage.set(null),this.successMessage.set(null)}clearMessages(){this.successMessage.set(null),this.errorMessage.set(null)}getFormErrors(){let r={};return Object.keys(this.smtpForm.controls).forEach(n=>{let o=this.smtpForm.get(n);o&&!o.valid&&o.touched&&(r[n]=o.errors)}),r}markAllFieldsAsTouched(){Object.keys(this.smtpForm.controls).forEach(r=>{this.smtpForm.get(r)?.markAsTouched()})}getPrimaryColor(){let r=this.subdomainService.getCurrentCompany();return r?.primaryColor||r?.brandingConfig?.primaryColor||"#3B82F6"}static \u0275fac=function(n){return new(n||m)};static \u0275cmp=w({type:m,selectors:[["app-smtp-config"]],decls:181,vars:19,consts:[["title","Configura\xE7\xE3o SMTP"],[1,"flex","items-center","space-x-3"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-6","p-4","bg-green-50","border","border-green-200","rounded-lg","text-green-800"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-800"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center"],[1,"fas","fa-envelope","text-blue-500","mr-2"],[1,"text-sm","text-gray-600","mt-1"],[1,"p-6"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-4"],[1,"lg:col-span-3"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","formControlName","host","placeholder","smtp.sendgrid.net"],[1,"text-xs","text-gray-500","mt-1"],["type","number","formControlName","port","placeholder","587",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],["type","text","formControlName","user","placeholder","apikey"],["type","password","formControlName","password","placeholder","SG.xxxxxxxxxx..."],["type","text","formControlName","fromName",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"placeholder"],["type","email","formControlName","fromEmail","placeholder","noreply@suaempresa.com",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500"],[1,"space-y-3"],[1,"text-md","font-medium","text-gray-900"],[1,"flex","items-center"],["type","checkbox","formControlName","secure","id","secureConnection",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["for","secureConnection",1,"ml-2","text-sm","text-gray-700"],[1,"text-xs","text-gray-500"],[1,"pt-6","border-t","border-gray-200"],[1,"text-md","font-medium","text-gray-900","mb-4"],[1,"flex","space-x-3"],["type","email","placeholder","seu-email@exemplo.com",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel","ngModelOptions"],["type","button",1,"text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"text-xs","text-gray-500","mt-2"],[1,"mt-8","bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"fas","fa-question-circle","text-blue-500","mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"border","border-green-200","rounded-lg","p-4","bg-green-50"],[1,"flex","items-center","mb-3"],[1,"w-8","h-8","bg-green-500","rounded","flex","items-center","justify-center"],[1,"fas","fa-paper-plane","text-white","text-sm"],[1,"ml-3","text-sm","font-semibold","text-gray-900"],[1,"ml-2","px-2","py-1","bg-green-100","text-green-800","text-xs","rounded"],[1,"text-xs","text-gray-600","space-y-1"],[1,"text-green-700"],[1,"border","border-gray-200","rounded-lg","p-4"],[1,"w-8","h-8","bg-red-500","rounded","flex","items-center","justify-center"],[1,"fab","fa-google","text-white","text-sm"],[1,"w-8","h-8","bg-blue-500","rounded","flex","items-center","justify-center"],[1,"fab","fa-microsoft","text-white","text-sm"],[1,"w-8","h-8","bg-gray-500","rounded","flex","items-center","justify-center"],[1,"fas","fa-server","text-white","text-sm"],[1,"fas","fa-spinner","fa-spin","mr-1"],[1,"fas","fa-save","mr-1"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-exclamation-circle","mr-2"],[1,"fas","fa-paper-plane","mr-1"]],template:function(n,o){if(n&1&&(i(0,"app-main-layout")(1,"app-config-header",0)(2,"div",1)(3,"button",2),S("click",function(){return o.saveConfiguration()}),f(4,Y,2,0)(5,Z,2,0),e()()(),i(6,"div",3),f(7,ee,3,1,"div",4),f(8,te,3,1,"div",5),i(9,"div",6)(10,"div",7)(11,"h3",8),s(12,"i",9),t(13," Configura\xE7\xE3o do Servidor SMTP "),e(),i(14,"p",10),t(15,"Configure o servidor de email para sua empresa enviar notifica\xE7\xF5es"),e()(),i(16,"div",11)(17,"form",12),S("ngSubmit",function(){return o.saveConfiguration()}),i(18,"div",13)(19,"div",14)(20,"label",15),t(21," Servidor SMTP * "),e(),s(22,"input",16),i(23,"p",17),t(24,"Endere\xE7o do servidor SMTP"),e()(),i(25,"div")(26,"label",15),t(27," Porta * "),e(),s(28,"input",18),i(29,"p",17),t(30,"Porta SMTP"),e()()(),i(31,"div",19)(32,"div")(33,"label",15),t(34," Usu\xE1rio * "),e(),s(35,"input",20),i(36,"p",17),t(37,'Para SendGrid, use sempre "apikey"'),e()(),i(38,"div")(39,"label",15),t(40," Senha * "),e(),s(41,"input",21),i(42,"p",17),t(43,"API Key do SendGrid (come\xE7a com SG.)"),e()()(),i(44,"div",19)(45,"div")(46,"label",15),t(47," Nome do Remetente * "),e(),s(48,"input",22),i(49,"p",17),t(50,"Nome que aparecer\xE1 nos emails enviados"),e()(),i(51,"div")(52,"label",15),t(53," Email do Remetente * "),e(),s(54,"input",23),i(55,"p",17),t(56,"Email que aparecer\xE1 como remetente"),e()()(),i(57,"div",24)(58,"h4",25),t(59,"Op\xE7\xF5es de Seguran\xE7a"),e(),i(60,"div",26),s(61,"input",27),i(62,"label",28),t(63," Usar conex\xE3o segura (SSL/TLS) "),e()(),i(64,"p",29),t(65,"Recomendado para a maioria dos provedores de email"),e()(),i(66,"div",30)(67,"h4",31),t(68,"Testar Configura\xE7\xE3o"),e(),i(69,"div",32)(70,"input",33),T("ngModelChange",function(d){return F(o.testEmail,d)||(o.testEmail=d),d}),e(),i(71,"button",34),S("click",function(){return o.sendTestEmail()}),f(72,ie,2,0)(73,re,2,0),e()(),i(74,"p",35),t(75,"Envie um email de teste para verificar se a configura\xE7\xE3o est\xE1 funcionando"),e()()()()(),i(76,"div",36)(77,"div",7)(78,"h3",8),s(79,"i",37),t(80," Guias de Configura\xE7\xE3o R\xE1pida "),e()(),i(81,"div",11)(82,"div",38)(83,"div",39)(84,"div",40)(85,"div",41),s(86,"i",42),e(),i(87,"h4",43),t(88,"SendGrid (Recomendado)"),e(),i(89,"span",44),t(90,"Configurado"),e()(),i(91,"div",45)(92,"p")(93,"strong"),t(94,"Servidor:"),e(),t(95," smtp.sendgrid.net"),e(),i(96,"p")(97,"strong"),t(98,"Porta:"),e(),t(99," 587"),e(),i(100,"p")(101,"strong"),t(102,"Usu\xE1rio:"),e(),t(103," apikey"),e(),i(104,"p")(105,"strong"),t(106,"Senha:"),e(),t(107," Sua API Key do SendGrid"),e(),i(108,"p",46)(109,"strong"),t(110,"\u2713"),e(),t(111," Maior taxa de entrega"),e()()(),i(112,"div",47)(113,"div",40)(114,"div",48),s(115,"i",49),e(),i(116,"h4",43),t(117,"Gmail"),e()(),i(118,"div",45)(119,"p")(120,"strong"),t(121,"Servidor:"),e(),t(122," smtp.gmail.com"),e(),i(123,"p")(124,"strong"),t(125,"Porta:"),e(),t(126," 587"),e(),i(127,"p")(128,"strong"),t(129,"Seguro:"),e(),t(130," Sim"),e(),i(131,"p")(132,"strong"),t(133,"Senha:"),e(),t(134," App Password necess\xE1ria"),e()()(),i(135,"div",47)(136,"div",40)(137,"div",50),s(138,"i",51),e(),i(139,"h4",43),t(140,"Outlook"),e()(),i(141,"div",45)(142,"p")(143,"strong"),t(144,"Servidor:"),e(),t(145," smtp-mail.outlook.com"),e(),i(146,"p")(147,"strong"),t(148,"Porta:"),e(),t(149," 587"),e(),i(150,"p")(151,"strong"),t(152,"Seguro:"),e(),t(153," Sim"),e(),i(154,"p")(155,"strong"),t(156,"Auth:"),e(),t(157," STARTTLS"),e()()(),i(158,"div",47)(159,"div",40)(160,"div",52),s(161,"i",53),e(),i(162,"h4",43),t(163,"Outros"),e()(),i(164,"div",45)(165,"p")(166,"strong"),t(167,"Porta 25:"),e(),t(168," N\xE3o segura"),e(),i(169,"p")(170,"strong"),t(171,"Porta 465:"),e(),t(172," SSL"),e(),i(173,"p")(174,"strong"),t(175,"Porta 587:"),e(),t(176," TLS"),e(),i(177,"p")(178,"strong"),t(179,"Porta 2525:"),e(),t(180," Alternativa"),e()()()()()()()()),n&2){let a,d,v,y;l(3),c("disabled",o.isSaving()),l(),h(o.isSaving()?4:5),l(3),h(o.successMessage()?7:-1),l(),h(o.errorMessage()?8:-1),l(9),c("formGroup",o.smtpForm),l(5),b("w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 "+((a=o.smtpForm.get("host"))!=null&&a.invalid&&((a=o.smtpForm.get("host"))!=null&&a.touched)?"border-red-300 bg-red-50":"border-gray-300")),l(13),b("w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 "+((d=o.smtpForm.get("user"))!=null&&d.invalid&&((d=o.smtpForm.get("user"))!=null&&d.touched)?"border-red-300 bg-red-50":"border-gray-300")),l(6),b("w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 "+((v=o.smtpForm.get("password"))!=null&&v.invalid&&((v=o.smtpForm.get("password"))!=null&&v.touched)?"border-red-300 bg-red-50":"border-gray-300")),l(7),c("placeholder",((y=o.currentCompany())==null?null:y.name)||"Nome da Empresa"),l(22),_("ngModel",o.testEmail),c("ngModelOptions",P(18,X)),l(),M("background-color",o.getPrimaryColor()),c("disabled",o.isTesting()||!o.testEmail||o.smtpForm.invalid),l(),h(o.isTesting()?72:73)}},dependencies:[N,V,$,A,q,k,G,D,I,R,L,O,J,z],styles:["[_nghost-%COMP%]{display:block}"]})};export{Q as SmtpConfigComponent};
