import{a as J}from"./chunk-KB4RQOZG.js";import{a as H}from"./chunk-SMGATDB2.js";import"./chunk-OKLJU3B3.js";import"./chunk-W3OFA55M.js";import{A as $,C as B,J as z,m as L,p as A,t as R}from"./chunk-QT4WKFE7.js";import"./chunk-ZBJHR7UR.js";import{F as j,G,I as q}from"./chunk-NQOWQODE.js";import{$b as P,Ab as _,Cb as k,Db as D,Eb as w,Fb as i,Gb as o,Hb as u,Ob as E,Pb as C,Rb as d,Ua as I,Vc as V,Ya as c,Yb as T,a as M,ac as l,b as S,bc as N,cc as b,f as h,fa as U,gb as F,la as x,ma as f,wa as g,zb as v}from"./chunk-HM7IHYI7.js";var K=(r,t)=>t.email;function Q(r,t){if(r&1){let e=E();i(0,"button",10),C("click",function(){x(e);let s=d();return f(s.showInviteFormToggle())}),u(1,"i",11),l(2," Convidar Usu\xE1rio "),o()}if(r&2){let e=d();T("background-color",e.getPrimaryColor()),w("disabled",e.inviteLoading())}}function W(r,t){if(r&1&&(i(0,"div",16),u(1,"i",32),l(2),o()),r&2){let e=d(2);c(2),b(" ",e.inviteSuccess()," ")}}function X(r,t){if(r&1&&(i(0,"div",17),u(1,"i",33),l(2),o()),r&2){let e=d(2);c(2),b(" ",e.inviteError()," ")}}function Z(r,t){r&1&&(u(0,"i",34),l(1," Enviando... "))}function ee(r,t){r&1&&(u(0,"i",35),l(1," Enviar Convite "))}function te(r,t){if(r&1){let e=E();i(0,"div",5)(1,"div",12),u(2,"i",13),i(3,"strong",14),l(4,"Convidar Usu\xE1rio"),o()(),i(5,"p",15),l(6,"O usu\xE1rio receber\xE1 um email de convite para se juntar \xE0 empresa."),o(),v(7,W,3,1,"div",16),v(8,X,3,1,"div",17),i(9,"form",18),C("submit",function(s){return x(e),d().inviteUser(),f(s.preventDefault())}),i(10,"div",19)(11,"div")(12,"label",20),l(13,"Nome do Usu\xE1rio *"),o(),i(14,"input",21),C("input",function(s){x(e);let m=d();return f(m.inviteName.set(s.target.value))}),o()(),i(15,"div")(16,"label",20),l(17,"Email do Usu\xE1rio *"),o(),i(18,"input",22),C("input",function(s){x(e);let m=d();return f(m.inviteEmail.set(s.target.value))}),o()()(),i(19,"div",23)(20,"div")(21,"label",20),l(22,"Fun\xE7\xE3o"),o(),i(23,"select",24),C("change",function(s){x(e);let m=d();return f(m.inviteRole.set(s.target.value))}),i(24,"option",25),l(25,"Usu\xE1rio"),o(),i(26,"option",26),l(27,"Gerente"),o(),i(28,"option",27),l(29,"Administrador"),o()()()(),i(30,"div",28)(31,"button",29),v(32,Z,2,0)(33,ee,2,0),o(),i(34,"button",30),C("click",function(){x(e);let s=d();return f(s.showInviteForm.set(!1))}),u(35,"i",31),l(36," Cancelar "),o()()()()}if(r&2){let e=d();c(7),_(e.inviteSuccess()?7:-1),c(),_(e.inviteError()?8:-1),c(6),w("value",e.inviteName()),c(4),w("value",e.inviteEmail()),c(5),w("value",e.inviteRole()),c(8),T("background-color",e.getPrimaryColor()),w("disabled",e.inviteLoading()||!e.inviteEmail().trim()||!e.inviteName().trim()),c(),_(e.inviteLoading()?32:33)}}function ne(r,t){r&1&&(i(0,"div",6),u(1,"i",36),i(2,"p",37),l(3,"Carregando usu\xE1rios..."),o()())}function ie(r,t){if(r&1){let e=E();i(0,"button",42),C("click",function(){x(e);let s=d(2);return f(s.showInviteFormToggle())}),u(1,"i",11),l(2," Convidar Primeiro Usu\xE1rio "),o()}if(r&2){let e=d(2);T("background-color",e.getPrimaryColor())}}function oe(r,t){if(r&1&&(i(0,"div",6),u(1,"i",38),i(2,"h5",39),l(3,"Nenhum usu\xE1rio encontrado"),o(),i(4,"p",40),l(5,"Convide usu\xE1rios para colaborar na sua empresa."),o(),v(6,ie,3,2,"button",41),o()),r&2){let e=d();c(6),_(e.canManageUsers()?6:-1)}}function re(r,t){if(r&1&&(i(0,"div",52),l(1),o()),r&2){let e=d().$implicit;c(),b(" ",e.displayName.charAt(0).toUpperCase()," ")}}function ae(r,t){r&1&&u(0,"i",53)}function se(r,t){r&1&&(i(0,"span",56),l(1,"(Voc\xEA)"),o())}function le(r,t){r&1&&(i(0,"span",57),l(1,"(Propriet\xE1rio)"),o())}function ce(r,t){if(r&1){let e=E();i(0,"select",64),C("change",function(s){x(e);let m=d().$implicit,p=d(2);return f(p.changeUserRole(m.email,s.target.value))}),i(1,"option",25),l(2,"Usu\xE1rio"),o(),i(3,"option",26),l(4,"Gerente"),o(),i(5,"option",27),l(6,"Administrador"),o()()}if(r&2){let e=d().$implicit,n=d(2);w("value",e.role)("disabled",n.isLoading())}}function me(r,t){if(r&1&&(i(0,"span"),l(1),o()),r&2){let e=d().$implicit,n=d(2);P(n.getRoleBadgeClass(e.role)),c(),b(" ",n.getRoleLabel(e.role)," ")}}function de(r,t){if(r&1){let e=E();i(0,"button",69),C("click",function(){x(e);let s=d(2).$implicit,m=d(2);return f(m.resendInvite(s.email))}),u(1,"i",70),l(2," Reenviar "),o()}if(r&2){let e=d(4);w("disabled",e.isLoading())}}function ue(r,t){if(r&1){let e=E();i(0,"button",71),C("click",function(){x(e);let s=d(2).$implicit,m=d(2);return f(m.inactivateUser(s.email))}),u(1,"i",72),l(2," Inativar "),o()}if(r&2){let e=d(4);w("disabled",e.isLoading())}}function pe(r,t){if(r&1){let e=E();i(0,"div",63),v(1,de,3,1,"button",65),v(2,ue,3,1,"button",66),i(3,"button",67),C("click",function(){x(e);let s=d().$implicit,m=d(2);return f(m.removeUser(s.email))}),u(4,"i",68),l(5," Excluir "),o()()}if(r&2){let e=d().$implicit,n=d(2);c(),_(e.inviteStatus==="pending"?1:-1),c(),_(e.inviteStatus==="accepted"?2:-1),c(),w("disabled",n.isLoading())}}function ge(r,t){if(r&1&&(i(0,"tr",48)(1,"td",49)(2,"div",50)(3,"div",51),v(4,re,2,1,"div",52)(5,ae,1,0,"i",53),o(),i(6,"div",54)(7,"div",55),l(8),o(),v(9,se,2,0,"span",56),v(10,le,2,0,"span",57),o()()(),i(11,"td",49)(12,"div",58),l(13),o()(),i(14,"td",49),v(15,ce,7,2,"select",59)(16,me,2,3,"span",60),o(),i(17,"td",49)(18,"span"),l(19),o()(),i(20,"td",61),l(21),o(),i(22,"td",62),v(23,pe,6,3,"div",63),o()()),r&2){let e,n,s,m,p=t.$implicit,a=d(2);c(4),_(p.displayName?4:5),c(4),b(" ",p.displayName||"Usu\xE1rio sem nome"," "),c(),_(p.email===((e=a.currentUser())==null?null:e.email)?9:-1),c(),_(p.email===((n=a.currentCompany())==null?null:n.ownerEmail)?10:-1),c(3),N(p.email),c(2),_(a.canManageUsers()&&p.email!==((s=a.currentCompany())==null?null:s.ownerEmail)?15:16),c(3),P(a.getStatusBadgeClass(p.inviteStatus||"accepted")),c(),b(" ",a.getStatusLabel(p.inviteStatus||"accepted")," "),c(2),b(" ",a.formatJoinedDate(p.joinedAt)," "),c(2),_(a.canManageUsers()&&p.email!==((m=a.currentUser())==null?null:m.email)&&p.email!==((m=a.currentCompany())==null?null:m.ownerEmail)?23:-1)}}function xe(r,t){if(r&1&&(i(0,"div",7)(1,"table",43)(2,"thead",44)(3,"tr")(4,"th",45),l(5,"Usu\xE1rio"),o(),i(6,"th",45),l(7,"Email"),o(),i(8,"th",45),l(9,"Fun\xE7\xE3o"),o(),i(10,"th",45),l(11,"Status"),o(),i(12,"th",45),l(13,"Membro desde"),o(),i(14,"th",46),l(15,"A\xE7\xF5es"),o()()(),i(16,"tbody",47),k(17,ge,24,11,"tr",48,K),o()()()),r&2){let e=d();c(17),D(e.users())}}function fe(r,t){if(r&1){let e=E();i(0,"tr",79)(1,"td",49)(2,"div",50)(3,"div",80),u(4,"i",81),o(),i(5,"div",54)(6,"div",55),l(7),o()()()(),i(8,"td",82),l(9),o(),i(10,"td",49)(11,"span",83),l(12),o()(),i(13,"td",61),l(14),o(),i(15,"td",49)(16,"span",84),u(17,"i",85),l(18," Pendente "),o()(),i(19,"td",86)(20,"button",87),C("click",function(){let s=x(e).$implicit,m=d(2);return f(m.resendInvite(s.email))}),u(21,"i",35),l(22," Reenviar "),o(),i(23,"button",88),C("click",function(){let s=x(e).$implicit,m=d(2);return f(m.markInviteAsAccepted(s.email))}),u(24,"i",89),l(25," Aceitar "),o(),i(26,"button",90),C("click",function(){let s=x(e).$implicit,m=d(2);return f(m.deletePendingInvite(s.email))}),u(27,"i",68),l(28," Excluir "),o()()()}if(r&2){let e=t.$implicit,n=d(2);c(7),b(" ",e.displayName||"Nome n\xE3o informado"," "),c(2),b(" ",e.email," "),c(3),b(" ",e.role||"user"," "),c(2),b(" ",n.formatDate(e.joinedAt)," ")}}function ve(r,t){if(r&1&&(i(0,"div",8)(1,"div",73)(2,"h3",74),u(3,"i",75),l(4),o(),i(5,"div",7)(6,"table",43)(7,"thead",76)(8,"tr")(9,"th",77),l(10,"Usu\xE1rio Convidado"),o(),i(11,"th",77),l(12,"Email"),o(),i(13,"th",77),l(14,"Fun\xE7\xE3o"),o(),i(15,"th",77),l(16,"Convidado em"),o(),i(17,"th",77),l(18,"Status"),o(),i(19,"th",78),l(20,"A\xE7\xF5es"),o()()(),i(21,"tbody",47),k(22,fe,29,4,"tr",79,K),o()()()()()),r&2){let e=d();c(4),b(" Convites Pendentes (",e.pendingInvites().length,") "),c(18),D(e.pendingInvites())}}function _e(r,t){if(r&1){let e=E();i(0,"div",9)(1,"div",91)(2,"div",92)(3,"h3",93),l(4),o()(),i(5,"div",94),u(6,"p",95),o(),i(7,"div",96)(8,"button",97),C("click",function(){x(e);let s=d();return f(s.cancelModalAction())}),l(9," Cancelar "),o(),i(10,"button",98),C("click",function(){x(e);let s=d();return f(s.confirmModalAction())}),l(11),o()()()()}if(r&2){let e=d();c(4),N(e.confirmTitle()),c(2),w("innerHTML",e.confirmMessage(),I),c(4),P(e.confirmButtonClass()==="btn-danger"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),c(),b(" ",e.confirmButtonText()," ")}}var Y=class r{companyService=U(q);authService=U(G);subdomainService=U(j);users=g([]);pendingInvites=g([]);currentCompany=g(null);currentUser=g(null);isLoading=g(!1);showInviteForm=g(!1);inviteEmail=g("");inviteName=g("");inviteRole=g("user");inviteLoading=g(!1);inviteError=g(null);inviteSuccess=g(null);showConfirmModal=g(!1);confirmAction=g(null);confirmTitle=g("");confirmMessage=g("");confirmButtonText=g("Confirmar");confirmButtonClass=g("btn-danger");ngOnInit(){return h(this,null,function*(){yield this.ensureCompanyContext(),yield this.loadUserData(),yield this.forceAddCurrentUser(),yield this.loadCompanyUsers()})}forceAddCurrentUser(){return h(this,null,function*(){let t=this.authService.getCurrentUser(),e=this.currentCompany();if(console.log("Force adding current user - User:",t?.email,"Company:",e?.name,"ID:",e?.id),!t||!e||!t.email||!e.id){console.log("Missing data for force add user");return}try{let s=(yield this.companyService.getCompanyUsers(e.id)).some(m=>m.email===t.email);if(console.log("User already exists in company:",s),!s){let m=t.email===e.ownerEmail?"admin":"user";console.log("Adding user with role:",m),yield this.companyService.addUserToCompany(e.id,t.email,m),console.log("User added successfully")}}catch(n){console.error("Error in forceAddCurrentUser:",n)}})}syncCurrentUserToCompany(){return h(this,null,function*(){let t=this.authService.getCurrentUser(),e=this.currentCompany();if(!(!t||!e||!t.email))try{if(!this.users().find(s=>s.email===t.email)){let s=t.email===e.ownerEmail?"admin":"user";yield this.companyService.addUserToCompany(e.id,t.email,s),yield this.loadCompanyUsers()}}catch(n){console.error("Erro ao sincronizar usu\xE1rio atual:",n)}})}loadUserData(){return h(this,null,function*(){let t=this.subdomainService.getCurrentCompany(),e=this.authService.getCurrentUser();this.currentCompany.set(t),this.currentUser.set(e)})}ensureCompanyContext(){return h(this,null,function*(){let t=this.subdomainService.getCurrentCompany();if(!t)try{t=yield this.subdomainService.initializeFromSubdomain()}catch{}if(t)this.currentCompany.set(t);else{let e=this.authService.getCurrentUser();if(e?.email)try{let n=yield this.companyService.getCompanyByUserEmail(e.email);n&&(this.subdomainService.setCurrentCompany(n),this.currentCompany.set(n))}catch{}}})}loadCompanyUsers(){return h(this,null,function*(){let t=this.currentCompany();if(!((!t||!t.id)&&(yield this.ensureCompanyContext(),t=this.currentCompany(),!t||!t.id))){this.isLoading.set(!0);try{let e=yield this.companyService.getAllCompanyUsers(t.id),n=e.filter(a=>!a.inviteStatus||a.inviteStatus==="accepted"||a.uid&&a.uid.trim()!==""),s=e.filter(a=>a.inviteStatus==="pending"),m=n;if(m.length===0){let a=this.authService.getCurrentUser();if(console.log("No users found, current user:",a),a&&a.email){let y=a.email===t.ownerEmail?"admin":"user",O={uid:a.uid,email:a.email,displayName:a.displayName||this.extractNameFromEmail(a.email),role:y,permissions:[],joinedAt:new Date,photoURL:a.photoURL,emailVerified:a.emailVerified,inviteStatus:"accepted"};m=[O],this.companyService.addUserToCompany(t.id,a.email,O.role).catch(()=>{})}}let p=m.map(a=>{try{let y=this.authService.getCurrentUser();return y&&y.email===a.email?S(M({},a),{displayName:y.displayName||a.displayName||this.extractNameFromEmail(a.email),photoURL:y.photoURL||a.photoURL,emailVerified:y.emailVerified||a.emailVerified,uid:y.uid||a.uid,inviteStatus:a.inviteStatus||"accepted",inviteToken:a.inviteToken}):S(M({},a),{displayName:a.displayName||this.extractNameFromEmail(a.email),inviteStatus:a.inviteStatus||"accepted",inviteToken:a.inviteToken})}catch(y){return console.warn("Erro ao enriquecer dados do usu\xE1rio:",a.email,y),S(M({},a),{displayName:a.displayName||this.extractNameFromEmail(a.email),inviteStatus:a.inviteStatus||"accepted",inviteToken:a.inviteToken})}});this.users.set(p),this.pendingInvites.set(s),console.log("\u{1F4CA} Debug Users Loaded:",{total:e.length,active:p.length,pending:s.length,pendingDetails:s.map(a=>({email:a.email,name:a.displayName,status:a.inviteStatus,joinedAt:a.joinedAt,token:a.inviteToken?"present":"missing"}))})}catch(e){console.error("Erro ao carregar usu\xE1rios:",e),this.pendingInvites.set([])}finally{this.isLoading.set(!1)}}})}extractNameFromEmail(t){return t.split("@")[0].replace(/[._]/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" ")}inviteUser(){return h(this,null,function*(){let t=this.inviteEmail().trim(),e=this.inviteName().trim(),n=this.inviteRole(),s=this.currentCompany();if(!t||!s)return;if(!e){this.inviteError.set("Nome \xE9 obrigat\xF3rio");return}if(e.length<2){this.inviteError.set("Nome deve ter pelo menos 2 caracteres");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){this.inviteError.set("Email inv\xE1lido");return}if(this.users().find(a=>a.email===t)){this.inviteError.set("Este usu\xE1rio j\xE1 faz parte da empresa");return}this.inviteLoading.set(!0),this.inviteError.set(null),this.inviteSuccess.set(null);try{yield this.companyService.addUserToCompany(s.id,t,n,e),this.inviteSuccess.set(`Convite enviado para ${e} (${t})`),this.inviteEmail.set(""),this.inviteName.set(""),this.inviteRole.set("user"),yield this.loadCompanyUsers(),setTimeout(()=>{this.showInviteForm.set(!1),this.inviteSuccess.set(null)},2e3)}catch(a){console.error("Erro ao convidar usu\xE1rio:",a);let y="Erro ao enviar convite. Tente novamente.";a?.message&&(a.message.includes("Configura\xE7\xE3o SMTP")?y=`\u274C ${a.message}. Configure o SMTP na se\xE7\xE3o de configura\xE7\xF5es antes de enviar convites.`:a.message.includes("email de convite")?y=a.message:y=`Erro: ${a.message}`),this.inviteError.set(y)}finally{this.inviteLoading.set(!1)}})}removeUser(t){console.log("\u{1F680} Debug - removeUser chamado para:",t);let e=this.currentCompany(),n=this.currentUser();if(console.log("\u{1F3E2} Debug - Company:",!!e),console.log("\u{1F464} Debug - Current user:",!!n),!e||!n){console.log("\u274C Debug - Company ou usu\xE1rio n\xE3o encontrado");return}if(t===n.email){this.showConfirmation("A\xE7\xE3o n\xE3o permitida",'Voc\xEA n\xE3o pode remover a si mesmo. Use a op\xE7\xE3o "Excluir Empresa" se deseja sair.',()=>{},"Entendi","btn-primary");return}let m=this.users().find(p=>p.email===t)?.displayName||t;this.showConfirmation("Confirmar exclus\xE3o",`Deseja realmente remover <strong>${m}</strong> (${t}) da empresa?<br><br>Esta a\xE7\xE3o n\xE3o pode ser desfeita.`,()=>this.confirmRemoveUser(t),"Excluir Usu\xE1rio","btn-danger")}confirmRemoveUser(t){return h(this,null,function*(){let e=this.currentCompany();if(!e){console.error("\u{1F6AB} Debug - Empresa n\xE3o encontrada");return}console.log("\u{1F5D1}\uFE0F Debug - Iniciando remo\xE7\xE3o do usu\xE1rio:",{userEmail:t,companyId:e.id}),this.isLoading.set(!0);try{console.log("\u{1F504} Debug - Chamando removeUserFromCompany..."),yield this.companyService.removeUserFromCompany(e.id,t),console.log("\u2705 Debug - Usu\xE1rio removido do Firestore"),console.log("\u{1F504} Debug - Recarregando lista de usu\xE1rios..."),yield this.loadCompanyUsers(),console.log("\u2705 Debug - Lista de usu\xE1rios recarregada"),this.inviteSuccess.set(`Usu\xE1rio ${t} removido com sucesso.`),setTimeout(()=>{this.inviteSuccess.set(null)},3e3)}catch(n){console.error("\u274C Debug - Erro ao remover usu\xE1rio:",n),this.showConfirmation("Erro ao remover usu\xE1rio","Ocorreu um erro ao tentar remover o usu\xE1rio. Tente novamente.",()=>{},"Fechar","btn-primary")}finally{this.isLoading.set(!1)}})}changeUserRole(t,e){return h(this,null,function*(){let n=this.currentCompany();if(n){this.isLoading.set(!0);try{yield this.companyService.updateUserRole(n.id,t,e),yield this.loadCompanyUsers()}catch(s){console.error("Erro ao alterar fun\xE7\xE3o do usu\xE1rio:",s),this.showConfirmation("Erro ao alterar fun\xE7\xE3o","Ocorreu um erro ao alterar a fun\xE7\xE3o do usu\xE1rio. Tente novamente.",()=>{},"Fechar","btn-primary")}finally{this.isLoading.set(!1)}}})}resendInvite(t){return h(this,null,function*(){let e=this.currentCompany();if(e){this.isLoading.set(!0);try{let n=this.users().find(s=>s.email===t);n&&(yield this.companyService.addUserToCompany(e.id,t,n.role,n.displayName),this.inviteSuccess.set(`Convite reenviado para ${t}`),setTimeout(()=>{this.inviteSuccess.set(null)},3e3),yield this.loadCompanyUsers())}catch(n){console.error("Erro ao reenviar convite:",n);let s="Erro ao reenviar convite. Tente novamente.";n?.message&&n.message.includes("Configura\xE7\xE3o SMTP")&&(s=`\u274C ${n.message}. Configure o SMTP na se\xE7\xE3o de configura\xE7\xF5es antes de reenviar convites.`),this.inviteError.set(s),setTimeout(()=>{this.inviteError.set(null)},5e3)}finally{this.isLoading.set(!1)}}})}inactivateUser(t){if(!this.currentCompany())return;let s=this.users().find(m=>m.email===t)?.displayName||t;this.showConfirmation("Confirmar inativa\xE7\xE3o",`Deseja realmente inativar <strong>${s}</strong> (${t})?<br><br>O usu\xE1rio n\xE3o poder\xE1 mais acessar o sistema at\xE9 ser reativado.`,()=>this.confirmInactivateUser(t),"Inativar Usu\xE1rio","btn-danger")}confirmInactivateUser(t){return h(this,null,function*(){let e=this.currentCompany();if(e){this.isLoading.set(!0);try{yield this.companyService.updateUserInCompany(e.id,t,{inviteStatus:"inactive"}),yield this.loadCompanyUsers(),this.inviteSuccess.set(`Usu\xE1rio ${t} foi inativado com sucesso.`),setTimeout(()=>{this.inviteSuccess.set(null)},3e3)}catch(n){console.error("Erro ao inativar usu\xE1rio:",n),this.showConfirmation("Erro ao inativar usu\xE1rio","Ocorreu um erro ao tentar inativar o usu\xE1rio. Tente novamente.",()=>{},"Fechar","btn-primary")}finally{this.isLoading.set(!1)}}})}deletePendingInvite(t){return h(this,null,function*(){let e=this.currentCompany();e?.id&&this.showConfirmation("Excluir Convite Pendente",`Tem certeza que deseja excluir o convite pendente para ${t}? Esta a\xE7\xE3o n\xE3o pode ser desfeita.`,()=>h(this,null,function*(){try{yield this.companyService.removeUserFromCompany(e.id,t),yield this.loadCompanyUsers(),this.inviteSuccess.set(`Convite para ${t} foi exclu\xEDdo com sucesso.`),setTimeout(()=>{this.inviteSuccess.set(null)},3e3)}catch(n){console.error("Erro ao excluir convite:",n),this.inviteError.set("Erro ao excluir convite. Tente novamente."),setTimeout(()=>{this.inviteError.set(null)},3e3)}}),"Excluir","btn-danger")})}markInviteAsAccepted(t){return h(this,null,function*(){let e=this.currentCompany();e?.id&&this.showConfirmation("Marcar Convite como Aceito",`Deseja marcar o convite de ${t} como aceito? Isso ir\xE1 ativar o usu\xE1rio na empresa.`,()=>h(this,null,function*(){try{yield this.companyService.updateUserInCompany(e.id,t,{inviteStatus:"accepted",inviteToken:null,acceptedAt:new Date}),yield this.loadCompanyUsers(),this.inviteSuccess.set(`Convite de ${t} marcado como aceito com sucesso.`),setTimeout(()=>{this.inviteSuccess.set(null)},3e3)}catch(n){console.error("Erro ao marcar convite como aceito:",n),this.inviteError.set("Erro ao atualizar convite. Tente novamente."),setTimeout(()=>{this.inviteError.set(null)},3e3)}}),"Marcar como Aceito","btn-success")})}formatDate(t){if(!t)return"N/A";try{return(t.toDate?t.toDate():new Date(t)).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Data inv\xE1lida"}}canManageUsers(){let t=this.currentUser(),e=this.currentCompany();return!t||!e?!1:e.ownerEmail===t.email?!0:this.users().length>0?this.users().find(s=>s.email===t.email)?.role==="admin":!0}showInviteFormToggle(){this.showInviteForm.set(!this.showInviteForm()),this.inviteError.set(null),this.inviteSuccess.set(null),this.inviteEmail.set(""),this.inviteName.set("")}showConfirmation(t,e,n,s="Confirmar",m="btn-danger"){console.log("\u{1F4F1} Debug Modal - Mostrando confirma\xE7\xE3o:",{title:t,buttonText:s}),this.confirmTitle.set(t),this.confirmMessage.set(e),this.confirmAction.set(n),this.confirmButtonText.set(s),this.confirmButtonClass.set(m),this.showConfirmModal.set(!0),console.log("\u2705 Debug Modal - Modal configurado e aberto")}confirmModalAction(){console.log("\u{1F504} Debug Modal - Confirmando a\xE7\xE3o...");let t=this.confirmAction();console.log("\u{1F3AF} Debug Modal - A\xE7\xE3o encontrada:",!!t),t?(console.log("\u25B6\uFE0F Debug Modal - Executando a\xE7\xE3o..."),t()):console.log("\u274C Debug Modal - Nenhuma a\xE7\xE3o para executar"),this.showConfirmModal.set(!1),console.log("\u2705 Debug Modal - Modal fechado")}cancelModalAction(){this.showConfirmModal.set(!1),this.confirmAction.set(null)}getRoleLabel(t){switch(t){case"admin":return"Administrador";case"manager":return"Gerente";case"user":return"Usu\xE1rio";default:return t}}getRoleBadgeClass(t){switch(t){case"admin":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800";case"manager":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800";case"user":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800";default:return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800"}}getStatusLabel(t){switch(t){case"pending":return"Convite Pendente";case"accepted":return"Ativo";case"expired":return"Convite Expirado";case"inactive":return"Inativo";default:return"Desconhecido"}}getStatusBadgeClass(t){switch(t){case"pending":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800";case"accepted":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800";case"expired":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800";case"inactive":return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800";default:return"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800"}}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}formatJoinedDate(t){if(!t)return"Data n\xE3o dispon\xEDvel";try{return t&&typeof t.toDate=="function"?t.toDate().toLocaleDateString("pt-BR"):t instanceof Date?t.toLocaleDateString("pt-BR"):typeof t=="string"?new Date(t).toLocaleDateString("pt-BR"):"Data n\xE3o dispon\xEDvel"}catch(e){return console.warn("Erro ao formatar data:",t,e),"Data n\xE3o dispon\xEDvel"}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-user-management"]],decls:12,vars:5,consts:[["title","Gerenciar Usu\xE1rios"],[1,"text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"background-color","disabled"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"p-6"],[1,"mb-6","p-4","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"text-center","py-8"],[1,"overflow-x-auto"],[1,"mt-8"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50","flex","items-center","justify-center"],[1,"text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"fas","fa-plus","mr-1"],[1,"flex","items-center","mb-3"],[1,"fas","fa-info-circle","text-blue-500","mr-2"],[1,"text-blue-800"],[1,"text-blue-700","text-sm","mb-4"],[1,"mb-4","p-3","bg-green-50","border","border-green-200","rounded","text-green-800"],[1,"mb-4","p-3","bg-red-50","border","border-red-200","rounded","text-red-800"],[1,"space-y-4",3,"submit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","placeholder","Jo\xE3o Silva","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"input","value"],["type","email","name","email","placeholder","usuario@exemplo.com","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"input","value"],[1,"grid","grid-cols-1","md:grid-cols-1","gap-4"],["name","role",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"change","value"],["value","user"],["value","manager"],["value","admin"],[1,"flex","space-x-3"],["type","submit",1,"text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","disabled:opacity-50",3,"disabled"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click"],[1,"fas","fa-times","mr-1"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-exclamation-circle","mr-2"],[1,"fas","fa-spinner","fa-spin","mr-1"],[1,"fas","fa-paper-plane","mr-1"],[1,"fas","fa-spinner","fa-spin","text-2xl","text-gray-400","mb-4"],[1,"text-gray-600"],[1,"fas","fa-users","text-4xl","text-gray-300","mb-4"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"background-color"],[1,"text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center"],[1,"flex-shrink-0","h-10","w-10"],[1,"h-10","w-10","rounded-full","bg-blue-500","flex","items-center","justify-center","text-white","font-medium"],[1,"fas","fa-user-circle","text-2xl","text-gray-400"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-blue-600","font-medium"],[1,"text-xs","text-purple-600","font-medium"],[1,"text-sm","text-gray-900"],[1,"text-sm","border","border-gray-300","rounded","px-2","py-1","focus:ring-blue-500","focus:border-blue-500",3,"value","disabled"],[3,"class"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],[1,"flex","space-x-2","justify-end"],[1,"text-sm","border","border-gray-300","rounded","px-2","py-1","focus:ring-blue-500","focus:border-blue-500",3,"change","value","disabled"],["title","Reenviar convite",1,"text-blue-600","hover:text-blue-800","text-sm",3,"disabled"],["title","Inativar usu\xE1rio",1,"text-orange-600","hover:text-orange-800","text-sm",3,"disabled"],["title","Excluir usu\xE1rio",1,"text-red-600","hover:text-red-800","text-sm",3,"click","disabled"],[1,"fas","fa-trash","mr-1"],["title","Reenviar convite",1,"text-blue-600","hover:text-blue-800","text-sm",3,"click","disabled"],[1,"fas","fa-envelope","mr-1"],["title","Inativar usu\xE1rio",1,"text-orange-600","hover:text-orange-800","text-sm",3,"click","disabled"],[1,"fas","fa-user-slash","mr-1"],[1,"border-t","border-gray-200","pt-6"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"fas","fa-clock","text-yellow-500","mr-2"],[1,"bg-yellow-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-yellow-700","uppercase","tracking-wider"],[1,"px-6","py-3","text-right","text-xs","font-medium","text-yellow-700","uppercase","tracking-wider"],[1,"hover:bg-yellow-50"],[1,"w-10","h-10","bg-yellow-100","rounded-full","flex","items-center","justify-center"],[1,"fas","fa-user","text-yellow-600"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"inline-flex","px-2","py-1","text-xs","font-semibold","rounded-full","bg-blue-100","text-blue-800"],[1,"inline-flex","px-2","py-1","text-xs","font-semibold","rounded-full","bg-yellow-100","text-yellow-800"],[1,"fas","fa-clock","mr-1"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium","space-x-2"],["type","button","title","Reenviar convite",1,"text-blue-600","hover:text-blue-900","transition-colors",3,"click"],["type","button","title","Marcar como aceito",1,"text-green-600","hover:text-green-900","transition-colors",3,"click"],[1,"fas","fa-check","mr-1"],["type","button","title","Excluir convite",1,"text-red-600","hover:text-red-900","transition-colors",3,"click"],[1,"relative","bg-white","rounded-lg","shadow-xl","max-w-md","mx-auto"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900"],[1,"px-6","py-4"],[1,"text-gray-700",3,"innerHTML"],[1,"px-6","py-4","border-t","border-gray-200","flex","justify-end","space-x-3"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-md","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-white","rounded-md","transition-colors",3,"click"]],template:function(e,n){e&1&&(i(0,"app-main-layout")(1,"app-config-header",0),v(2,Q,3,3,"button",1),o(),i(3,"div",2)(4,"div",3)(5,"div",4),v(6,te,37,9,"div",5),v(7,ne,4,0,"div",6)(8,oe,7,1,"div",6)(9,xe,19,0,"div",7),v(10,ve,24,1,"div",8),o()()(),v(11,_e,12,5,"div",9),o()),e&2&&(c(2),_(n.canManageUsers()?2:-1),c(4),_(n.showInviteForm()?6:-1),c(),_(n.isLoading()?7:n.users().length===0?8:9),c(3),_(n.pendingInvites().length>0&&n.canManageUsers()?10:-1),c(),_(n.showConfirmModal()?11:-1))},dependencies:[V,z,R,$,B,L,A,J,H],styles:[".user-management-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.invite-form[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;padding:20px}.user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#007bff;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0}.avatar-initials[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600;color:#495057}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px;font-weight:500}.badge-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.badge-warning[_ngcontent-%COMP%]{background-color:#ffc107;color:#212529}.badge-info[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff}.badge-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.danger-zone[_ngcontent-%COMP%]{border:1px solid #dc3545;border-radius:6px;padding:20px;background-color:#fff5f5}.danger-zone[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#dc3545!important}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:1040;width:100vw;height:100vh;background-color:#00000080}.modal[_ngcontent-%COMP%]{z-index:1050}.modal-dialog[_ngcontent-%COMP%]{max-width:500px;margin:1.75rem auto}.btn[_ngcontent-%COMP%]{border-radius:6px;font-weight:500;transition:all .2s ease}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.btn-sm[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.alert[_ngcontent-%COMP%]{border-radius:8px;border:none;display:flex;align-items:center;gap:10px}.gap-2[_ngcontent-%COMP%]{gap:8px}.d-flex[_ngcontent-%COMP%]{display:flex}.align-items-center[_ngcontent-%COMP%]{align-items:center}.justify-content-between[_ngcontent-%COMP%]{justify-content:space-between}.ms-2[_ngcontent-%COMP%]{margin-left:8px}.mt-2[_ngcontent-%COMP%]{margin-top:8px}.mb-2[_ngcontent-%COMP%]{margin-bottom:8px}.mb-3[_ngcontent-%COMP%]{margin-bottom:16px}.mb-4[_ngcontent-%COMP%]{margin-bottom:24px}.py-4[_ngcontent-%COMP%]{padding-top:24px;padding-bottom:24px}.text-center[_ngcontent-%COMP%]{text-align:center}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.text-primary[_ngcontent-%COMP%]{color:#007bff!important}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.fw-bold[_ngcontent-%COMP%]{font-weight:700}.small[_ngcontent-%COMP%]{font-size:.875em}@media (max-width: 768px){.user-management-container[_ngcontent-%COMP%]{padding:10px}.invite-form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{gap:10px}.invite-form[_ngcontent-%COMP%]   .col-md-2[_ngcontent-%COMP%], .invite-form[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%], .invite-form[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{width:100%}.table-responsive[_ngcontent-%COMP%]{font-size:14px}.user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;font-size:14px}}"]})};export{Y as UserManagementComponent};
