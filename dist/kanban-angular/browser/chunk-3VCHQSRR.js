import{Ea as Kh,_ as Gi,a as Te,b as Xe,ba as Vn,da as ze,e as Ot,ea as Ln,f as m,ha as Gh,i as on,ia as Ki,kb as Ze,n as zh,na as xt,nc as Hh,o as Wh,oc as Qh,pc as Zo,r as Wi,s as Jo,t as Xo,va as Hi,wa as Fe}from"./chunk-CM3JQ4U2.js";var Yh=()=>{};var Zh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},n_=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],u=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Qi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,u=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,p=s>>2,_=(s&3)<<4|u>>4,v=(u&15)<<2|d>>6,R=d&63;l||(R=64,a||(v=64)),r.push(t[p],t[_],t[v],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Zh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):n_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let _=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||u==null||d==null||_==null)throw new ta;let v=s<<2|u>>4;if(r.push(v),d!==64){let R=u<<4&240|d>>2;if(r.push(R),_!==64){let k=d<<6&192|_;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},ta=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},r_=function(n){let e=Zh(n);return Qi.encodeByteArray(e,!0)},Mr=function(n){return r_(n).replace(/\./g,"")},Yi=function(n){try{return Qi.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ra(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var i_=()=>ra().__FIREBASE_DEFAULTS__,s_=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},o_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Yi(n[1]);return e&&JSON.parse(e)},Ji=()=>{try{return Yh()||i_()||s_()||o_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ia=n=>{var e,t;return(t=(e=Ji())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},ed=n=>{let e=ia(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},sa=()=>{var n;return(n=Ji())===null||n===void 0?void 0:n.config},oa=n=>{var e;return(e=Ji())===null||e===void 0?void 0:e[`_${n}`]};var an=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Vt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Xi(n){return m(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function td(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Mr(JSON.stringify(t)),Mr(JSON.stringify(a)),""].join(".")}var Lr={};function a_(){let n={prod:[],emulator:[]};for(let e of Object.keys(Lr))Lr[e]?n.emulator.push(e):n.prod.push(e);return n}function c_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Jh=!1;function Zi(n,e){if(typeof window>"u"||typeof document>"u"||!Vt(window.location.host)||Lr[n]===e||Lr[n]||Jh)return;Lr[n]=e;function t(v){return`__firebase__banner__${v}`}let r="__firebase__banner",s=a_().prod.length>0;function a(){let v=document.getElementById(r);v&&v.remove()}function u(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function l(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){let v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Jh=!0,a()},v}function p(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){let v=c_(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),D=document.getElementById(x)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){let j=v.element;u(j),p(D,x);let J=d();l(U,$),j.append(U,k,D,J),document.body.appendChild(j)}s?(k.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function pe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function nd(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pe())}function u_(){var n;let e=(n=Ji())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function rd(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function id(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function sd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function od(){let n=pe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ad(){return!u_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Fr(){try{return typeof indexedDB=="object"}catch{return!1}}function cd(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var l_="FirebaseError",xe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=l_,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,We.prototype.create)}},We=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?h_(s,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new xe(i,u,r)}};function h_(n,e){return n.replace(d_,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var d_=/\{\$([^}]+)}/g;function ud(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function et(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Xh(s)&&Xh(a)){if(!et(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Xh(n){return n!==null&&typeof n=="object"}function Mn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Un(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function ld(n,e){let t=new na(n,e);return t.subscribe.bind(t)}var na=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");f_(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=ea),i.error===void 0&&(i.error=ea),i.complete===void 0&&(i.complete=ea);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function f_(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ea(){}var MT=14400*1e3;function ne(n){return n&&n._delegate?n._delegate:n}var ke=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var cn="[DEFAULT]";var aa=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new an;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(m_(e))try{this.getOrInitializeService({instanceIdentifier:cn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=cn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return m(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=cn){return this.instances.has(e)}getOptions(e=cn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(s);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:p_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=cn){return this.component?this.component.multipleInstances?e:cn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function p_(n){return n===cn?void 0:n}function m_(n){return n.instantiationMode==="EAGER"}var es=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new aa(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var g_=[],W=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(W||{}),__={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},y_=W.INFO,v_={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},I_=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=v_[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},tt=class{constructor(e){this.name=e,this._logLevel=y_,this._logHandler=I_,this._userLogHandler=null,g_.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?__[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var w_=(n,e)=>e.some(t=>n instanceof t),hd,dd;function E_(){return hd||(hd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function T_(){return dd||(dd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var fd=new WeakMap,ua=new WeakMap,pd=new WeakMap,ca=new WeakMap,ha=new WeakMap;function A_(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(nt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&fd.set(t,n)}).catch(()=>{}),ha.set(e,n),e}function b_(n){if(ua.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});ua.set(n,e)}var la={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ua.get(n);if(e==="objectStoreNames")return n.objectStoreNames||pd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return nt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function md(n){la=n(la)}function S_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ts(this),e,...t);return pd.set(r,e.sort?e.sort():[e]),nt(r)}:T_().includes(n)?function(...e){return n.apply(ts(this),e),nt(fd.get(this))}:function(...e){return nt(n.apply(ts(this),e))}}function R_(n){return typeof n=="function"?S_(n):(n instanceof IDBTransaction&&b_(n),w_(n,E_())?new Proxy(n,la):n)}function nt(n){if(n instanceof IDBRequest)return A_(n);if(ca.has(n))return ca.get(n);let e=R_(n);return e!==n&&(ca.set(n,e),ha.set(e,n)),e}var ts=n=>ha.get(n);function _d(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),u=nt(a);return r&&a.addEventListener("upgradeneeded",l=>{r(nt(a.result),l.oldVersion,l.newVersion,nt(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),u.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var P_=["get","getKey","getAll","getAllKeys","count"],C_=["put","add","delete","clear"],da=new Map;function gd(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(da.get(e))return da.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=C_.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||P_.includes(t)))return;let s=function(a,...u){return m(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&l.done]))[0]})};return da.set(e,s),s}md(n=>Xe(Te({},n),{get:(e,t,r)=>gd(e,t)||n.get(e,t,r),has:(e,t)=>!!gd(e,t)||n.has(e,t)}));var pa=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(k_(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function k_(n){let e=n.getComponent();return e?.type==="VERSION"}var ma="@firebase/app",yd="0.13.2";var dt=new tt("@firebase/app"),D_="@firebase/app-compat",N_="@firebase/analytics-compat",O_="@firebase/analytics",x_="@firebase/app-check-compat",V_="@firebase/app-check",L_="@firebase/auth",M_="@firebase/auth-compat",F_="@firebase/database",U_="@firebase/data-connect",B_="@firebase/database-compat",q_="@firebase/functions",$_="@firebase/functions-compat",j_="@firebase/installations",z_="@firebase/installations-compat",W_="@firebase/messaging",G_="@firebase/messaging-compat",K_="@firebase/performance",H_="@firebase/performance-compat",Q_="@firebase/remote-config",Y_="@firebase/remote-config-compat",J_="@firebase/storage",X_="@firebase/storage-compat",Z_="@firebase/firestore",ey="@firebase/ai",ty="@firebase/firestore-compat",ny="firebase",ry="11.10.0";var ga="[DEFAULT]",iy={[ma]:"fire-core",[D_]:"fire-core-compat",[O_]:"fire-analytics",[N_]:"fire-analytics-compat",[V_]:"fire-app-check",[x_]:"fire-app-check-compat",[L_]:"fire-auth",[M_]:"fire-auth-compat",[F_]:"fire-rtdb",[U_]:"fire-data-connect",[B_]:"fire-rtdb-compat",[q_]:"fire-fn",[$_]:"fire-fn-compat",[j_]:"fire-iid",[z_]:"fire-iid-compat",[W_]:"fire-fcm",[G_]:"fire-fcm-compat",[K_]:"fire-perf",[H_]:"fire-perf-compat",[Q_]:"fire-rc",[Y_]:"fire-rc-compat",[J_]:"fire-gcs",[X_]:"fire-gcs-compat",[Z_]:"fire-fst",[ty]:"fire-fst-compat",[ey]:"fire-vertex","fire-js":"fire-js",[ny]:"fire-js-all"};var Ur=new Map,sy=new Map,_a=new Map;function vd(n,e){try{n.container.addComponent(e)}catch(t){dt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ge(n){let e=n.name;if(_a.has(e))return dt.debug(`There were multiple attempts to register component ${e}.`),!1;_a.set(e,n);for(let t of Ur.values())vd(t,n);for(let t of sy.values())vd(t,n);return!0}function Bn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function De(n){return n==null?!1:n.settings!==void 0}var oy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Lt=new We("app","Firebase",oy);var ya=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ke("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Lt.create("app-deleted",{appName:this._name})}};var Mt=ry;function wa(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:ga,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Lt.create("bad-app-name",{appName:String(i)});if(t||(t=sa()),!t)throw Lt.create("no-options");let s=Ur.get(i);if(s){if(et(t,s.options)&&et(r,s.config))return s;throw Lt.create("duplicate-app",{appName:i})}let a=new es(i);for(let l of _a.values())a.addComponent(l);let u=new ya(t,r,a);return Ur.set(i,u),u}function un(n=ga){let e=Ur.get(n);if(!e&&n===ga&&sa())return wa();if(!e)throw Lt.create("no-app",{appName:n});return e}function ns(){return Array.from(Ur.values())}function se(n,e,t){var r;let i=(r=iy[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let u=[`Unable to register library "${i}" with version "${e}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dt.warn(u.join(" "));return}Ge(new ke(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var ay="firebase-heartbeat-database",cy=1,Br="firebase-heartbeat-store",fa=null;function Td(){return fa||(fa=_d(ay,cy,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Br)}catch(t){console.warn(t)}}}}).catch(n=>{throw Lt.create("idb-open",{originalErrorMessage:n.message})})),fa}function uy(n){return m(this,null,function*(){try{let t=(yield Td()).transaction(Br),r=yield t.objectStore(Br).get(Ad(n));return yield t.done,r}catch(e){if(e instanceof xe)dt.warn(e.message);else{let t=Lt.create("idb-get",{originalErrorMessage:e?.message});dt.warn(t.message)}}})}function Id(n,e){return m(this,null,function*(){try{let r=(yield Td()).transaction(Br,"readwrite");yield r.objectStore(Br).put(e,Ad(n)),yield r.done}catch(t){if(t instanceof xe)dt.warn(t.message);else{let r=Lt.create("idb-set",{originalErrorMessage:t?.message});dt.warn(r.message)}}})}function Ad(n){return`${n.name}!${n.options.appId}`}var ly=1024,hy=30,va=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ia(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return m(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=wd();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>hy){let a=fy(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){dt.warn(r)}})}getHeartbeatsHeader(){return m(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=wd(),{heartbeatsToSend:r,unsentEntries:i}=dy(this._heartbeatsCache.heartbeats),s=Mr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return dt.warn(t),""}})}};function wd(){return new Date().toISOString().substring(0,10)}function dy(n,e=ly){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),Ed(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Ed(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Ia=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return m(this,null,function*(){return Fr()?cd().then(()=>!0).catch(()=>!1):!1})}read(){return m(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield uy(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Id(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Id(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Ed(n){return Mr(JSON.stringify({version:2,heartbeats:n})).length}function fy(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function py(n){Ge(new ke("platform-logger",e=>new pa(e),"PRIVATE")),Ge(new ke("heartbeat",e=>new va(e),"PRIVATE")),se(ma,yd,n),se(ma,yd,"esm2017"),se("fire-js","")}py("");var bd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Sd={};var ft,Ea;(function(){var n;function e(E,g){function I(){}I.prototype=g.prototype,E.D=g.prototype,E.prototype=new I,E.prototype.constructor=E,E.C=function(w,T,b){for(var y=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)y[ut-2]=arguments[ut];return g.prototype[T].apply(w,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,g,I){I||(I=0);var w=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)w[T]=g.charCodeAt(I++)|g.charCodeAt(I++)<<8|g.charCodeAt(I++)<<16|g.charCodeAt(I++)<<24;else for(T=0;16>T;++T)w[T]=g[I++]|g[I++]<<8|g[I++]<<16|g[I++]<<24;g=E.g[0],I=E.g[1],T=E.g[2];var b=E.g[3],y=g+(b^I&(T^b))+w[0]+3614090360&4294967295;g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[2]+606105819&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[3]+3250441966&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[4]+4118548399&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[6]+2821735955&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[7]+4249261313&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[8]+1770035416&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[10]+4294925233&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[11]+2304563134&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(b^I&(T^b))+w[12]+1804603682&4294967295,g=I+(y<<7&4294967295|y>>>25),y=b+(T^g&(I^T))+w[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=T+(I^b&(g^I))+w[14]+2792965006&4294967295,T=b+(y<<17&4294967295|y>>>15),y=I+(g^T&(b^g))+w[15]+1236535329&4294967295,I=T+(y<<22&4294967295|y>>>10),y=g+(T^b&(I^T))+w[1]+4129170786&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[11]+643717713&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[0]+3921069994&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[5]+3593408605&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[15]+3634488961&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[4]+3889429448&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[9]+568446438&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[3]+4107603335&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[8]+1163531501&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(T^b&(I^T))+w[13]+2850285829&4294967295,g=I+(y<<5&4294967295|y>>>27),y=b+(I^T&(g^I))+w[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=T+(g^I&(b^g))+w[7]+1735328473&4294967295,T=b+(y<<14&4294967295|y>>>18),y=I+(b^g&(T^b))+w[12]+2368359562&4294967295,I=T+(y<<20&4294967295|y>>>12),y=g+(I^T^b)+w[5]+4294588738&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[11]+1839030562&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[14]+4259657740&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[1]+2763975236&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[7]+4139469664&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[10]+3200236656&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[13]+681279174&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[3]+3572445317&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[6]+76029189&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(I^T^b)+w[9]+3654602809&4294967295,g=I+(y<<4&4294967295|y>>>28),y=b+(g^I^T)+w[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=T+(b^g^I)+w[15]+530742520&4294967295,T=b+(y<<16&4294967295|y>>>16),y=I+(T^b^g)+w[2]+3299628645&4294967295,I=T+(y<<23&4294967295|y>>>9),y=g+(T^(I|~b))+w[0]+4096336452&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[14]+2878612391&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[5]+4237533241&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[12]+1700485571&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[10]+4293915773&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[1]+2240044497&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[8]+1873313359&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[6]+2734768916&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[13]+1309151649&4294967295,I=T+(y<<21&4294967295|y>>>11),y=g+(T^(I|~b))+w[4]+4149444226&4294967295,g=I+(y<<6&4294967295|y>>>26),y=b+(I^(g|~T))+w[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=T+(g^(b|~I))+w[2]+718787259&4294967295,T=b+(y<<15&4294967295|y>>>17),y=I+(b^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.u=function(E,g){g===void 0&&(g=E.length);for(var I=g-this.blockSize,w=this.B,T=this.h,b=0;b<g;){if(T==0)for(;b<=I;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(w[T++]=E.charCodeAt(b++),T==this.blockSize){i(this,w),T=0;break}}else for(;b<g;)if(w[T++]=E[b++],T==this.blockSize){i(this,w),T=0;break}}this.h=T,this.o+=g},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;var I=8*this.o;for(g=E.length-8;g<E.length;++g)E[g]=I&255,I/=256;for(this.u(E),E=Array(16),g=I=0;4>g;++g)for(var w=0;32>w;w+=8)E[I++]=this.g[g]>>>w&255;return E};function s(E,g){var I=u;return Object.prototype.hasOwnProperty.call(I,E)?I[E]:I[E]=g(E)}function a(E,g){this.h=g;for(var I=[],w=!0,T=E.length-1;0<=T;T--){var b=E[T]|0;w&&b==g||(I[T]=b,w=!1)}this.g=I}var u={};function l(E){return-128<=E&&128>E?s(E,function(g){return new a([g|0],0>g?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return _;if(0>E)return D(d(-E));for(var g=[],I=1,w=0;E>=I;w++)g[w]=E/I|0,I*=4294967296;return new a(g,0)}function p(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return D(p(E.substring(1),g));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=d(Math.pow(g,8)),w=_,T=0;T<E.length;T+=8){var b=Math.min(8,E.length-T),y=parseInt(E.substring(T,T+b),g);8>b?(b=d(Math.pow(g,b)),w=w.j(b).add(d(y))):(w=w.j(I),w=w.add(d(y)))}return w}var _=l(0),v=l(1),R=l(16777216);n=a.prototype,n.m=function(){if(x(this))return-D(this).m();for(var E=0,g=1,I=0;I<this.g.length;I++){var w=this.i(I);E+=(0<=w?w:4294967296+w)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(x(this))return"-"+D(this).toString(E);for(var g=d(Math.pow(E,6)),I=this,w="";;){var T=J(I,g).g;I=$(I,T.j(g));var b=((0<I.g.length?I.g[0]:I.h)>>>0).toString(E);if(I=T,k(I))return b+w;for(;6>b.length;)b="0"+b;w=b+w}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(var g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function x(E){return E.h==-1}n.l=function(E){return E=$(this,E),x(E)?-1:k(E)?0:1};function D(E){for(var g=E.g.length,I=[],w=0;w<g;w++)I[w]=~E.g[w];return new a(I,~E.h).add(v)}n.abs=function(){return x(this)?D(this):this},n.add=function(E){for(var g=Math.max(this.g.length,E.g.length),I=[],w=0,T=0;T<=g;T++){var b=w+(this.i(T)&65535)+(E.i(T)&65535),y=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=y>>>16,b&=65535,y&=65535,I[T]=y<<16|b}return new a(I,I[I.length-1]&-2147483648?-1:0)};function $(E,g){return E.add(D(g))}n.j=function(E){if(k(this)||k(E))return _;if(x(this))return x(E)?D(this).j(D(E)):D(D(this).j(E));if(x(E))return D(this.j(D(E)));if(0>this.l(R)&&0>E.l(R))return d(this.m()*E.m());for(var g=this.g.length+E.g.length,I=[],w=0;w<2*g;w++)I[w]=0;for(w=0;w<this.g.length;w++)for(var T=0;T<E.g.length;T++){var b=this.i(w)>>>16,y=this.i(w)&65535,ut=E.i(T)>>>16,_r=E.i(T)&65535;I[2*w+2*T]+=y*_r,U(I,2*w+2*T),I[2*w+2*T+1]+=b*_r,U(I,2*w+2*T+1),I[2*w+2*T+1]+=y*ut,U(I,2*w+2*T+1),I[2*w+2*T+2]+=b*ut,U(I,2*w+2*T+2)}for(w=0;w<g;w++)I[w]=I[2*w+1]<<16|I[2*w];for(w=g;w<2*g;w++)I[w]=0;return new a(I,0)};function U(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function j(E,g){this.g=E,this.h=g}function J(E,g){if(k(g))throw Error("division by zero");if(k(E))return new j(_,_);if(x(E))return g=J(D(E),g),new j(D(g.g),D(g.h));if(x(g))return g=J(E,D(g)),new j(D(g.g),g.h);if(30<E.g.length){if(x(E)||x(g))throw Error("slowDivide_ only works with positive integers.");for(var I=v,w=g;0>=w.l(E);)I=Re(I),w=Re(w);var T=Y(I,1),b=Y(w,1);for(w=Y(w,2),I=Y(I,2);!k(w);){var y=b.add(w);0>=y.l(E)&&(T=T.add(I),b=y),w=Y(w,1),I=Y(I,1)}return g=$(E,T.j(g)),new j(T,g)}for(T=_;0<=E.l(g);){for(I=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(I)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),b=d(I),y=b.j(g);x(y)||0<y.l(E);)I-=w,b=d(I),y=b.j(g);k(b)&&(b=v),T=T.add(b),E=$(E,y)}return new j(T,E)}n.A=function(E){return J(this,E).h},n.and=function(E){for(var g=Math.max(this.g.length,E.g.length),I=[],w=0;w<g;w++)I[w]=this.i(w)&E.i(w);return new a(I,this.h&E.h)},n.or=function(E){for(var g=Math.max(this.g.length,E.g.length),I=[],w=0;w<g;w++)I[w]=this.i(w)|E.i(w);return new a(I,this.h|E.h)},n.xor=function(E){for(var g=Math.max(this.g.length,E.g.length),I=[],w=0;w<g;w++)I[w]=this.i(w)^E.i(w);return new a(I,this.h^E.h)};function Re(E){for(var g=E.g.length+1,I=[],w=0;w<g;w++)I[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(I,E.h)}function Y(E,g){var I=g>>5;g%=32;for(var w=E.g.length-I,T=[],b=0;b<w;b++)T[b]=0<g?E.i(b+I)>>>g|E.i(b+I+1)<<32-g:E.i(b+I);return new a(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ea=Sd.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,ft=Sd.Integer=a}).apply(typeof bd<"u"?bd:typeof self<"u"?self:typeof window<"u"?window:{});var rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pt={};var Ta,my,qn,Aa,qr,is,ba,Sa,Ra;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof rs=="object"&&rs];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(o,c){if(c)e:{var h=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in h))break e;h=h[A]}o=o[o.length-1],f=h[o],c=c(f),c!=f&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,f=!1,A={next:function(){if(!f&&h<o.length){var S=h++;return{value:c(S,o[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function p(o,c,h){return o.call.apply(o.bind,arguments)}function _(o,c,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),o.apply(c,A)}}return function(){return o.apply(c,arguments)}}function v(o,c,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:_,v.apply(null,arguments)}function R(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function k(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,A,S){for(var N=Array(arguments.length-2),X=2;X<arguments.length;X++)N[X-2]=arguments[X];return c.prototype[A].apply(f,N)}}function x(o){let c=o.length;if(0<c){let h=Array(c);for(let f=0;f<c;f++)h[f]=o[f];return h}return[]}function D(o,c){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let A=o.length||0,S=f.length||0;o.length=A+S;for(let N=0;N<S;N++)o[A+N]=f[N]}else o.push(f)}}class ${constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function U(o){return/^[\s\xa0]*$/.test(o)}function j(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function J(o){return J[" "](o),o}J[" "]=function(){};var Re=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Y(o,c,h){for(let f in o)c.call(h,o[f],f,o)}function E(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function g(o){let c={};for(let h in o)c[h]=o[h];return c}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,c){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)o[h]=f[h];for(let S=0;S<I.length;S++)h=I[S],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function b(o){u.setTimeout(()=>{throw o},0)}function y(){var o=So;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class ut{constructor(){this.h=this.g=null}add(c,h){let f=_r.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var _r=new $(()=>new Eg,o=>o.reset());class Eg{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let yr,vr=!1,So=new ut,jl=()=>{let o=u.Promise.resolve(void 0);yr=()=>{o.then(Tg)}};var Tg=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){b(h)}var c=_r;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}vr=!1};function Ct(){this.s=this.s,this.C=this.C}Ct.prototype.s=!1,Ct.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ct.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ve(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}ve.prototype.h=function(){this.defaultPrevented=!0};var Ag=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o})();function Ir(o,c){if(ve.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Re){e:{try{J(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:bg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Ir.aa.h.call(this)}}k(Ir,ve);var bg={2:"touch",3:"pen",4:"mouse"};Ir.prototype.h=function(){Ir.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var wr="closure_listenable_"+(1e6*Math.random()|0),Sg=0;function Rg(o,c,h,f,A){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=A,this.key=++Sg,this.da=this.fa=!1}function Pi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ci(o){this.src=o,this.g={},this.h=0}Ci.prototype.add=function(o,c,h,f,A){var S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);var N=Po(o,c,f,A);return-1<N?(c=o[N],h||(c.fa=!1)):(c=new Rg(c,this.src,S,!!f,A),c.fa=h,o.push(c)),c};function Ro(o,c){var h=c.type;if(h in o.g){var f=o.g[h],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(Pi(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Po(o,c,h,f){for(var A=0;A<o.length;++A){var S=o[A];if(!S.da&&S.listener==c&&S.capture==!!h&&S.ha==f)return A}return-1}var Co="closure_lm_"+(1e6*Math.random()|0),ko={};function zl(o,c,h,f,A){if(f&&f.once)return Gl(o,c,h,f,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)zl(o,c[S],h,f,A);return null}return h=xo(h),o&&o[wr]?o.K(c,h,d(f)?!!f.capture:!!f,A):Wl(o,c,h,!1,f,A)}function Wl(o,c,h,f,A,S){if(!c)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,X=No(o);if(X||(o[Co]=X=new Ci(o)),h=X.add(c,h,f,N,S),h.proxy)return h;if(f=Pg(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Ag||(A=N),A===void 0&&(A=!1),o.addEventListener(c.toString(),f,A);else if(o.attachEvent)o.attachEvent(Hl(c.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Pg(){function o(h){return c.call(o.src,o.listener,h)}let c=Cg;return o}function Gl(o,c,h,f,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)Gl(o,c[S],h,f,A);return null}return h=xo(h),o&&o[wr]?o.L(c,h,d(f)?!!f.capture:!!f,A):Wl(o,c,h,!0,f,A)}function Kl(o,c,h,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Kl(o,c[S],h,f,A);else f=d(f)?!!f.capture:!!f,h=xo(h),o&&o[wr]?(o=o.i,c=String(c).toString(),c in o.g&&(S=o.g[c],h=Po(S,h,f,A),-1<h&&(Pi(S[h]),Array.prototype.splice.call(S,h,1),S.length==0&&(delete o.g[c],o.h--)))):o&&(o=No(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Po(c,h,f,A)),(h=-1<o?c[o]:null)&&Do(h))}function Do(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[wr])Ro(c.i,o);else{var h=o.type,f=o.proxy;c.removeEventListener?c.removeEventListener(h,f,o.capture):c.detachEvent?c.detachEvent(Hl(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=No(c))?(Ro(h,o),h.h==0&&(h.src=null,c[Co]=null)):Pi(o)}}}function Hl(o){return o in ko?ko[o]:ko[o]="on"+o}function Cg(o,c){if(o.da)o=!0;else{c=new Ir(c,this);var h=o.listener,f=o.ha||o.src;o.fa&&Do(o),o=h.call(f,c)}return o}function No(o){return o=o[Co],o instanceof Ci?o:null}var Oo="__closure_events_fn_"+(1e9*Math.random()>>>0);function xo(o){return typeof o=="function"?o:(o[Oo]||(o[Oo]=function(c){return o.handleEvent(c)}),o[Oo])}function Ie(){Ct.call(this),this.i=new Ci(this),this.M=this,this.F=null}k(Ie,Ct),Ie.prototype[wr]=!0,Ie.prototype.removeEventListener=function(o,c,h,f){Kl(this,o,c,h,f)};function Pe(o,c){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=c.type||c,typeof c=="string")c=new ve(c,o);else if(c instanceof ve)c.target=c.target||o;else{var A=c;c=new ve(f,o),w(c,A)}if(A=!0,h)for(var S=h.length-1;0<=S;S--){var N=c.g=h[S];A=ki(N,f,!0,c)&&A}if(N=c.g=o,A=ki(N,f,!0,c)&&A,A=ki(N,f,!1,c)&&A,h)for(S=0;S<h.length;S++)N=c.g=h[S],A=ki(N,f,!1,c)&&A}Ie.prototype.N=function(){if(Ie.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],f=0;f<h.length;f++)Pi(h[f]);delete o.g[c],o.h--}}this.F=null},Ie.prototype.K=function(o,c,h,f){return this.i.add(String(o),c,!1,h,f)},Ie.prototype.L=function(o,c,h,f){return this.i.add(String(o),c,!0,h,f)};function ki(o,c,h,f){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var N=c[S];if(N&&!N.da&&N.capture==h){var X=N.listener,ye=N.ha||N.src;N.fa&&Ro(o.i,N),A=X.call(ye,f)!==!1&&A}}return A&&!f.defaultPrevented}function Ql(o,c,h){if(typeof o=="function")h&&(o=v(o,h));else if(o&&typeof o.handleEvent=="function")o=v(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Yl(o){o.g=Ql(()=>{o.g=null,o.i&&(o.i=!1,Yl(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class kg extends Ct{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Yl(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Er(o){Ct.call(this),this.h=o,this.g={}}k(Er,Ct);var Jl=[];function Xl(o){Y(o.g,function(c,h){this.g.hasOwnProperty(h)&&Do(c)},o),o.g={}}Er.prototype.N=function(){Er.aa.N.call(this),Xl(this)},Er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Vo=u.JSON.stringify,Dg=u.JSON.parse,Ng=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Lo(){}Lo.prototype.h=null;function Zl(o){return o.h||(o.h=o.i())}function eh(){}var Tr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Mo(){ve.call(this,"d")}k(Mo,ve);function Fo(){ve.call(this,"c")}k(Fo,ve);var tn={},th=null;function Di(){return th=th||new Ie}tn.La="serverreachability";function nh(o){ve.call(this,tn.La,o)}k(nh,ve);function Ar(o){let c=Di();Pe(c,new nh(c))}tn.STAT_EVENT="statevent";function rh(o,c){ve.call(this,tn.STAT_EVENT,o),this.stat=c}k(rh,ve);function Ce(o){let c=Di();Pe(c,new rh(c,o))}tn.Ma="timingevent";function ih(o,c){ve.call(this,tn.Ma,o),this.size=c}k(ih,ve);function br(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function Sr(){this.g=!0}Sr.prototype.xa=function(){this.g=!1};function Og(o,c,h,f,A,S){o.info(function(){if(o.g)if(S)for(var N="",X=S.split("&"),ye=0;ye<X.length;ye++){var H=X[ye].split("=");if(1<H.length){var we=H[0];H=H[1];var Ee=we.split("_");N=2<=Ee.length&&Ee[1]=="type"?N+(we+"="+H+"&"):N+(we+"=redacted&")}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+h+`
`+N})}function xg(o,c,h,f,A,S,N){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+h+`
`+S+" "+N})}function Dn(o,c,h,f){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Lg(o,h)+(f?" "+f:"")})}function Vg(o,c){o.info(function(){return"TIMEOUT: "+c})}Sr.prototype.info=function(){};function Lg(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return Vo(h)}catch{return c}}var Ni={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Uo;function Oi(){}k(Oi,Lo),Oi.prototype.g=function(){return new XMLHttpRequest},Oi.prototype.i=function(){return{}},Uo=new Oi;function kt(o,c,h,f){this.j=o,this.i=c,this.l=h,this.R=f||1,this.U=new Er(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new oh}function oh(){this.i=null,this.g="",this.h=!1}var ah={},Bo={};function qo(o,c,h){o.L=1,o.v=Mi(lt(c)),o.m=h,o.P=!0,ch(o,null)}function ch(o,c){o.F=Date.now(),xi(o),o.A=lt(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),Eh(h.i,"t",f),o.C=0,h=o.j.J,o.h=new oh,o.g=Bh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new kg(v(o.Y,o,o.g),o.O)),c=o.U,h=o.g,f=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(Jl[0]=A.toString()),A=Jl);for(var S=0;S<A.length;S++){var N=zl(h,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Ar(),Og(o.i,o.u,o.A,o.l,o.R,o.m)}kt.prototype.ca=function(o){o=o.target;let c=this.M;c&&ht(o)==3?c.j():this.Y(o)},kt.prototype.Y=function(o){try{if(o==this.g)e:{let Ee=ht(this.g);var c=this.g.Ba();let xn=this.g.Z();if(!(3>Ee)&&(Ee!=3||this.g&&(this.h.h||this.g.oa()||Ch(this.g)))){this.J||Ee!=4||c==7||(c==8||0>=xn?Ar(3):Ar(2)),$o(this);var h=this.g.Z();this.X=h;t:if(uh(this)){var f=Ch(this.g);o="";var A=f.length,S=ht(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nn(this),Rr(this);var N="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,o+=this.h.i.decode(f[c],{stream:!(S&&c==A-1)});f.length=0,this.h.g+=o,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=h==200,xg(this.i,this.u,this.A,this.l,this.R,Ee,h),this.o){if(this.T&&!this.K){t:{if(this.g){var X,ye=this.g;if((X=ye.g?ye.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(X)){var H=X;break t}}H=null}if(h=H)Dn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,jo(this,h);else{this.o=!1,this.s=3,Ce(12),nn(this),Rr(this);break e}}if(this.P){h=!0;let je;for(;!this.J&&this.C<N.length;)if(je=Mg(this,N),je==Bo){Ee==4&&(this.s=4,Ce(14),h=!1),Dn(this.i,this.l,null,"[Incomplete Response]");break}else if(je==ah){this.s=4,Ce(15),Dn(this.i,this.l,N,"[Invalid Chunk]"),h=!1;break}else Dn(this.i,this.l,je,null),jo(this,je);if(uh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ee!=4||N.length!=0||this.h.h||(this.s=1,Ce(16),h=!1),this.o=this.o&&h,!h)Dn(this.i,this.l,N,"[Invalid Chunked Response]"),nn(this),Rr(this);else if(0<N.length&&!this.W){this.W=!0;var we=this.j;we.g==this&&we.ba&&!we.M&&(we.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),Qo(we),we.M=!0,Ce(11))}}else Dn(this.i,this.l,N,null),jo(this,N);Ee==4&&nn(this),this.o&&!this.J&&(Ee==4?Lh(this.j,this):(this.o=!1,xi(this)))}else e_(this.g),h==400&&0<N.indexOf("Unknown SID")?(this.s=3,Ce(12)):(this.s=0,Ce(13)),nn(this),Rr(this)}}}catch{}finally{}};function uh(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Mg(o,c){var h=o.C,f=c.indexOf(`
`,h);return f==-1?Bo:(h=Number(c.substring(h,f)),isNaN(h)?ah:(f+=1,f+h>c.length?Bo:(c=c.slice(f,f+h),o.C=f+h,c)))}kt.prototype.cancel=function(){this.J=!0,nn(this)};function xi(o){o.S=Date.now()+o.I,lh(o,o.I)}function lh(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=br(v(o.ba,o),c)}function $o(o){o.B&&(u.clearTimeout(o.B),o.B=null)}kt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Vg(this.i,this.A),this.L!=2&&(Ar(),Ce(17)),nn(this),this.s=2,Rr(this)):lh(this,this.S-o)};function Rr(o){o.j.G==0||o.J||Lh(o.j,o)}function nn(o){$o(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Xl(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function jo(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||zo(h.h,o))){if(!o.K&&zo(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)$i(h),Bi(h);else break e;Ho(h),Ce(18)}}else h.za=A[1],0<h.za-h.T&&37500>A[2]&&h.F&&h.v==0&&!h.C&&(h.C=br(v(h.Za,h),6e3));if(1>=fh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else sn(h,11)}else if((o.K||h.g==o)&&$i(h),!U(c))for(A=h.Da.g.parse(c),c=0;c<A.length;c++){let H=A[c];if(h.T=H[0],H=H[1],h.G==2)if(H[0]=="c"){h.K=H[1],h.ia=H[2];let we=H[3];we!=null&&(h.la=we,h.j.info("VER="+h.la));let Ee=H[4];Ee!=null&&(h.Aa=Ee,h.j.info("SVER="+h.Aa));let xn=H[5];xn!=null&&typeof xn=="number"&&0<xn&&(f=1.5*xn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let je=o.g;if(je){let zi=je.g?je.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zi){var S=f.h;S.g||zi.indexOf("spdy")==-1&&zi.indexOf("quic")==-1&&zi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Wo(S,S.h),S.h=null))}if(f.D){let Yo=je.g?je.g.getResponseHeader("X-HTTP-Session-Id"):null;Yo&&(f.ya=Yo,ee(f.I,f.D,Yo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var N=o;if(f.qa=Uh(f,f.J?f.ia:null,f.W),N.K){ph(f.h,N);var X=N,ye=f.L;ye&&(X.I=ye),X.B&&($o(X),xi(X)),f.g=N}else xh(f);0<h.i.length&&qi(h)}else H[0]!="stop"&&H[0]!="close"||sn(h,7);else h.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?sn(h,7):Ko(h):H[0]!="noop"&&h.l&&h.l.ta(H),h.v=0)}}Ar(4)}catch{}}var Fg=class{constructor(o,c){this.g=o,this.map=c}};function hh(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function fh(o){return o.h?1:o.g?o.g.size:0}function zo(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Wo(o,c){o.g?o.g.add(c):o.h=c}function ph(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}hh.prototype.cancel=function(){if(this.i=mh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function mh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return x(o.i)}function Ug(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,f=0;f<h;f++)c.push(o[f]);return c}c=[],h=0;for(f in o)c[h++]=o[f];return c}function Bg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let f in o)c[h++]=f;return c}}}function gh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Bg(o),f=Ug(o),A=f.length,S=0;S<A;S++)c.call(void 0,f[S],h&&h[S],o)}var _h=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qg(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),A=null;if(0<=f){var S=o[h].substring(0,f);A=o[h].substring(f+1)}else S=o[h];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function rn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof rn){this.h=o.h,Vi(this,o.j),this.o=o.o,this.g=o.g,Li(this,o.s),this.l=o.l;var c=o.i,h=new kr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),yh(this,h),this.m=o.m}else o&&(c=String(o).match(_h))?(this.h=!1,Vi(this,c[1]||"",!0),this.o=Pr(c[2]||""),this.g=Pr(c[3]||"",!0),Li(this,c[4]),this.l=Pr(c[5]||"",!0),yh(this,c[6]||"",!0),this.m=Pr(c[7]||"")):(this.h=!1,this.i=new kr(null,this.h))}rn.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Cr(c,vh,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Cr(c,vh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Cr(h,h.charAt(0)=="/"?zg:jg,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Cr(h,Gg)),o.join("")};function lt(o){return new rn(o)}function Vi(o,c,h){o.j=h?Pr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Li(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function yh(o,c,h){c instanceof kr?(o.i=c,Kg(o.i,o.h)):(h||(c=Cr(c,Wg)),o.i=new kr(c,o.h))}function ee(o,c,h){o.i.set(c,h)}function Mi(o){return ee(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Pr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Cr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,$g),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function $g(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var vh=/[#\/\?@]/g,jg=/[#\?:]/g,zg=/[#\?]/g,Wg=/[#\?@]/g,Gg=/#/g;function kr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Dt(o){o.g||(o.g=new Map,o.h=0,o.i&&qg(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=kr.prototype,n.add=function(o,c){Dt(this),this.i=null,o=Nn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Ih(o,c){Dt(o),c=Nn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function wh(o,c){return Dt(o),c=Nn(o,c),o.g.has(c)}n.forEach=function(o,c){Dt(this),this.g.forEach(function(h,f){h.forEach(function(A){o.call(c,A,f,this)},this)},this)},n.na=function(){Dt(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let f=0;f<c.length;f++){let A=o[f];for(let S=0;S<A.length;S++)h.push(c[f])}return h},n.V=function(o){Dt(this);let c=[];if(typeof o=="string")wh(this,o)&&(c=c.concat(this.g.get(Nn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},n.set=function(o,c){return Dt(this),this.i=null,o=Nn(this,o),wh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Eh(o,c,h){Ih(o,c),0<h.length&&(o.i=null,o.g.set(Nn(o,c),x(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var f=c[h];let S=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=S;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),o.push(A)}}return this.i=o.join("&")};function Nn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Kg(o,c){c&&!o.j&&(Dt(o),o.i=null,o.g.forEach(function(h,f){var A=f.toLowerCase();f!=A&&(Ih(this,f),Eh(this,A,h))},o)),o.j=c}function Hg(o,c){let h=new Sr;if(u.Image){let f=new Image;f.onload=R(Nt,h,"TestLoadImage: loaded",!0,c,f),f.onerror=R(Nt,h,"TestLoadImage: error",!1,c,f),f.onabort=R(Nt,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=R(Nt,h,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else c(!1)}function Qg(o,c){let h=new Sr,f=new AbortController,A=setTimeout(()=>{f.abort(),Nt(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?Nt(h,"TestPingServer: ok",!0,c):Nt(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),Nt(h,"TestPingServer: error",!1,c)})}function Nt(o,c,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function Yg(){this.g=new Ng}function Jg(o,c,h){let f=h||"";try{gh(o,function(A,S){let N=A;d(A)&&(N=Vo(A)),c.push(f+S+"="+encodeURIComponent(N))})}catch(A){throw c.push(f+"type="+encodeURIComponent("_badmap")),A}}function Dr(o){this.l=o.Ub||null,this.j=o.eb||!1}k(Dr,Lo),Dr.prototype.g=function(){return new Fi(this.l,this.j)},Dr.prototype.i=(function(o){return function(){return o}})({});function Fi(o,c){Ie.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Fi,Ie),n=Fi.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Or(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Nr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Or(this)),this.g&&(this.readyState=3,Or(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Th(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Th(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Nr(this):Or(this),this.readyState==3&&Th(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Nr(this))},n.Qa=function(o){this.g&&(this.response=o,Nr(this))},n.ga=function(){this.g&&Nr(this)};function Nr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Or(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Or(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Fi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Ah(o){let c="";return Y(o,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function Go(o,c,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=Ah(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):ee(o,c,h))}function ie(o){Ie.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ie,Ie);var Xg=/^https?$/i,Zg=["POST","PUT"];n=ie.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Uo.g(),this.v=this.o?Zl(this.o):Zl(Uo),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(S){bh(this,S);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),A=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Zg,c,void 0))||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,N]of h)this.g.setRequestHeader(S,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ph(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){bh(this,S)}};function bh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Sh(o),Ui(o)}function Sh(o){o.A||(o.A=!0,Pe(o,"complete"),Pe(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Pe(this,"complete"),Pe(this,"abort"),Ui(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ui(this,!0)),ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Rh(this):this.bb())},n.bb=function(){Rh(this)};function Rh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ht(o)!=4||o.Z()!=2)){if(o.u&&ht(o)==4)Ql(o.Ea,0,o);else if(Pe(o,"readystatechange"),ht(o)==4){o.h=!1;try{let N=o.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var f;if(f=N===0){var A=String(o.D).match(_h)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),f=!Xg.test(A?A.toLowerCase():"")}h=f}if(h)Pe(o,"complete"),Pe(o,"success");else{o.m=6;try{var S=2<ht(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",Sh(o)}}finally{Ui(o)}}}}function Ui(o,c){if(o.g){Ph(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Pe(o,"ready");try{h.onreadystatechange=f}catch{}}}function Ph(o){o.I&&(u.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function ht(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<ht(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Dg(c)}};function Ch(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function e_(o){let c={};o=(o.g&&2<=ht(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(U(o[f]))continue;var h=T(o[f]);let A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let S=c[A]||[];c[A]=S,S.push(h)}E(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function xr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function kh(o){this.Aa=0,this.i=[],this.j=new Sr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=xr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=xr("baseRetryDelayMs",5e3,o),this.cb=xr("retryDelaySeedMs",1e4,o),this.Wa=xr("forwardChannelMaxRetries",2,o),this.wa=xr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new hh(o&&o.concurrentRequestLimit),this.Da=new Yg,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=kh.prototype,n.la=8,n.G=1,n.connect=function(o,c,h,f){Ce(0),this.W=o,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=Uh(this,null,this.W),qi(this)};function Ko(o){if(Dh(o),o.G==3){var c=o.U++,h=lt(o.I);if(ee(h,"SID",o.K),ee(h,"RID",c),ee(h,"TYPE","terminate"),Vr(o,h),c=new kt(o,o.j,c),c.L=2,c.v=Mi(lt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Bh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),xi(c)}Fh(o)}function Bi(o){o.g&&(Qo(o),o.g.cancel(),o.g=null)}function Dh(o){Bi(o),o.u&&(u.clearTimeout(o.u),o.u=null),$i(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function qi(o){if(!dh(o.h)&&!o.s){o.s=!0;var c=o.Ga;yr||jl(),vr||(yr(),vr=!0),So.add(c,o),o.B=0}}function t_(o,c){return fh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=br(v(o.Ga,o,c),Mh(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let A=new kt(this,this.j,o),S=this.o;if(this.S&&(S?(S=g(S),w(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=Oh(this,A,c),h=lt(this.I),ee(h,"RID",o),ee(h,"CVER",22),this.D&&ee(h,"X-HTTP-Session-Id",this.D),Vr(this,h),S&&(this.O?c="headers="+encodeURIComponent(String(Ah(S)))+"&"+c:this.m&&Go(h,this.m,S)),Wo(this.h,A),this.Ua&&ee(h,"TYPE","init"),this.P?(ee(h,"$req",c),ee(h,"SID","null"),A.T=!0,qo(A,h,null)):qo(A,h,c),this.G=2}}else this.G==3&&(o?Nh(this,o):this.i.length==0||dh(this.h)||Nh(this))};function Nh(o,c){var h;c?h=c.l:h=o.U++;let f=lt(o.I);ee(f,"SID",o.K),ee(f,"RID",h),ee(f,"AID",o.T),Vr(o,f),o.m&&o.o&&Go(f,o.m,o.o),h=new kt(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Oh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Wo(o.h,h),qo(h,f,c)}function Vr(o,c){o.H&&Y(o.H,function(h,f){ee(c,f,h)}),o.l&&gh({},function(h,f){ee(c,f,h)})}function Oh(o,c,h){h=Math.min(o.i.length,h);var f=o.l?v(o.l.Na,o.l,o):null;e:{var A=o.i;let S=-1;for(;;){let N=["count="+h];S==-1?0<h?(S=A[0].g,N.push("ofs="+S)):S=0:N.push("ofs="+S);let X=!0;for(let ye=0;ye<h;ye++){let H=A[ye].g,we=A[ye].map;if(H-=S,0>H)S=Math.max(0,A[ye].g-100),X=!1;else try{Jg(we,N,"req"+H+"_")}catch{f&&f(we)}}if(X){f=N.join("&");break e}}}return o=o.i.splice(0,h),c.D=o,f}function xh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;yr||jl(),vr||(yr(),vr=!0),So.add(c,o),o.v=0}}function Ho(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=br(v(o.Fa,o),Mh(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Vh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=br(v(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ce(10),Bi(this),Vh(this))};function Qo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Vh(o){o.g=new kt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=lt(o.qa);ee(c,"RID","rpc"),ee(c,"SID",o.K),ee(c,"AID",o.T),ee(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&ee(c,"TO",o.ja),ee(c,"TYPE","xmlhttp"),Vr(o,c),o.m&&o.o&&Go(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Mi(lt(c)),h.m=null,h.P=!0,ch(h,o)}n.Za=function(){this.C!=null&&(this.C=null,Bi(this),Ho(this),Ce(19))};function $i(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Lh(o,c){var h=null;if(o.g==c){$i(o),Qo(o),o.g=null;var f=2}else if(zo(o.h,c))h=c.D,ph(o.h,c),f=1;else return;if(o.G!=0){if(c.o)if(f==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var A=o.B;f=Di(),Pe(f,new ih(f,h)),qi(o)}else xh(o);else if(A=c.s,A==3||A==0&&0<c.X||!(f==1&&t_(o,c)||f==2&&Ho(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),A){case 1:sn(o,5);break;case 4:sn(o,10);break;case 3:sn(o,6);break;default:sn(o,2)}}}function Mh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function sn(o,c){if(o.j.info("Error code "+c),c==2){var h=v(o.fb,o),f=o.Xa;let A=!f;f=new rn(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Vi(f,"https"),Mi(f),A?Hg(f.toString(),h):Qg(f.toString(),h)}else Ce(2);o.G=0,o.l&&o.l.sa(c),Fh(o),Dh(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function Fh(o){if(o.G=0,o.ka=[],o.l){let c=mh(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,x(o.i),o.i.length=0),o.l.ra()}}function Uh(o,c,h){var f=h instanceof rn?lt(h):new rn(h);if(f.g!="")c&&(f.g=c+"."+f.g),Li(f,f.s);else{var A=u.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new rn(null);f&&Vi(S,f),c&&(S.g=c),A&&Li(S,A),h&&(S.l=h),f=S}return h=o.D,c=o.ya,h&&c&&ee(f,h,c),ee(f,"VER",o.la),Vr(o,f),f}function Bh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ie(new Dr({eb:h})):new ie(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function qh(){}n=qh.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ji(){}ji.prototype.g=function(o,c){return new Oe(o,c)};function Oe(o,c){Ie.call(this),this.g=new kh(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!U(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!U(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new On(this)}k(Oe,Ie),Oe.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Oe.prototype.close=function(){Ko(this.g)},Oe.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Vo(o),o=h);c.i.push(new Fg(c.Ya++,o)),c.G==3&&qi(c)},Oe.prototype.N=function(){this.g.l=null,delete this.j,Ko(this.g),delete this.g,Oe.aa.N.call(this)};function $h(o){Mo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(let h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}k($h,Mo);function jh(){Fo.call(this),this.status=1}k(jh,Fo);function On(o){this.g=o}k(On,qh),On.prototype.ua=function(){Pe(this.g,"a")},On.prototype.ta=function(o){Pe(this.g,new $h(o))},On.prototype.sa=function(o){Pe(this.g,new jh)},On.prototype.ra=function(){Pe(this.g,"b")},ji.prototype.createWebChannel=ji.prototype.g,Oe.prototype.send=Oe.prototype.o,Oe.prototype.open=Oe.prototype.m,Oe.prototype.close=Oe.prototype.close,Ra=pt.createWebChannelTransport=function(){return new ji},Sa=pt.getStatEventTarget=function(){return Di()},ba=pt.Event=tn,is=pt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ni.NO_ERROR=0,Ni.TIMEOUT=8,Ni.HTTP_ERROR=6,qr=pt.ErrorCode=Ni,sh.COMPLETE="complete",Aa=pt.EventType=sh,eh.EventType=Tr,Tr.OPEN="a",Tr.CLOSE="b",Tr.ERROR="c",Tr.MESSAGE="d",Ie.prototype.listen=Ie.prototype.K,qn=pt.WebChannel=eh,my=pt.FetchXmlHttpFactory=Dr,ie.prototype.listenOnce=ie.prototype.L,ie.prototype.getLastError=ie.prototype.Ka,ie.prototype.getLastErrorCode=ie.prototype.Ba,ie.prototype.getStatus=ie.prototype.Z,ie.prototype.getResponseJson=ie.prototype.Oa,ie.prototype.getResponseText=ie.prototype.oa,ie.prototype.send=ie.prototype.ea,ie.prototype.setWithCredentials=ie.prototype.Ha,Ta=pt.XhrIo=ie}).apply(typeof rs<"u"?rs:typeof self<"u"?self:typeof window<"u"?window:{});var Rd="@firebase/firestore",Pd="4.8.0";var me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};me.UNAUTHENTICATED=new me(null),me.GOOGLE_CREDENTIALS=new me("google-credentials-uid"),me.FIRST_PARTY=new me("first-party-uid"),me.MOCK_USER=new me("mock-user");var or="11.10.0";var mn=new tt("@firebase/firestore");function $n(){return mn.logLevel}function V(n,...e){if(mn.logLevel<=W.DEBUG){let t=e.map(vu);mn.debug(`Firestore (${or}): ${n}`,...t)}}function mt(n,...e){if(mn.logLevel<=W.ERROR){let t=e.map(vu);mn.error(`Firestore (${or}): ${n}`,...t)}}function $t(n,...e){if(mn.logLevel<=W.WARN){let t=e.map(vu);mn.warn(`Firestore (${or}): ${n}`,...t)}}function vu(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,wf(n,r,t)}function wf(n,e,t){let r=`FIRESTORE (${or}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw mt(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||wf(e,i,r)}function B(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends xe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ke=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var hs=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Oa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(me.UNAUTHENTICATED))}shutdown(){}},xa=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Va=class{constructor(e){this.t=e,this.currentUser=me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new Ke;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ke,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>m(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ke)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new hs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new me(e)}},La=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=me.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ma=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new La(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ds=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Fa=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,De(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ds(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ds(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function gy(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Ef(){return new TextEncoder}var Kr=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=gy(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function Ua(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return z(r,i);{let s=Ef(),a=_y(s.encode(Cd(n,t)),s.encode(Cd(e,t)));return a!==0?a:z(r,i)}}t+=r>65535?2:1}return z(n.length,e.length)}function Cd(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function _y(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function Qn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var kd="__name__",fs=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Ua(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ft.fromString(e.substring(4,e.length-2))}},te=class n extends fs{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},yy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends fs{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return yy.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===kd}static keyField(){return new n([kd])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(s(),i++)}if(s(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new te(e.slice()))}};function Iu(n,e,t){if(!t)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function vy(n,e,t,r){if(e===!0&&r===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Dd(n){if(!L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Nd(n){if(L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Tf(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ws(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function be(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ws(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function he(n,e){let t={typeString:n};return e&&(t.value=e),t}function oi(n,e){if(!Tf(n))throw new O(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new O(P.INVALID_ARGUMENT,t);return!0}var Od=-62135596800,xd=1e6,de=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*xd);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Od)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xd}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(oi(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Od;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};de._jsonSchemaVersion="firestore/timestamp/1.0",de._jsonSchema={type:he("string",de._jsonSchemaVersion),seconds:he("number"),nanoseconds:he("number")};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new de(0,0))}static max(){return new n(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Hr=-1,Ba=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Ba.UNKNOWN_ID=-1;function Iy(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new de(t+1,0):new de(t,r));return new gn(i,L.empty(),e)}function wy(n){return new gn(n.readTime,n.key,Hr)}var gn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),L.empty(),Hr)}static max(){return new n(q.max(),L.empty(),Hr)}};function Ey(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var Ty="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",qa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ar(n){return m(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==Ty)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(p=>{a[d]=p,++u,u===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function Ay(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function cr(n){return n.name==="IndexedDbTransactionError"}var wu=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),Eu=-1;function Gs(n){return n==null}function Qr(n){return n===0&&1/n==-1/0}function by(n){return typeof n=="number"&&Number.isInteger(n)&&!Qr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Af="";function Sy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Vd(e)),e=Ry(n.get(t),e);return Vd(e)}function Ry(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Af:t+="";break;default:t+=s}}return t}function Vd(n){return n+Af+""}var Py="remoteDocuments",bf="owner";var Sf="mutationQueues";var Rf="mutations";var Pf="documentMutations",Cy="remoteDocumentsV14";var Cf="remoteDocumentGlobal";var kf="targets";var Df="targetDocuments";var Nf="targetGlobal",Of="collectionParents";var xf="clientMetadata";var Vf="bundles";var Lf="namedQueries";var ky="indexConfiguration";var Dy="indexState";var Ny="indexEntries";var Mf="documentOverlays";var Oy="globals";var xy=[Sf,Rf,Pf,Py,kf,bf,Nf,Df,xf,Cf,Of,Vf,Lf],yA=[...xy,Mf],Vy=[Sf,Rf,Pf,Cy,kf,bf,Nf,Df,xf,Cf,Of,Vf,Lf,Mf],Ly=Vy,My=[...Ly,ky,Dy,Ny];var vA=[...My,Oy];function Ld(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Gt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ff(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var oe=class n{constructor(e,t){this.comparator=e,this.root=t||rt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gn(this.root,e,this.comparator,!0)}},Gn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},rt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};rt.EMPTY=null,rt.RED=!0,rt.BLACK=!1;rt.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new rt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ge=class n{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ps(this.data.getIterator())}getIteratorFrom(e){return new ps(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ps=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Be=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new ge(Le.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ms=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Se=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ms("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Se.EMPTY_BYTE_STRING=new Se("");var Fy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gt(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=Fy.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:re(n.seconds),nanos:re(n.nanos)}}function re(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _t(n){return typeof n=="string"?Se.fromBase64String(n):Se.fromUint8Array(n)}var Uf="server_timestamp",Bf="__type__",qf="__previous_value__",$f="__local_write_time__";function Tu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Bf])===null||t===void 0?void 0:t.stringValue)===Uf}function Ks(n){let e=n.mapValue.fields[qf];return Tu(e)?Ks(e):e}function Yr(n){let e=gt(n.mapValue.fields[$f].timestampValue);return new de(e.seconds,e.nanos)}var $a=class{constructor(e,t,r,i,s,a,u,l,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=p}},gs="(default)",_s=class n{constructor(e,t){this.projectId=e,this.database=t||gs}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===gs}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Au="__type__",jf="__max__",ss={mapValue:{fields:{__type__:{stringValue:jf}}}},bu="__vector__",Yn="value";function jt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Tu(n)?4:Wf(n)?9007199254740991:zf(n)?10:11:M(28295,{value:n})}function ot(n,e){if(n===e)return!0;let t=jt(n);if(t!==jt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Yr(n).isEqual(Yr(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=gt(i.timestampValue),u=gt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return _t(i.bytesValue).isEqual(_t(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return re(i.geoPointValue.latitude)===re(s.geoPointValue.latitude)&&re(i.geoPointValue.longitude)===re(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return re(i.integerValue)===re(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=re(i.doubleValue),u=re(s.doubleValue);return a===u?Qr(a)===Qr(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return Qn(n.arrayValue.values||[],e.arrayValue.values||[],ot);case 10:case 11:return(function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Ld(a)!==Ld(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!ot(a[l],u[l])))return!1;return!0})(n,e);default:return M(52216,{left:n})}}function Jr(n,e){return(n.values||[]).find(t=>ot(t,e))!==void 0}function Jn(n,e){if(n===e)return 0;let t=jt(n),r=jt(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return(function(s,a){let u=re(s.integerValue||s.doubleValue),l=re(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1})(n,e);case 3:return Md(n.timestampValue,e.timestampValue);case 4:return Md(Yr(n),Yr(e));case 5:return Ua(n.stringValue,e.stringValue);case 6:return(function(s,a){let u=_t(s),l=_t(a);return u.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let p=z(u[d],l[d]);if(p!==0)return p}return z(u.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,a){let u=z(re(s.latitude),re(a.latitude));return u!==0?u:z(re(s.longitude),re(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Fd(n.arrayValue,e.arrayValue);case 10:return(function(s,a){var u,l,d,p;let _=s.fields||{},v=a.fields||{},R=(u=_[Yn])===null||u===void 0?void 0:u.arrayValue,k=(l=v[Yn])===null||l===void 0?void 0:l.arrayValue,x=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return x!==0?x:Fd(R,k)})(n.mapValue,e.mapValue);case 11:return(function(s,a){if(s===ss.mapValue&&a===ss.mapValue)return 0;if(s===ss.mapValue)return 1;if(a===ss.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let _=0;_<l.length&&_<p.length;++_){let v=Ua(l[_],p[_]);if(v!==0)return v;let R=Jn(u[l[_]],d[p[_]]);if(R!==0)return R}return z(l.length,p.length)})(n.mapValue,e.mapValue);default:throw M(23264,{le:t})}}function Md(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=gt(n),r=gt(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function Fd(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Jn(t[i],r[i]);if(s)return s}return z(t.length,r.length)}function Xn(n){return ja(n)}function ja(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=gt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _t(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=ja(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${ja(t.fields[a])}`;return i+"}"})(n.mapValue):M(61005,{value:n})}function cs(n){switch(jt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ks(n);return e?16+cs(e):16;case 5:return 2*n.stringValue.length;case 6:return _t(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+cs(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Gt(r.fields,(s,a)=>{i+=s.length+cs(a)}),i})(n.mapValue);default:throw M(13486,{value:n})}}function Ud(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function za(n){return!!n&&"integerValue"in n}function Su(n){return!!n&&"arrayValue"in n}function Bd(n){return!!n&&"nullValue"in n}function qd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function us(n){return!!n&&"mapValue"in n}function zf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Au])===null||t===void 0?void 0:t.stringValue)===bu}function jr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Gt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=jr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=jr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Wf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===jf}var wA={mapValue:{fields:{[Au]:{stringValue:bu},[Yn]:{arrayValue:{}}}}};var Ve=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!us(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=jr(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=jr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());us(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];us(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Gt(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(jr(this.value))}};function Gf(n){let e=[];return Gt(n.fields,(t,r)=>{let i=new Le([t]);if(us(r)){let s=Gf(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Be(e)}var He=class n{constructor(e,t,r,i,s,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Ve.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Zn=class{constructor(e,t){this.position=e,this.inclusive=t}};function $d(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Jn(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function jd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ot(n.position[t],e.position[t]))return!1;return!0}var _n=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Uy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ys=class{},le=class n extends ys{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ga(e,t,r):t==="array-contains"?new Qa(e,r):t==="in"?new Ya(e,r):t==="not-in"?new Ja(e,r):t==="array-contains-any"?new Xa(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ka(e,r):new Ha(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Jn(t,this.value)):t!==null&&jt(this.value)===jt(t)&&this.matchesComparison(Jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Qe=class n extends ys{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return Kf(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function Kf(n){return n.op==="and"}function Hf(n){return By(n)&&Kf(n)}function By(n){for(let e of n.filters)if(e instanceof Qe)return!1;return!0}function Wa(n){if(n instanceof le)return n.field.canonicalString()+n.op.toString()+Xn(n.value);if(Hf(n))return n.filters.map(e=>Wa(e)).join(",");{let e=n.filters.map(t=>Wa(t)).join(",");return`${n.op}(${e})`}}function Qf(n,e){return n instanceof le?(function(r,i){return i instanceof le&&r.op===i.op&&r.field.isEqual(i.field)&&ot(r.value,i.value)})(n,e):n instanceof Qe?(function(r,i){return i instanceof Qe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,u)=>s&&Qf(a,i.filters[u]),!0):!1})(n,e):void M(19439)}function Yf(n){return n instanceof le?(function(t){return`${t.field.canonicalString()} ${t.op} ${Xn(t.value)}`})(n):n instanceof Qe?(function(t){return t.op.toString()+" {"+t.getFilters().map(Yf).join(" ,")+"}"})(n):"Filter"}var Ga=class extends le{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Ka=class extends le{constructor(e,t){super(e,"in",t),this.keys=Jf("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ha=class extends le{constructor(e,t){super(e,"not-in",t),this.keys=Jf("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Jf(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var Qa=class extends le{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Su(t)&&Jr(t.arrayValue,this.value)}},Ya=class extends le{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Jr(this.value.arrayValue,t)}},Ja=class extends le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Jr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Jr(this.value.arrayValue,t)}},Xa=class extends le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Su(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Jr(this.value.arrayValue,r))}};var Za=class{constructor(e,t=null,r=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Pe=null}};function zd(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Za(n,e,t,r,i,s,a)}function Ru(n){let e=B(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Wa(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),Gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Xn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Xn(r)).join(",")),e.Pe=t}return e.Pe}function Pu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Uy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Qf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jd(n.startAt,e.startAt)&&jd(n.endAt,e.endAt)}function ec(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var yt=class{constructor(e,t=null,r=[],i=[],s=null,a="F",u=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function qy(n,e,t,r,i,s,a,u){return new yt(n,e,t,r,i,s,a,u)}function Hs(n){return new yt(n)}function Wd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Xf(n){return n.collectionGroup!==null}function zr(n){let e=B(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ge(Le.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new _n(s,r))}),t.has(Le.keyField().canonicalString())||e.Te.push(new _n(Le.keyField(),r))}return e.Te}function it(n){let e=B(n);return e.Ie||(e.Ie=$y(e,zr(n))),e.Ie}function $y(n,e){if(n.limitType==="F")return zd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new _n(i.field,s)});let t=n.endAt?new Zn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zn(n.startAt.position,n.startAt.inclusive):null;return zd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function tc(n,e){let t=n.filters.concat([e]);return new yt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function nc(n,e,t){return new yt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Qs(n,e){return Pu(it(n),it(e))&&n.limitType===e.limitType}function Zf(n){return`${Ru(it(n))}|lt:${n.limitType}`}function jn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Yf(i)).join(", ")}]`),Gs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Xn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Xn(i)).join(",")),`Target(${r})`})(it(n))}; limitType=${n.limitType})`}function Ys(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):L.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of zr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,u,l){let d=$d(a,u,l);return a.inclusive?d<=0:d<0})(r.startAt,zr(r),i)||r.endAt&&!(function(a,u,l){let d=$d(a,u,l);return a.inclusive?d>=0:d>0})(r.endAt,zr(r),i))})(n,e)}function jy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ep(n){return(e,t)=>{let r=!1;for(let i of zr(n)){let s=zy(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function zy(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Jn(l,d):M(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var vt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Gt(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Ff(this.inner)}size(){return this.innerSize}};var Wy=new oe(L.comparator);function It(){return Wy}var tp=new oe(L.comparator);function $r(...n){let e=tp;for(let t of n)e=e.insert(t.key,t);return e}function np(n){let e=tp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ln(){return Wr()}function rp(){return Wr()}function Wr(){return new vt(n=>n.toString(),(n,e)=>n.isEqual(e))}var Gy=new oe(L.comparator),Ky=new ge(L.comparator);function G(...n){let e=Ky;for(let t of n)e=e.add(t);return e}var Hy=new ge(z);function Qy(){return Hy}function Cu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qr(e)?"-0":e}}function ip(n){return{integerValue:""+n}}function Yy(n,e){return by(e)?ip(e):Cu(n,e)}var er=class{constructor(){this._=void 0}};function Jy(n,e,t){return n instanceof yn?(function(i,s){let a={fields:{[Bf]:{stringValue:Uf},[$f]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Tu(s)&&(s=Ks(s)),s&&(a.fields[qf]=s),{mapValue:a}})(t,e):n instanceof vn?op(n,e):n instanceof In?ap(n,e):(function(i,s){let a=sp(i,s),u=Gd(a)+Gd(i.Ee);return za(a)&&za(i.Ee)?ip(u):Cu(i.serializer,u)})(n,e)}function Xy(n,e,t){return n instanceof vn?op(n,e):n instanceof In?ap(n,e):t}function sp(n,e){return n instanceof tr?(function(r){return za(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var yn=class extends er{},vn=class extends er{constructor(e){super(),this.elements=e}};function op(n,e){let t=cp(e);for(let r of n.elements)t.some(i=>ot(i,r))||t.push(r);return{arrayValue:{values:t}}}var In=class extends er{constructor(e){super(),this.elements=e}};function ap(n,e){let t=cp(e);for(let r of n.elements)t=t.filter(i=>!ot(i,r));return{arrayValue:{values:t}}}var tr=class extends er{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function Gd(n){return re(n.integerValue||n.doubleValue)}function cp(n){return Su(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var rc=class{constructor(e,t){this.field=e,this.transform=t}};function Zy(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof vn&&i instanceof vn||r instanceof In&&i instanceof In?Qn(r.elements,i.elements,ot):r instanceof tr&&i instanceof tr?ot(r.Ee,i.Ee):r instanceof yn&&i instanceof yn})(n.transform,e.transform)}var ic=class{constructor(e,t){this.version=e,this.transformResults=t}},Me=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ls(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var nr=class{};function up(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new rr(n.key,Me.none()):new wn(n.key,n.data,Me.none());{let t=n.data,r=Ve.empty(),i=new ge(Le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new at(n.key,r,new Be(i.toArray()),Me.none())}}function ev(n,e,t){n instanceof wn?(function(i,s,a){let u=i.value.clone(),l=Hd(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof at?(function(i,s,a){if(!ls(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Hd(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(lp(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Gr(n,e,t,r){return n instanceof wn?(function(s,a,u,l){if(!ls(s.precondition,a))return u;let d=s.value.clone(),p=Qd(s.fieldTransforms,l,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof at?(function(s,a,u,l){if(!ls(s.precondition,a))return u;let d=Qd(s.fieldTransforms,l,a),p=a.data;return p.setAll(lp(s)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(_=>_.field))})(n,e,t,r):(function(s,a,u){return ls(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function tv(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=sp(r.transform,i||null);s!=null&&(t===null&&(t=Ve.empty()),t.set(r.field,s))}return t||null}function Kd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Qn(r,i,(s,a)=>Zy(s,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var wn=class extends nr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},at=class extends nr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function lp(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Hd(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,u=e.data.field(s.field);r.set(s.field,Xy(a,u,t[i]))}return r}function Qd(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,Jy(s,a,e))}return r}var rr=class extends nr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},sc=class extends nr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var oc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&ev(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Gr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Gr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=rp();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let l=up(a,u);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&Qn(this.mutations,e.mutations,(t,r)=>Kd(t,r))&&Qn(this.baseMutations,e.baseMutations,(t,r)=>Kd(t,r))}},ac=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=(function(){return Gy})(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var cc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var uc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ce,K;function nv(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function hp(n){if(n===void 0)return mt("GRPC error has no .code"),P.UNKNOWN;switch(n){case ce.OK:return P.OK;case ce.CANCELLED:return P.CANCELLED;case ce.UNKNOWN:return P.UNKNOWN;case ce.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ce.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ce.INTERNAL:return P.INTERNAL;case ce.UNAVAILABLE:return P.UNAVAILABLE;case ce.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ce.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ce.NOT_FOUND:return P.NOT_FOUND;case ce.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ce.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ce.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ce.ABORTED:return P.ABORTED;case ce.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ce.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ce.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(K=ce||(ce={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var Yd=null;var rv=new ft([4294967295,4294967295],0);function Jd(n){let e=Ef().encode(n),t=new Ea;return t.update(e),new Uint8Array(t.digest())}function Xd(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ft([t,r],0),new ft([i,s],0)]}var lc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hn(`Invalid padding: ${t}`);if(r<0)throw new hn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new hn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=ft.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(ft.fromNumber(r)));return i.compare(rv)===1&&(i=new ft([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=Jd(e),[r,i]=Xd(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.fe===0)return;let t=Jd(e),[r,i]=Xd(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);this.we(a)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},hn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var vs=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Xr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new oe(z),It(),G())}},Xr=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,G(),G(),G())}};var Kn=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},Is=class{constructor(e,t){this.targetId=e,this.De=t}},ws=class{constructor(e,t,r=Se.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Es=class{constructor(){this.ve=0,this.Ce=Zd(),this.Fe=Se.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=G(),t=G(),r=G();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:s})}}),new Xr(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Zd()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},hc=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=It(),this.je=os(),this.Je=os(),this.He=new oe(z)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(ec(s))if(r===0){let a=new L(s.path);this.Xe(t,a,He.newNoDocument(a,q.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this.ot(t);if(a!==r){let u=this._t(e),l=u?this.ut(u,e,a):1;if(l!==0){this.rt(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}Yd?.ct((function(p,_,v,R,k){var x,D,$,U,j,J;let Re={localCacheCount:p,existenceFilterCount:_.count,databaseId:v.database,projectId:v.projectId},Y=_.unchangedNames;return Y&&(Re.bloomFilter={applied:k===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(U=($=(D=Y?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(J=(j=Y?.bits)===null||j===void 0?void 0:j.padding)!==null&&J!==void 0?J:0,mightContain:E=>{var g;return(g=R?.mightContain(E))!==null&&g!==void 0&&g}}),Re})(a,e.De,this.We.lt(),u,l))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,u;try{a=_t(r).toUint8Array()}catch(l){if(l instanceof ms)return $t("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new lc(a,i,s)}catch(l){return $t(l instanceof hn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.fe===0?null:u}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,a)=>{let u=this.st(a);if(u){if(s.current&&ec(u.target)){let l=new L(u.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,He.newNoDocument(l,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=G();this.Je.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));let i=new vs(e,t,this.He,this.ze,r);return this.ze=It(),this.je=os(),this.Je=os(),this.He=new oe(z),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Es,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new ge(z),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new ge(z),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Es),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function os(){return new oe(L.comparator)}function Zd(){return new oe(L.comparator)}var iv={asc:"ASCENDING",desc:"DESCENDING"},sv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ov={and:"AND",or:"OR"},dc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function fc(n,e){return n.useProto3Json||Gs(e)?e:{value:e}}function Ts(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function av(n,e){return Ts(n,e.toTimestamp())}function st(n){return Q(!!n,49232),q.fromTimestamp((function(t){let r=gt(t);return new de(r.seconds,r.nanos)})(n))}function ku(n,e){return pc(n,e).canonicalString()}function pc(n,e){let t=(function(i){return new te(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function fp(n){let e=te.fromString(n);return Q(yp(e),10190,{key:e.toString()}),e}function mc(n,e){return ku(n.databaseId,e.path)}function Pa(n,e){let t=fp(e);if(t.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(mp(t))}function pp(n,e){return ku(n.databaseId,e)}function cv(n){let e=fp(n);return e.length===4?te.emptyPath():mp(e)}function gc(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mp(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ef(n,e,t){return{name:mc(n,e),fields:t.value.mapValue.fields}}function uv(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),Se.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Se.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){let p=d.code===void 0?P.UNKNOWN:hp(d.code);return new O(p,d.message||"")})(a);t=new ws(r,i,s,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Pa(n,r.document.name),s=st(r.document.updateTime),a=r.document.createTime?st(r.document.createTime):q.min(),u=new Ve({mapValue:{fields:r.document.fields}}),l=He.newFoundDocument(i,s,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Kn(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Pa(n,r.document),s=r.readTime?st(r.readTime):q.min(),a=He.newNoDocument(i,s),u=r.removedTargetIds||[];t=new Kn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Pa(n,r.document),s=r.removedTargetIds||[];t=new Kn([],s,i,null)}else{if(!("filter"in e))return M(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new uc(i,s),u=r.targetId;t=new Is(u,a)}}return t}function lv(n,e){let t;if(e instanceof wn)t={update:ef(n,e.key,e.value)};else if(e instanceof rr)t={delete:mc(n,e.key)};else if(e instanceof at)t={update:ef(n,e.key,e.data),updateMask:vv(e.fieldMask)};else{if(!(e instanceof sc))return M(16599,{Rt:e.type});t={verify:mc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,a){let u=a.transform;if(u instanceof yn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof vn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof In)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof tr)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw M(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:av(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)})(n,e.precondition)),t}function hv(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>(function(i,s){let a=i.updateTime?st(i.updateTime):st(s);return a.isEqual(q.min())&&(a=st(s)),new ic(a,i.transformResults||[])})(t,e))):[]}function dv(n,e){return{documents:[pp(n,e.path)]}}function fv(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=pp(n,i);let s=(function(d){if(d.length!==0)return _p(Qe.create(d,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let a=(function(d){if(d.length!==0)return d.map(p=>(function(v){return{field:zn(v.field),direction:gv(v.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=fc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{Vt:t,parent:i}}function pv(n){let e=cv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=(function(_){let v=gp(_);return v instanceof Qe&&Hf(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map(v=>(function(k){return new _n(Wn(k.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(v))})(t.orderBy));let u=null;t.limit&&(u=(function(_){let v;return v=typeof _=="object"?_.value:_,Gs(v)?null:v})(t.limit));let l=null;t.startAt&&(l=(function(_){let v=!!_.before,R=_.values||[];return new Zn(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){let v=!_.before,R=_.values||[];return new Zn(R,v)})(t.endAt)),qy(e,i,a,s,u,"F",l,d)}function mv(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gp(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Wn(t.unaryFilter.field);return le.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Wn(t.unaryFilter.field);return le.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Wn(t.unaryFilter.field);return le.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Wn(t.unaryFilter.field);return le.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(n):n.fieldFilter!==void 0?(function(t){return le.create(Wn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Qe.create(t.compositeFilter.filters.map(r=>gp(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(n):M(30097,{filter:n})}function gv(n){return iv[n]}function _v(n){return sv[n]}function yv(n){return ov[n]}function zn(n){return{fieldPath:n.canonicalString()}}function Wn(n){return Le.fromServerFormat(n.fieldPath)}function _p(n){return n instanceof le?(function(t){if(t.op==="=="){if(qd(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NAN"}};if(Bd(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(qd(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NOT_NAN"}};if(Bd(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zn(t.field),op:_v(t.op),value:t.value}}})(n):n instanceof Qe?(function(t){let r=t.getFilters().map(i=>_p(i));return r.length===1?r[0]:{compositeFilter:{op:yv(t.op),filters:r}}})(n):M(54877,{filter:n})}function vv(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Zr=class n{constructor(e,t,r,i,s=q.min(),a=q.min(),u=Se.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var _c=class{constructor(e){this.gt=e}};function Iv(n){let e=pv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?nc(e,e.limit,"L"):e}var As=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(re(e.integerValue));else if("doubleValue"in e){let r=re(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Qr(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=gt(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(_t(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Wf(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):zf(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):M(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let a=Yn,u=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(re(u)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),L.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};As.Ut=new As;var yc=class{constructor(){this.Dn=new vc}addToCollectionParentIndex(e,t){return this.Dn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(gn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(gn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},vc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ge(te.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ge(te.comparator)).toArray()}};var EA=new Uint8Array(0);var tf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},vp=41943040,Ue=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Ue.DEFAULT_COLLECTION_PERCENTILE=10,Ue.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ue.DEFAULT=new Ue(vp,Ue.DEFAULT_COLLECTION_PERCENTILE,Ue.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ue.DISABLED=new Ue(-1,0,0);var ei=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var nf="LruGarbageCollector",wv=1048576;function rf([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var Ic=class{constructor(e){this.Tr=e,this.buffer=new ge(rf),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();rf(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},wc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){V(nf,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){cr(t)?V(nf,"Ignoring IndexedDB error during garbage collection: ",t):yield ar(t)}yield this.Rr(3e5)}))}},Ec=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(wu.ue);let r=new Ic(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(tf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tf):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,u,l,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,a=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,u=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(d=Date.now(),$n()<=W.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${_} documents in `+(d-l)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}};function Ev(n,e){return new Ec(n,e)}var Tc=class{constructor(){this.changes=new vt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,He.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ac=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var bc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Gr(r.mutation,i,Be.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,G()).next(()=>r))}getLocalViewOfDocuments(e,t,r=G()){let i=ln();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=$r();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,G()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let s=It(),a=Wr(),u=(function(){return Wr()})();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof at)?s=s.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Gr(p.mutation,d,p.mutation.getFieldMask(),de.now())):a.set(d.key,Be.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var _;return u.set(d,new Ac(p,(_=a.get(d))!==null&&_!==void 0?_:null))}),u))}recalculateAndSaveOverlays(e,t){let r=Wr(),i=new oe((a,u)=>a-u),s=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||Be.empty();p=u.applyToLocalView(d,p),r.set(l,p);let _=(i.get(u.batchId)||G()).add(l);i=i.insert(u.batchId,_)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,p=l.value,_=rp();p.forEach(v=>{if(!s.has(v)){let R=up(t.get(v),r.get(v));R!==null&&_.set(v,R),s=s.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve(ln()),u=Hr,l=s;return a.next(d=>C.forEach(d,(p,_)=>(u<_.largestBatchId&&(u=_.largestBatchId),s.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(v=>{l=l.insert(p,v)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,G())).next(p=>({batchId:u,changes:np(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=$r();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=$r();return this.indexManager.getCollectionParents(e,s).next(u=>C.forEach(u,l=>{let d=(function(_,v){return new yt(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((_,v)=>{a=a.insert(_,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,He.newInvalidDocument(p)))});let u=$r();return a.forEach((l,d)=>{let p=s.get(l);p!==void 0&&Gr(p.mutation,d,Be.empty(),de.now()),Ys(t,d)&&(u=u.insert(l,d))}),u})}};var Sc=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return C.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:st(i.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:Iv(i.bundledQuery),readTime:st(i.readTime)}})(t)),C.resolve()}};var Rc=class{constructor(){this.overlays=new oe(L.comparator),this.kr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ln();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=ln(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new oe((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=s.get(d.largestBatchId);p===null&&(p=ln(),s=s.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=ln(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return C.resolve(u)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new cc(t,r));let s=this.kr.get(t);s===void 0&&(s=G(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var Pc=class{constructor(){this.sessionToken=Se.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var ti=class{constructor(){this.qr=new ge(ue.Qr),this.$r=new ge(ue.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new ue(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new ue(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new L(new te([])),r=new ue(t,e),i=new ue(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new L(new te([])),r=new ue(t,e),i=new ue(t,e+1),s=G();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new ue(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ue=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return L.comparator(e.key,t.key)||z(e.Hr,t.Hr)}static Ur(e,t){return z(e.Hr,t.Hr)||L.comparator(e.key,t.key)}};var Cc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ge(ue.Qr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new oc(s,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Yr=this.Yr.add(new ue(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Eu:this.er-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ue(t,0),i=new ue(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{let u=this.Zr(a.Hr);s.push(u)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ge(z);return t.forEach(i=>{let s=new ue(i,0),a=new ue(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],u=>{r=r.add(u.Hr)})}),C.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;L.isDocumentKey(s)||(s=s.child(""));let a=new ue(new L(s),0),u=new ge(z);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.Hr)),!0)},a),C.resolve(this.ei(u))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return C.forEach(t.mutations,i=>{let s=new ue(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new ue(t,0),i=this.Yr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var kc=class{constructor(e){this.ni=e,this.docs=(function(){return new oe(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():He.newInvalidDocument(t))}getEntries(e,t){let r=It();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():He.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=It(),a=t.path,u=new L(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ey(wy(p),r)<=0||(i.has(p.key)||Ys(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ri(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Dc(this)}getSize(e){return C.resolve(this.size)}},Dc=class extends Tc{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var Nc=class{constructor(e){this.persistence=e,this.ii=new vt(t=>Ru(t),Pu),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.si=0,this.oi=new ti,this.targetCount=0,this._i=ei.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),C.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new ei(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.hr(t),C.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.oi.containsKey(t))}};var bs=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new wu(0),this.ci=!1,this.ci=!0,this.li=new Pc,this.referenceDelegate=e(this),this.hi=new Nc(this),this.indexManager=new yc,this.remoteDocumentCache=(function(i){return new kc(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new _c(t),this.Ti=new Sc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Rc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Cc(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Oc(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return C.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Oc=class extends qa{constructor(e){super(),this.currentSequenceNumber=e}},xc=class n{constructor(e){this.persistence=e,this.Ai=new ti,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw M(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.mi,r=>{let i=L.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,q.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return C.or([()=>C.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Ss=class n{constructor(e,t){this.persistence=e,this.gi=new vt(r=>Sy(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Ev(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return C.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(u=>{u||(r++,s.removeEntry(a,q.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=cs(e.data.value)),t}Sr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Vc=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=G(),i=G();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Lc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Mc=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return ad()?8:Ay(pe())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Lc;return this.ws(e,t,a).next(u=>{if(s.result=u,this.Rs)return this.Ss(e,t,a,u.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?($n()<=W.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",jn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):($n()<=W.DEBUG&&V("QueryEngine","Query:",jn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?($n()<=W.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",jn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,it(t))):C.resolve())}ps(e,t){if(Wd(t))return C.resolve(null);let r=it(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=nc(t,null,"F"),r=it(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=G(...s);return this.gs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.bs(t,u);return this.Ds(t,d,a,l.readTime)?this.ps(e,nc(t,null,"F")):this.vs(e,d,t,l)}))})))}ys(e,t,r,i){return Wd(t)||i.isEqual(q.min())?C.resolve(null):this.gs.getDocuments(e,r).next(s=>{let a=this.bs(t,s);return this.Ds(t,a,r,i)?C.resolve(null):($n()<=W.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),jn(t)),this.vs(e,a,t,Iy(i,Hr)).next(u=>u))})}bs(e,t){let r=new ge(ep(e));return t.forEach((i,s)=>{Ys(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return $n()<=W.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",jn(t)),this.gs.getDocumentsMatchingQuery(e,t,gn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Du="LocalStore",Tv=3e8,Fc=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new oe(z),this.Ms=new vt(s=>Ru(s),Pu),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bc(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function Av(n,e,t,r){return new Fc(n,e,t,r)}function Ip(n,e){return m(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],u=[],l=G();for(let d of i){a.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}for(let d of s){u.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}return t.localDocuments.getDocuments(r,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function bv(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return(function(u,l,d,p){let _=d.batch,v=_.keys(),R=C.resolve();return v.forEach(k=>{R=R.next(()=>p.getEntry(l,k)).next(x=>{let D=d.docVersions.get(k);Q(D!==null,48541),x.version.compareTo(D)<0&&(_.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(l,_))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let l=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function wp(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function Sv(n,e){let t=B(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let u=[];e.targetChanges.forEach((p,_)=>{let v=i.get(_);if(!v)return;u.push(t.hi.removeMatchingKeys(s,p.removedDocuments,_).next(()=>t.hi.addMatchingKeys(s,p.addedDocuments,_)));let R=v.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(_)!==null?R=R.withResumeToken(Se.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(_,R),(function(x,D,$){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=Tv?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(v,R,p)&&u.push(t.hi.updateTargetData(s,R))});let l=It(),d=G();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),u.push(Rv(s,a,e.documentUpdates).next(p=>{l=p.Ls,d=p.ks})),!r.isEqual(q.min())){let p=t.hi.getLastRemoteSnapshotVersion(s).next(_=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(p)}return C.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.Fs=i,s))}function Rv(n,e,t){let r=G(),i=G();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=It();return t.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(q.min())?(e.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(u,l)):V(Du,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function Pv(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Eu),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Cv(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new Zr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function Uc(n,e,t){return m(this,null,function*(){let r=B(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!cr(a))throw a;V(Du,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function sf(n,e,t){let r=B(n),i=q.min(),s=G();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(l,d,p){let _=B(l),v=_.Ms.get(p);return v!==void 0?C.resolve(_.Fs.get(v)):_.hi.getTargetData(d,p)})(r,a,it(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?s:G())).next(u=>(kv(r,jy(e),u),{documents:u,qs:s})))}function kv(n,e,t){let r=n.xs.get(e)||q.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}var Rs=class{constructor(){this.activeTargetIds=Qy()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Bc=class{constructor(){this.Fo=new Rs,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Rs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var qc=class{xo(e){}shutdown(){}};var of="ConnectivityMonitor",Ps=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){V(of,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){V(of,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var as=null;function $c(){return as===null?as=(function(){return 268435456+Math.round(2147483648*Math.random())})():as++,"0x"+as.toString(16)}var Ca="RestConnection",Dv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},jc=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===gs?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let a=$c(),u=this.Go(e,t.toUriEncodedString());V(Ca,`Sending RPC '${e}' ${a}:`,u,r);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:d}=new URL(u),p=Vt(d);return this.jo(e,u,l,r,p).then(_=>(V(Ca,`Received RPC '${e}' ${a}: `,_),_),_=>{throw $t(Ca,`RPC '${e}' ${a} failed with error: `,_,"url: ",u,"request:",r),_})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+or})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=Dv[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var zc=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Ae="WebChannelConnection",Wc=class extends jc{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let a=$c();return new Promise((u,l)=>{let d=new Ta;d.setWithCredentials(!0),d.listenOnce(Aa.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case qr.NO_ERROR:let _=d.getResponseJson();V(Ae,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),u(_);break;case qr.TIMEOUT:V(Ae,`RPC '${e}' ${a} timed out`),l(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case qr.HTTP_ERROR:let v=d.getStatus();if(V(Ae,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let x=(function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(k.status);l(new O(x,k.message))}else l(new O(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new O(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{V(Ae,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);V(Ae,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}P_(e,t,r){let i=$c(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ra(),u=Sa(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let p=s.join("");V(Ae,`Creating RPC '${e}' stream ${i}: ${p}`,l);let _=a.createWebChannel(p,l);this.T_(_);let v=!1,R=!1,k=new zc({Ho:D=>{R?V(Ae,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(v||(V(Ae,`Opening RPC '${e}' stream ${i} transport.`),_.open(),v=!0),V(Ae,`RPC '${e}' stream ${i} sending:`,D),_.send(D))},Yo:()=>_.close()}),x=(D,$,U)=>{D.listen($,j=>{try{U(j)}catch(J){setTimeout(()=>{throw J},0)}})};return x(_,qn.EventType.OPEN,()=>{R||(V(Ae,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),x(_,qn.EventType.CLOSE,()=>{R||(R=!0,V(Ae,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(_))}),x(_,qn.EventType.ERROR,D=>{R||(R=!0,$t(Ae,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),k.__(new O(P.UNAVAILABLE,"The operation could not be completed")))}),x(_,qn.EventType.MESSAGE,D=>{var $;if(!R){let U=D.data[0];Q(!!U,16349);let j=U,J=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(J){V(Ae,`RPC '${e}' stream ${i} received error:`,J);let Re=J.status,Y=(function(I){let w=ce[I];if(w!==void 0)return hp(w)})(Re),E=J.message;Y===void 0&&(Y=P.INTERNAL,E="Unknown error status: "+Re+" with message "+J.message),R=!0,k.__(new O(Y,E)),_.close()}else V(Ae,`RPC '${e}' stream ${i} received:`,U),k.a_(U)}}),x(u,ba.STAT_EVENT,D=>{D.stat===is.PROXY?V(Ae,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===is.NOPROXY&&V(Ae,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function ka(){return typeof document<"u"?document:null}function Js(n){return new dc(n,!0)}var Cs=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var af="PersistentStream",ks=class{constructor(e,t,r,i,s,a,u,l){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Cs(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return m(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return m(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return m(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(mt(t.toString()),mt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new O(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>m(this,null,function*(){this.state=0,this.start()}))}G_(e){return V(af,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(V(af,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Gc=class extends ks{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=uv(this.serializer,e),r=(function(s){if(!("targetChange"in s))return q.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?st(a.readTime):q.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=gc(this.serializer),t.addTarget=(function(s,a){let u,l=a.target;if(u=ec(l)?{documents:dv(s,l)}:{query:fv(s,l).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=dp(s,a.resumeToken);let d=fc(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=Ts(s,a.snapshotVersion.toTimestamp());let d=fc(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);let r=mv(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=gc(this.serializer),t.removeTarget=e,this.k_(t)}},Kc=class extends ks{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=hv(e.writeResults,e.commitTime),r=st(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=gc(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>lv(this.serializer,r))};this.k_(t)}};var Hc=class{},Qc=class extends Hc{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,pc(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(P.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(e,pc(t,r),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Yc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(mt(t),this._a=!1):V("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var En="RemoteStore",Jc=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(()=>m(this,null,function*(){bn(this)&&(V(En,"Restarting streams for network reachability change."),yield(function(l){return m(this,null,function*(){let d=B(l);d.Ia.add(4),yield ai(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Xs(d)})})(this))}))}),this.Aa=new Yc(r,i)}};function Xs(n){return m(this,null,function*(){if(bn(n))for(let e of n.da)yield e(!0)})}function ai(n){return m(this,null,function*(){for(let e of n.da)yield e(!1)})}function Ep(n,e){let t=B(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Vu(t)?xu(t):ur(t).x_()&&Ou(t,e))}function Nu(n,e){let t=B(n),r=ur(t);t.Ta.delete(e),r.x_()&&Tp(t,e),t.Ta.size===0&&(r.x_()?r.B_():bn(t)&&t.Aa.set("Unknown"))}function Ou(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ur(n).H_(e)}function Tp(n,e){n.Ra.$e(e),ur(n).Y_(e)}function xu(n){n.Ra=new hc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),ur(n).start(),n.Aa.aa()}function Vu(n){return bn(n)&&!ur(n).M_()&&n.Ta.size>0}function bn(n){return B(n).Ia.size===0}function Ap(n){n.Ra=void 0}function Nv(n){return m(this,null,function*(){n.Aa.set("Online")})}function Ov(n){return m(this,null,function*(){n.Ta.forEach((e,t)=>{Ou(n,e)})})}function xv(n,e){return m(this,null,function*(){Ap(n),Vu(n)?(n.Aa.la(e),xu(n)):n.Aa.set("Unknown")})}function Vv(n,e,t){return m(this,null,function*(){if(n.Aa.set("Online"),e instanceof ws&&e.state===2&&e.cause)try{yield(function(i,s){return m(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ta.delete(u),i.Ra.removeTarget(u))})})(n,e)}catch(r){V(En,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ds(n,r)}else if(e instanceof Kn?n.Ra.Ye(e):e instanceof Is?n.Ra.it(e):n.Ra.et(e),!t.isEqual(q.min()))try{let r=yield wp(n.localStore);t.compareTo(r)>=0&&(yield(function(s,a){let u=s.Ra.Pt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let p=s.Ta.get(d);p&&s.Ta.set(d,p.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let p=s.Ta.get(l);if(!p)return;s.Ta.set(l,p.withResumeToken(Se.EMPTY_BYTE_STRING,p.snapshotVersion)),Tp(s,l);let _=new Zr(p.target,l,d,p.sequenceNumber);Ou(s,_)}),s.remoteSyncer.applyRemoteEvent(u)})(n,t))}catch(r){V(En,"Failed to raise snapshot:",r),yield Ds(n,r)}})}function Ds(n,e,t){return m(this,null,function*(){if(!cr(e))throw e;n.Ia.add(1),yield ai(n),n.Aa.set("Offline"),t||(t=()=>wp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(null,null,function*(){V(En,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield Xs(n)}))})}function bp(n,e){return e().catch(t=>Ds(n,t,e))}function Zs(n){return m(this,null,function*(){let e=B(n),t=zt(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Eu;for(;Lv(e);)try{let i=yield Pv(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,Mv(e,i)}catch(i){yield Ds(e,i)}Sp(e)&&Rp(e)})}function Lv(n){return bn(n)&&n.Pa.length<10}function Mv(n,e){n.Pa.push(e);let t=zt(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function Sp(n){return bn(n)&&!zt(n).M_()&&n.Pa.length>0}function Rp(n){zt(n).start()}function Fv(n){return m(this,null,function*(){zt(n).na()})}function Uv(n){return m(this,null,function*(){let e=zt(n);for(let t of n.Pa)e.X_(t.mutations)})}function Bv(n,e,t){return m(this,null,function*(){let r=n.Pa.shift(),i=ac.from(r,e,t);yield bp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Zs(n)})}function qv(n,e){return m(this,null,function*(){e&&zt(n).Z_&&(yield(function(r,i){return m(this,null,function*(){if((function(a){return nv(a)&&a!==P.ABORTED})(i.code)){let s=r.Pa.shift();zt(r).N_(),yield bp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Zs(r)}})})(n,e)),Sp(n)&&Rp(n)})}function cf(n,e){return m(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),V(En,"RemoteStore received new credentials");let r=bn(t);t.Ia.add(3),yield ai(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield Xs(t)})}function $v(n,e){return m(this,null,function*(){let t=B(n);e?(t.Ia.delete(2),yield Xs(t)):e||(t.Ia.add(2),yield ai(t),t.Aa.set("Unknown"))})}function ur(n){return n.Va||(n.Va=(function(t,r,i){let s=B(t);return s.ia(),new Gc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:Nv.bind(null,n),e_:Ov.bind(null,n),n_:xv.bind(null,n),J_:Vv.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.Va.N_(),Vu(n)?xu(n):n.Aa.set("Unknown")):(yield n.Va.stop(),Ap(n))}))),n.Va}function zt(n){return n.ma||(n.ma=(function(t,r,i){let s=B(t);return s.ia(),new Kc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:Fv.bind(null,n),n_:qv.bind(null,n),ea:Uv.bind(null,n),ta:Bv.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.ma.N_(),yield Zs(n)):(yield n.ma.stop(),n.Pa.length>0&&(V(En,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var Xc=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,u=new n(e,t,a,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Lu(n,e){if(mt("AsyncQueue",`${e}: ${n}`),cr(n))return new O(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Ns=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=$r(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Os=class{constructor(){this.fa=new oe(L.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):M(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},ir=class n{constructor(e,t,r,i,s,a,u,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Ns.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Zc=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},eu=class{constructor(){this.queries=uf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=B(t),s=i.queries;i.queries=uf(),s.forEach((a,u)=>{for(let l of u.wa)l.onError(r)})})(this,new O(P.ABORTED,"Firestore shutting down"))}};function uf(){return new vt(n=>Zf(n),Qs)}function Mu(n,e){return m(this,null,function*(){let t=B(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Zc,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Lu(a,`Initialization of query '${jn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Uu(t)})}function Fu(n,e){return m(this,null,function*(){let t=B(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function jv(n,e){let t=B(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.wa)u.Ca(i)&&(r=!0);a.ya=i}}r&&Uu(t)}function zv(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Uu(n){n.Da.forEach(e=>{e.next()})}var tu,lf;(lf=tu||(tu={})).Fa="default",lf.Cache="cache";var ni=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ir(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=ir.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==tu.Cache}};var xs=class{constructor(e){this.key=e}},Vs=class{constructor(e){this.key=e}},nu=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=G(),this.mutatedKeys=G(),this.Xa=ep(e),this.eu=new Ns(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Os,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,_)=>{let v=i.get(p),R=Ys(this.query,_)?_:null,k=!!v&&this.mutatedKeys.has(v.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;v&&R?v.data.isEqual(R.data)?k!==x&&(r.track({type:3,doc:R}),D=!0):this.iu(v,R)||(r.track({type:2,doc:R}),D=!0,(l&&this.Xa(R,l)>0||d&&this.Xa(R,d)<0)&&(u=!0)):!v&&R?(r.track({type:0,doc:R}),D=!0):v&&!R&&(r.track({type:1,doc:v}),D=!0,(l||d)&&(u=!0)),D&&(R?(a=a.add(R),s=x?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{eu:a,ru:r,Ds:u,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((p,_)=>(function(R,k){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{At:D})}};return x(R)-x(k)})(p.type,_.type)||this.Xa(p.doc,_.doc)),this.su(r),i=i!=null&&i;let u=t&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new ir(this.query,e.eu,s,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Os,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=G(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new Vs(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new xs(r))}),t}uu(e){this.Ha=e.qs,this.Za=G();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ir.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Bu="SyncEngine",ru=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},iu=class{constructor(e){this.key=e,this.lu=!1}},su=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new vt(u=>Zf(u),Qs),this.Tu=new Map,this.Iu=new Set,this.du=new oe(L.comparator),this.Eu=new Map,this.Au=new ti,this.Ru={},this.Vu=new Map,this.mu=ei.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function Wv(n,e,t=!0){return m(this,null,function*(){let r=Op(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield Pp(r,e,t,!0),i})}function Gv(n,e){return m(this,null,function*(){let t=Op(n);yield Pp(t,e,!0,!1)})}function Pp(n,e,t,r){return m(this,null,function*(){let i=yield Cv(n.localStore,it(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),u;return r&&(u=yield Kv(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Ep(n.remoteStore,i),u})}function Kv(n,e,t,r,i){return m(this,null,function*(){n.gu=(_,v,R)=>(function(x,D,$,U){return m(this,null,function*(){let j=D.view.nu($);j.Ds&&(j=yield sf(x.localStore,D.query,!1).then(({documents:E})=>D.view.nu(E,j)));let J=U&&U.targetChanges.get(D.targetId),Re=U&&U.targetMismatches.get(D.targetId)!=null,Y=D.view.applyChanges(j,x.isPrimaryClient,J,Re);return df(x,D.targetId,Y._u),Y.snapshot})})(n,_,v,R);let s=yield sf(n.localStore,e,!0),a=new nu(e,s.qs),u=a.nu(s.documents),l=Xr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,l);df(n,t,d._u);let p=new ru(e,t,a);return n.Pu.set(e,p),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot})}function Hv(n,e,t){return m(this,null,function*(){let r=B(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!Qs(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Uc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Nu(r.remoteStore,i.targetId),ou(r,i.targetId)}).catch(ar))):(ou(r,i.targetId),yield Uc(r.localStore,i.targetId,!0))})}function Qv(n,e){return m(this,null,function*(){let t=B(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Nu(t.remoteStore,r.targetId))})}function Yv(n,e,t){return m(this,null,function*(){let r=rI(n);try{let i=yield(function(a,u){let l=B(a),d=de.now(),p=u.reduce((R,k)=>R.add(k.key),G()),_,v;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=It(),x=G();return l.Os.getEntries(R,p).next(D=>{k=D,k.forEach(($,U)=>{U.isValidDocument()||(x=x.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,k)).next(D=>{_=D;let $=[];for(let U of u){let j=tv(U,_.get(U.key).overlayedDocument);j!=null&&$.push(new at(U.key,j,Gf(j.value.mapValue),Me.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,$,u)}).next(D=>{v=D;let $=D.applyToLocalDocumentSet(_,x);return l.documentOverlayCache.saveOverlays(R,D.batchId,$)})}).then(()=>({batchId:v.batchId,changes:np(_)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new oe(z)),d=d.insert(u,l),a.Ru[a.currentUser.toKey()]=d})(r,i.batchId,t),yield ci(r,i.changes),yield Zs(r.remoteStore)}catch(i){let s=Lu(i,"Failed to persist write");t.reject(s)}})}function Cp(n,e){return m(this,null,function*(){let t=B(n);try{let r=yield Sv(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Eu.get(s);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?Q(a.lu,14607):i.removedDocuments.size>0&&(Q(a.lu,42227),a.lu=!1))}),yield ci(t,r,e)}catch(r){yield ar(r)}})}function hf(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let l=B(a);l.onlineState=u;let d=!1;l.queries.forEach((p,_)=>{for(let v of _.wa)v.va(u)&&(d=!0)}),d&&Uu(l)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Jv(n,e,t){return m(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let a=new oe(L.comparator);a=a.insert(s,He.newNoDocument(s,q.min()));let u=G().add(s),l=new vs(q.min(),new Map,new oe(z),a,u);yield Cp(r,l),r.du=r.du.remove(s),r.Eu.delete(e),qu(r)}else yield Uc(r.localStore,e,!1).then(()=>ou(r,e,t)).catch(ar)})}function Xv(n,e){return m(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield bv(t.localStore,e);Dp(t,r,null),kp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ci(t,i)}catch(i){yield ar(i)}})}function Zv(n,e,t){return m(this,null,function*(){let r=B(n);try{let i=yield(function(a,u){let l=B(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return l.mutationQueue.lookupMutationBatch(d,u).next(_=>(Q(_!==null,37113),p=_.keys(),l.mutationQueue.removeMutationBatch(d,_))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>l.localDocuments.getDocuments(d,p))})})(r.localStore,e);Dp(r,e,t),kp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ci(r,i)}catch(i){yield ar(i)}})}function kp(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function Dp(n,e,t){let r=B(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function ou(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||Np(n,r)})}function Np(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Nu(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),qu(n))}function df(n,e,t){for(let r of t)r instanceof xs?(n.Au.addReference(r.key,e),eI(n,r)):r instanceof Vs?(V(Bu,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||Np(n,r.key)):M(19791,{yu:r})}function eI(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(V(Bu,"New document in limbo: "+t),n.Iu.add(r),qu(n))}function qu(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new L(te.fromString(e)),r=n.mu.next();n.Eu.set(r,new iu(t)),n.du=n.du.insert(t,r),Ep(n.remoteStore,new Zr(it(Hs(t.path)),r,"TargetPurposeLimboResolution",wu.ue))}}function ci(n,e,t){return m(this,null,function*(){let r=B(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((u,l)=>{a.push(r.gu(l,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let _=d?!d.fromCache:(p=t?.targetChanges.get(l.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(l.targetId,_?"current":"not-current")}if(d){i.push(d);let _=Vc.Es(l.targetId,d);s.push(_)}}))}),yield Promise.all(a),r.hu.J_(i),yield(function(l,d){return m(this,null,function*(){let p=B(l);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>C.forEach(d,v=>C.forEach(v.Is,R=>p.persistence.referenceDelegate.addReference(_,v.targetId,R)).next(()=>C.forEach(v.ds,R=>p.persistence.referenceDelegate.removeReference(_,v.targetId,R)))))}catch(_){if(!cr(_))throw _;V(Du,"Failed to update sequence numbers: "+_)}for(let _ of d){let v=_.targetId;if(!_.fromCache){let R=p.Fs.get(v),k=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(k);p.Fs=p.Fs.insert(v,x)}}})})(r.localStore,s))})}function tI(n,e){return m(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){V(Bu,"User change. New user:",e.toKey());let r=yield Ip(t.localStore,e);t.currentUser=e,(function(s,a){s.Vu.forEach(u=>{u.forEach(l=>{l.reject(new O(P.CANCELLED,a))})}),s.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ci(t,r.Bs)}})}function nI(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.lu)return G().add(r.key);{let i=G(),s=t.Tu.get(e);if(!s)return i;for(let a of s){let u=t.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}function Op(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Cp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=nI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Jv.bind(null,e),e.hu.J_=jv.bind(null,e.eventManager),e.hu.pu=zv.bind(null,e.eventManager),e}function rI(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zv.bind(null,e),e}var xp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return m(this,null,function*(){this.serializer=Js(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return Av(this.persistence,new Mc,t.initialUser,this.serializer)}Du(t){return new bs(xc.Vi,this.serializer)}bu(t){return new Bc}terminate(){return m(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),au=class extends xp{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Q(this.persistence.referenceDelegate instanceof Ss,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new wc(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?Ue.withCacheSize(this.cacheSizeBytes):Ue.DEFAULT;return new bs(r=>Ss.Vi(r,t),this.serializer)}};var iI=(()=>{class n{initialize(t,r){return m(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>hf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=tI.bind(null,this.syncEngine),yield $v(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new eu})()}createDatastore(t){let r=Js(t.databaseInfo.databaseId),i=(function(a){return new Wc(a)})(t.databaseInfo);return(function(a,u,l,d){return new Qc(a,u,l,d)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,a,u,l){return new Jc(i,s,a,u,l)})(this.localStore,this.datastore,t.asyncQueue,r=>hf(this.syncEngine,r,0),(function(){return Ps.C()?new Ps:new qc})())}createSyncEngine(t,r){return(function(s,a,u,l,d,p,_){let v=new su(s,a,u,l,d,p);return _&&(v.fu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return m(this,null,function*(){var t,r;yield(function(s){return m(this,null,function*(){let a=B(s);V(En,"RemoteStore shutting down."),a.Ia.add(5),yield ai(a),a.Ea.shutdown(),a.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var ri=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):mt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Wt="FirestoreClient",cu=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=me.UNAUTHENTICATED,this.clientId=Kr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>m(this,null,function*(){V(Wt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(V(Wt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Lu(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Da(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(Wt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(null,null,function*(){r.isEqual(i)||(yield Ip(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{$t("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{V("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{$t("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function ff(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield sI(n);V(Wt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>cf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>cf(e.remoteStore,i)),n._onlineComponents=e})}function sI(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Wt,"Using user provided OfflineComponentProvider");try{yield Da(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;$t("Error using user provided cache. Falling back to memory cache: "+t),yield Da(n,new xp)}}else V(Wt,"Using default OfflineComponentProvider"),yield Da(n,new au(void 0));return n._offlineComponents})}function Vp(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Wt,"Using user provided OnlineComponentProvider"),yield ff(n,n._uninitializedComponentsProvider._online)):(V(Wt,"Using default OnlineComponentProvider"),yield ff(n,new iI))),n._onlineComponents})}function oI(n){return Vp(n).then(e=>e.syncEngine)}function Ls(n){return m(this,null,function*(){let e=yield Vp(n),t=e.eventManager;return t.onListen=Wv.bind(null,e.syncEngine),t.onUnlisten=Hv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Gv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Qv.bind(null,e.syncEngine),t})}function aI(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,u,l,d){let p=new ri({next:v=>{p.Ou(),a.enqueueAndForget(()=>Fu(s,_));let R=v.docs.has(u);!R&&v.fromCache?d.reject(new O(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&v.fromCache&&l&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),_=new ni(Hs(u.path),p,{includeMetadataChanges:!0,ka:!0});return Mu(s,_)})(yield Ls(n),n.asyncQueue,e,t,r)})),r.promise}function cI(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,u,l,d){let p=new ri({next:v=>{p.Ou(),a.enqueueAndForget(()=>Fu(s,_)),v.fromCache&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),_=new ni(u,p,{includeMetadataChanges:!0,ka:!0});return Mu(s,_)})(yield Ls(n),n.asyncQueue,e,t,r)})),r.promise}function Lp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var pf=new Map;var Mp="firestore.googleapis.com",mf=!0,Ms=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Mp,this.ssl=mf}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:mf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=vp;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<wv)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Lp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Tn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ms({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ms(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Oa;switch(r.type){case"firstParty":return new Ma(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return m(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=pf.get(t);r&&(V("ComponentProvider","Removing Datastore"),pf.delete(t),r.terminate())})(this),Promise.resolve()}};function Fp(n,e,t,r={}){var i;n=be(n,Tn);let s=Vt(e),a=n._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;s&&(Xi(`https://${l}`),Zi("Firestore",!0)),a.host!==Mp&&a.host!==l&&$t("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!et(d,u)&&(n._setSettings(d),r.mockUserToken)){let p,_;if(typeof r.mockUserToken=="string")p=r.mockUserToken,_=me.MOCK_USER;else{p=td(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new me(v)}n._authCredentials=new xa(new hs(p,_))}}var wt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},fe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ft(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(oi(t,n._jsonSchema))return new n(e,r||null,new L(te.fromString(t.referencePath)))}};fe._jsonSchemaVersion="firestore/documentReference/1.0",fe._jsonSchema={type:he("string",fe._jsonSchemaVersion),referencePath:he("string")};var Ft=class n extends wt{constructor(e,t,r){super(e,t,Hs(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new fe(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Up(n,e,...t){if(n=ne(n),Iu("collection","path",e),n instanceof Tn){let r=te.fromString(e,...t);return Nd(r),new Ft(n,null,r)}{if(!(n instanceof fe||n instanceof Ft))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Nd(r),new Ft(n.firestore,null,r)}}function Bp(n,e){if(n=be(n,Tn),Iu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new wt(n,null,(function(r){return new yt(te.emptyPath(),r)})(e))}function $u(n,e,...t){if(n=ne(n),arguments.length===1&&(e=Kr.newId()),Iu("doc","path",e),n instanceof Tn){let r=te.fromString(e,...t);return Dd(r),new fe(n,null,new L(r))}{if(!(n instanceof fe||n instanceof Ft))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Dd(r),new fe(n.firestore,n instanceof Ft?n.converter:null,new L(r))}}var gf="AsyncQueue",Fs=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Cs(this,"async_queue_retry"),this.oc=()=>{let r=ka();r&&V(gf,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=ka();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=ka();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Ke;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return m(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!cr(e))throw e;V(gf,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,mt("INTERNAL UNHANDLED ERROR: ",_f(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Xc.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&M(47125,{hc:_f(this.tc)})}verifyOperationInProgress(){}Pc(){return m(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function _f(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function yf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var qe=class extends Tn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Fs,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return m(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Fs(e),this._firestoreClient=void 0,yield e}})}};function qp(n,e){let t=typeof n=="object"?n:un(),r=typeof n=="string"?n:e||gs,i=Bn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=ed("firestore");s&&Fp(i,...s)}return i}function ui(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||uI(n),n._firestoreClient}function uI(n){var e,t,r;let i=n._freezeSettings(),s=(function(u,l,d,p){return new $a(u,l,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Lp(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new cu(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}})(n._componentsProvider))}var Ut=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Se.fromBase64String(e))}catch(t){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(oi(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Ut._jsonSchemaVersion="firestore/bytes/1.0",Ut._jsonSchema={type:he("string",Ut._jsonSchemaVersion),bytes:he("string")};var An=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var sr=class{constructor(e){this._methodName=e}};var Bt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(oi(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Bt._jsonSchemaVersion="firestore/geoPoint/1.0",Bt._jsonSchema={type:he("string",Bt._jsonSchemaVersion),latitude:he("number"),longitude:he("number")};var qt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(oi(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new O(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};qt._jsonSchemaVersion="firestore/vectorValue/1.0",qt._jsonSchema={type:he("string",qt._jsonSchemaVersion),vectorValues:he("object")};var lI=/^__.*__$/,uu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new at(e,this.data,this.fieldMask,t,this.fieldTransforms):new wn(e,this.data,t,this.fieldTransforms)}},Us=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new at(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function $p(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ec:n})}}var lu=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return qs(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if($p(this.Ec)&&lI.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},hu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Js(e)}Dc(e,t,r,i=!1){return new lu({Ec:e,methodName:t,bc:r,path:Le.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function li(n){let e=n._freezeSettings(),t=Js(n._databaseId);return new hu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ju(n,e,t,r,i,s={}){let a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);zu("Data must be an object, but it was:",a,r);let u=Wp(r,a),l,d;if(s.merge)l=new Be(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let p=[];for(let _ of s.mergeFields){let v=fu(e,_,t);if(!a.contains(v))throw new O(P.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Kp(p,v)||p.push(v)}l=new Be(p),d=a.fieldTransforms.filter(_=>l.covers(_.field))}else l=null,d=a.fieldTransforms;return new uu(new Ve(u),l,d)}var Bs=class n extends sr{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};var du=class n extends sr{_toFieldTransform(e){return new rc(e.path,new yn)}isEqual(e){return e instanceof n}};function jp(n,e,t,r){let i=n.Dc(1,e,t);zu("Data must be an object, but it was:",i,r);let s=[],a=Ve.empty();Gt(r,(l,d)=>{let p=Wu(e,l,t);d=ne(d);let _=i.gc(p);if(d instanceof Bs)s.push(p);else{let v=hi(d,_);v!=null&&(s.push(p),a.set(p,v))}});let u=new Be(s);return new Us(a,u,i.fieldTransforms)}function zp(n,e,t,r,i,s){let a=n.Dc(1,e,t),u=[fu(e,r,t)],l=[i];if(s.length%2!=0)throw new O(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)u.push(fu(e,s[v])),l.push(s[v+1]);let d=[],p=Ve.empty();for(let v=u.length-1;v>=0;--v)if(!Kp(d,u[v])){let R=u[v],k=l[v];k=ne(k);let x=a.gc(R);if(k instanceof Bs)d.push(R);else{let D=hi(k,x);D!=null&&(d.push(R),p.set(R,D))}}let _=new Be(d);return new Us(p,_,a.fieldTransforms)}function hI(n,e,t,r=!1){return hi(t,n.Dc(r?4:3,e))}function hi(n,e){if(Gp(n=ne(n)))return zu("Unsupported field value:",e,n),Wp(n,e);if(n instanceof sr)return(function(r,i){if(!$p(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,i){let s=[],a=0;for(let u of r){let l=hi(u,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Yy(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=de.fromDate(r);return{timestampValue:Ts(i.serializer,s)}}if(r instanceof de){let s=new de(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ts(i.serializer,s)}}if(r instanceof Bt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ut)return{bytesValue:dp(i.serializer,r._byteString)};if(r instanceof fe){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ku(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof qt)return(function(a,u){return{mapValue:{fields:{[Au]:{stringValue:bu},[Yn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.wc("VectorValues must only contain numeric values.");return Cu(u.serializer,d)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${Ws(r)}`)})(n,e)}function Wp(n,e){let t={};return Ff(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gt(n,(r,i)=>{let s=hi(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Gp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof de||n instanceof Bt||n instanceof Ut||n instanceof fe||n instanceof sr||n instanceof qt)}function zu(n,e,t){if(!Gp(t)||!Tf(t)){let r=Ws(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function fu(n,e,t){if((e=ne(e))instanceof An)return e._internalPath;if(typeof e=="string")return Wu(n,e);throw qs("Field path arguments must be of type string or ",n,!1,void 0,t)}var dI=new RegExp("[~\\*/\\[\\]]");function Wu(n,e,t){if(e.search(dI)>=0)throw qs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new An(...e.split("."))._internalPath}catch{throw qs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function qs(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new O(P.INVALID_ARGUMENT,u+n+l)}function Kp(n,e){return n.some(t=>t.isEqual(e))}var $s=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new fe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new pu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(eo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},pu=class extends $s{data(){return super.data()}};function eo(n,e){return typeof e=="string"?Wu(n,e):e instanceof An?e._internalPath:e._delegate._internalPath}function Hp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ii=class{},js=class extends ii{};function Qp(n,e,...t){let r=[];e instanceof ii&&r.push(e),r=r.concat(t),(function(s){let a=s.filter(l=>l instanceof mu).length,u=s.filter(l=>l instanceof zs).length;if(a>1||a>0&&u>0)throw new O(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var zs=class n extends js{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Xp(e._query,t),new wt(e.firestore,e.converter,tc(e._query,t))}_parse(e){let t=li(e.firestore);return(function(s,a,u,l,d,p,_){let v;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new O(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){If(_,p);let k=[];for(let x of _)k.push(vf(l,s,x));v={arrayValue:{values:k}}}else v=vf(l,s,_)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||If(_,p),v=hI(u,a,_,p==="in"||p==="not-in");return le.create(d,p,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Yp(n,e,t){let r=e,i=eo("where",n);return zs._create(i,r,t)}var mu=class n extends ii{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Qe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)Xp(a,l),a=tc(a,l)})(e._query,t),new wt(e.firestore,e.converter,tc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var gu=class n extends js{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,a){if(i.startAt!==null)throw new O(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new O(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _n(s,a)})(e._query,this._field,this._direction);return new wt(e.firestore,e.converter,(function(i,s){let a=i.explicitOrderBy.concat([s]);return new yt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function Jp(n,e="asc"){let t=e,r=eo("orderBy",n);return gu._create(r,t)}function vf(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new O(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xf(e)&&t.indexOf("/")!==-1)throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!L.isDocumentKey(r))throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ud(n,new L(r))}if(t instanceof fe)return Ud(n,t._key);throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ws(t)}.`)}function If(n,e){if(!Array.isArray(n)||n.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Xp(n,e){let t=(function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var _u=class{convertValue(e,t="none"){switch(jt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return re(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_t(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Gt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Yn].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>re(a.doubleValue));return new qt(s)}convertGeoPoint(e){return new Bt(re(e.latitude),re(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ks(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Yr(e));default:return null}}convertTimestamp(e){let t=gt(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);Q(yp(r),9688,{name:e});let i=new _s(r.get(1),r.get(3)),s=new L(r.popFirst(5));return i.isEqual(t)||mt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Gu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var dn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},fn=class n extends $s{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Hn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(eo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};fn._jsonSchemaVersion="firestore/documentSnapshot/1.0",fn._jsonSchema={type:he("string",fn._jsonSchemaVersion),bundleSource:he("string","DocumentSnapshot"),bundleName:he("string"),bundle:he("string")};var Hn=class extends fn{data(e={}){return super.data(e)}},pn=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new dn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Hn(this._firestore,this._userDataWriter,r.key,r,new dn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Hn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new Hn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:fI(u.type),doc:l,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Kr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function fI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function Zp(n){n=be(n,fe);let e=be(n.firestore,qe);return aI(ui(e),n._key).then(t=>om(e,n,t))}pn._jsonSchemaVersion="firestore/querySnapshot/1.0",pn._jsonSchema={type:he("string",pn._jsonSchemaVersion),bundleSource:he("string","QuerySnapshot"),bundleName:he("string"),bundle:he("string")};var si=class extends _u{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ut(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fe(this.firestore,null,t)}};function em(n){n=be(n,wt);let e=be(n.firestore,qe),t=ui(e),r=new si(e);return Hp(n._query),cI(t,n._query).then(i=>new pn(e,r,n,i))}function tm(n,e,t){n=be(n,fe);let r=be(n.firestore,qe),i=Gu(n.converter,e,t);return di(r,[ju(li(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Me.none())])}function nm(n,e,t,...r){n=be(n,fe);let i=be(n.firestore,qe),s=li(i),a;return a=typeof(e=ne(e))=="string"||e instanceof An?zp(s,"updateDoc",n._key,e,t,r):jp(s,"updateDoc",n._key,e),di(i,[a.toMutation(n._key,Me.exists(!0))])}function rm(n){return di(be(n.firestore,qe),[new rr(n._key,Me.none())])}function im(n,e){let t=be(n.firestore,qe),r=$u(n),i=Gu(n.converter,e);return di(t,[ju(li(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Me.exists(!1))]).then(()=>r)}function sm(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||yf(e[a])||(s=e[a++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(yf(e[a])){let _=e[a];e[a]=(t=_.next)===null||t===void 0?void 0:t.bind(_),e[a+1]=(r=_.error)===null||r===void 0?void 0:r.bind(_),e[a+2]=(i=_.complete)===null||i===void 0?void 0:i.bind(_)}let l,d,p;if(n instanceof fe)d=be(n.firestore,qe),p=Hs(n._key.path),l={next:_=>{e[a]&&e[a](om(d,n,_))},error:e[a+1],complete:e[a+2]};else{let _=be(n,wt);d=be(_.firestore,qe),p=_._query;let v=new si(d);l={next:R=>{e[a]&&e[a](new pn(d,v,_,R))},error:e[a+1],complete:e[a+2]},Hp(n._query)}return(function(v,R,k,x){let D=new ri(x),$=new ni(R,D,k);return v.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Mu(yield Ls(v),$)})),()=>{D.Ou(),v.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Fu(yield Ls(v),$)}))}})(ui(d),p,u,l)}function di(n,e){return(function(r,i){let s=new Ke;return r.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Yv(yield oI(r),i,s)})),s.promise})(ui(n),e)}function om(n,e,t){let r=t.docs.get(e._key),i=new si(n);return new fn(n,i,e._key,r,new dn(t.hasPendingWrites,t.fromCache),e.converter)}var yu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=li(e)}set(e,t,r){this._verifyNotCommitted();let i=Na(e,this._firestore),s=Gu(i.converter,t,r),a=ju(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Me.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Na(e,this._firestore),a;return a=typeof(t=ne(t))=="string"||t instanceof An?zp(this._dataReader,"WriteBatch.update",s._key,t,r,i):jp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Me.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Na(e,this._firestore);return this._mutations=this._mutations.concat(new rr(t._key,Me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Na(n,e){if((n=ne(n)).firestore!==e)throw new O(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function TA(){return new du("serverTimestamp")}function am(n){return ui(n=be(n,qe)),new yu(n,e=>di(n,e))}(function(e,t=!0){(function(i){or=i})(Mt),Ge(new ke("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),u=new qe(new Va(r.getProvider("auth-internal")),new Fa(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _s(d.options.projectId,p)})(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),se(Rd,Pd,e),se(Rd,Pd,"esm2017")})();var pI="firebase",mI="11.10.0";se(pI,mI,"app");function cm(n){n===void 0&&(n=ze(xt));let e=n.get(Hi);return t=>new on(r=>{let i=e.add(),s=!1;function a(){s||(i(),s=!0)}let u=t.subscribe({next:l=>{r.next(l),a()},complete:()=>{r.complete(),a()},error:l=>{r.error(l),a()}});return u.add(()=>{r.unsubscribe(),a()}),u})}var Kt=new Hh("ANGULARFIRE2_VERSION");function fi(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var hr=(n,e)=>{let t=e?[e]:ns(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},lr=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(lr||{}),um=Zo()&&typeof Zone<"u"?lr.WARN:lr.SILENT;var to=class{zone;delegate;constructor(e,t=Wh){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(s,t,r)}},Ht=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=ze(Ze);this.outsideAngular=t.runOutsideAngular(()=>new to(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new to(typeof Zone>"u"?void 0:Zone.current,zh))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Gi({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),lm=!1;function _I(n,e){!lm&&(um>lr.SILENT||Zo())&&(lm=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),um>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function yI(n){let e=ze(Ze,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Sn(n){let e=ze(Ze,{optional:!0});return e?e.run(()=>n()):n()}var vI=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),Ki(t,()=>Sn(()=>n.apply(void 0,r)))),Z=(n,e,t)=>(t||=e?lr.WARN:lr.VERBOSE,function(){let r,i=arguments,s,a,u;try{s=ze(Ht),a=ze(Hi),u=ze(Gh)}catch{return _I(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=Sn(()=>a.add())),i[d]=vI(i[d],r,u));let l=yI(()=>n.apply(this,i));return e?l instanceof on?l.pipe(Xo(s.outsideAngular),Jo(s.insideAngular),cm(u)):l instanceof Promise?Sn(()=>{let d=a.add();return new Promise((p,_)=>{l.then(v=>Ki(u,()=>Sn(()=>p(v))),v=>Ki(u,()=>Sn(()=>_(v)))).finally(d)})}):typeof l=="function"&&r?function(){return setTimeout(r,0),l.apply(this,arguments)}:Sn(()=>l):l instanceof on?l.pipe(Xo(s.outsideAngular),Jo(s.insideAngular)):Sn(()=>l)});var Et=class{constructor(e){return e}},Rn=class{constructor(){return ns()}};function II(n){return n&&n.length===1?n[0]:new Et(un())}var Ku=new Vn("angularfire2._apps"),wI={provide:Et,useFactory:II,deps:[[new Fe,Ku]]},EI={provide:Rn,deps:[[new Fe,Ku]]};function TI(n){return(e,t)=>{let r=t.get(Kh);se("angularfire",Kt.full,"core"),se("angularfire",Kt.full,"app"),se("angular",Qh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Et(i)}}function tb(n,...e){return Ln([wI,EI,{provide:Ku,useFactory:TI(n),multi:!0,deps:[Ze,xt,Ht,...e]}])}var nb=Z(wa,!0);var AI=new Map,bI={activated:!1,tokenObservers:[]},SI={initialized:!1,enabled:!1};function Ye(n){return AI.get(n)||Object.assign({},bI)}function pm(){return SI}var RI="https://content-firebaseappcheck.googleapis.com/v1";var PI="exchangeDebugToken",hm={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},hb=1440*60*1e3;var Yu=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new an,this.pending.promise.catch(t=>{}),yield CI(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new an,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function CI(n){return new Promise(e=>{setTimeout(e,n)})}var kI={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Qt=new We("appCheck","AppCheck",kI);function mm(n){if(!Ye(n).activated)throw Qt.create("use-before-activation",{appName:n.name})}function gm(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(s["X-Firebase-Client"]=R)}let u={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,u)}catch(R){throw Qt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(l.status!==200)throw Qt.create("fetch-status-error",{httpStatus:l.status});let d;try{d=yield l.json()}catch(R){throw Qt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Qt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let _=Number(p[1])*1e3,v=Date.now();return{token:d.token,expireTimeMillis:v+_,issuedAtTimeMillis:v}})}function _m(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${RI}/projects/${t}/apps/${r}:${PI}?key=${i}`,body:{debug_token:e}}}var DI="firebase-app-check-database",NI=1,Ju="firebase-app-check-store";var no=null;function OI(){return no||(no=new Promise((n,e)=>{try{let t=indexedDB.open(DI,NI);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Qt.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Ju,{keyPath:"compositeKey"})}}}catch(t){e(Qt.create("storage-open",{originalErrorMessage:t?.message}))}}),no)}function xI(n,e){return VI(LI(n),e)}function VI(n,e){return m(this,null,function*(){let r=(yield OI()).transaction(Ju,"readwrite"),s=r.objectStore(Ju).put({compositeKey:n,value:e});return new Promise((a,u)=>{s.onsuccess=l=>{a()},r.onerror=l=>{var d;u(Qt.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})})}function LI(n){return`${n.options.appId}-${n.name}`}var pi=new tt("@firebase/app-check");function Hu(n,e){return Fr()?xI(n,e).catch(t=>{pi.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ym(){return pm().enabled}function vm(){return m(this,null,function*(){let n=pm();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var MI={error:"UNKNOWN_ERROR"};function FI(n){return Qi.encodeString(JSON.stringify(n),!1)}function Xu(n,e=!1,t=!1){return m(this,null,function*(){let r=n.app;mm(r);let i=Ye(r),s=i.token,a;if(s&&!mi(s)&&(i.token=void 0,s=void 0),!s){let d=yield i.cachedTokenPromise;d&&(mi(d)?s=d:yield Hu(r,void 0))}if(!e&&s&&mi(s))return{token:s.token};let u=!1;if(ym())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=gm(_m(r,yield vm()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let d=yield i.exchangeTokenPromise;return yield Hu(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?pi.warn(d.message):t&&pi.error(d),Qu(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),s=yield Ye(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?pi.warn(d.message):t&&pi.error(d),a=d}let l;return s?a?mi(s)?l={token:s.token,internalError:a}:l=Qu(a):(l={token:s.token},i.token=s,yield Hu(r,s)):l=Qu(a),u&&$I(r,l),l})}function UI(n){return m(this,null,function*(){let e=n.app;mm(e);let{provider:t}=Ye(e);if(ym()){let r=yield vm(),{token:i}=yield gm(_m(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function BI(n,e,t,r){let{app:i}=n,s=Ye(i),a={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&mi(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),dm(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>dm(n))}function Im(n,e){let t=Ye(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function dm(n){let{app:e}=n,t=Ye(e),r=t.tokenRefresher;r||(r=qI(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function qI(n){let{app:e}=n;return new Yu(()=>m(null,null,function*(){let t=Ye(e),r;if(t.token?r=yield Xu(n,!0):r=yield Xu(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ye(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},hm.RETRIAL_MIN_WAIT,hm.RETRIAL_MAX_WAIT)}function $I(n,e){let t=Ye(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function mi(n){return n.expireTimeMillis-Date.now()>0}function Qu(n){return{token:FI(MI),error:n}}var Zu=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ye(this.app);for(let t of e)Im(this.app,t.next);return Promise.resolve()}};function jI(n,e){return new Zu(n,e)}function zI(n){return{getToken:e=>Xu(n,e),getLimitedUseToken:()=>UI(n),addTokenListener:e=>BI(n,"INTERNAL",e),removeTokenListener:e=>Im(n.app,e)}}var WI="@firebase/app-check",GI="0.10.1";var KI="app-check",fm="app-check-internal";function HI(){Ge(new ke(KI,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return jI(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(fm).initialize()})),Ge(new ke(fm,n=>{let e=n.getProvider("app-check").getImmediate();return zI(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),se(WI,GI)}HI();var QI="app-check";var dr=class{constructor(){return hr(QI)}};var YI=["localhost","0.0.0.0","127.0.0.1"],Ab=typeof window<"u"&&YI.includes(window.location.hostname);function Lm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Mm=Lm,Fm=new We("auth","Firebase",Lm());var co=new tt("@firebase/auth");function JI(n,...e){co.logLevel<=W.WARN&&co.warn(`Auth (${Mt}): ${n}`,...e)}function io(n,...e){co.logLevel<=W.ERROR&&co.error(`Auth (${Mt}): ${n}`,...e)}function $e(n,...e){throw El(n,...e)}function Je(n,...e){return El(n,...e)}function wl(n,e,t){let r=Object.assign(Object.assign({},Mm()),{[e]:t});return new We("auth","Firebase",r).create(e,{appName:n.name})}function bt(n){return wl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function XI(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&$e(n,"argument-error"),wl(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function El(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Fm.create(n,...e)}function F(n,e,...t){if(!n)throw El(e,...t)}function Tt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw io(e),new Error(e)}function St(n,e){n||Tt(e)}function nl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function ZI(){return wm()==="http:"||wm()==="https:"}function wm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function ew(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(ZI()||id()||"connection"in navigator)?navigator.onLine:!0}function tw(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Pn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,St(t>e,"Short delay should be less than long delay!"),this.isMobile=nd()||sd()}get(){return ew()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Tl(n,e){St(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var uo=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var nw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var rw=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],iw=new Pn(3e4,6e4);function Xt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Rt(s,a,u,l){return m(this,arguments,function*(n,e,t,r,i={}){return Um(n,i,()=>m(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let _=Mn(Object.assign({key:n.config.apiKey},p)).slice(1),v=yield n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:v},d);return rd()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Vt(n.emulatorConfig.host)&&(R.credentials="include"),uo.fetch()(yield Bm(n,n.config.apiHost,t,_),R)}))})}function Um(n,e,t){return m(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},nw),e);try{let i=new rl(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw ro(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let u=s.ok?a.errorMessage:a.error.message,[l,d]=u.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw ro(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw ro(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw ro(n,"user-disabled",a);let p=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw wl(n,p,d);$e(n,p)}}catch(i){if(i instanceof xe)throw i;$e(n,"network-request-failed",{message:String(i)})}})}function Ti(s,a,u,l){return m(this,arguments,function*(n,e,t,r,i={}){let d=yield Rt(n,e,t,r,i);return"mfaPendingCredential"in d&&$e(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Bm(n,e,t,r){return m(this,null,function*(){let i=`${e}${t}?${r}`,s=n,a=s.config.emulator?Tl(n.config,i):`${n.config.apiScheme}://${i}`;return rw.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a})}function sw(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var rl=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Je(this.auth,"network-request-failed")),iw.get())})}};function ro(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Je(n,e,r);return i.customData._tokenResponse=t,i}function Em(n){return n!==void 0&&n.enterprise!==void 0}var il=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return sw(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function ow(n,e){return m(this,null,function*(){return Rt(n,"GET","/v2/recaptchaConfig",Xt(n,e))})}function aw(n,e){return m(this,null,function*(){return Rt(n,"POST","/v1/accounts:delete",e)})}function lo(n,e){return m(this,null,function*(){return Rt(n,"POST","/v1/accounts:lookup",e)})}function _i(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Al(n,e=!1){return m(this,null,function*(){let t=ne(n),r=yield t.getIdToken(e),i=bl(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:_i(el(i.auth_time)),issuedAtTime:_i(el(i.iat)),expirationTime:_i(el(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function el(n){return Number(n)*1e3}function bl(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return io("JWT malformed, contained fewer than 3 sections"),null;try{let i=Yi(t);return i?JSON.parse(i):(io("Failed to decode base64 JWT payload"),null)}catch(i){return io("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Tm(n){let e=bl(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function pr(n,e,t=!1){return m(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof xe&&cw(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function cw({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var sl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>m(this,null,function*(){yield this.iteration()}),t)}iteration(){return m(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var vi=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_i(this.lastLoginAt),this.creationTime=_i(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ho(n){return m(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield pr(n,lo(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?qm(s.providerUserInfo):[],u=uw(n.providerData,a),l=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!u?.length,p=l?d:!1,_={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:u,metadata:new vi(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,_)})}function Sl(n){return m(this,null,function*(){let e=ne(n);yield ho(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function uw(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function qm(n){return n.map(e=>{var{providerId:t}=e,r=Wi(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function lw(n,e){return m(this,null,function*(){let t=yield Um(n,{},()=>m(null,null,function*(){let r=Mn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=yield Bm(n,i,"/v1/token",`key=${s}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:u,body:r};return n.emulatorConfig&&Vt(n.emulatorConfig.host)&&(l.credentials="include"),uo.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function hw(n,e){return m(this,null,function*(){return Rt(n,"POST","/v2/accounts:revokeToken",Xt(n,e))})}var yi=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Tm(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=Tm(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return m(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return m(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield lw(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Tt("not implemented")}};function Yt(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Jt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Wi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new sl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new vi(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return m(this,null,function*(){let t=yield pr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Al(this,e)}reload(){return Sl(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return m(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ho(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return m(this,null,function*(){if(De(this.auth.app))return Promise.reject(bt(this.auth));let e=yield this.getIdToken();return yield pr(this,aw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,u,l,d,p;let _=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(i=t.email)!==null&&i!==void 0?i:void 0,R=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(u=t.tenantId)!==null&&u!==void 0?u:void 0,D=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:J,isAnonymous:Re,providerData:Y,stsTokenManager:E}=t;F(j&&E,e,"internal-error");let g=yi.fromJSON(this.name,E);F(typeof j=="string",e,"internal-error"),Yt(_,e.name),Yt(v,e.name),F(typeof J=="boolean",e,"internal-error"),F(typeof Re=="boolean",e,"internal-error"),Yt(R,e.name),Yt(k,e.name),Yt(x,e.name),Yt(D,e.name),Yt($,e.name),Yt(U,e.name);let I=new n({uid:j,auth:e,email:v,emailVerified:J,displayName:_,isAnonymous:Re,photoURL:k,phoneNumber:R,tenantId:x,stsTokenManager:g,createdAt:$,lastLoginAt:U});return Y&&Array.isArray(Y)&&(I.providerData=Y.map(w=>Object.assign({},w))),D&&(I._redirectEventId=D),I}static _fromIdTokenResponse(e,t,r=!1){return m(this,null,function*(){let i=new yi;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield ho(s),s})}static _fromGetAccountInfoResponse(e,t,r){return m(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?qm(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,u=new yi;u.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new vi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,d),l})}};var Am=new Map;function At(n){St(n instanceof Function,"Expected a class definition");let e=Am.get(n);return e?(St(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Am.set(n,e),e)}var dw=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return m(this,null,function*(){return!0})}_set(t,r){return m(this,null,function*(){this.storage[t]=r})}_get(t){return m(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return m(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),ol=dw;function so(n,e,t){return`firebase:${n}:${e}:${t}`}var fo=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=so(this.userKey,i.apiKey,s),this.fullPersistenceKey=so("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return m(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield lo(this.auth,{idToken:e}).catch(()=>{});return t?Jt._fromGetAccountInfoResponse(this.auth,t,e):null}return Jt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return m(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return m(this,null,function*(){if(!t.length)return new n(At(ol),e,r);let i=(yield Promise.all(t.map(d=>m(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||At(ol),a=so(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let _;if(typeof p=="string"){let v=yield lo(e,{idToken:p}).catch(()=>{});if(!v)break;_=yield Jt._fromGetAccountInfoResponse(e,v,p)}else _=Jt._fromJSON(e,p);d!==s&&(u=_),s=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],u&&(yield s._set(a,u.toJSON())),yield Promise.all(t.map(d=>m(null,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function bm(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Wm(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($m(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Km(e))return"Blackberry";if(Hm(e))return"Webos";if(jm(e))return"Safari";if((e.includes("chrome/")||zm(e))&&!e.includes("edge/"))return"Chrome";if(Gm(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function $m(n=pe()){return/firefox\//i.test(n)}function jm(n=pe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zm(n=pe()){return/crios\//i.test(n)}function Wm(n=pe()){return/iemobile/i.test(n)}function Gm(n=pe()){return/android/i.test(n)}function Km(n=pe()){return/blackberry/i.test(n)}function Hm(n=pe()){return/webos/i.test(n)}function Rl(n=pe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function fw(n=pe()){var e;return Rl(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function pw(){return od()&&document.documentMode===10}function Qm(n=pe()){return Rl(n)||Gm(n)||Hm(n)||Km(n)||/windows phone/i.test(n)||Wm(n)}function Ym(n,e=[]){let t;switch(n){case"Browser":t=bm(pe());break;case"Worker":t=`${bm(pe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Mt}/${r}`}var al=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,u)=>{try{let l=e(s);a(l)}catch(l){u(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return m(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function mw(t){return m(this,arguments,function*(n,e={}){return Rt(n,"GET","/v2/passwordPolicy",Xt(n,e))})}var gw=6,cl=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:gw,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,u;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(u=l.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var ul=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new po(this),this.idTokenSubscription=new po(this),this.beforeStateQueue=new al(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=At(t)),this._initializationPromise=this.queue(()=>m(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield fo.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return m(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return m(this,null,function*(){try{let t=yield lo(this,{idToken:e}),r=yield Jt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return m(this,null,function*(){var t;if(De(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===u)&&l?.user&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return m(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return m(this,null,function*(){try{yield ho(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=tw()}_delete(){return m(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return m(this,null,function*(){if(De(this.app))return Promise.reject(bt(this));let t=e?ne(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return m(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>m(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return m(this,null,function*(){return De(this.app)?Promise.reject(bt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return De(this.app)?Promise.reject(bt(this)):this.queue(()=>m(this,null,function*(){yield this.assertedPersistence.setPersistence(At(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return m(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return m(this,null,function*(){let e=yield mw(this),t=new cl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new We("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return m(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield hw(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return m(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return m(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&At(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield fo.create(this,[At(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return m(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>m(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return m(this,null,function*(){if(e===this.currentUser)return this.queue(()=>m(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(u,this,"internal-error"),u.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return m(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ym(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return m(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return m(this,null,function*(){var e;if(De(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&JI(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Zt(n){return ne(n)}var po=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=ld(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var To={loadJS(){return m(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _w(n){To=n}function Jm(n){return To.loadJS(n)}function yw(){return To.recaptchaEnterpriseScript}function vw(){return To.gapiScript}function Xm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var ll=class{constructor(){this.enterprise=new hl}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},hl=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var Iw="recaptcha-enterprise",Zm="NO_RECAPTCHA",dl=class{constructor(e){this.type=Iw,this.auth=Zt(e)}verify(e="verify",t=!1){return m(this,null,function*(){function r(s){return m(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,u)=>m(null,null,function*(){ow(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{let d=new il(l);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(l=>{u(l)})}))})}function i(s,a,u){let l=window.grecaptcha;Em(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(Zm)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ll().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(u=>{if(!t&&Em(window.grecaptcha))i(u,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=yw();l.length!==0&&(l+=u),Jm(l).then(()=>{i(u,s,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})})}};function gi(n,e,t,r=!1,i=!1){return m(this,null,function*(){let s=new dl(n),a;if(i)a=Zm;else try{a=yield s.verify(t)}catch{a=yield s.verify(t,!0)}let u=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){let l=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){let l=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u})}function fl(n,e,t,r,i){return m(this,null,function*(){var s,a;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let u=yield gi(n,e,t,t==="getOobCode");return r(n,u)}else return r(n,e).catch(u=>m(null,null,function*(){if(u.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let l=yield gi(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(u)}));else if(i==="PHONE_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("PHONE_PROVIDER")){let u=yield gi(n,e,t);return r(n,u).catch(l=>m(null,null,function*(){var d;if(((d=n._getRecaptchaConfig())===null||d===void 0?void 0:d.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let p=yield gi(n,e,t,!1,!0);return r(n,p)}return Promise.reject(l)}))}else{let u=yield gi(n,e,t,!1,!0);return r(n,u)}else return Promise.reject(i+" provider is not supported.")})}function Pl(n,e){let t=Bn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(et(s,e??{}))return i;$e(i,"already-initialized")}return t.initialize({options:e})}function ww(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(At);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Cl(n,e,t){let r=Zt(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=eg(e),{host:a,port:u}=Ew(e),l=u===null?"":`:${u}`,d={url:`${s}//${a}${l}/`},p=Object.freeze({host:a,port:u,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(et(d,r.config.emulator)&&et(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Vt(a)?(Xi(`${s}//${a}${l}`),Zi("Auth",!0)):i||Tw()}function eg(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ew(n){let e=eg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Sm(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:Sm(a)}}}function Sm(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Tw(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var mr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Tt("not implemented")}_getIdTokenResponse(e){return Tt("not implemented")}_linkToIdToken(e,t){return Tt("not implemented")}_getReauthenticationResolver(e){return Tt("not implemented")}};function Aw(n,e){return m(this,null,function*(){return Rt(n,"POST","/v1/accounts:signUp",e)})}function bw(n,e){return m(this,null,function*(){return Ti(n,"POST","/v1/accounts:signInWithPassword",Xt(n,e))})}function Sw(n,e){return m(this,null,function*(){return Ti(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))})}function Rw(n,e){return m(this,null,function*(){return Ti(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))})}var Ii=class n extends mr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return m(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fl(e,t,"signInWithPassword",bw,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Sw(e,{email:this._email,oobCode:this._password});default:$e(e,"internal-error")}})}_linkToIdToken(e,t){return m(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fl(e,r,"signUpPassword",Aw,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Rw(e,{idToken:t,email:this._email,oobCode:this._password});default:$e(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function fr(n,e){return m(this,null,function*(){return Ti(n,"POST","/v1/accounts:signInWithIdp",Xt(n,e))})}var Pw="http://localhost",mo=class n extends mr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):$e("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=Wi(t,["providerId","signInMethod"]);if(!r||!i)return null;let a=new n(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){let t=this.buildRequest();return fr(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,fr(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,fr(e,t)}buildRequest(){let e={requestUri:Pw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Mn(t)}return e}};function Cw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function kw(n){let e=Fn(Un(n)).link,t=e?Fn(Un(e)).deep_link_id:null,r=Fn(Un(n)).deep_link_id;return(r?Fn(Un(r)).link:null)||r||t||e||n}var go=class n{constructor(e){var t,r,i,s,a,u;let l=Fn(Un(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,p=(r=l.oobCode)!==null&&r!==void 0?r:null,_=Cw((i=l.mode)!==null&&i!==void 0?i:null);F(d&&p&&_,"argument-error"),this.apiKey=d,this.operation=_,this.code=p,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.lang)!==null&&a!==void 0?a:null,this.tenantId=(u=l.tenantId)!==null&&u!==void 0?u:null}static parseLink(e){let t=kw(e);try{return new n(t)}catch{return null}}};var tg=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Ii._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=go.parseLink(r);return F(i,"argument-error"),Ii._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),wi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var _o=class extends wi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var Dw=(()=>{class n extends _o{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return mo._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();function Nw(n,e){return m(this,null,function*(){return Ti(n,"POST","/v1/accounts:signUp",Xt(n,e))})}var gr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return m(this,null,function*(){let s=yield Jt._fromIdTokenResponse(e,r,i),a=Rm(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return m(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Rm(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Rm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var pl=class n extends xe{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function ng(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?pl._fromErrorAndOperation(n,s,e,r):s})}function Ow(n,e,t=!1){return m(this,null,function*(){let r=yield pr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return gr._forOperation(n,"link",r)})}function xw(n,e,t=!1){return m(this,null,function*(){let{auth:r}=n;if(De(r.app))return Promise.reject(bt(r));let i="reauthenticate";try{let s=yield pr(n,ng(r,i,e,n),t);F(s.idToken,r,"internal-error");let a=bl(s.idToken);F(a,r,"internal-error");let{sub:u}=a;return F(n.uid===u,r,"user-mismatch"),gr._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&$e(r,"user-mismatch"),s}})}function rg(n,e,t=!1){return m(this,null,function*(){if(De(n.app))return Promise.reject(bt(n));let r="signIn",i=yield ng(n,r,e),s=yield gr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function kl(n,e){return m(this,null,function*(){return rg(Zt(n),e)})}function ig(n){return m(this,null,function*(){let e=Zt(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Dl(n,e,t){return m(this,null,function*(){if(De(n.app))return Promise.reject(bt(n));let r=Zt(n),a=yield fl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Nw,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&ig(n),l}),u=yield gr._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(u.user),u})}function Nl(n,e,t){return De(n.app)?Promise.reject(bt(n)):kl(ne(n),tg.credential(e,t)).catch(r=>m(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&ig(n),r}))}function Vw(n,e){return m(this,null,function*(){return Rt(n,"POST","/v1/accounts:update",e)})}function Ol(r,i){return m(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ne(n),u={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},l=yield pr(s,Vw(s.auth,u));s.displayName=l.displayName||null,s.photoURL=l.photoUrl||null;let d=s.providerData.find(({providerId:p})=>p==="password");d&&(d.displayName=s.displayName,d.photoURL=s.photoURL),yield s._updateTokensIfNecessary(l)})}function Ai(n,e,t,r){return ne(n).onIdTokenChanged(e,t,r)}function xl(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function Vl(n){return ne(n).signOut()}var yo="__sak";var vo=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yo,"1"),this.storage.removeItem(yo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Lw=1e3,Mw=10,Fw=(()=>{class n extends vo{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Qm(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,l,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);pw()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,Mw):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Lw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return m(this,null,function*(){yield Ot(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return m(this,null,function*(){let r=yield Ot(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return m(this,null,function*(){yield Ot(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),sg=Fw;var Uw=(()=>{class n extends vo{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Ll=Uw;function Bw(n){return Promise.all(n.map(e=>m(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var qw=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return m(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,u=this.handlersMap[s];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let l=Array.from(u).map(p=>m(this,null,function*(){return p(r.origin,a)})),d=yield Bw(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Ml(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var ml=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return m(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((u,l)=>{let d=Ml("",20);i.port1.start();let p=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(_){let v=_;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),u(v.data.response);break;default:clearTimeout(p),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function ct(){return window}function $w(n){ct().location.href=n}function og(){return typeof ct().WorkerGlobalScope<"u"&&typeof ct().importScripts=="function"}function jw(){return m(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function zw(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Ww(){return og()?self:null}var ag="firebaseLocalStorageDb",Gw=1,Io="firebaseLocalStorage",cg="fbase_key",Cn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Ao(n,e){return n.transaction([Io],e?"readwrite":"readonly").objectStore(Io)}function Kw(){let n=indexedDB.deleteDatabase(ag);return new Cn(n).toPromise()}function gl(){let n=indexedDB.open(ag,Gw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Io,{keyPath:cg})}catch(i){t(i)}}),n.addEventListener("success",()=>m(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Io)?e(r):(r.close(),yield Kw(),e(yield gl()))}))})}function Pm(n,e,t){return m(this,null,function*(){let r=Ao(n,!0).put({[cg]:e,value:t});return new Cn(r).toPromise()})}function Hw(n,e){return m(this,null,function*(){let t=Ao(n,!1).get(e),r=yield new Cn(t).toPromise();return r===void 0?null:r.value})}function Cm(n,e){let t=Ao(n,!0).delete(e);return new Cn(t).toPromise()}var Qw=800,Yw=3,Jw=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return m(this,null,function*(){return this.db?this.db:(this.db=yield gl(),this.db)})}_withRetries(t){return m(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>Yw)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return m(this,null,function*(){return og()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return m(this,null,function*(){this.receiver=qw._getInstance(Ww()),this.receiver._subscribe("keyChanged",(t,r)=>m(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>m(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return m(this,null,function*(){var t,r;if(this.activeServiceWorker=yield jw(),!this.activeServiceWorker)return;this.sender=new ml(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return m(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||zw()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return m(this,null,function*(){try{if(!indexedDB)return!1;let t=yield gl();return yield Pm(t,yo,"1"),yield Cm(t,yo),!0}catch{}return!1})}_withPendingWrite(t){return m(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(i=>Pm(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return m(this,null,function*(){let r=yield this._withRetries(i=>Hw(i,t));return this.localCache[t]=r,r})}_remove(t){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(r=>Cm(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return m(this,null,function*(){let t=yield this._withRetries(s=>{let a=Ao(s,!1).getAll();return new Cn(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>m(this,null,function*(){return this._poll()}),Qw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),ug=Jw;var Nb=Xm("rcb"),Ob=new Pn(3e4,6e4);function lg(n,e){return e?At(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Ei=class extends mr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Xw(n){return rg(n.auth,new Ei(n),n.bypassAuthState)}function Zw(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),xw(t,new Ei(n),n.bypassAuthState)}function eE(n){return m(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Ow(t,new Ei(n),n.bypassAuthState)})}var wo=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>m(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return m(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:u}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(l))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xw;case"linkViaPopup":case"linkViaRedirect":return eE;case"reauthViaPopup":case"reauthViaRedirect":return Zw;default:$e(this.auth,"internal-error")}}resolve(e){St(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){St(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var tE=new Pn(2e3,1e4);function Fl(n,e,t){return m(this,null,function*(){if(De(n.app))return Promise.reject(Je(n,"operation-not-supported-in-this-environment"));let r=Zt(n);XI(n,e,wi);let i=lg(r,t);return new nE(r,"signInViaPopup",e,i).executeNotNull()})}var nE=(()=>{class n extends wo{constructor(t,r,i,s,a){super(t,r,s,a),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return m(this,null,function*(){let t=yield this.execute();return F(t,this.auth,"internal-error"),t})}onExecution(){return m(this,null,function*(){St(this.filter.length===1,"Popup operations only handle one event");let t=Ml();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Je(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Je(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Je(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,tE.get())};t()}}n.currentPopupAction=null;return n})(),rE="pendingRedirect",oo=new Map,_l=class n extends wo{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return m(this,null,function*(){let e=oo.get(this.auth._key());if(!e){try{let r=(yield iE(this.resolver,this.auth))?yield Ot(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}oo.set(this.auth._key(),e)}return this.bypassAuthState||oo.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return m(this,null,function*(){if(e.type==="signInViaRedirect")return Ot(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Ot(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return m(this,null,function*(){})}cleanUp(){}};function iE(n,e){return m(this,null,function*(){let t=aE(e),r=oE(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function sE(n,e){oo.set(n._key(),e)}function oE(n){return At(n._redirectPersistence)}function aE(n){return so(rE,n.config.apiKey,n.name)}function cE(n,e,t=!1){return m(this,null,function*(){if(De(n.app))return Promise.reject(bt(n));let r=Zt(n),i=lg(r,e),a=yield new _l(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var uE=600*1e3,yl=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!hg(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Je(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=uE&&this.cachedEventUids.clear(),this.cachedEventUids.has(km(e))}saveEventToCache(e){this.cachedEventUids.add(km(e)),this.lastProcessedEventTime=Date.now()}};function km(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function hg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function lE(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hg(n);default:return!1}}function hE(t){return m(this,arguments,function*(n,e={}){return Rt(n,"GET","/v1/projects",e)})}var dE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fE=/^https?/;function pE(n){return m(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield hE(n);for(let t of e)try{if(mE(t))return}catch{}$e(n,"unauthorized-domain")})}function mE(n){let e=nl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!fE.test(t))return!1;if(dE.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var gE=new Pn(3e4,6e4);function Dm(){let n=ct().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function _E(n){return new Promise((e,t)=>{var r,i,s;function a(){Dm(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Dm(),t(Je(n,"network-request-failed"))},timeout:gE.get()})}if(!((i=(r=ct().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=ct().gapi)===null||s===void 0)&&s.load)a();else{let u=Xm("iframefcb");return ct()[u]=()=>{gapi.load?a():t(Je(n,"network-request-failed"))},Jm(`${vw()}?onload=${u}`).catch(l=>t(l))}}).catch(e=>{throw ao=null,e})}var ao=null;function yE(n){return ao=ao||_E(n),ao}var vE=new Pn(5e3,15e3),IE="__/auth/iframe",wE="emulator/auth/iframe",EE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AE(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Tl(e,wE):`https://${n.config.authDomain}/${IE}`,r={apiKey:e.apiKey,appName:n.name,v:Mt},i=TE.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Mn(r).slice(1)}`}function bE(n){return m(this,null,function*(){let e=yield yE(n),t=ct().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:AE(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:EE,dontclear:!0},r=>new Promise((i,s)=>m(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=Je(n,"network-request-failed"),u=ct().setTimeout(()=>{s(a)},vE.get());function l(){ct().clearTimeout(u),i(r)}r.ping(l).then(l,()=>{s(a)})})))})}var SE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},RE=500,PE=600,CE="_blank",kE="http://localhost",Eo=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function DE(n,e,t,r=RE,i=PE){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",l=Object.assign(Object.assign({},SE),{width:r.toString(),height:i.toString(),top:s,left:a}),d=pe().toLowerCase();t&&(u=zm(d)?CE:t),$m(d)&&(e=e||kE,l.scrollbars="yes");let p=Object.entries(l).reduce((v,[R,k])=>`${v}${R}=${k},`,"");if(fw(d)&&u!=="_self")return NE(e||"",u),new Eo(null);let _=window.open(e||"",u,p);F(_,n,"popup-blocked");try{_.focus()}catch{}return new Eo(_)}function NE(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var OE="__/auth/handler",xE="emulator/auth/handler",VE=encodeURIComponent("fac");function Nm(n,e,t,r,i,s){return m(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Mt,eventId:i};if(e instanceof wi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ud(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,_]of Object.entries(s||{}))a[p]=_}if(e instanceof _o){let p=e.getScopes().filter(_=>_!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let l=yield n._getAppCheckToken(),d=l?`#${VE}=${encodeURIComponent(l)}`:"";return`${LE(n)}?${Mn(u).slice(1)}${d}`})}function LE({config:n}){return n.emulator?Tl(n,xE):`https://${n.authDomain}/${OE}`}var tl="webStorageSupport",vl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ll,this._completeRedirectFn=cE,this._overrideRedirectResult=sE}_openPopup(e,t,r,i){return m(this,null,function*(){var s;St((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield Nm(e,t,r,nl(),i);return DE(e,a,Ml())})}_openRedirect(e,t,r,i){return m(this,null,function*(){yield this._originValidation(e);let s=yield Nm(e,t,r,nl(),i);return $w(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(St(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return m(this,null,function*(){let t=yield bE(e),r=new yl(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tl,{type:tl},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[tl];a!==void 0&&t(!!a),$e(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=pE(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Qm()||jm()||Rl()}},dg=vl;var Om="@firebase/auth",xm="1.10.8";var Il=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return m(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function ME(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function FE(n){Ge(new ke("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ym(n)},d=new ul(r,i,s,l);return ww(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ge(new ke("auth-internal",e=>{let t=Zt(e.getProvider("auth").getImmediate());return(r=>new Il(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),se(Om,xm,ME(n)),se(Om,xm,"esm2017")}var UE=300,BE=oa("authIdTokenMaxAge")||UE,Vm=null,qE=n=>e=>m(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>BE)return;let i=t?.token;Vm!==i&&(Vm=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Ul(n=un()){let e=Bn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Pl(n,{popupRedirectResolver:dg,persistence:[ug,sg,Ll]}),r=oa("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=qE(s.toString());xl(t,a,()=>a(t.currentUser)),Ai(t,u=>a(u))}}let i=ia("auth");return i&&Cl(t,`http://${i}`),t}function $E(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}_w({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=Je("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",$E().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});FE("Browser");function mg(n){return new on(function(e){var t=Ai(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var gg="auth",bi=class{constructor(e){return e}},Si=class{constructor(){return hr(gg)}};var Bl=new Vn("angularfire2.auth-instances");function RT(n,e){let t=fi(gg,n,e);return t&&new bi(t)}function PT(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new bi(r)}}var CT={provide:Si,deps:[[new Fe,Bl]]},kT={provide:bi,useFactory:RT,deps:[[new Fe,Bl],Et]};function b0(n,...e){return se("angularfire",Kt.full,"auth"),Ln([kT,CT,{provide:Bl,useFactory:PT(n),multi:!0,deps:[Ze,xt,Ht,Rn,[new Fe,dr],...e]}])}var S0=Z(mg,!0);var R0=Z(Dl,!0,2);var P0=Z(Ul,!0);var C0=Z(Nl,!0,2);var k0=Z(Fl,!0,2);var D0=Z(Vl,!0,2);var N0=Z(Ol,!0,2);var kn=class{constructor(e){return e}},_g="firestore",ql=class{constructor(){return hr(_g)}};var $l=new Vn("angularfire2.firestore-instances");function DT(n,e){let t=fi(_g,n,e);return t&&new kn(t)}function NT(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new kn(r)}}var OT={provide:ql,deps:[[new Fe,$l]]},xT={provide:kn,useFactory:DT,deps:[[new Fe,$l],Et]};function OS(n,...e){return se("angularfire",Kt.full,"fst"),Ln([xT,OT,{provide:$l,useFactory:NT(n),multi:!0,deps:[Ze,xt,Ht,Rn,[new Fe,Si],[new Fe,dr],...e]}])}var xS=Z(im,!0,2);var ae=Z(Up,!0,2),VS=Z(Bp,!0,2);var en=Z(rm,!0,2);var _e=Z($u,!0,2);var bo=Z(Zp,!0);var Ne=Z(em,!0);var LS=Z(qp,!0);var yg=Z(sm,!0);var MS=Z(Jp,!0,2),vg=Z(Qp,!0,2);var Pt=Z(tm,!0,2);var Ri=Z(nm,!0,2);var Ig=Z(Yp,!0,2),FS=Z(am,!0,2);var wg=class n{firestore=ze(kn);createCompany(e){return m(this,null,function*(){try{let t=_e(ae(this.firestore,"companies")),r=new Date,i=Xe(Te({},e),{id:t.id,smtpConfig:e.smtpConfig||{host:"smtp.gmail.com",port:587,secure:!1,user:"",password:"",fromName:e.name,fromEmail:e.contactEmail||""},apiConfig:{enabled:!0,token:this.generateApiToken(),endpoint:`https://${e.subdomain}.taskboard.com.br/api/v1/lead-intake`,webhookUrl:""},features:this.getFeaturesByPlan(e.plan),status:"active",createdAt:r,updatedAt:r});return yield Pt(t,i),yield this.createDefaultSettings(t.id,e.ownerId),t.id}catch(t){throw console.error("Erro ao criar empresa:",t),t}})}getCompanyBySubdomain(e){return m(this,null,function*(){try{let t=ae(this.firestore,"companies"),r=vg(t,Ig("subdomain","==",e)),i=yield Ne(r);if(i.empty)return null;let s=i.docs[0];return Te({id:s.id},s.data())}catch(t){throw console.error("Erro ao buscar empresa por subdom\xEDnio:",t),t}})}getCompany(e){return m(this,null,function*(){try{let t=_e(this.firestore,"companies",e),r=yield bo(t);return r.exists()?Te({id:r.id},r.data()):null}catch(t){throw console.error("Erro ao buscar empresa:",t),t}})}updateCompany(e,t){return m(this,null,function*(){try{let r=_e(this.firestore,"companies",e);yield Ri(r,Xe(Te({},t),{updatedAt:new Date}))}catch(r){throw console.error("Erro ao atualizar empresa:",r),r}})}addUserToCompany(e,t,r){return m(this,null,function*(){try{let i=_e(this.firestore,"companies",e,"users",t),s={uid:"",email:t,displayName:"",role:r,permissions:this.getPermissionsByRole(r),joinedAt:new Date};yield Pt(i,s)}catch(i){throw i}})}getCompanyUsers(e){return m(this,null,function*(){try{let t=ae(this.firestore,"companies",e,"users");return(yield Ne(t)).docs.map(s=>Te({uid:s.id},s.data()))}catch{return[]}})}removeUserFromCompany(e,t){return m(this,null,function*(){try{let r=_e(this.firestore,"companies",e,"users",t);yield en(r)}catch(r){throw console.error("Erro ao remover usu\xE1rio da empresa:",r),r}})}updateUserRole(e,t,r){return m(this,null,function*(){try{let i=_e(this.firestore,"companies",e,"users",t);yield Ri(i,{role:r,permissions:this.getPermissionsByRole(r)})}catch(i){throw console.error("Erro ao atualizar fun\xE7\xE3o do usu\xE1rio:",i),i}})}deleteCompany(e){return m(this,null,function*(){try{let t=ae(this.firestore,"companies",e,"users"),r=yield Ne(t);for(let d of r.docs)yield en(d.ref);let i=_e(this.firestore,"companies",e,"settings","general");(yield bo(i)).exists()&&(yield en(i));let a=ae(this.firestore,"companies",e,"boards"),u=yield Ne(a);for(let d of u.docs){let p=d.id,_=ae(this.firestore,"companies",e,"boards",p,"columns"),v=yield Ne(_);for(let x of v.docs)yield en(x.ref);let R=ae(this.firestore,"companies",e,"boards",p,"leads"),k=yield Ne(R);for(let x of k.docs)yield en(x.ref);yield en(d.ref)}let l=_e(this.firestore,"companies",e);yield en(l)}catch(t){throw console.error("Erro ao excluir empresa:",t),t}})}createDefaultSettings(e,t){return m(this,null,function*(){try{let r=_e(this.firestore,"companies",e,"settings","general");yield Pt(r,{companyId:e,timezone:"America/Sao_Paulo",language:"pt-BR",dateFormat:"DD/MM/YYYY",notifications:{emailOnNewLead:!0,emailOnLeadMove:!0,emailOnLeadComment:!1},formSettings:{allowPublicForm:!0,requireCaptcha:!1,thankyouMessage:"Obrigado! Entraremos em contato em breve."}})}catch(r){throw console.error("Erro ao criar configura\xE7\xF5es padr\xE3o:",r),r}})}getCompanySettings(e){return m(this,null,function*(){try{let t=_e(this.firestore,"companies",e,"settings","general"),r=yield bo(t);return r.exists()?r.data():null}catch(t){throw console.error("Erro ao buscar configura\xE7\xF5es da empresa:",t),t}})}updateCompanySettings(e,t){return m(this,null,function*(){try{let r=_e(this.firestore,"companies",e,"settings","general");yield Ri(r,t)}catch(r){throw console.error("Erro ao atualizar configura\xE7\xF5es da empresa:",r),r}})}isSubdomainAvailable(e){return m(this,null,function*(){try{return(yield this.getCompanyBySubdomain(e))===null}catch(t){return console.error("Erro ao verificar disponibilidade do subdom\xEDnio:",t),!1}})}seedGobuyerCompany(){return m(this,null,function*(){try{let e=yield this.getCompanyBySubdomain("gobuyer");if(e){console.log("Empresa Gobuyer j\xE1 existe:",e.id);return}console.log("Criando empresa Gobuyer...");let t={subdomain:"gobuyer",name:"Gobuyer Digital",contactEmail:"contato@gobuyer.com.br",contactPhone:"+55 11 99999-9999",address:"S\xE3o Paulo, SP",cnpj:"12.345.678/0001-90",plan:"professional",status:"active",ownerId:"system",ownerEmail:"geovane.lopes@gobuyer.com.br",maxUsers:50,maxBoards:100,smtpConfig:{host:"smtp.gmail.com",port:587,secure:!1,user:"",password:"",fromName:"Gobuyer Digital",fromEmail:"contato@gobuyer.com.br"},apiConfig:{enabled:!0,token:this.generateApiToken(),endpoint:"https://gobuyer.taskboard.com.br/api/v1/lead-intake",webhookUrl:""},features:this.getFeaturesByPlan("professional"),brandingConfig:{primaryColor:"#3B82F6",secondaryColor:"#1E40AF",logo:"https://apps.gobuyer.com.br/sso/assets/images/logos/logo-gobuyer.png",favicon:"",customCSS:"",companyName:"Gobuyer Digital"}},r=yield this.createCompany(t);console.log("Empresa Gobuyer criada com ID:",r),yield this.migrateBoardsFromUsers(r)}catch(e){console.error("Erro ao criar empresa Gobuyer:",e)}})}getCompanySubdomain(){if(typeof window<"u"){let e=window.location.hostname;if(e==="localhost"||e==="127.0.0.1")return localStorage.getItem("dev-subdomain")||"gobuyer";if(e.includes("taskboard.com.br")){let t=e.split(".");if(t.length>=3)return t[0]}}return null}getCompanyByUserEmail(e){return m(this,null,function*(){try{let t=ae(this.firestore,"companies"),r=yield Ne(t);for(let i of r.docs){let s=i.data();if(s.ownerEmail===e)return Te({id:i.id},s);let a=ae(this.firestore,"companies",i.id,"users");if((yield Ne(a)).docs.some(d=>d.data().email===e))return Te({id:i.id},s)}return null}catch(t){return console.error("Erro ao buscar empresa do usu\xE1rio:",t),null}})}migrateExistingData(e){return m(this,null,function*(){try{console.log("Migrando dados existentes para a empresa Gobuyer...");let t=[{email:"geovane.lopes@gobuyer.com.br",role:"admin"},{email:"admin@gobuyer.com.br",role:"admin"},{email:"contato@gobuyer.com.br",role:"manager"},{email:"suporte@gobuyer.com.br",role:"user"}];for(let r of t)yield this.addUserToCompany(e,r.email,r.role);yield this.migrateLegacyBoards(e),console.log("Migra\xE7\xE3o de dados conclu\xEDda")}catch(t){console.error("Erro na migra\xE7\xE3o de dados:",t)}})}migrateLegacyBoards(e){return m(this,null,function*(){try{console.log("Migrando quadros existentes para a empresa Gobuyer...");let t=ae(this.firestore,"companies",e,"boards");(yield Ne(t)).empty?(yield this.migrateBoardsFromUsers(e))||(console.log("Nenhum quadro encontrado, criando quadro padr\xE3o da Gobuyer..."),yield this.createDefaultBoard(e)):(console.log("Quadros j\xE1 existem na nova estrutura"),yield this.updateBoardsWithCompanyId(e))}catch(t){console.error("Erro ao migrar quadros:",t)}})}migrateBoardsFromUsers(e){return m(this,null,function*(){try{let t=ae(this.firestore,"users"),r=yield Ne(t),i=!1;for(let s of r.docs){let a=s.id,u=ae(this.firestore,"users",a,"boards"),l=yield Ne(u);if(!l.empty){console.log(`Encontrados ${l.docs.length} quadros do usu\xE1rio ${a}`);for(let d of l.docs){let p=d.data(),_=_e(ae(this.firestore,"companies",e,"boards"));yield Pt(_,Xe(Te({},p),{companyId:e,migratedFrom:`users/${a}/boards/${d.id}`,migratedAt:new Date})),console.log(`Quadro migrado: ${p.name} -> ${_.id}`),yield this.migrateBoardColumns(a,d.id,e,_.id),yield this.migrateBoardLeads(a,d.id,e,_.id),i=!0}}}return i}catch(t){return console.error("Erro ao migrar quadros de usu\xE1rios:",t),!1}})}migrateBoardColumns(e,t,r,i){return m(this,null,function*(){try{let s=ae(this.firestore,"users",e,"boards",t,"columns"),a=yield Ne(s);for(let u of a.docs){let l=u.data(),d=_e(ae(this.firestore,"companies",r,"boards",i,"columns"));yield Pt(d,Xe(Te({},l),{companyId:r,migratedFrom:`users/${e}/boards/${t}/columns/${u.id}`}))}console.log(`Colunas migradas para o quadro ${i}`)}catch(s){console.error("Erro ao migrar colunas:",s)}})}migrateBoardLeads(e,t,r,i){return m(this,null,function*(){try{let s=ae(this.firestore,"users",e,"boards",t,"leads"),a=yield Ne(s);for(let u of a.docs){let l=u.data(),d=_e(ae(this.firestore,"companies",r,"boards",i,"leads"));yield Pt(d,Xe(Te({},l),{companyId:r,migratedFrom:`users/${e}/boards/${t}/leads/${u.id}`}))}console.log(`Leads migrados para o quadro ${i}`)}catch(s){console.error("Erro ao migrar leads:",s)}})}createDefaultBoard(e){return m(this,null,function*(){let t={name:"Leads Gobuyer",description:"Quadro principal para gerenciamento de leads da Gobuyer Digital",companyId:e,createdAt:null},r=_e(ae(this.firestore,"companies",e,"boards"));yield Pt(r,t);let i=[{name:"Novo Lead",order:0,color:"#4A90E2",endStageType:"none"},{name:"Em Contato",order:1,color:"#F5A623",endStageType:"none"},{name:"Proposta Enviada",order:2,color:"#7ED321",endStageType:"none"},{name:"Fechado",order:3,color:"#50E3C2",endStageType:"won"},{name:"Perdido",order:4,color:"#D0021B",endStageType:"lost"}];for(let s of i){let a=_e(ae(this.firestore,"companies",e,"boards",r.id,"columns"));yield Pt(a,Xe(Te({},s),{companyId:e}))}console.log("Quadro padr\xE3o criado:",r.id)})}updateBoardsWithCompanyId(e){return m(this,null,function*(){try{let t=ae(this.firestore,"companies",e,"boards"),r=yield Ne(t);for(let i of r.docs){let s=i.data();s.companyId||(yield Ri(i.ref,{companyId:e}),console.log(`CompanyId adicionado ao quadro: ${s.name}`))}}catch(t){console.error("Erro ao atualizar quadros com companyId:",t)}})}generateApiToken(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*",t="";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}getFeaturesByPlan(e){switch(e){case"free":return{maxBoards:1,maxUsers:2,maxLeadsPerMonth:100,maxEmailsPerMonth:50,customBranding:!1,apiAccess:!1,webhooks:!1,advancedReports:!1,whiteLabel:!1};case"starter":return{maxBoards:3,maxUsers:5,maxLeadsPerMonth:1e3,maxEmailsPerMonth:500,customBranding:!0,apiAccess:!0,webhooks:!1,advancedReports:!1,whiteLabel:!1};case"professional":return{maxBoards:10,maxUsers:20,maxLeadsPerMonth:5e3,maxEmailsPerMonth:2500,customBranding:!0,apiAccess:!0,webhooks:!0,advancedReports:!0,whiteLabel:!1};case"enterprise":return{maxBoards:-1,maxUsers:-1,maxLeadsPerMonth:-1,maxEmailsPerMonth:-1,customBranding:!0,apiAccess:!0,webhooks:!0,advancedReports:!0,whiteLabel:!0};default:return this.getFeaturesByPlan("free")}}getPermissionsByRole(e){switch(e){case"admin":return["*"];case"manager":return["leads.read","leads.create","leads.update","leads.delete","boards.read","boards.create","boards.update","users.read","users.invite","templates.read","templates.create","templates.update","templates.delete","automations.read","automations.create","automations.update","automations.delete","reports.read"];case"user":return["leads.read","leads.create","leads.update","boards.read","templates.read","automations.read"];default:return["leads.read"]}}subscribeToCompany(e,t){let r=_e(this.firestore,"companies",e);return yg(r,i=>{i.exists()?t(Te({id:i.id},i.data())):t(null)})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Gi({token:n,factory:n.\u0275fac,providedIn:"root"})};export{ed as a,Vt as b,Xi as c,td as d,Zi as e,xe as f,ne as g,ke as h,Ge as i,Bn as j,De as k,Mt as l,un as m,se as n,Kt as o,fi as p,hr as q,Ht as r,Z as s,Et as t,Rn as u,tb as v,nb as w,dr as x,Dw as y,bi as z,Si as A,b0 as B,S0 as C,R0 as D,P0 as E,C0 as F,k0 as G,D0 as H,N0 as I,TA as J,kn as K,OS as L,xS as M,ae as N,VS as O,en as P,_e as Q,bo as R,Ne as S,LS as T,yg as U,MS as V,vg as W,Pt as X,Ri as Y,Ig as Z,FS as _,wg as $};
