import{a as me}from"./chunk-EFTP2LWP.js";import{A as ie,C as oe,H as ne,J as re,c as K,i as Q,l as H,m as J,t as W,u as X,v as Y,x as Z,y as ee,z as te}from"./chunk-XK5HOQP2.js";import"./chunk-ZHVOT3GW.js";import{F as ae,H as le,I as se}from"./chunk-OGGO43S6.js";import{Db as o,Eb as l,Fb as s,Gb as f,Kb as w,Lb as I,Lc as R,Mc as k,Nb as D,Nc as B,Oc as j,Pb as M,Pc as q,Rb as m,Tc as z,Ua as L,Xa as n,Xb as A,Yb as G,a as F,ac as p,b as P,bc as y,cc as U,f as N,fa as b,fb as $,kb as d,la as E,ma as T,mc as S,sc as V,va as C,vb as O}from"./chunk-D5KXDZZX.js";var ce=()=>[],de=()=>["Quente","Morno","Frio"];function ue(t,i){if(t&1&&(l(0,"div",12),f(1,"img",13),s()),t&2){let e=m();n(),o("src",e.companyLogo,L)}}function fe(t,i){if(t&1&&(l(0,"span",14),p(1),s()),t&2){let e=m();n(),y(e.companyName())}}function ge(t,i){t&1&&(l(0,"div",15),p(1,"Carregando..."),s())}function _e(t,i){t&1&&(l(0,"div",15),p(1,"Nenhum campo configurado para esta fase."),s())}function be(t,i){if(t&1&&f(0,"input",31),t&2){let e=m().$implicit;o("formControlName",e.name)}}function ye(t,i){if(t&1&&f(0,"input",32),t&2){let e=m().$implicit;o("formControlName",e.name)}}function ve(t,i){if(t&1&&f(0,"input",33),t&2){let e=m().$implicit;o("formControlName",e.name)}}function Ce(t,i){if(t&1&&f(0,"input",34),t&2){let e=m().$implicit;o("formControlName",e.name)}}function xe(t,i){if(t&1&&f(0,"textarea",35),t&2){let e=m().$implicit;o("formControlName",e.name)}}function he(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e.value),n(),y(e.label)}}function Fe(t,i){if(t&1&&(w(0),d(1,he,2,2,"option",39),I()),t&2){let e=m(2).$implicit;n(),o("ngForOf",e.options)}}function Se(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e),n(),y(e)}}function Ne(t,i){if(t&1&&d(0,Se,2,2,"option",39),t&2){let e=m(2).$implicit;o("ngForOf",e.options||S(1,ce))}}function we(t,i){if(t&1&&(l(0,"select",36)(1,"option",37),p(2,"Selecione..."),s(),d(3,Fe,2,1,"ng-container",38)(4,Ne,1,2,"ng-template",null,0,V),s()),t&2){let e=A(5),r=m().$implicit;o("formControlName",r.name),n(3),o("ngIf",r.options&&r.options.length&&typeof r.options[0]=="object")("ngIfElse",e)}}function Ie(t,i){if(t&1&&(l(0,"label",43),f(1,"input",44),l(2,"span"),p(3),s()()),t&2){let e=i.$implicit,r=m(2).$implicit;n(),o("value",(e==null?null:e.value)??e)("formControlName",r.name),O("name",r.name),n(2),y((e==null?null:e.label)??e)}}function Pe(t,i){if(t&1&&(l(0,"div",41),d(1,Ie,4,4,"label",42),s()),t&2){let e=m().$implicit;n(),o("ngForOf",e.options||S(1,ce))}}function Ee(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e),n(),y(e)}}function Te(t,i){if(t&1&&(l(0,"select",36)(1,"option",37),p(2,"Selecione..."),s(),d(3,Ee,2,2,"option",39),s()),t&2){let e=m().$implicit;o("formControlName",e.name),n(3),o("ngForOf",e.options&&e.options.length?e.options:S(2,de))}}function Le(t,i){if(t&1&&f(0,"input",31),t&2){let e=m().$implicit;o("formControlName",e.name)}}function $e(t,i){if(t&1&&(l(0,"div",20)(1,"label",21),p(2),s(),w(3,22),d(4,be,1,1,"input",23)(5,ye,1,1,"input",24)(6,ve,1,1,"input",25)(7,Ce,1,1,"input",26)(8,xe,1,1,"textarea",27)(9,we,6,3,"select",28)(10,Pe,2,2,"div",29)(11,Te,4,3,"select",28)(12,Le,1,1,"input",30),I(),s()),t&2){let e=i.$implicit;n(2),y(e.label),n(),o("ngSwitch",e.type),n(),o("ngSwitchCase","text"),n(),o("ngSwitchCase","email"),n(),o("ngSwitchCase","tel"),n(),o("ngSwitchCase","number"),n(),o("ngSwitchCase","textarea"),n(),o("ngSwitchCase","select"),n(),o("ngSwitchCase","radio"),n(),o("ngSwitchCase","temperatura")}}function Oe(t,i){if(t&1){let e=D();l(0,"form",16),M("ngSubmit",function(){E(e);let a=m();return T(a.onSubmit())}),d(1,$e,13,10,"div",17),l(2,"div",18)(3,"button",19),p(4),s()()()}if(t&2){let e=m();o("formGroup",e.form),n(),o("ngForOf",e.currentFields),n(2),G("background-color",e.primaryColor()),o("disabled",e.saving()),n(),U(" ",e.saving()?"Salvando...":"Salvar"," ")}}var pe=class t{route=b(K);fs=b(le);subdomain=b(ae);toast=b(me);fb=b(ne);companyService=b(se);form=this.fb.group({});loading=C(!0);saving=C(!1);fieldsLoaded=C(!1);companyName=C(null);primaryColor=C(this.subdomain.getCurrentCompany()?.brandingConfig?.primaryColor||"#3B82F6");companyLogo=null;userId="";boardId="";columnId="";leadId="";currentFields=[];lead=null;companyUsers=[];ngOnInit(){return N(this,null,function*(){let i=this.route.snapshot.queryParamMap,e=i.get("subdomain")||void 0,r=i.get("companyId")||"";this.userId=i.get("userId")||"",this.boardId=i.get("boardId")||"",this.leadId=i.get("leadId")||"",this.columnId=i.get("columnId")||"";try{let a=null;if(r&&(a=yield this.companyService.getCompany(r)),!a&&e&&(a=yield this.companyService.getCompanyBySubdomain(e)),a||(a=yield this.subdomain.initializeFromSubdomain()),a){this.subdomain.setCurrentCompany(a),this.companyName.set(a.name||e||null),this.primaryColor.set(a.brandingConfig?.primaryColor||"#3B82F6");let g=a.subdomain;this.companyLogo=(a.brandingConfig?.logo&&a.brandingConfig.logo.trim()!==""?a.brandingConfig.logo:null)||(g==="gobuyer"?"https://apps.gobuyer.com.br/sso/assets/images/logos/logo-gobuyer.png":null)}else e&&this.companyName.set(e)}catch{this.companyName.set(e||null)}try{this.leadId&&(this.lead=yield this.fs.getLead(this.userId,this.boardId,this.leadId))}catch{}try{let g=(yield this.fs.getPhaseFormConfig(this.userId,this.boardId,this.columnId))?.fields||[];if(this.currentFields=g.sort((c,v)=>(c.order||0)-(v.order||0)),this.currentFields.some(c=>c.type==="responsavel")){let c=this.subdomain.getCurrentCompany();if(c?.id)try{let v=yield this.companyService.getCompanyUsers(c.id);this.companyUsers=v||[],this.currentFields=this.currentFields.map(x=>x.type==="responsavel"?P(F({},x),{type:"select",originalType:"responsavel",options:v.map(u=>({value:u.uid||u.email,label:u.displayName||u.email}))}):x)}catch{}}let _={};this.currentFields.forEach(c=>{let v=c.apiFieldName||c.name,x=this.lead?.fields?.[v]??"";_[c.name]=[x],c.type==="radio"&&Array.isArray(c.options)&&(c.options=c.options.map(u=>typeof u=="object"?u:{value:u,label:u}))}),this.form=this.fb.group(_),this.fieldsLoaded.set(this.currentFields.length>0)}catch{this.currentFields=[],this.fieldsLoaded.set(!1)}this.loading.set(!1)})}mapFormToLeadFields(){let i=this.form.value,e={};return this.currentFields.forEach(r=>{let a=r.apiFieldName||r.name;e[a]=i[r.name]}),e}onSubmit(){return N(this,null,function*(){if(!(!this.lead||!this.leadId)){this.saving.set(!0);try{let i=this.mapFormToLeadFields(),e={fields:F(F({},this.lead.fields||{}),i)};try{let r=this.currentFields.find(a=>a.originalType==="responsavel"||a.type==="responsavel"||(a.name||"").toLowerCase()==="responsavel");if(r){let a=r.name,g=this.form.get(a)?.value;if(g){let h=this.companyUsers.find(_=>_.uid&&_.uid===g||_.email&&_.email===g);e.responsibleUserId=h?.uid||g,e.responsibleUserName=h?.displayName||"",e.responsibleUserEmail=h?.email||""}}}catch{}yield this.fs.updateLead(this.userId,this.boardId,this.leadId,e);try{this.toast.success("Formul\xE1rio salvo.")}catch{}}catch(i){console.error(i);try{this.toast.error("Erro ao salvar formul\xE1rio.")}catch{}}finally{this.saving.set(!1)}}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=$({type:t,selectors:[["app-public-form"]],decls:16,vars:5,consts:[["simpleOpts",""],[1,"min-h-screen","bg-gray-50","py-10","px-4"],[1,"max-w-2xl","mx-auto"],["class","mb-6 text-center",4,"ngIf"],[1,"bg-white","border","border-gray-200","rounded-xl","shadow-sm"],[1,"px-6","py-4","border-b","border-gray-200","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900"],["class","text-xs text-gray-500",4,"ngIf"],[1,"p-6"],["class","text-sm text-gray-500",4,"ngIf"],["class","space-y-4",3,"formGroup","ngSubmit",4,"ngIf"],[1,"mt-6","text-center","text-xs","text-gray-400"],[1,"mb-6","text-center"],["alt","Logo da empresa",1,"h-10","inline-block",3,"src"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-500"],[1,"space-y-4",3,"ngSubmit","formGroup"],["class","space-y-1",4,"ngFor","ngForOf"],[1,"pt-2"],["type","submit",1,"px-4","py-2","text-white","rounded-lg",3,"disabled"],[1,"space-y-1"],[1,"block","text-sm","font-medium","text-gray-700"],[3,"ngSwitch"],["type","text","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","email","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","tel","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","number","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["rows","3","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["class","flex flex-col gap-2",4,"ngSwitchCase"],["type","text","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchDefault"],["type","text",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","email",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","tel",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","number",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["value",""],[4,"ngIf","ngIfElse"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-col","gap-2"],["class","inline-flex items-center gap-2 text-sm text-gray-700",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-2","text-sm","text-gray-700"],["type","radio",1,"text-blue-600","focus:ring-blue-500",3,"value","formControlName"]],template:function(e,r){e&1&&(l(0,"div",1)(1,"div",2),d(2,ue,2,1,"div",3),l(3,"div",4)(4,"div",5)(5,"h1",6),p(6,"Formul\xE1rio"),s(),d(7,fe,2,1,"span",7),s(),l(8,"div",8),d(9,ge,2,0,"div",9)(10,_e,2,0,"div",9)(11,Oe,5,6,"form",10),s()(),l(12,"div",11),p(13," Powered by "),l(14,"strong"),p(15,"Task Board"),s()()()()),e&2&&(n(2),o("ngIf",r.companyLogo),n(5),o("ngIf",r.companyName()),n(2),o("ngIf",r.loading()),n(),o("ngIf",!r.loading()&&!r.fieldsLoaded()),n(),o("ngIf",r.fieldsLoaded()))},dependencies:[z,R,k,B,j,q,re,W,ie,oe,Q,X,te,Y,H,J,Z,ee],encapsulation:2})};export{pe as PublicFormComponent};
