import{a as sn}from"./chunk-5A7TC7UE.js";import{a as an}from"./chunk-6ZCF74V7.js";import{a as Yi,d as Ji,e as Xi,g as li,h as en}from"./chunk-TT6JOLC2.js";import{a as nn}from"./chunk-JZ6U7NWM.js";import"./chunk-WEP5UXW6.js";import"./chunk-PV5HZT57.js";import{a as rn}from"./chunk-AI2JU4OL.js";import"./chunk-OWB4XDBK.js";import{a as on}from"./chunk-W3OFA55M.js";import{A as ge,C as he,D as Mt,I as _e,J as oe,K as re,c as Qi,e as Zi,g as tn,h as Pe,i as ie,j as q,l as ne,m as me,s as Je,t as ue,u as Xe,v as Pt,x as pe,y as fe,z as Ne}from"./chunk-QT4WKFE7.js";import"./chunk-ZBJHR7UR.js";import{F as Me,G as $e,H as J,I as Tt}from"./chunk-OUCFDODB.js";import{$ as ni,$b as Oe,Ba as st,Da as ke,Dc as De,Eb as m,F as ei,Fa as Ri,Fb as a,Fc as Ve,G as Ti,Gb as s,Gc as Ki,H as Ct,Ha as St,Hb as g,Hc as Hi,I as wt,J as ti,Lb as Ie,Mb as Fe,Mc as qi,Nc as Z,O as ki,Ob as F,Oc as Y,Pb as x,Pc as Gi,Qc as Wi,R as Oi,Rb as u,Ua as Vi,Ub as Ce,V as ii,Va as Ni,Vb as we,Vc as K,W as Et,Wa as It,Wb as Ee,X as rt,Xb as Re,Y as Te,Ya as l,Yb as W,Z as Ai,Zb as A,Zc as Dt,_b as $i,a as R,aa as U,ab as Ze,ac as c,b as ee,ba as We,bc as P,cb as Le,cc as S,d as Pi,da as be,db as oi,dc as Bi,ec as Ft,f as D,fa as I,fc as le,g as ze,gb as j,gc as de,hb as Ye,hc as ce,i as ot,ib as Ke,ja as Li,jc as ji,kb as ri,kc as zi,l as V,la as _,lb as b,lc as Ae,m as xt,ma as v,mc as N,ob as C,oc as Ui,p as Xt,pb as xe,qa as at,qb as ai,ra as Ue,uc as He,v as Mi,vb as si,wa as Qe,wb as ye,z as yt}from"./chunk-HM7IHYI7.js";var kt=class o{firestoreService=I(J);smtpService=I(nn);subdomainService=I(Me);companyService=I(Tt);timeAutomationLocks=new Map;newLeadLocks=new Map;processNewLeadAutomations(t,e,i){return D(this,null,function*(){try{let n=`newlead_${i}_${e}_${t.id}`;if(this.newLeadLocks.get(n)){console.log("\u{1F512} Novo lead j\xE1 est\xE1 sendo processado (lock ativo), pulando:",{leadId:t.id,boardId:e,timestamp:new Date().toISOString()});return}this.newLeadLocks.set(n,!0);try{let d=(yield this.firestoreService.getAutomations(i,e)).filter(p=>{if(!p||!p.active)return!1;let f=p.triggerType||p.trigger?.type,h=p.triggerPhase||p.trigger?.phase;return h?f==="new-lead-created"&&t.columnId===h:f==="new-lead-created"});for(let p of d)yield this.executeAutomation(p,t,e,i)}finally{setTimeout(()=>{this.newLeadLocks.delete(n),console.log("\u{1F513} Lock de novo lead liberado:",n)},5e3)}}catch(n){console.error("Erro ao processar automa\xE7\xF5es de novo lead:",n)}})}phaseChangeLocks=new Map;processPhaseChangeAutomations(t,e,i,n,r){return D(this,null,function*(){try{let d=`phasechange_${r}_${n}_${t.id}_${e}`;if(this.phaseChangeLocks.get(d)){console.log("\u{1F512} Mudan\xE7a de fase j\xE1 est\xE1 sendo processada (lock ativo), pulando:",{leadId:t.id,newColumnId:e,oldColumnId:i,timestamp:new Date().toISOString()});return}this.phaseChangeLocks.set(d,!0);try{let f=(yield this.firestoreService.getAutomations(r,n)).filter(h=>{let y=h.active,w=h.triggerType==="card-enters-phase",E=h.triggerPhase===e;return y&&w&&E});for(let h of f)yield this.executeAutomation(h,t,n,r)}finally{setTimeout(()=>{this.phaseChangeLocks.delete(d),console.log("\u{1F513} Lock de mudan\xE7a de fase liberado:",d)},3e3)}}catch(d){console.error("Erro ao processar automa\xE7\xF5es de mudan\xE7a de fase:",d)}})}executeAutomation(t,e,i,n){return D(this,null,function*(){try{for(let r of t.actions)yield this.executeAction(r,e,i,n,t);yield this.addAutomationHistory(t,e,i,n,"success")}catch(r){console.error(`Erro ao executar automa\xE7\xE3o ${t.name}:`,r),yield this.addAutomationHistory(t,e,i,n,"error",r.message)}})}executeAction(t,e,i,n,r){return D(this,null,function*(){switch(t.type){case"send-email":yield this.executeSendEmailAction(t,e,i,n);break;case"move-to-phase":yield this.executeMoveToPhaseAction(t,e,i,n);break;case"assign-user":yield this.executeAssignUserAction(t,e,i,n);break;case"add-note":yield this.executeAddNoteAction(t,e,i,n);break;default:console.warn(`Tipo de a\xE7\xE3o n\xE3o reconhecido: ${t.type}`)}})}executeSendEmailAction(t,e,i,n,r){return D(this,null,function*(){if(!t.templateId)throw new Error("Template de email n\xE3o especificado");let d=`email_${n}_${i}_${e.id}_${t.templateId}_${r?.id||"manual"}`;if(this.timeAutomationLocks.get(d)){console.log("\u{1F512} Email j\xE1 est\xE1 sendo enviado (lock ativo), pulando:",{leadId:e.id,templateId:t.templateId,automationId:r?.id,timestamp:new Date().toISOString()});return}this.timeAutomationLocks.set(d,!0);try{let f=(yield this.firestoreService.getEmailTemplates(n,i)).find($=>$.id===t.templateId);if(!f)throw new Error(`Template de email n\xE3o encontrado: ${t.templateId}`);let h=f.recipients||"",y=this.processEmailTemplate(h,e)||"",w=$=>$?$.split(/[;,]/).map(L=>L.trim()).filter(L=>/.+@.+\..+/.test(L)):[],E=w(y),k=w(t.toEmail||"").concat(w(e.fields.contactEmail||"")).concat(w(e.fields.email||"")).concat(w(e.fields.emailLead||"")).concat(w(e.fields.contatoEmail||"")),M=(E.length?E:k).join(",");if(!M)throw new Error("Destinat\xE1rio n\xE3o definido (template/a\xE7\xE3o/lead)");let O=f.body||f.content||"",B=this.processEmailTemplate(O,e,i,n),z=this.processEmailTemplate(f.subject||f.name||"Mensagem",e,i,n),ae=null;try{let $=yield this.firestoreService.findRecentOutboxEmail(n,i,{automationId:r?.id||void 0,leadId:e.id,subject:z,withinMs:72e5});if($){console.log("\u{1F4E7} Email duplicado detectado (automa\xE7\xE3o + assunto, 2h), pulando envio:",{leadId:e.id,automationId:r?.id,subject:z,existingEmailId:$,timestamp:new Date().toISOString()});return}let L=yield this.firestoreService.findRecentOutboxEmail(n,i,{templateId:t.templateId,leadId:e.id,withinMs:14400*1e3});if(L){console.log("\u{1F4E7} Template duplicado detectado (template + lead, 4h), pulando envio:",{leadId:e.id,templateId:t.templateId,subject:z,existingEmailId:L,timestamp:new Date().toISOString()});return}let H=yield this.firestoreService.findRecentOutboxEmail(n,i,{leadId:e.id,subject:z,withinMs:3600*1e3});if(H){console.log("\u{1F4E7} Email duplicado detectado (lead + assunto, 1h), pulando envio:",{leadId:e.id,subject:z,to:M,existingEmailId:H,timestamp:new Date().toISOString()});return}ae=(ae?{id:ae}:yield this.firestoreService.createOutboxEmail(n,i,{to:M,subject:z,html:B,leadId:e.id,automationId:r?.id||null,templateId:t.templateId||null,delivery:{state:"PENDING"}}))?.id||null}catch($){console.warn("\u26A0\uFE0F N\xE3o foi poss\xEDvel registrar o email na caixa de sa\xEDda antes do envio.",$)}yield new Promise(($,L)=>{this.smtpService.sendEmail({to:M,subject:z,html:B}).subscribe({next:H=>D(this,null,function*(){try{ae&&(yield this.firestoreService.updateOutboxEmail(n,i,ae,{delivery:{state:"SUCCESS",messageId:H?.messageId||"sent"}}))}catch{}$()}),error:H=>D(this,null,function*(){try{ae&&(yield this.firestoreService.updateOutboxEmail(n,i,ae,{delivery:{state:"ERROR",error:H?.error||H?.message||"Erro"}}))}catch{}L(H)})})}),console.log("\u2705 Email enviado com sucesso:",{leadId:e.id,templateId:t.templateId,automationId:r?.id,subject:z,to:M,timestamp:new Date().toISOString()})}catch(p){throw console.error("\u274C Erro ao enviar email:",{leadId:e.id,templateId:t.templateId,automationId:r?.id,error:p?.message||p,timestamp:new Date().toISOString()}),p}finally{this.timeAutomationLocks.delete(d),console.log("\u{1F513} Lock de email liberado:",d)}})}executeMoveToPhaseAction(t,e,i,n){return D(this,null,function*(){if(!t.phaseId)throw new Error("Fase de destino n\xE3o especificada");try{let r=new Date,d=R({},e.phaseHistory||{}),p=e.columnId;if(p&&d[p]){let f=d[p].enteredAt?.toDate&&d[p].enteredAt.toDate()||new Date(d[p].enteredAt||r);d[p].exitedAt=r,d[p].duration=r.getTime()-f.getTime()}d[t.phaseId]={phaseId:t.phaseId,enteredAt:r},yield this.firestoreService.updateLead(n,i,e.id,{columnId:t.phaseId,movedToCurrentColumnAt:r,phaseHistory:d});try{yield this.firestoreService.addLeadHistory(n,i,e.id,{type:"move",text:"Moveu automaticamente para outra fase",user:"Automa\xE7\xE3o"})}catch(f){console.warn("Erro ao registrar hist\xF3rico de movimenta\xE7\xE3o:",f)}}catch(r){throw console.error("Erro ao executar a\xE7\xE3o de mover para fase:",r),r}})}executeAssignUserAction(t,e,i,n){return D(this,null,function*(){if(!t.userId)throw new Error("Usu\xE1rio n\xE3o especificado");let r=this.subdomainService.getCurrentCompany()?.id,d="",p="";if(r&&t.userId)try{let f=yield this.companyService.getCompanyUser(r,t.userId);if(f)d=f.displayName||"",p=f.email||t.userId;else{let y=(yield this.companyService.getCompanyUsers(r)).find(w=>w.uid===t.userId||w.email===t.userId);y&&(d=y.displayName||"",p=y.email||"")}}catch(f){console.warn("Erro ao buscar dados do usu\xE1rio:",f)}yield this.firestoreService.updateLead(n,i,e.id,{responsibleUserId:t.userId,responsibleUserName:d,responsibleUserEmail:p})})}executeAddNoteAction(t,e,i,n){return D(this,null,function*(){if(!t.note)throw new Error("Nota n\xE3o especificada");let r=this.processEmailTemplate(t.note,e,i,n),p=(e.fields.notes||"")+`

[AUTOMA\xC7\xC3O] `+new Date().toLocaleString("pt-BR")+`:
`+r;yield this.firestoreService.updateLead(n,i,e.id,{fields:ee(R({},e.fields),{notes:p})})})}processEmailTemplate(t,e,i,n){if(!t)return"";let r=t,d={"{{contactName}}":e.fields.contactName||"","{{companyName}}":e.fields.companyName||"","{{contactEmail}}":e.fields.contactEmail||"","{{contactPhone}}":e.fields.contactPhone||"","{{cnpj}}":e.fields.cnpj||""},p=e.responsibleUserName||e.fields.responsibleUserName||"",f=e.responsibleUserEmail||e.fields.responsibleUserEmail||"",h=this.buildLeadPublicLink(e,i,n);return Object.assign(d,{"{{responsibleUserName}}":p,"{{responsibleUserEmail}}":f,"{{nomeResponsavel}}":p,"{{emailResponsavel}}":f,"{{responsavel}}":p,"{{leadLink}}":h}),Object.entries(d).forEach(([w,E])=>{r=r.replace(new RegExp(w,"g"),E)}),Object.entries(e.fields).forEach(([w,E])=>{typeof E=="string"&&(r=r.replace(new RegExp(`{{${w}}}`,"g"),E))}),[["id",e.id],["responsibleUserId",e.responsibleUserId],["responsibleUserName",e.responsibleUserName],["responsibleUserEmail",e.responsibleUserEmail]].forEach(([w,E])=>{typeof E=="string"&&(r=r.replace(new RegExp(`{{${w}}}`,"g"),E))}),r}buildLeadPublicLink(t,e,i){try{let n=this.subdomainService.getCurrentCompany();if(!n||!e||!i||!t?.id||!t?.columnId)return"";let r=new URLSearchParams({companyId:n.id,userId:i,boardId:e,leadId:t.id,columnId:t.columnId});if(this.subdomainService.isDevelopment()){let d=this.subdomainService.getBaseUrl();return r.set("subdomain",n.subdomain),`${d}/form?${r.toString()}`}return`https://${n.subdomain}.taskboard.com.br/form?${r.toString()}`}catch{return""}}addAutomationHistory(t,e,i,n,r,d){return D(this,null,function*(){let p=R({automationId:t.id,automationName:t.name,leadId:e.id,leadName:e.fields.contactName||e.fields.companyName||"Lead sem nome",status:r,executedAt:new Date,actions:t.actions.map(f=>({type:f.type,details:this.getActionDetails(f)}))},d&&{errorMessage:d});try{yield this.firestoreService.addAutomationHistoryItem(n,i,p)}catch(f){console.error("Erro ao adicionar ao hist\xF3rico de automa\xE7\xE3o:",f)}})}getActionDetails(t){switch(t.type){case"send-email":return`Template: ${t.templateId}`;case"move-to-phase":return`Fase: ${t.phaseId}`;case"assign-user":return`Usu\xE1rio: ${t.userId}`;case"add-note":return`Nota: ${t.note?.substring(0,50)}...`;default:return""}}processTimeBasedAutomations(t,e,i,n){return D(this,null,function*(){let r=`${n}-${i}`;if(this.timeAutomationLocks.get(r)){console.log("\u23F3 Automa\xE7\xF5es de tempo j\xE1 em execu\xE7\xE3o para este board, pulando...");return}this.timeAutomationLocks.set(r,!0);try{if(!t||t.length===0)return;let p=(yield this.firestoreService.getAutomations(n,i)).filter(E=>E&&E.active);if(p.length===0){console.log("\u2139\uFE0F Nenhuma automa\xE7\xE3o ativa encontrada");return}let f={},h=E=>D(this,null,function*(){if(f.hasOwnProperty(E))return f[E]?.fields||[];let k=yield this.firestoreService.getPhaseFormConfig(n,i,E);return f[E]=k,k?.fields||[]}),y=1440*60*1e3,w=Date.now();for(let E of p){let k=E.triggerType||E.trigger?.type,T=E.triggerPhase||E.trigger?.phase||"",M=E.triggerDays||E.trigger?.days||0;if(k)for(let O of t){if(T&&O.columnId!==T)continue;let B=O.movedToCurrentColumnAt,z=B?.toDate?B.toDate().getTime():B?.seconds?B.seconds*1e3:new Date(B).getTime(),ae=z?Math.floor((w-z)/y):"N/A";try{if(k==="card-in-phase-for-time"){if(!M||M<=0)continue;let $=O.movedToCurrentColumnAt,L=$?.toDate?$.toDate().getTime():$?.seconds?$.seconds*1e3:new Date($).getTime();if(!L)continue;w-L>=M*y&&!this.hasRecentlyExecutedForDays(O,E.id,M,y)&&(yield this.executeAutomation(E,O,i,n),yield this.markExecutedForDays(n,i,O,E.id,M))}else if(k==="sla-overdue"){let L=e.find(X=>X.id===O.columnId)?.slaDays||0;if(!L||L<=0)continue;let H=O.movedToCurrentColumnAt,Q=H?.toDate?H.toDate().getTime():H?.seconds?H.seconds*1e3:new Date(H).getTime();if(!Q)continue;w-Q>L*y&&!this.hasRecentlyExecuted(O,E.id,y)&&(yield this.executeAutomation(E,O,i,n),yield this.markExecuted(n,i,O,E.id))}else if(k==="form-not-answered"){let $=T||O.columnId;if(T&&O.columnId!==T)continue;let L=yield h($);if(!L||L.length===0)continue;let H=M&&M>0?M:1,Q=O.movedToCurrentColumnAt,X=null;if(Q?.toDate)X=Q.toDate().getTime();else if(Q?.seconds)X=Q.seconds*1e3;else if(Q)try{X=new Date(Q).getTime()}catch{X=null}if(!X){let se=O.createdAt;if(se?.toDate)X=se.toDate().getTime();else if(se?.seconds)X=se.seconds*1e3;else if(se)try{X=new Date(se).getTime()}catch{X=Date.now()}}let Dd=X?Math.floor((w-X)/y):0;if(!X||w-X<H*y)continue;let Qn={},Zn=[];if(L.every(se=>{let Di=se.apiFieldName||se.name,je=O.fields?.[Di];Qn[Di]=je;let Yt=!0;if(je!=null&&je!==""){let Jt=`${je}`.trim();Yt=Jt===""||Jt==="undefined"||Jt==="null"}return Zn.push({fieldName:se.name,apiFieldName:se.apiFieldName,value:je,isEmpty:Yt,type:typeof je}),Yt})&&!this.hasRecentlyExecuted(O,E.id,y))try{yield this.executeAutomation(E,O,i,n),yield this.markExecuted(n,i,O,E.id)}catch(se){console.error(`Erro ao executar automa\xE7\xE3o form-not-answered para lead ${O.id}:`,se)}}}catch($){console.warn("Falha ao avaliar automa\xE7\xE3o baseada em tempo para lead:",O.id,$)}}}}catch(d){console.error("\u274C Erro ao processar automa\xE7\xF5es baseadas em tempo:",d)}finally{this.timeAutomationLocks.delete(r)}})}hasRecentlyExecuted(t,e,i){try{let r=(t.executedAutomations||{})[e];if(!r)return!1;let d=null,p=r.lastExecutedAt;if(p?.toDate)d=p.toDate().getTime();else if(p?.seconds)d=p.seconds*1e3;else if(p)try{d=new Date(p).getTime()}catch{d=null}return d?Date.now()-d<i:!1}catch(n){return console.error(`Erro ao verificar execu\xE7\xE3o recente para automa\xE7\xE3o ${e}:`,n),!1}}hasRecentlyExecutedForDays(t,e,i,n){try{let r=t.executedAutomations||{},d=`${e}_${i}days`,p=r[d];if(!p)return!1;let f=null,h=p.lastExecutedAt;if(h?.toDate)f=h.toDate().getTime();else if(h?.seconds)f=h.seconds*1e3;else if(h)try{f=new Date(h).getTime()}catch{f=null}return f?Date.now()-f<n:!1}catch(r){return console.error(`Erro ao verificar execu\xE7\xE3o recente para automa\xE7\xE3o ${e} (${i} dias):`,r),!1}}markExecuted(t,e,i,n){return D(this,null,function*(){try{let r=R({},i.executedAutomations||{}),d=new Date;r[n]={lastExecutedAt:d},yield this.firestoreService.updateLead(t,e,i.id,{executedAutomations:r})}catch(r){console.error(`Erro ao marcar automa\xE7\xE3o ${n} como executada para lead ${i.id}:`,r)}})}markExecutedForDays(t,e,i,n,r){return D(this,null,function*(){try{let d=R({},i.executedAutomations||{}),p=new Date,f=`${n}_${r}days`;d[f]={lastExecutedAt:p,automationId:n,days:r},console.log(`\u2705 Marcando execu\xE7\xE3o para ${f}: ${p.toISOString()}`),yield this.firestoreService.updateLead(t,e,i.id,{executedAutomations:d})}catch(d){console.error(`Erro ao marcar automa\xE7\xE3o ${n} (${r} dias) como executada para lead ${i.id}:`,d)}})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})};var di;function Yn(){if(di==null){let o=typeof document<"u"?document.head:null;di=!!(o&&(o.createShadowRoot||o.attachShadow))}return di}function Ot(o){if(Yn()){let t=o.getRootNode?o.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function lt(o){return o.composedPath?o.composedPath()[0]:o.target}function ln(o){return o.buttons===0||o.detail===0}function dn(o){let t=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function At(o,t=0){return Jn(o)?Number(o):arguments.length===2?t:0}function Jn(o){return!isNaN(parseFloat(o))&&!isNaN(Number(o))}function Se(o){return o instanceof ke?o.nativeElement:o}var Lt=new WeakMap,cn=(()=>{class o{_appRef;_injector=I(at);_environmentInjector=I(Li);load(e){let i=this._appRef=this._appRef||this._injector.get(si),n=Lt.get(i);n||(n={loaders:new Set,refs:[]},Lt.set(i,n),i.onDestroy(()=>{Lt.get(i)?.refs.forEach(r=>r.destroy()),Lt.delete(i)})),n.loaders.has(e)||(n.loaders.add(e),n.refs.push(Hi(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var ci;try{ci=typeof Intl<"u"&&Intl.v8BreakIterator}catch{ci=!1}var mi=(()=>{class o{_platformId=I(St);isBrowser=this._platformId?Dt(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||ci)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Xn=new be("cdk-dir-doc",{providedIn:"root",factory:eo});function eo(){return I(Ue)}var to=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function io(o){let t=o?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?to.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var ui=(()=>{class o{get value(){return this.valueSignal()}valueSignal=Qe("ltr");change=new C;constructor(){let e=I(Xn,{optional:!0});if(e){let i=e.body?e.body.dir:null,n=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(io(i||n||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var oo=20,mn=(()=>{class o{_ngZone=I(xe);_platform=I(mi);_renderer=I(Ze).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new V;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=oo){return this._platform.isBrowser?new ot(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let n=e>0?this._scrolled.pipe(ti(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{n.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Mi()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){let n=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(wt(r=>!r||n.indexOf(r)>-1))}getAncestorScrollContainers(e){let i=[];return this.scrollContainers.forEach((n,r)=>{this._scrollableContainsElement(r,e)&&i.push(r)}),i}_scrollableContainsElement(e,i){let n=Se(i),r=e.getElementRef().nativeElement;do if(n==r)return!0;while(n=n.parentElement);return!1}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var ro=20,un=(()=>{class o{_platform=I(mi);_listeners;_viewportSize;_change=new V;_document=I(Ue);constructor(){let e=I(xe),i=I(Ze).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let n=r=>this._change.next(r);this._listeners=[i.listen("window","resize",n),i.listen("window","orientationchange",n)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:i,height:n}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+n,right:e.left+i,height:n,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,i=this._getWindow(),n=e.documentElement,r=n.getBoundingClientRect(),d=-r.top||e.body.scrollTop||i.scrollY||n.scrollTop||0,p=-r.left||e.body.scrollLeft||i.scrollX||n.scrollLeft||0;return{top:d,left:p}}change(e=ro){return e>0?this._change.pipe(ti(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var pn=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Ye({type:o});static \u0275inj=We({})}return o})();var pi={},fn=(()=>{class o{_appId=I(Ri);getId(e){return this._appId!=="ng"&&(e+=this._appId),pi.hasOwnProperty(e)||(pi[e]=0),`${e}${pi[e]++}`}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function gn(o){return Array.isArray(o)?o:[o]}function hi(o){let t=o.cloneNode(!0),e=t.querySelectorAll("[id]"),i=o.nodeName.toLowerCase();t.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return i==="canvas"?vn(o,t):(i==="input"||i==="select"||i==="textarea")&&_n(o,t),hn("canvas",o,t,vn),hn("input, textarea, select",o,t,_n),t}function hn(o,t,e,i){let n=t.querySelectorAll(o);if(n.length){let r=e.querySelectorAll(o);for(let d=0;d<n.length;d++)i(n[d],r[d])}}var ao=0;function _n(o,t){t.type!=="file"&&(t.value=o.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${ao++}`)}function vn(o,t){let e=t.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function wi(o){let t=o.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function _i(o,t,e){let{top:i,bottom:n,left:r,right:d}=o;return e>=i&&e<=n&&t>=r&&t<=d}function so(o,t){let e=t.left<o.left,i=t.left+t.width>o.right,n=t.top<o.top,r=t.top+t.height>o.bottom;return e||i||n||r}function mt(o,t,e){o.top+=t,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function bn(o,t,e,i){let{top:n,right:r,bottom:d,left:p,width:f,height:h}=o,y=f*t,w=h*t;return i>n-w&&i<d+w&&e>p-y&&e<r+y}var Rt=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:wi(e)})})}handleScroll(t){let e=lt(t),i=this.positions.get(e);if(!i)return null;let n=i.scrollPosition,r,d;if(e===this._document){let h=this.getViewportScrollPosition();r=h.top,d=h.left}else r=e.scrollTop,d=e.scrollLeft;let p=n.top-r,f=n.left-d;return this.positions.forEach((h,y)=>{h.clientRect&&e!==y&&e.contains(y)&&mt(h.clientRect,p,f)}),n.top=r,n.left=d,{top:p,left:f}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function Mn(o,t){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(n=>i.appendChild(n)),i}function Ei(o,t,e){for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];n?o.setProperty(i,n,e?.has(i)?"important":""):o.removeProperty(i)}return o}function et(o,t){let e=t?"":"none";Ei(o.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function xn(o,t,e){Ei(o.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Vt(o,t){return t&&t!="none"?o+" "+t:o}function yn(o,t){o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.style.transform=ut(t.left,t.top)}function ut(o,t){return`translate3d(${Math.round(o)}px, ${Math.round(t)}px, 0)`}function Cn(o){let t=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*t}function lo(o){let t=getComputedStyle(o),e=fi(t,"transition-property"),i=e.find(p=>p==="transform"||p==="all");if(!i)return 0;let n=e.indexOf(i),r=fi(t,"transition-duration"),d=fi(t,"transition-delay");return Cn(r[n])+Cn(d[n])}function fi(o,t){return o.getPropertyValue(t).split(",").map(i=>i.trim())}var co=new Set(["position"]),vi=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,n,r,d,p,f,h,y){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=n,this._previewTemplate=r,this._previewClass=d,this._pickupPositionOnPage=p,this._initialTransform=f,this._zIndex=h,this._renderer=y}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),wn(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return lo(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,n;if(i&&t){let r=t.matchSize?this._initialDomRect:null,d=t.viewContainer.createEmbeddedView(i,t.context);d.detectChanges(),n=Mn(d,this._document),this._previewEmbeddedView=d,t.matchSize?yn(n,r):n.style.transform=ut(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=hi(this._rootElement),yn(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return Ei(n.style,{"pointer-events":"none",margin:wn(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},co),et(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>n.classList.add(r)):n.classList.add(e)),n}};function wn(o){return"showPopover"in o}var mo={passive:!0},En={passive:!1},uo={passive:!1,capture:!0},po=800,Sn="cdk-drag-placeholder",In=new Set(["position"]),bi=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Qe(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new V;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=ze.EMPTY;_pointerUpSubscription=ze.EMPTY;_scrollSubscription=ze.EMPTY;_resizeSubscription=ze.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>et(e,t)))}_disabled=!1;beforeStarted=new V;started=new V;released=new V;ended=new V;entered=new V;exited=new V;dropped=new V;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,n,r,d,p){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=d,this._renderer=p,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Rt(i),d.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>Se(i)),this._handles.forEach(i=>et(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Se(t);if(e!==this._rootElement){this._removeRootElementListeners();let i=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[i.listen(e,"mousedown",this._pointerDown,En),i.listen(e,"touchstart",this._pointerDown,mo),i.listen(e,"dragstart",this._nativeDragStart,En)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Se(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&so(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let t=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),i=0,n=0;e.left<t.left?i=t.left-e.left:e.right>t.right&&(i=t.right-e.right),e.top<t.top?n=t.top-e.top:e.bottom>t.bottom&&(n=t.bottom-e.bottom);let r=this._activeTransform.x,d=this._activeTransform.y,p=r+i,f=d+n;this._rootElement.style.transform=ut(p,f),this._activeTransform={x:p,y:f},this._passiveTransform={x:p,y:f}}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),et(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),et(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+r>=this._config.dragStartThreshold){let p=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),f=this._dropContainer;if(!p){this._endDragSequence(t);return}(!f||!f.isDragging()&&!f.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=i.x-n.x+this._passiveTransform.x,r.y=i.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){dt(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",fo,uo)}),i){let n=this._rootElement,r=n.parentNode,d=this._placeholder=this._createPlaceholderElement(),p=this._marker=this._marker||this._document.createComment("");r.insertBefore(p,n),this._initialTransform=n.style.transform||"",this._preview=new vi(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),xn(n,!1,In),this._document.body.appendChild(r.replaceChild(d,n)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),n=dt(e),r=!n&&e.button!==0,d=this._rootElement,p=lt(e),f=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+po>Date.now(),h=n?dn(e):ln(e);if(p&&p.draggable&&e.type==="mousedown"&&e.preventDefault(),i||r||f||h)return;if(this._handles.length){let E=d.style;this._rootElementTapHighlight=E.webkitTapHighlightColor||"",E.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(E=>this._updateOnScroll(E)),this._boundaryElement&&(this._boundaryRect=wi(this._boundaryElement));let y=this._previewTemplate;this._pickupPositionInElement=y&&y.template&&!y.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let w=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:w.x,y:w.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){xn(this._rootElement,!0,In),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),r=this._getDragDistance(n),d=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:d,distance:r,dropPoint:n,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,d,r,n,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{let d=this._dropContainer.getItemIndex(this),p=this._dropContainer.getItemAtIndex(d+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(r,this._dropContainer,p),this._dropContainer=r,this._dropContainer.enter(this,t,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let n=p=>{(!p||this._preview&&lt(p)===this._preview.element&&p.propertyName==="transform")&&(d(),i(),clearTimeout(r))},r=setTimeout(n,e*1.5),d=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=Mn(this._placeholderRef,this._document)):i=hi(this._rootElement),i.style.pointerEvents="none",i.classList.add(Sn),i}_getPointerPositionInElement(t,e,i){let n=e===this._rootElement?null:e,r=n?n.getBoundingClientRect():t,d=dt(i)?i.targetTouches[0]:i,p=this._getViewportScrollPosition(),f=d.pageX-r.left-p.left,h=d.pageY-r.top-p.top;return{x:r.left-t.left+f,y:r.top-t.top+h}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=dt(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,r=i.pageY-e.top;if(this._ownerSVGElement){let d=this._ownerSVGElement.getScreenCTM();if(d){let p=this._ownerSVGElement.createSVGPoint();return p.x=n,p.y=r,p.matrixTransform(d.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:d}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,p=this._boundaryRect,{width:f,height:h}=this._getPreviewRect(),y=p.top+d,w=p.bottom-(h-d),E=p.left+r,k=p.right-(f-r);i=Fn(i,E,k),n=Fn(n,y,w)}return{x:i,y:n}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,d=Math.abs(e-r.x),p=Math.abs(i-r.y);return d>this._config.pointerDirectionChangeThreshold&&(n.x=e>r.x?1:-1,r.x=e),p>this._config.pointerDirectionChangeThreshold&&(n.y=i>r.y?1:-1,r.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,et(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,n=ut(t*i,e*i),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=Vt(n,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,n=ut(t,e);this._preview.setTransform(Vt(n,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||i.width===0&&i.height===0)return;let r=n.left-i.left,d=i.right-n.right,p=n.top-i.top,f=i.bottom-n.bottom;n.width>i.width?(r>0&&(t+=r),d>0&&(t-=d)):t=0,n.height>i.height?(p>0&&(e+=p),f>0&&(e-=f)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:dt(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=lt(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&mt(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Ot(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Se(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}_conditionallyInsertAnchor(t,e,i){if(t===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let n=this._anchor??=hi(this._placeholder);n.classList.remove(Sn),n.classList.add("cdk-drag-anchor"),n.style.transform="",i?i.before(n):Se(e.element).appendChild(n)}}};function Fn(o,t,e){return Math.max(t,Math.min(e,o))}function dt(o){return o.type[0]==="t"}function fo(o){o.preventDefault()}function qe(o,t,e){let i=Nt(t,o.length-1),n=Nt(e,o.length-1);if(i===n)return;let r=o[i],d=n<i?-1:1;for(let p=i;p!==n;p+=d)o[p]=o[p+d];o[n]=r}function Bt(o,t,e,i){let n=Nt(e,o.length-1),r=Nt(i,t.length);o.length&&t.splice(r,0,o.splice(n,1)[0])}function Nt(o,t){return Math.max(0,Math.min(t,o))}var $t=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,n){let r=this._itemPositions,d=this._getItemIndexFromPointerPosition(t,e,i,n);if(d===-1&&r.length>0)return null;let p=this.orientation==="horizontal",f=r.findIndex(O=>O.drag===t),h=r[d],y=r[f].clientRect,w=h.clientRect,E=f>d?1:-1,k=this._getItemOffsetPx(y,w,E),T=this._getSiblingOffsetPx(f,r,E),M=r.slice();return qe(r,f,d),r.forEach((O,B)=>{if(M[B]===O)return;let z=O.drag===t,ae=z?k:T,$=z?t.getPlaceholderElement():O.drag.getRootElement();O.offset+=ae;let L=Math.round(O.offset*(1/O.drag.scale));p?($.style.transform=Vt(`translate3d(${L}px, 0, 0)`,O.initialTransform),mt(O.clientRect,0,ae)):($.style.transform=Vt(`translate3d(0, ${L}px, 0)`,O.initialTransform),mt(O.clientRect,ae,0))}),this._previousSwap.overlaps=_i(w,e,i),this._previousSwap.drag=h.drag,this._previousSwap.delta=p?n.x:n.y,{previousIndex:f,currentIndex:d}}enter(t,e,i,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n,d=this._activeDraggables,p=d.indexOf(t),f=t.getPlaceholderElement(),h=d[r];if(h===t&&(h=d[r+1]),!h&&(r==null||r===-1||r<d.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(h=d[0]),p>-1&&d.splice(p,1),h&&!this._dragDropRegistry.isDragging(h)){let y=h.getRootElement();y.parentElement.insertBefore(f,y),d.splice(r,0,t)}else this._element.appendChild(f),d.push(t);f.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(n=>n.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return this._getVisualItemPositions().findIndex(e=>e.drag===t)}getItemAtIndex(t){return this._getVisualItemPositions()[t]?.drag||null}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{mt(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:wi(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(t,e,i){let n=this.orientation==="horizontal",r=n?e.left-t.left:e.top-t.top;return i===-1&&(r+=n?e.width-t.width:e.height-t.height),r}_getSiblingOffsetPx(t,e,i){let n=this.orientation==="horizontal",r=e[t].clientRect,d=e[t+i*-1],p=r[n?"width":"height"]*i;if(d){let f=n?"left":"top",h=n?"right":"bottom";i===-1?p-=d.clientRect[f]-r[h]:p+=r[f]-d.clientRect[h]}return p}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,n=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let d=i[i.length-1].clientRect;return n?t>=d.right:e>=d.bottom}else{let d=i[0].clientRect;return n?t<=d.left:e<=d.top}}_getItemIndexFromPointerPosition(t,e,i,n){let r=this.orientation==="horizontal",d=this._itemPositions.findIndex(({drag:p,clientRect:f})=>{if(p===t)return!1;if(n){let h=r?n.x:n.y;if(p===this._previousSwap.drag&&this._previousSwap.overlaps&&h===this._previousSwap.delta)return!1}return r?e>=Math.floor(f.left)&&e<Math.floor(f.right):i>=Math.floor(f.top)&&i<Math.floor(f.bottom)});return d===-1||!this._sortPredicate(d,t)?-1:d}},xi=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let n=e[i];this._relatedNodes.push([n,n.nextSibling])}this.withItems(t)}sort(t,e,i,n){let r=this._getItemIndexFromPointerPosition(t,e,i),d=this._previousSwap;if(r===-1||this._activeItems[r]===t)return null;let p=this._activeItems[r];if(d.drag===p&&d.overlaps&&d.deltaX===n.x&&d.deltaY===n.y)return null;let f=this.getItemIndex(t),h=t.getPlaceholderElement(),y=p.getRootElement();r>f?y.after(h):y.before(h),qe(this._activeItems,f,r);let w=this._getRootNode().elementFromPoint(e,i);return d.deltaX=n.x,d.deltaY=n.y,d.drag=p,d.overlaps=y===w||y.contains(w),{previousIndex:f,currentIndex:r}}enter(t,e,i,n){let r=this._activeItems.indexOf(t);r>-1&&this._activeItems.splice(r,1);let d=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n;d===-1&&(d=this._getClosestItemIndexToPointer(t,e,i));let p=this._activeItems[d];p&&!this._dragDropRegistry.isDragging(p)?(this._activeItems.splice(d,0,t),p.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[n,r]=this._relatedNodes[i];n.parentNode===t&&n.nextSibling!==r&&(r===null?t.appendChild(n):r.parentNode===t&&t.insertBefore(n,r))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}getItemAtIndex(t){return this._activeItems[t]||null}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),r=n?this._activeItems.findIndex(d=>{let p=d.getRootElement();return n===p||p.contains(n)}):-1;return r===-1||!this._sortPredicate(r,t)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=Ot(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,r=-1;for(let d=0;d<this._activeItems.length;d++){let p=this._activeItems[d];if(p!==t){let{x:f,y:h}=p.getRootElement().getBoundingClientRect(),y=Math.hypot(e-f,i-h);y<n&&(n=y,r=d)}}return r}},Dn=.05,Tn=.05,ve=(function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o})(ve||{}),te=(function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o})(te||{}),yi=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new V;entered=new V;exited=new V;dropped=new V;sorted=new V;receivingStarted=new V;receivingStopped=new V;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=ze.EMPTY;_verticalScrollDirection=ve.NONE;_horizontalScrollDirection=te.NONE;_scrollNode;_stopScrollTimers=new V;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,n,r){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=r;let d=this.element=Se(t);this._document=i,this.withOrientation("vertical").withElementContainer(d),e.registerDropContainer(this),this._parentPositions=new Rt(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,r,d,p,f={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:r,distance:d,dropPoint:p,event:f})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>t.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof $t&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new xi(this._document,this._dragDropRegistry);else{let e=new $t(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Se(this.element),i=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}getItemAtIndex(t){return this._isDragging?this._sortStrategy.getItemAtIndex(t):this._draggables[t]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._domRect||!bn(this._domRect,Dn,e,i))return;let r=this._sortStrategy.sort(t,e,i,n);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=ve.NONE,r=te.NONE;if(this._parentPositions.positions.forEach((d,p)=>{p===this._document||!d.clientRect||i||bn(d.clientRect,Dn,t,e)&&([n,r]=go(p,d.clientRect,this._direction,t,e),(n||r)&&(i=p))}),!n&&!r){let{width:d,height:p}=this._viewportRuler.getViewportSize(),f={width:d,height:p,top:0,right:d,bottom:p,left:0};n=kn(f,e),r=On(f,t),i=window}i&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=i,(n||r)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Ti(0,Xt).pipe(Te(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===ve.UP?t.scrollBy(0,-e):this._verticalScrollDirection===ve.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===te.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===te.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&_i(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!_i(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,i);return n?n===this._container||this._container.contains(n):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=Ot(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function kn(o,t){let{top:e,bottom:i,height:n}=o,r=n*Tn;return t>=e-r&&t<=e+r?ve.UP:t>=i-r&&t<=i+r?ve.DOWN:ve.NONE}function On(o,t){let{left:e,right:i,width:n}=o,r=n*Tn;return t>=e-r&&t<=e+r?te.LEFT:t>=i-r&&t<=i+r?te.RIGHT:te.NONE}function go(o,t,e,i,n){let r=kn(t,n),d=On(t,i),p=ve.NONE,f=te.NONE;if(r){let h=o.scrollTop;r===ve.UP?h>0&&(p=ve.UP):o.scrollHeight-h>o.clientHeight&&(p=ve.DOWN)}if(d){let h=o.scrollLeft;e==="rtl"?d===te.RIGHT?h<0&&(f=te.RIGHT):o.scrollWidth+h>o.clientWidth&&(f=te.LEFT):d===te.LEFT?h>0&&(f=te.LEFT):o.scrollWidth-h>o.clientWidth&&(f=te.RIGHT)}return[p,f]}var ct={capture:!0},gi={passive:!1,capture:!0},ho=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275cmp=j({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),Si=(()=>{class o{_ngZone=I(xe);_document=I(Ue);_styleLoader=I(cn);_renderer=I(Ze).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new V;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Qe([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new V;pointerUp=new V;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,gi)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(ho),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=i.type.startsWith("touch"),r=p=>this.pointerUp.next(p),d=[["scroll",p=>this._scroll.next(p),ct],["selectstart",this._preventDefaultWhileDragging,gi]];n?d.push(["touchend",r,ct],["touchcancel",r,ct]):d.push(["mouseup",r,ct]),n||d.push(["mousemove",p=>this.pointerMove.next(p),gi]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=d.map(([p,f,h])=>this._renderer.listen(this._document,p,f,h))})}}stopDragging(e){this._activeDragInstances.update(i=>{let n=i.indexOf(e);return n>-1?(i.splice(n,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this._scroll];return e&&e!==this._document&&i.push(new ot(n=>this._ngZone.runOutsideAngular(()=>{let r=this._renderer.listen(e,"scroll",d=>{this._activeDragInstances().length&&n.next(d)},ct);return()=>{r()}}))),Ct(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),_o={dragStartThreshold:5,pointerDirectionChangeThreshold:5},Ii=(()=>{class o{_document=I(Ue);_ngZone=I(xe);_viewportRuler=I(un);_dragDropRegistry=I(Si);_renderer=I(Ze).createRenderer(null,null);constructor(){}createDrag(e,i=_o){return new bi(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new yi(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Ci=new be("CDK_DRAG_PARENT");var An=new be("CdkDragHandle"),jt=(()=>{class o{element=I(ke);_parentDrag=I(Ci,{optional:!0,skipSelf:!0});_dragDropRegistry=I(Si);_stateChanges=new V;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let e=this.element.nativeElement.parentElement;for(;e;){let i=this._dragDropRegistry.getDragDirectiveForNode(e);if(i){this._parentDrag=i,i._addHandle(this);break}e=e.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ke({type:o,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",Ve]},features:[Ae([{provide:An,useExisting:o}])]})}return o})(),Ln=new be("CDK_DRAG_CONFIG"),Rn=new be("CdkDropList"),zt=(()=>{class o{element=I(ke);dropContainer=I(Rn,{optional:!0,skipSelf:!0});_ngZone=I(xe);_viewContainerRef=I(oi);_dir=I(ui,{optional:!0});_changeDetectorRef=I(De);_selfHandle=I(An,{optional:!0,self:!0});_parentDrag=I(Ci,{optional:!0,skipSelf:!0});_dragDropRegistry=I(Si);_destroyed=new V;_handles=new xt([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new C;released=new C;ended=new C;entered=new C;exited=new C;dropped=new C;moved=new ot(e=>{let i=this._dragRef.moved.pipe(yt(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=I(at);constructor(){let e=this.dropContainer,i=I(Ln,{optional:!0}),n=I(Ii);this._dragRef=n.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Te(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){ai(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,n=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),n=i.indexOf(e);n>-1&&(i.splice(n,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Se(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,n=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,d=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:At(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(d).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(ki(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let n=this._dragDropRegistry.getDragDirectiveForNode(i);if(n){e.withParent(n._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:n,constrainPosition:r,previewClass:d,boundaryElement:p,draggingDisabled:f,rootElementSelector:h,previewContainer:y}=e;this.disabled=f??!1,this.dragStartDelay=n||0,this.lockAxis=i||null,r&&(this.constrainPosition=r),d&&(this.previewClass=d),p&&(this.boundaryElement=p),h&&(this.rootElementSelector=h),y&&(this.previewContainer=y)}_setupHandlesListener(){this._handles.pipe(Ai(e=>{let i=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),rt(e=>Ct(...e.map(i=>i._stateChanges.pipe(Et(i))))),Te(this._destroyed)).subscribe(e=>{let i=this._dragRef,n=e.element.nativeElement;e.disabled?i.disableHandle(n):i.enableHandle(n)})}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ke({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,n){i&2&&A("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Ve],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Ki]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Ae([{provide:Ci,useExisting:o}]),st]})}return o})(),Pn=new be("CdkDropListGroup");var Ut=(()=>{class o{element=I(ke);_changeDetectorRef=I(De);_scrollDispatcher=I(mn);_dir=I(ui,{optional:!0});_group=I(Pn,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new V;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=I(fn).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new C;entered=new C;exited=new C;sorted=new C;_unsortedItems=new Set;constructor(){let e=I(Ii),i=I(Ln,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(n,r)=>this.enterPredicate(n.data,r.data),this._dropListRef.sortPredicate=(n,r,d)=>this.sortPredicate(n,r.data,d.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),o._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=o._dropLists.indexOf(this);e>-1&&o._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(Et(this._dir.value),Te(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=gn(this.connectedTo).map(n=>{if(typeof n=="string"){let r=o._dropLists.find(d=>d.id===n);return r}return n});if(this._group&&this._group._items.forEach(n=>{i.indexOf(n)===-1&&i.push(n)}),!this._scrollableParentsResolved){let n=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(r=>r.getElementRef().nativeElement);this._dropListRef.withScrollableParents(n),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let n=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(n)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=At(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(i.filter(n=>n&&n!==this).map(n=>n._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),Ct(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:n,sortingDisabled:r,listAutoScrollDisabled:d,listOrientation:p}=e;this.disabled=n??!1,this.sortingDisabled=r??!1,this.autoScrollDisabled=d??!1,this.orientation=p||"vertical",this.lockAxis=i||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ke({type:o,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,n){i&2&&(ye("id",n.id),A("cdk-drop-list-disabled",n.disabled)("cdk-drop-list-dragging",n._dropListRef.isDragging())("cdk-drop-list-receiving",n._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",Ve],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",Ve],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",Ve],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",Ve]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[Ae([{provide:Pn,useValue:void 0},{provide:Rn,useExisting:o}])]})}return o})();var Kt=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Ye({type:o});static \u0275inj=We({providers:[Ii],imports:[pn]})}return o})();var tt=class o{storage=I(Yi);uploadFile(t,e){return D(this,null,function*(){try{let i=li(this.storage,e),n=yield en(i,t);return yield Xi(n.ref)}catch(i){throw console.error("Erro ao fazer upload:",i),i}})}uploadLeadAttachment(t,e,i,n,r){return D(this,null,function*(){let d=Date.now(),f=`${r?`companies/${r}`:`users/${t}`}/boards/${e}/leads/${i}/attachments/${d}_${n.name}`;try{let h=yield this.uploadFile(n,f);return{name:n.name,url:h}}catch(h){throw console.error("Erro ao fazer upload do anexo:",h),h}})}deleteFile(t){return D(this,null,function*(){try{let e=li(this.storage,t);yield Ji(e)}catch(e){throw console.error("Erro ao deletar arquivo:",e),e}})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ht=class o{applyCpfMask(t){if(!t)return"";let e=t.replace(/\D/g,"");return e.length<=11?e.replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"):e.slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}applyCnpjMask(t){if(!t)return"";let e=t.replace(/\D/g,"");return e.length<=14?e.replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2"):e.slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2")}applyPhoneMask(t){if(!t)return"";let e=t.replace(/\D/g,"");if(e.length===11)return e.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d{4})$/,"$1-$2");if(e.length===10)return e.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d{4})$/,"$1-$2");if(e.length<=11){let i=e;return e.length>=2&&(i=e.replace(/(\d{2})(\d)/,"($1) $2")),e.length>=7&&(i=i.replace(/(\d{4,5})(\d{4})$/,"$1-$2")),i}return this.applyPhoneMask(e.slice(0,11))}isValidCpf(t){if(!t)return!1;let e=t.replace(/\D/g,"");if(e.length!==11||/^(\d)\1+$/.test(e))return!1;let i=0;for(let d=0;d<9;d++)i+=parseInt(e.charAt(d))*(10-d);let n=11-i%11;n>9&&(n=0),i=0;for(let d=0;d<10;d++)i+=parseInt(e.charAt(d))*(11-d);let r=11-i%11;return r>9&&(r=0),parseInt(e.charAt(9))===n&&parseInt(e.charAt(10))===r}isValidCnpj(t){if(!t)return!1;let e=t.replace(/\D/g,"");if(e.length!==14||/^(\d)\1+$/.test(e))return!1;let i=e.split("").map(Number),n=0,r=[5,4,3,2,9,8,7,6,5,4,3,2];for(let E=0;E<12;E++)n+=i[E]*r[E];let d=n%11,p=d<2?0:11-d,f=0,h=[6,5,4,3,2,9,8,7,6,5,4,3,2];for(let E=0;E<13;E++)f+=i[E]*h[E];let y=f%11,w=y<2?0:11-y;return i[12]===p&&i[13]===w}isValidEmail(t){return t?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t):!1}removeFormatting(t){return t?t.replace(/\D/g,""):""}getTemperatureColor(t){switch(t?.toLowerCase()){case"quente":return"#EF4444";case"morno":return"#EAB308";case"frio":return"#3B82F6";default:return"#6B7280"}}getTemperatureClass(t){switch(t?.toLowerCase()){case"quente":return"bg-red-500 text-white";case"morno":return"bg-yellow-500 text-white";case"frio":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}}maskPhone(t){let e=t.target,i=e.value,n=this.applyPhoneMask(i);e.value=n;let r=new Event("input",{bubbles:!0});e.dispatchEvent(r)}maskCPF(t){let e=t.target,i=e.value,n=this.applyCpfMask(i);e.value=n;let r=new Event("input",{bubbles:!0});e.dispatchEvent(r)}maskCNPJ(t){let e=t.target,i=e.value,n=this.applyCnpjMask(i);e.value=n;let r=new Event("input",{bubbles:!0});e.dispatchEvent(r)}validateCPF(t){return this.isValidCpf(t)}validateCNPJ(t){return this.isValidCnpj(t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})};var vo=()=>["Quente","Morno","Frio"];function bo(o,t){o&1&&(a(0,"span",27),c(1,"*"),s())}function xo(o,t){if(o&1&&g(0,"input",28),o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("type",i.type)("id",i.name)("formControlName",i.name)("placeholder",i.placeholder||"")("disabled",n.isLoading)}}function yo(o,t){if(o&1){let e=F();a(0,"input",29),x("input",function(n){_(e);let r=u(3);return v(r.maskHelper.maskPhone(n))})("keyup",function(n){_(e);let r=u(3);return v(r.maskHelper.maskPhone(n))}),s()}if(o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("placeholder",i.placeholder||"(11) 99999-9999")("disabled",n.isLoading)}}function Co(o,t){if(o&1){let e=F();a(0,"input",30),x("input",function(n){_(e);let r=u(3);return v(r.maskHelper.maskCNPJ(n))})("keyup",function(n){_(e);let r=u(3);return v(r.maskHelper.maskCNPJ(n))}),s()}if(o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function wo(o,t){if(o&1){let e=F();a(0,"input",31),x("input",function(n){_(e);let r=u(3);return v(r.maskHelper.maskCPF(n))})("keyup",function(n){_(e);let r=u(3);return v(r.maskHelper.maskCPF(n))}),s()}if(o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function Eo(o,t){if(o&1&&(a(0,"option",35),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" ",e," ")}}function So(o,t){if(o&1&&(a(0,"select",32)(1,"option",33),c(2,"Selecione..."),s(),b(3,Eo,2,2,"option",34),s()),o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("disabled",n.isLoading),l(3),m("ngForOf",i.options)}}function Io(o,t){if(o&1&&(a(0,"option",35),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" ",e," ")}}function Fo(o,t){if(o&1&&(a(0,"select",32)(1,"option",33),c(2,"Selecione a temperatura"),s(),b(3,Io,2,2,"option",34),s()),o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("disabled",n.isLoading),l(3),m("ngForOf",i.options||N(6,vo))}}function Do(o,t){if(o&1&&(a(0,"div",38),g(1,"input",39),a(2,"label",40),c(3),s()()),o&2){let e=t.$implicit,i=t.index,n=u(2).$implicit,r=u(2);l(),m("id",n.name+"_radio_"+i)("formControlName",n.name)("value",e)("disabled",r.isLoading),l(),m("for",n.name+"_radio_"+i),l(),S(" ",e," ")}}function Po(o,t){if(o&1&&(a(0,"div",36),b(1,Do,4,6,"div",37),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options)}}function Mo(o,t){if(o&1&&(a(0,"label",41),g(1,"input",42),a(2,"span",43),c(3),s()()),o&2){let e=u().$implicit,i=u(2);l(),m("id",e.name)("formControlName",e.name)("disabled",i.isLoading),l(2),P(e.placeholder||e.label)}}function To(o,t){if(o&1&&g(0,"textarea",44),o&2){let e,i=u().$implicit,n=u(2);A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("formControlName",i.name)("disabled",n.isLoading)}}function ko(o,t){if(o&1){let e=F();a(0,"div")(1,"input",45),x("change",function(n){_(e);let r=u().$implicit,d=u(2);return v(d.onFileSelected(n,r.name))}),s(),a(2,"p",46),c(3),s()()}if(o&2){let e,i=u().$implicit,n=u(2);l(),A("border-red-500",((e=n.leadForm.get(i.name))==null?null:e.invalid)&&((e=n.leadForm.get(i.name))==null?null:e.touched)),m("id",i.name)("multiple",i.placeholder==="multiple")("disabled",n.isLoading),l(2),S(" ",i.placeholder||"Voc\xEA pode anexar arquivos como documentos, imagens, etc."," ")}}function Oo(o,t){if(o&1&&(a(0,"div",47),c(1),s()),o&2){let e=u().$implicit,i=u(2);l(),S(" ",i.getFieldError(e.name)," ")}}function Ao(o,t){if(o&1&&(a(0,"div",14)(1,"label",15),c(2),b(3,bo,2,0,"span",16),s(),b(4,xo,1,7,"input",17)(5,yo,1,6,"input",18)(6,Co,1,5,"input",19)(7,wo,1,5,"input",20)(8,So,4,6,"select",21)(9,Fo,4,7,"select",21)(10,Po,2,1,"div",22)(11,Mo,4,4,"label",23)(12,To,1,5,"textarea",24)(13,ko,4,6,"div",25)(14,Oo,2,1,"div",26),s()),o&2){let e=t.$implicit,i=u(2);l(),m("for",e.name),l(),S(" ",e.label," "),l(),m("ngIf",e.required),l(),m("ngIf",e.type==="text"||e.type==="email"||e.type==="date"||e.type==="time"||e.type==="number"),l(),m("ngIf",e.type==="tel"),l(),m("ngIf",e.type==="cnpj"),l(),m("ngIf",e.type==="cpf"),l(),m("ngIf",e.type==="select"),l(),m("ngIf",e.type==="temperatura"),l(),m("ngIf",e.type==="radio"),l(),m("ngIf",e.type==="checkbox"),l(),m("ngIf",e.type==="textarea"),l(),m("ngIf",e.type==="file"),l(),m("ngIf",i.getFieldError(e.name))}}function Lo(o,t){if(o&1&&(a(0,"div",48),c(1),s()),o&2){let e=u(2);l(),S(" ",e.errorMessage," ")}}function Ro(o,t){o&1&&g(0,"div",49)}function Vo(o,t){if(o&1){let e=F();a(0,"div",1),x("click",function(n){_(e);let r=u();return v(r.onBackdropClick(n))}),a(1,"div",2)(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){_(e);let n=u();return v(n.hide())}),c(6," \xD7 "),s()(),a(7,"form",6),x("ngSubmit",function(){_(e);let n=u();return v(n.saveLead())}),a(8,"div",7),b(9,Ao,15,14,"div",8)(10,Lo,2,1,"div",9),s(),a(11,"div",10)(12,"button",11),x("click",function(){_(e);let n=u();return v(n.hide())}),c(13," Cancelar "),s(),a(14,"button",12),b(15,Ro,1,0,"div",13),c(16),s()()()()()}if(o&2){let e=u();l(4),S(" ",e.isEditing?"Editar Registro":"Novo Registro"," "),l(),m("disabled",e.isLoading),l(2),m("formGroup",e.leadForm),l(2),m("ngForOf",e.formFields),l(),m("ngIf",e.errorMessage),l(2),m("disabled",e.isLoading),l(2),m("disabled",e.isLoading||!e.leadForm.valid),l(),m("ngIf",e.isLoading),l(),S(" ",e.isLoading?"Salvando...":e.isEditing?"Atualizar Registro":"Salvar Registro"," ")}}var pt=class o{authService=I($e);firestoreService=I(J);storageService=I(tt);fb=I(_e);maskService=I(Ht);ownerId="";boardId="";columns=[];leadCreated=new C;leadUpdated=new C;closeModal=new C;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentLead=null;leadForm=this.fb.group({});formFields=[];selectedFiles=[];ngOnInit(){this.initializeForm()}initializeForm(){return D(this,null,function*(){yield this.loadFormFieldsFromInitialBoard(),this.formFields.length===0&&(yield this.loadFormFieldsFromInitialPhase()),this.buildForm()})}loadFormFieldsFromInitialBoard(){return D(this,null,function*(){try{if(!this.boardId)return;let t=yield this.firestoreService.getInitialFormConfig(this.boardId);t&&t.fields&&(this.formFields=t.fields.map((e,i)=>ee(R({},e),{includeInApi:e.includeInApi!==!1,order:e.order??i})).sort((e,i)=>(e.order||0)-(i.order||0)))}catch{}})}loadFormFieldsFromInitialPhase(){return D(this,null,function*(){try{if(this.boardId&&this.ownerId){console.log("\u{1F50D} Carregando campos do formul\xE1rio da fase inicial...",{boardId:this.boardId,ownerId:this.ownerId});let t=yield this.firestoreService.getColumns(this.ownerId,this.boardId);console.log("\u{1F4CB} Colunas encontradas:",t);let e=t.find(i=>i.isInitialPhase)||t.sort((i,n)=>(i.order||0)-(n.order||0))[0];if(e){console.log("\u{1F3AF} Fase inicial encontrada:",e);let i=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,e.id);console.log("\u2699\uFE0F Configura\xE7\xE3o da fase encontrada:",i),i&&i.fields?(this.formFields=i.fields.map(n=>(n.type==="temperatura"&&((!n.options||n.options.length===0)&&(n.options=["Quente","Morno","Frio"]),console.log("\u{1F321}\uFE0F Campo temperatura reconstru\xEDdo:",n)),ee(R({},n),{includeInApi:n.includeInApi!==!1,order:n.order||0}))).sort((n,r)=>(n.order||0)-(r.order||0)),console.log("\u2705 Formul\xE1rio carregado da fase inicial:",this.formFields)):console.log("\u26A0\uFE0F Nenhuma configura\xE7\xE3o de formul\xE1rio encontrada para a fase")}else console.log("\u26A0\uFE0F Nenhuma coluna encontrada no quadro")}else console.log("\u26A0\uFE0F BoardId ou OwnerId n\xE3o definidos:",{boardId:this.boardId,ownerId:this.ownerId})}catch(t){console.error("\u274C Erro ao carregar campos do formul\xE1rio da fase:",t)}})}buildForm(){let t={};this.formFields.forEach(e=>{let i=e.required?[q.required]:[];switch(e.type){case"email":i.push(q.email);break;case"cnpj":i.push(n=>{let r=n.value;return r?this.maskService.validateCNPJ(r)?null:{cnpj:!0}:null});break;case"cpf":i.push(n=>{let r=n.value;return r?this.maskService.validateCPF(r)?null:{cpf:!0}:null});break}t[e.name]=["",i]}),this.leadForm=this.fb.group(t)}showCreateModal(){this.isEditing=!1,this.currentLead=null,this.isVisible=!0,this.resetForm()}showEditModal(t){this.isEditing=!0,this.currentLead=t,this.isVisible=!0,this.populateForm(t)}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){this.leadForm.reset(),this.errorMessage="",this.selectedFiles=[],this.isLoading=!1}populateForm(t){t.fields&&Object.keys(t.fields).forEach(e=>{this.leadForm.controls[e]&&this.leadForm.patchValue({[e]:t.fields[e]})})}saveLead(){return D(this,null,function*(){if(!this.leadForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.leadForm.value,e=this.authService.getCurrentUser();if(!e)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.isEditing&&this.currentLead)yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,{fields:t}),yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"update",text:"Lead atualizado",user:e.displayName||e.email}),this.leadUpdated.emit();else{let i=this.columns.find(p=>p.isInitialPhase)||this.columns.sort((p,f)=>(p.order||0)-(f.order||0))[0];if(!i){let p=yield this.firestoreService.getInitialColumnId(this.boardId);p&&(i=this.columns.find(f=>f.id===p)||null)}if(!i)throw new Error("Nenhuma coluna inicial encontrada");let n=new Date,r={fields:t,columnId:i.id,companyId:"",boardId:this.boardId,createdAt:null,movedToCurrentColumnAt:null,responsibleUserId:e.uid,responsibleUserName:e.displayName||"",responsibleUserEmail:e.email||"",phaseHistory:{[i.id]:{phaseId:i.id,enteredAt:n}},executedAutomations:{}},d=yield this.firestoreService.createLead(this.ownerId,this.boardId,r);try{let p=yield this.firestoreService.getLead(this.ownerId,this.boardId,d.id);p&&(!p.phaseHistory||!p.phaseHistory[i.id])&&(yield this.firestoreService.updateLead(this.ownerId,this.boardId,d.id,{phaseHistory:{[i.id]:{phaseId:i.id,enteredAt:new Date}}}))}catch{}yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,d.id,{type:"creation",text:`Lead criado na fase <b>${i.name}</b>`,user:e.displayName||e.email}),this.leadCreated.emit()}this.hide()}catch(t){console.error("Erro ao salvar lead:",t),this.errorMessage="Erro ao salvar lead. Tente novamente."}finally{this.isLoading=!1}})}onFileSelected(t,e){let i=t.target.files;i&&(e?this.leadForm.patchValue({[e]:Array.from(i)}):this.selectedFiles=Array.from(i))}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}getFieldError(t){let e=this.leadForm.get(t);if(e?.errors&&e.touched){if(e.errors.required)return`${this.getFieldLabel(t)} \xE9 obrigat\xF3rio`;if(e.errors.email)return"Email inv\xE1lido";if(e.errors.cnpj)return"CNPJ inv\xE1lido";if(e.errors.cpf)return"CPF inv\xE1lido"}return""}getFieldLabel(t){return this.formFields.find(i=>i.name===t)?.label||t}get maskHelper(){return this.maskService}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-lead-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns"},outputs:{leadCreated:"leadCreated",leadUpdated:"leadUpdated",closeModal:"closeModal"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-y-auto"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"space-y-4"],["class","form-group",4,"ngFor","ngForOf"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"flex","justify-end","gap-3","mt-6","pt-4","border-t","border-gray-200"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-2","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-700","mb-1",3,"for"],["class","text-red-500",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"type","id","formControlName","placeholder","border-red-500","disabled",4,"ngIf"],["type","tel","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","placeholder","border-red-500","disabled","input","keyup",4,"ngIf"],["type","text","placeholder","00.000.000/0000-00","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled","input","keyup",4,"ngIf"],["type","text","placeholder","000.000.000-00","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled","input","keyup",4,"ngIf"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",3,"id","formControlName","border-red-500","disabled",4,"ngIf"],["class","space-y-2",4,"ngIf"],["class","flex items-center cursor-pointer",4,"ngIf"],["rows","3","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none",3,"id","formControlName","border-red-500","disabled",4,"ngIf"],[4,"ngIf"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"text-red-500"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"type","id","formControlName","placeholder","disabled"],["type","tel",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","placeholder","disabled"],["type","text","placeholder","00.000.000/0000-00",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","disabled"],["type","text","placeholder","000.000.000-00",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"input","keyup","id","formControlName","disabled"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"id","formControlName","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"space-y-2"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["type","radio",1,"mr-2","text-blue-600","focus:ring-blue-500","border-gray-300",3,"id","formControlName","value","disabled"],[1,"text-gray-700","cursor-pointer",3,"for"],[1,"flex","items-center","cursor-pointer"],["type","checkbox",1,"mr-2","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"id","formControlName","disabled"],[1,"text-gray-700"],["rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","resize-none",3,"id","formControlName","disabled"],["type","file",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"change","id","multiple","disabled"],[1,"text-xs","text-gray-500","mt-1"],[1,"text-red-500","text-sm","mt-1"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,Vo,17,9,"div",0),e&2&&m("ngIf",i.isVisible)},dependencies:[K,Z,Y,oe,ue,ge,he,ie,Pe,Ne,Pt,ne,me,re,pe,fe],styles:[`.fixed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.bg-white[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.form-group[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #3b82f61a}.border-red-500[_ngcontent-%COMP%]{border-color:#ef4444!important}select[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}`]})};function No(o,t){if(o&1&&(a(0,"div",42),c(1),s()),o&2){let e=u(2);l(),S(" ",e.getFieldError("name")," ")}}function $o(o,t){o&1&&(a(0,"div",45),g(1,"i",46),s())}function Bo(o,t){if(o&1){let e=F();a(0,"div",43),x("click",function(){let n=_(e).$implicit,r=u(2);return v(!r.isLoading&&r.columnForm.patchValue({color:n}))}),b(1,$o,2,0,"div",44),s()}if(o&2){let e,i,n,r,d,p=t.$implicit,f=t.index,h=u(2);$i("background-color: "+p+" !important;"),A("border-gray-800",((e=h.columnForm.get("color"))==null?null:e.value)===p)("border-gray-300",((i=h.columnForm.get("color"))==null?null:i.value)!==p)("ring-2",((n=h.columnForm.get("color"))==null?null:n.value)===p)("ring-blue-500",((r=h.columnForm.get("color"))==null?null:r.value)===p),m("title",p),ye("data-color",p)("data-index",f),l(),m("ngIf",((d=h.columnForm.get("color"))==null?null:d.value)===p)}}function jo(o,t){if(o&1&&(a(0,"option",47),c(1),s()),o&2){let e=t.$implicit;m("value",e.value),l(),S(" ",e.label," ")}}function zo(o,t){if(o&1&&(a(0,"div",42),c(1),s()),o&2){let e=u(2);l(),S(" ",e.getFieldError("slaDays")," ")}}function Uo(o,t){if(o&1&&(a(0,"div",48),c(1),s()),o&2){let e=u(2);l(),S(" ",e.errorMessage," ")}}function Ko(o,t){if(o&1){let e=F();a(0,"button",49),x("click",function(){_(e);let n=u(2);return v(n.deleteColumn())}),g(1,"i",50),c(2," Excluir Fase "),s()}if(o&2){let e=u(2);m("disabled",e.isLoading)}}function Ho(o,t){o&1&&g(0,"div")}function qo(o,t){o&1&&g(0,"div",51)}function Go(o,t){if(o&1){let e=F();a(0,"div",1),x("click",function(n){_(e);let r=u();return v(r.onBackdropClick(n))}),a(1,"div",2)(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){_(e);let n=u();return v(n.hide())}),c(6," \xD7 "),s()(),a(7,"form",6),x("ngSubmit",function(){_(e);let n=u();return v(n.saveColumn())}),a(8,"div",7)(9,"div",8)(10,"label",9),c(11," Nome da Fase "),a(12,"span",10),c(13,"*"),s()(),g(14,"input",11),b(15,No,2,1,"div",12),s(),a(16,"div",8)(17,"label",13),c(18," Cor da Fase "),s(),a(19,"div",14),b(20,Bo,2,14,"div",15),s(),a(21,"div",16)(22,"label",17),c(23,"Cor personalizada:"),s(),g(24,"input",18),a(25,"span",19),c(26),s()()(),a(27,"div",8)(28,"label",20),c(29," Tipo de Finaliza\xE7\xE3o "),s(),a(30,"select",21),b(31,jo,2,2,"option",22),s(),a(32,"p",23),c(33," Fases de finaliza\xE7\xE3o n\xE3o permitem que leads sejam movidos para outras fases. "),s()(),a(34,"div",8)(35,"label",24),c(36," SLA (dias) "),s(),g(37,"input",25),b(38,zo,2,1,"div",12),a(39,"p",23),c(40," Defina um prazo em dias para esta fase. Use 0 para desabilitar o SLA. "),s()(),a(41,"div",8)(42,"label",26),g(43,"input",27),a(44,"span",28),c(45," Esta \xE9 a fase inicial "),s()(),a(46,"p",23),c(47," A fase inicial ser\xE1 usada automaticamente ao criar novos registros. "),s()(),b(48,Uo,2,1,"div",29),a(49,"div",30)(50,"div",31),g(51,"i",32),a(52,"div",33)(53,"strong"),c(54,"Dica:"),s(),a(55,"ul",34)(56,"li"),c(57,"Organize suas fases na ordem do seu funil de vendas"),s(),a(58,"li"),c(59,"Use cores diferentes para facilitar a identifica\xE7\xE3o"),s(),a(60,"li"),c(61,"Fases de "),a(62,"strong"),c(63,"Sucesso"),s(),c(64," indicam leads convertidos"),s(),a(65,"li"),c(66,"Fases de "),a(67,"strong"),c(68,"Fracasso"),s(),c(69," indicam leads perdidos"),s()()()()()(),a(70,"div",35),b(71,Ko,3,1,"button",36)(72,Ho,1,0,"div",37),a(73,"div",38)(74,"button",39),x("click",function(){_(e);let n=u();return v(n.hide())}),c(75," Cancelar "),s(),a(76,"button",40),b(77,qo,1,0,"div",41),c(78),s()()()()()()}if(o&2){let e,i,n,r=u();l(4),S(" ",r.isEditing?"Editar Fase":"Nova Fase"," "),l(),m("disabled",r.isLoading),l(2),m("formGroup",r.columnForm),l(7),A("border-red-500",((e=r.columnForm.get("name"))==null?null:e.invalid)&&((e=r.columnForm.get("name"))==null?null:e.touched)),m("disabled",r.isLoading),l(),m("ngIf",r.getFieldError("name")),l(5),m("ngForOf",r.predefinedColors),l(4),m("disabled",r.isLoading),l(2),P((i=r.columnForm.get("color"))==null?null:i.value),l(4),m("disabled",r.isLoading),l(),m("ngForOf",r.endStageTypes),l(6),A("border-red-500",((n=r.columnForm.get("slaDays"))==null?null:n.invalid)&&((n=r.columnForm.get("slaDays"))==null?null:n.touched)),m("disabled",r.isLoading),l(),m("ngIf",r.getFieldError("slaDays")),l(5),m("disabled",r.isLoading),l(5),m("ngIf",r.errorMessage),l(23),m("ngIf",r.isEditing),l(),m("ngIf",!r.isEditing),l(2),m("disabled",r.isLoading),l(2),m("disabled",r.isLoading||!r.columnForm.valid),l(),m("ngIf",r.isLoading),l(),S(" ",r.isLoading?"Salvando...":r.isEditing?"Atualizar Fase":"Criar Fase"," ")}}var ft=class o{authService=I($e);firestoreService=I(J);fb=I(_e);ownerId="";boardId="";columns=[];columnCreated=new C;columnUpdated=new C;columnDeleted=new C;closeModal=new C;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentColumn=null;predefinedColors=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#6B7280","#F97316","#06B6D4","#84CC16","#14B8A6","#F43F5E","#A855F7","#EAB308","#059669","#DC2626"];columnForm=this.fb.group({name:["",[q.required]],color:[this.predefinedColors[0]],endStageType:["none"],slaDays:[0,[q.min(0)]],isInitialPhase:[!1]});endStageTypes=[{value:"none",label:"Nenhuma (fase normal)"},{value:"success",label:"Sucesso (lead convertido)"},{value:"fail",label:"Fracasso (lead perdido)"}];showCreateModal(){this.isEditing=!1,this.currentColumn=null,this.isVisible=!0,this.resetForm()}showEditModal(t){this.isEditing=!0,this.currentColumn=t,this.isVisible=!0,this.populateForm(t)}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){let t=this.getNextAvailableColor();this.columnForm.reset({name:"",color:t,endStageType:"none",slaDays:0,isInitialPhase:!1}),this.errorMessage="",this.isLoading=!1}getNextAvailableColor(){let t=this.columns.map(i=>i.color).filter(i=>i);for(let i of this.predefinedColors)if(!t.includes(i))return i;let e=this.columns.length%this.predefinedColors.length;return this.predefinedColors[e]}populateForm(t){this.columnForm.patchValue({name:t.name,color:t.color||"#3B82F6",endStageType:t.endStageType||"none",slaDays:t.slaDays||0,isInitialPhase:t.isInitialPhase||!1})}saveColumn(){return D(this,null,function*(){if(!this.columnForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.columnForm.value;if(!this.authService.getCurrentUser())throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.isEditing&&this.currentColumn)yield this.firestoreService.updateColumn(this.ownerId,this.boardId,this.currentColumn.id,{name:t.name,color:t.color,endStageType:t.endStageType,slaDays:t.slaDays,isInitialPhase:t.isInitialPhase,updatedAt:new Date}),t.isInitialPhase&&(yield this.firestoreService.unsetOtherInitialPhases(this.boardId,this.currentColumn.id)),this.columnUpdated.emit();else{let i=Math.max(...this.columns.map(d=>d.order||0),-1)+1,n={name:t.name,color:t.color,order:i,endStageType:t.endStageType,slaDays:t.slaDays,isInitialPhase:t.isInitialPhase,boardId:this.boardId,companyId:"",createdAt:new Date,updatedAt:new Date},r=yield this.firestoreService.createColumn(this.ownerId,this.boardId,n);t.isInitialPhase&&r?.id&&(yield this.firestoreService.unsetOtherInitialPhases(this.boardId,r.id)),this.columnCreated.emit()}this.hide()}catch(t){console.error("Erro ao salvar coluna:",t),this.errorMessage="Erro ao salvar fase. Tente novamente."}finally{this.isLoading=!1}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}getFieldError(t){let e=this.columnForm.get(t);return e?.errors&&e.touched&&e.errors.required?`${this.getFieldLabel(t)} \xE9 obrigat\xF3rio`:""}getFieldLabel(t){return{name:"Nome da Fase",color:"Cor",endStageType:"Tipo de Finaliza\xE7\xE3o",slaDays:"SLA (dias)"}[t]||t}deleteColumn(){return D(this,null,function*(){if(!(!this.currentColumn||!this.currentColumn.id||!confirm(`Deseja excluir a fase "${this.currentColumn.name}"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.`))){this.isLoading=!0,this.errorMessage="";try{yield this.firestoreService.deleteColumn(this.ownerId,this.boardId,this.currentColumn.id),this.columnDeleted.emit(),this.hide()}catch(e){console.error("Erro ao excluir coluna:",e),this.errorMessage="Erro ao excluir fase. Tente novamente."}finally{this.isLoading=!1}}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-column-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns"},outputs:{columnCreated:"columnCreated",columnUpdated:"columnUpdated",columnDeleted:"columnDeleted",closeModal:"closeModal"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","overflow-y-auto"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6",3,"ngSubmit","formGroup"],[1,"space-y-4"],[1,"form-group"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","id","name","formControlName","name","placeholder","Digite o nome da fase",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"grid","grid-cols-8","gap-2","mb-3","p-3","bg-gray-50","rounded-lg"],["class","color-swatch w-10 h-10 rounded-lg border-2 transition-all duration-200 hover:scale-105 hover:shadow-md relative cursor-pointer",3,"style","border-gray-800","border-gray-300","ring-2","ring-blue-500","title","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-600"],["type","color","formControlName","color","title","Escolher cor personalizada",1,"w-12","h-8","border","border-gray-300","rounded","cursor-pointer",3,"disabled"],[1,"text-xs","text-gray-500","ml-1"],["for","endStageType",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","endStageType","formControlName","endStageType",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500","mt-1"],["for","slaDays",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","number","id","slaDays","formControlName","slaDays","min","0","placeholder","Ex: 3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"disabled"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","isInitialPhase",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"flex","items-start"],[1,"fas","fa-info-circle","text-blue-500","mt-0.5","mr-2"],[1,"text-sm","text-blue-700"],[1,"mt-1","ml-2","list-disc"],[1,"flex","justify-between","mt-6","pt-4","border-t","border-gray-200"],["type","button","class","px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg font-medium transition-colors flex items-center",3,"disabled","click",4,"ngIf"],[4,"ngIf"],[1,"flex","gap-3"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-2","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],[1,"color-swatch","w-10","h-10","rounded-lg","border-2","transition-all","duration-200","hover:scale-105","hover:shadow-md","relative","cursor-pointer",3,"click","title"],["class","absolute inset-0 flex items-center justify-center",4,"ngIf"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"fas","fa-check","text-white","text-sm","drop-shadow-md"],[3,"value"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],["type","button",1,"px-4","py-2","text-red-700","bg-red-100","hover:bg-red-200","rounded-lg","font-medium","transition-colors","flex","items-center",3,"click","disabled"],[1,"fas","fa-trash","mr-2"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,Go,79,24,"div",0),e&2&&m("ngIf",i.isVisible)},dependencies:[K,Z,Y,oe,ue,ge,he,ie,Xe,Pe,Ne,ne,me,Mt,re,pe,fe],styles:[`.fixed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.bg-white[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.form-group[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #3b82f61a}.border-red-500[_ngcontent-%COMP%]{border-color:#ef4444!important}select[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.color-swatch[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a;background-clip:padding-box!important}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #00000026}.color-swatch[_ngcontent-%COMP%]:active{transform:scale(.98)}.color-swatch[_ngcontent-%COMP%]   .fa-check[_ngcontent-%COMP%]{text-shadow:0 1px 2px rgba(0,0,0,.5)}.grid[_ngcontent-%COMP%]   .color-swatch[_ngcontent-%COMP%]{background:none!important}input[type=color][_ngcontent-%COMP%]{appearance:none;border:none;cursor:pointer}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch-wrapper{padding:0;border:1px solid #d1d5db;border-radius:4px}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch{border:none;border-radius:3px}input[type=color][_ngcontent-%COMP%]::-moz-color-swatch{border:none;border-radius:3px}`]})};var Wo=()=>["radio","checkbox","temperatura","file"],Qo=()=>["text","email","tel","number","date","time","cnpj","cpf"],Zo=()=>["Quente","Morno","Frio"];function Yo(o,t){if(o&1){let e=F();a(0,"div",17),x("click",function(){let n=_(e).$implicit,r=u();return v(r.selectFieldType(n.value))}),a(1,"div",18)(2,"div",19),g(3,"i",20),s(),a(4,"div")(5,"div",21),c(6),s(),a(7,"div",22),c(8),s()()()()}if(o&2){let e=t.$implicit,i=u();A("selected",i.selectedFieldType===e.value),l(3),Oe(i.getFieldTypeIcon(e.value)),l(3),P(e.label),l(2),P(i.getFieldTypeDescription(e.value))}}function Jo(o,t){if(o&1&&(a(0,"div")(1,"label",24),c(2," Placeholder "),s(),g(3,"input",47),s()),o&2){let e=u(2);l(3),m("placeholder",e.getPlaceholderExample(e.selectedFieldType))}}function Xo(o,t){if(o&1){let e=F();a(0,"div")(1,"label",24),c(2," Configura\xE7\xF5es do Arquivo "),s(),a(3,"label",31)(4,"input",48),x("change",function(n){_(e);let r=u(2);return v(r.fieldsForm.patchValue({placeholder:n.target.checked?"multiple":""}))}),s(),a(5,"span",33),c(6,"Permitir m\xFAltiplos arquivos"),s()()()}if(o&2){let e,i=u(2);l(4),m("checked",((e=i.fieldsForm.get("placeholder"))==null?null:e.value)==="multiple")}}function er(o,t){o&1&&(a(0,"div")(1,"label",24),c(2," Op\xE7\xF5es * "),s(),g(3,"textarea",49),a(4,"div",50),c(5,"Uma op\xE7\xE3o por linha"),s()())}function tr(o,t){o&1&&(a(0,"div")(1,"div")(2,"label",24),c(3," Op\xE7\xF5es de Checkbox * "),s(),g(4,"textarea",49),a(5,"div",50),c(6,"Uma op\xE7\xE3o por linha"),s()()())}function ir(o,t){o&1&&(a(0,"div",51)(1,"div",52),g(2,"i",53),a(3,"div",54)(4,"strong"),c(5,"Campo Respons\xE1vel:"),s(),g(6,"br"),c(7," Exibe uma lista com os usu\xE1rios da empresa para sele\xE7\xE3o do respons\xE1vel pelo registro. "),s()()())}function nr(o,t){o&1&&(a(0,"div",51)(1,"div",52),g(2,"i",53),a(3,"div",54)(4,"strong"),c(5,"Campo Temperatura:"),s(),g(6,"br"),c(7," Este campo criar\xE1 automaticamente uma lista suspensa com: "),a(8,"ul",55)(9,"li"),c(10,"\u{1F525} "),a(11,"strong"),c(12,"Quente"),s(),c(13," - Para leads com alta probabilidade"),s(),a(14,"li"),c(15,"\u{1F324}\uFE0F "),a(16,"strong"),c(17,"Morno"),s(),c(18," - Para leads com m\xE9dia probabilidade"),s(),a(19,"li"),c(20,"\u2744\uFE0F "),a(21,"strong"),c(22,"Frio"),s(),c(23," - Para leads com baixa probabilidade"),s()()()()())}function or(o,t){o&1&&(a(0,"div")(1,"label",24),c(2," Nome na API (opcional) "),s(),g(3,"input",56),a(4,"div",50),c(5,"Deixe vazio para usar o nome do campo"),s()())}function rr(o,t){if(o&1){let e=F();a(0,"button",57),x("click",function(){_(e);let n=u(2);return v(n.cancelEdit())}),c(1," Cancelar "),s()}}function ar(o,t){if(o&1){let e=F();a(0,"form",23)(1,"div")(2,"label",24),c(3," Nome do Campo * "),s(),g(4,"input",25),s(),a(5,"div")(6,"label",24),c(7," R\xF3tulo do Campo * "),s(),g(8,"input",26),s(),b(9,Jo,4,1,"div",27)(10,Xo,7,1,"div",27)(11,er,6,0,"div",27)(12,tr,7,0,"div",27)(13,ir,8,0,"div",28)(14,nr,24,0,"div",28),a(15,"div",29)(16,"h4",30),c(17,"Valida\xE7\xF5es"),s(),a(18,"label",31),g(19,"input",32),a(20,"span",33),c(21,"Campo obrigat\xF3rio"),s()()(),a(22,"div",29)(23,"h4",30),c(24,"Integra\xE7\xE3o API"),s(),a(25,"label",31),g(26,"input",34),a(27,"span",33),c(28,"Incluir este campo na API"),s()(),a(29,"div",35)(30,"p",36),c(31,"Op\xE7\xF5es de Exibi\xE7\xE3o"),s(),a(32,"label",31),g(33,"input",37),a(34,"span",33),c(35,"Exibir no card do registro"),s()(),a(36,"label",31),g(37,"input",38),a(38,"span",33),c(39,"Exibir em todas as fases"),s()(),a(40,"label",31),g(41,"input",39),a(42,"span",33),c(43,"Dispon\xEDvel para filtros"),s()(),a(44,"label",31),g(45,"input",40),a(46,"span",33),c(47,"Permitir edi\xE7\xE3o em qualquer fase"),s()(),a(48,"p",41),c(49," \u{1F4A1} Campos vis\xEDveis no card s\xE3o automaticamente vis\xEDveis em todas as fases "),s(),a(50,"p",42),c(51," \u{1F30D} Campos globais aparecem separados e podem ser editados em qualquer fase "),s()(),a(52,"label",31),g(53,"input",43),a(54,"span",33),c(55,"Obrigat\xF3rio para avan\xE7ar de fase"),s()(),b(56,or,6,0,"div",27),s(),a(57,"div",44)(58,"button",45),x("click",function(){_(e);let n=u();return v(n.addField())}),c(59),s(),b(60,rr,2,0,"button",46),s()()}if(o&2){let e,i=u();m("formGroup",i.fieldsForm),l(9),m("ngIf",!N(13,Wo).includes(i.selectedFieldType)),l(),m("ngIf",i.selectedFieldType==="file"),l(),m("ngIf",i.selectedFieldType==="select"||i.selectedFieldType==="radio"),l(),m("ngIf",i.selectedFieldType==="checkbox"),l(),m("ngIf",i.selectedFieldType==="responsavel"),l(),m("ngIf",i.selectedFieldType==="temperatura"),l(42),m("ngIf",(e=i.fieldsForm.get("includeInApi"))==null?null:e.value),l(2),W("background-color",i.getPrimaryColor()),m("disabled",i.fieldsForm.invalid),l(),S(" ",i.editingIndex>=0?"Atualizar Campo":"Adicionar Campo"," "),l(),m("ngIf",i.editingIndex>=0)}}function sr(o,t){o&1&&(a(0,"div",58),g(1,"i",59),a(2,"p",60),c(3,"Selecione um tipo de campo \xE0 esquerda para come\xE7ar"),s()())}function lr(o,t){if(o&1){let e=F();a(0,"button",68),x("click",function(){_(e);let n=u(2);return v(n.showApiSchema())}),g(1,"i",69),a(2,"span"),c(3,"API"),s()()}}function dr(o,t){o&1&&(a(0,"span",83),c(1,"*"),s())}function cr(o,t){o&1&&(a(0,"span",84),g(1,"i",85),s())}function mr(o,t){if(o&1){let e=F();a(0,"div",70)(1,"div",71)(2,"div",72),g(3,"i",73),s(),g(4,"i",74),a(5,"span",75),c(6),s(),b(7,dr,2,0,"span",76)(8,cr,2,0,"span",77),s(),a(9,"div",78)(10,"button",79),x("click",function(){let n=_(e).index,r=u(2);return v(r.editField(n))}),g(11,"i",80),s(),a(12,"button",81),x("click",function(){let n=_(e).index,r=u(2);return v(r.openRemoveField(n))}),g(13,"i",82),s()()()}if(o&2){let e=t.$implicit,i=u(2);l(4),Oe(i.getFieldTypeIcon(e.type)),l(2),P(e.label),l(),m("ngIf",e.required),l(),m("ngIf",e.includeInApi!==!1)}}function ur(o,t){if(o&1){let e=F();a(0,"div",61)(1,"div",62)(2,"div",63)(3,"div",64),c(4),s(),b(5,lr,4,0,"button",65),s(),a(6,"div",66),x("cdkDropListDropped",function(n){_(e);let r=u();return v(r.onDrop(n))}),b(7,mr,14,5,"div",67),s()()()}if(o&2){let e=u();l(4),S(" Campos (",e.fields.length,") "),l(),m("ngIf",e.fields.length>0),l(2),m("ngForOf",e.fields)}}function pr(o,t){o&1&&(a(0,"div",86)(1,"div",87),g(2,"i",88),s(),a(3,"h4",89),c(4,"Formul\xE1rio Vazio"),s(),a(5,"p",90),c(6,"Adicione campos \xE0 esquerda para ver a visualiza\xE7\xE3o aqui"),s()())}function fr(o,t){o&1&&(a(0,"span",103),c(1,"*"),s())}function gr(o,t){if(o&1&&g(0,"input",104),o&2){let e=u().$implicit,i=u(2);m("type",e.type==="cnpj"||e.type==="cpf"?"text":e.type)("placeholder",e.placeholder||i.getPlaceholderExample(e.type))("required",e.required)}}function hr(o,t){if(o&1&&(a(0,"textarea",105),c(1,"              "),s()),o&2){let e=u().$implicit;m("placeholder",e.placeholder||"")("required",e.required)}}function _r(o,t){if(o&1&&(a(0,"option",109),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" ",e," ")}}function vr(o,t){if(o&1&&(a(0,"select",106)(1,"option",107),c(2,"Selecione uma op\xE7\xE3o"),s(),b(3,_r,2,2,"option",108),s()),o&2){let e=u().$implicit;m("required",e.required),l(3),m("ngForOf",e.options)}}function br(o,t){o&1&&(a(0,"span"),c(1,"\u{1F525}"),s())}function xr(o,t){o&1&&(a(0,"span"),c(1,"\u{1F324}\uFE0F"),s())}function yr(o,t){o&1&&(a(0,"span"),c(1,"\u2744\uFE0F"),s())}function Cr(o,t){if(o&1&&(a(0,"option",109),c(1),b(2,br,2,0,"span",27)(3,xr,2,0,"span",27)(4,yr,2,0,"span",27),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" \u{1F321}\uFE0F ",e," "),l(),m("ngIf",e==="Quente"),l(),m("ngIf",e==="Morno"),l(),m("ngIf",e==="Frio")}}function wr(o,t){if(o&1&&(a(0,"select",106)(1,"option",107),c(2,"Selecione a temperatura"),s(),b(3,Cr,5,5,"option",108),s()),o&2){let e=u().$implicit;m("required",e.required),l(3),m("ngForOf",e.options||N(2,Zo))}}function Er(o,t){if(o&1&&(a(0,"label",112),g(1,"input",113),a(2,"span",114),c(3),s()()),o&2){let e=t.$implicit,i=u(2).$implicit;l(),m("name",i.name+"_preview")("value",e)("required",i.required),l(2),P(e)}}function Sr(o,t){if(o&1&&(a(0,"div",110),b(1,Er,4,4,"label",111),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options)}}function Ir(o,t){if(o&1&&(a(0,"label",112),g(1,"input",115),a(2,"span",114),c(3),s()()),o&2){let e=t.$implicit,i=t.index,n=u(2).$implicit;l(),m("name",n.name+"_preview_"+i)("value",e)("required",n.required&&i===0),l(2),P(e)}}function Fr(o,t){if(o&1&&(a(0,"div")(1,"div",110),b(2,Ir,4,4,"label",111),s()()),o&2){let e=u().$implicit;l(2),m("ngForOf",e.options)}}function Dr(o,t){if(o&1&&(a(0,"div"),g(1,"input",116),a(2,"div",50),c(3),s()()),o&2){let e=u().$implicit;l(),m("multiple",e.placeholder==="multiple")("required",e.required),l(2),S(" ",e.placeholder==="multiple"?"M\xFAltiplos arquivos permitidos":"Upload de arquivo"," ")}}function Pr(o,t){if(o&1){let e=F();a(0,"div",96),x("click",function(){let n=_(e),r=n.$implicit,d=n.index,p=u(2);return v(p.selectField(r,d))}),a(1,"label",97),c(2),b(3,fr,2,0,"span",98),s(),b(4,gr,1,3,"input",99)(5,hr,2,2,"textarea",100)(6,vr,4,2,"select",101)(7,wr,4,3,"select",101)(8,Sr,2,1,"div",102)(9,Fr,3,1,"div",27)(10,Dr,4,3,"div",27),s()}if(o&2){let e=t.$implicit,i=u(2);A("bg-blue-50",i.selectedField===e)("border-blue-200",i.selectedField===e)("border",i.selectedField===e)("p-3",i.selectedField===e)("rounded",i.selectedField===e),l(2),S(" ",e.label," "),l(),m("ngIf",e.required),l(),m("ngIf",N(19,Qo).includes(e.type)),l(),m("ngIf",e.type==="textarea"),l(),m("ngIf",e.type==="select"),l(),m("ngIf",e.type==="temperatura"),l(),m("ngIf",e.type==="radio"),l(),m("ngIf",e.type==="checkbox"),l(),m("ngIf",e.type==="file")}}function Mr(o,t){if(o&1&&(a(0,"div",91)(1,"div",92)(2,"h4",93),c(3,"Pr\xE9-visualiza\xE7\xE3o"),s(),a(4,"form",94),b(5,Pr,11,20,"div",95),s()()()),o&2){let e=u();l(5),m("ngForOf",e.fields)}}function Tr(o,t){if(o&1){let e=F();a(0,"div",117),x("click",function(){_(e);let n=u();return v(n.cancelRemoveField())}),a(1,"div",118),x("click",function(n){return _(e),v(n.stopPropagation())}),a(2,"h3",119),c(3,"Remover campo"),s(),a(4,"p",120),c(5,"Tem certeza que deseja remover este campo do formul\xE1rio?"),s(),a(6,"div",121)(7,"button",122),x("click",function(){_(e);let n=u();return v(n.cancelRemoveField())}),c(8,"Cancelar"),s(),a(9,"button",123),x("click",function(){_(e);let n=u();return v(n.confirmRemoveField())}),c(10,"Remover"),s()()()()}}var nt=class o{fields=[];fieldsChanged=new C;fb=I(_e);subdomainService=I(Me);fieldsForm;editingField=null;editingIndex=-1;selectedFieldType="";selectedField=null;showDeleteConfirm=!1;fieldPendingDeleteIndex=-1;fieldTypes=[{value:"text",label:"Texto"},{value:"email",label:"E-mail"},{value:"tel",label:"Telefone"},{value:"number",label:"N\xFAmero"},{value:"cnpj",label:"CNPJ"},{value:"cpf",label:"CPF"},{value:"temperatura",label:"Temperatura"},{value:"responsavel",label:"Respons\xE1vel"},{value:"textarea",label:"\xC1rea de Texto"},{value:"select",label:"Lista Suspensa"},{value:"checkbox",label:"Checkbox"},{value:"radio",label:"Bot\xE3o de R\xE1dio"},{value:"date",label:"Data"},{value:"time",label:"Hora"},{value:"file",label:"Upload de Arquivo"}];constructor(){this.fieldsForm=this.fb.group({name:["",q.required],label:["",q.required],type:["text",q.required],required:[!1],placeholder:[""],options:[""],includeInApi:[!0],apiFieldName:[""],showInCard:[!1],requiredToAdvance:[!1],showInAllPhases:[!1],showInFilters:[!1],allowEditInAnyPhase:[!1]}),this.fieldsForm.get("showInCard")?.valueChanges.subscribe(t=>{t&&this.fieldsForm.patchValue({showInAllPhases:!0},{emitEvent:!1})}),this.fieldsForm.get("showInAllPhases")?.valueChanges.subscribe(t=>{t||this.fieldsForm.patchValue({showInCard:!1},{emitEvent:!1})})}ngOnInit(){this.fields&&this.fields.length>0&&this.emitFieldsChange()}openRemoveField(t){this.fieldPendingDeleteIndex=t,this.showDeleteConfirm=!0}cancelRemoveField(){this.showDeleteConfirm=!1,this.fieldPendingDeleteIndex=-1}confirmRemoveField(){this.fieldPendingDeleteIndex<0||(this.removeField(this.fieldPendingDeleteIndex),this.cancelRemoveField())}removeField(t){this.fields.splice(t,1),this.selectedField===this.fields[t]&&(this.selectedField=null,this.selectedFieldType=""),this.emitFieldsChange()}moveFieldUp(t){if(t>0){let e=this.fields[t];this.fields[t]=this.fields[t-1],this.fields[t-1]=e,this.updateFieldOrders(),this.emitFieldsChange()}}moveFieldDown(t){if(t<this.fields.length-1){let e=this.fields[t];this.fields[t]=this.fields[t+1],this.fields[t+1]=e,this.updateFieldOrders(),this.emitFieldsChange()}}onDrop(t){qe(this.fields,t.previousIndex,t.currentIndex),this.updateFieldOrders(),this.emitFieldsChange()}resetForm(){this.fieldsForm.reset({type:"text",required:!1,includeInApi:!0,showInCard:!1,requiredToAdvance:!1,showInAllPhases:!1,showInFilters:!1,allowEditInAnyPhase:!1})}updateFieldOrders(){this.fields.forEach((t,e)=>{t.order=e})}emitFieldsChange(){console.log("\u{1F4E4} emitFieldsChange CHAMADO"),console.log("\u{1F4E4} Total de campos:",this.fields?.length),console.log("\u{1F4E4} Campos atuais:",this.fields),this.fields?.forEach((t,e)=>{console.log(`\u{1F4E4} Campo emitido ${e+1}:`,{name:t.name,label:t.label,type:t.type,showInCard:t.showInCard,showInAllPhases:t.showInAllPhases,showInFilters:t.showInFilters,completeField:t})}),this.fieldsChanged.emit([...this.fields]),console.log("\u{1F4E4} emitFieldsChange CONCLU\xCDDO - fieldsChanged.emit() executado")}getFieldTypeLabel(t){let e=this.fieldTypes.find(i=>i.value===t);return e?e.label:t}selectFieldType(t){if(this.selectedFieldType=t,this.fieldsForm.patchValue({type:t}),!this.fieldsForm.get("name")?.value){let e=t+(this.fields.length+1);this.fieldsForm.patchValue({name:e})}}selectField(t,e){this.selectedField=t,this.editField(e)}getFieldTypeIcon(t){return{text:"fas fa-font",email:"fas fa-envelope",tel:"fas fa-phone",number:"fas fa-hashtag",cnpj:"fas fa-building",cpf:"fas fa-id-card",temperatura:"fas fa-thermometer-half",responsavel:"fas fa-user",textarea:"fas fa-align-left",select:"fas fa-list",checkbox:"fas fa-check-square",radio:"fas fa-dot-circle",date:"fas fa-calendar",time:"fas fa-clock",file:"fas fa-upload"}[t]||"fas fa-question"}getFieldTypeDescription(t){return{text:"Campo de texto simples",email:"Campo de e-mail com valida\xE7\xE3o",tel:"Telefone com m\xE1scara DDD Brasil",number:"Campo num\xE9rico",cnpj:"CNPJ com m\xE1scara e valida\xE7\xE3o",cpf:"CPF com m\xE1scara e valida\xE7\xE3o",temperatura:"Lista suspensa (Quente, Morno, Frio)",responsavel:"Lista de usu\xE1rios da empresa",textarea:"\xC1rea de texto multilinha",select:"Lista suspensa",checkbox:"Caixa de sele\xE7\xE3o",radio:"Bot\xF5es de sele\xE7\xE3o \xFAnica",date:"Seletor de data",time:"Seletor de hora",file:"Upload de arquivos"}[t]||"Campo personalizado"}addField(){console.log("\u2795 addField INICIADO");let t=this.fieldsForm.value;if(console.log("\u2795 Valores do formul\xE1rio:",t),!t.name||!t.label){console.log("\u2795 ERRO: Nome e r\xF3tulo s\xE3o obrigat\xF3rios"),alert("Nome e r\xF3tulo s\xE3o obrigat\xF3rios");return}if(this.fields.some(r=>r.name===t.name&&this.editingIndex===-1)){console.log("\u2795 ERRO: J\xE1 existe um campo com este nome"),alert("J\xE1 existe um campo com este nome");return}let e=t.showInCard||!1,i=e?!0:t.showInAllPhases||!1;console.log("\u2795 Configura\xE7\xF5es de visibilidade:",{showInCard:e,showInAllPhases:i}),console.log("\u2795 allowEditInAnyPhase:",t.allowEditInAnyPhase);let n=R(R({name:t.name,label:t.label,type:t.type||this.selectedFieldType,required:t.required||!1,order:this.editingIndex>=0?this.fields[this.editingIndex].order:this.fields.length,includeInApi:t.includeInApi!==!1,showInCard:e,requiredToAdvance:t.requiredToAdvance||!1,showInAllPhases:i,showInFilters:t.showInFilters||!1,allowEditInAnyPhase:t.allowEditInAnyPhase||!1},t.placeholder&&t.placeholder.trim()&&{placeholder:t.placeholder.trim()}),t.apiFieldName&&t.apiFieldName.trim()&&{apiFieldName:t.apiFieldName.trim()});console.log("\u2795 Novo campo criado:",n),(n.type==="select"||n.type==="radio"||n.type==="checkbox")&&t.options&&(n.options=t.options.split(`
`).map(r=>r.trim()).filter(r=>r),console.log("\u2795 Op\xE7\xF5es processadas para select/radio/checkbox:",n.options)),n.type==="temperatura"&&(n.options=["Quente","Morno","Frio"],console.log("\u2795 Op\xE7\xF5es auto-configuradas para temperatura:",n.options)),console.log("\u2795 Campo final antes de adicionar:",n),this.editingIndex>=0?(console.log("\u2795 EDITANDO campo existente no \xEDndice:",this.editingIndex),this.fields[this.editingIndex]=n,this.editingIndex=-1,this.selectedField=null):(console.log("\u2795 ADICIONANDO novo campo"),console.log("\u2795 Array antes do push:",this.fields),this.fields.push(n),console.log("\u2795 Array depois do push:",this.fields)),console.log("\u2795 Total de campos ap\xF3s opera\xE7\xE3o:",this.fields.length),this.resetForm(),console.log("\u2795 Chamando emitFieldsChange..."),this.emitFieldsChange(),console.log("\u2795 addField CONCLU\xCDDO")}editField(t){let e=this.fields[t];console.log("\u270F\uFE0F Editando campo:",e),console.log("\u270F\uFE0F allowEditInAnyPhase no campo original:",e.allowEditInAnyPhase),this.editingIndex=t,this.editingField=R({},e),this.selectedFieldType=e.type,this.selectedField=e;let i={name:e.name,label:e.label,type:e.type,required:e.required,placeholder:e.placeholder||"",options:e.options?e.options.join(`
`):"",includeInApi:e.includeInApi!==!1,apiFieldName:e.apiFieldName||"",showInCard:e.showInCard||!1,requiredToAdvance:e.requiredToAdvance||!1,showInAllPhases:e.showInAllPhases||!1,showInFilters:e.showInFilters||!1,allowEditInAnyPhase:e.allowEditInAnyPhase||!1};console.log("\u270F\uFE0F Valores sendo aplicados ao formul\xE1rio:",i),this.fieldsForm.patchValue(i),setTimeout(()=>{let n=this.fieldsForm.get("allowEditInAnyPhase")?.value;console.log("\u270F\uFE0F Valor atual no formul\xE1rio ap\xF3s patchValue:",n)},100)}cancelEdit(){this.editingIndex=-1,this.editingField=null,this.selectedField=null,this.selectedFieldType="",this.resetForm()}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}getPlaceholderExample(t){return{text:"Ex: Digite seu nome",email:"Ex: usuario@exemplo.com",tel:"Ex: (11) 99999-9999",number:"Ex: 123",cnpj:"Ex: 00.000.000/0000-00",cpf:"Ex: 000.000.000-00",textarea:"Ex: Digite suas observa\xE7\xF5es...",date:"",time:""}[t]||"Ex: Digite aqui"}generateApiSchema(){let t=this.fields.filter(i=>i.includeInApi!==!1);return{fields:t.map(i=>R({name:i.apiFieldName||i.name,originalName:i.name,label:i.label,type:this.mapFieldTypeForApi(i.type),required:i.required,validation:this.getValidationRules(i)},i.options&&{options:i.options})),totalFields:t.length,generatedAt:new Date().toISOString()}}mapFieldTypeForApi(t){return{text:"string",email:"email",tel:"phone",number:"number",cnpj:"cnpj",cpf:"cpf",temperatura:"enum",responsavel:"string",textarea:"text",select:"enum",checkbox:"boolean",radio:"enum",date:"date",time:"time",file:"file"}[t]||"string"}getValidationRules(t){let e={};switch(t.required&&(e.required=!0),t.type){case"email":e.format="email";break;case"cnpj":e.format="cnpj",e.mask="00.000.000/0000-00";break;case"cpf":e.format="cpf",e.mask="000.000.000-00";break;case"tel":e.format="phone",e.mask="(00) 00000-0000";break;case"temperatura":case"select":case"radio":t.options&&(e.enum=t.options);break;case"file":e.type="file",t.placeholder==="multiple"&&(e.multiple=!0);break}return e}showApiSchema(){let t=this.generateApiSchema(),e=JSON.stringify(t,null,2);console.log("\u{1F4CB} Schema da API gerado:",t),console.log("\u{1F4CB} JSON Schema:",e);let i=`
\u{1F4CB} Schema da API - Resumo:

\u2705 Campos na API: ${t.totalFields}/${this.fields.length}
\u{1F4C5} Gerado em: ${new Date().toLocaleString("pt-BR")}

\u{1F517} Campos inclu\xEDdos na API:
${t.fields.map(n=>`\u2022 ${n.label} (${n.name}) - Tipo: ${n.type}${n.required?" *":""}`).join(`
`)}

\u{1F4CB} Schema completo salvo no console para c\xF3pia.
    `;alert(i)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-visual-form-builder"]],inputs:{fields:"fields"},outputs:{fieldsChanged:"fieldsChanged"},decls:23,vars:8,consts:[[1,"form-builder","h-full","flex","bg-gray-50"],[1,"w-64","bg-white","border-r","border-gray-200","flex","flex-col"],[1,"p-4","border-b","border-gray-200"],[1,"text-sm","font-semibold","text-gray-900","uppercase","tracking-wide"],[1,"flex-1","p-3","space-y-2","overflow-y-auto"],["class","field-type-item p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors",3,"selected","click",4,"ngFor","ngForOf"],[1,"w-80","bg-white","border-r","border-gray-200","flex","flex-col"],[1,"flex-1","p-4","overflow-y-auto"],["class","space-y-4",3,"formGroup",4,"ngIf"],["class","text-center py-8",4,"ngIf"],[1,"flex-1","bg-gray-50","flex","flex-col"],[1,"p-4","bg-white","border-b","border-gray-200"],["class","bg-white border-b border-gray-200 flex-shrink-0",4,"ngIf"],[1,"flex-1","p-6","overflow-y-auto"],["class","text-center py-16",4,"ngIf"],["class","max-w-2xl mx-auto",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",3,"click",4,"ngIf"],[1,"field-type-item","p-3","border","border-gray-300","rounded-lg","cursor-pointer","hover:border-blue-400","hover:bg-blue-50","transition-colors",3,"click"],[1,"flex","items-center","space-x-3"],[1,"w-8","h-8","bg-gray-100","rounded-md","flex","items-center","justify-center"],[1,"text-gray-600","text-sm"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"space-y-4",3,"formGroup"],[1,"block","text-xs","font-medium","text-gray-700","mb-2","uppercase","tracking-wide"],["type","text","formControlName","name","placeholder","Ex: nomeCompleto",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["type","text","formControlName","label","placeholder","Ex: Nome Completo",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],[4,"ngIf"],["class","p-3 bg-blue-50 border border-blue-200 rounded-md",4,"ngIf"],[1,"space-y-3"],[1,"text-xs","font-medium","text-gray-700","uppercase","tracking-wide"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","required",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],[1,"text-sm","text-gray-700"],["type","checkbox","formControlName","includeInApi",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],[1,"bg-blue-50","border","border-blue-200","rounded-md","p-3","space-y-2"],[1,"text-xs","text-blue-700","font-medium","mb-2"],["type","checkbox","formControlName","showInCard",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],["type","checkbox","formControlName","showInAllPhases",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],["type","checkbox","formControlName","showInFilters",1,"h-4","w-4","text-purple-600","focus:ring-purple-500","border-gray-300","rounded"],["type","checkbox","formControlName","allowEditInAnyPhase",1,"h-4","w-4","text-green-600","focus:ring-green-500","border-gray-300","rounded"],[1,"text-xs","text-blue-600","italic"],[1,"text-xs","text-green-600","italic"],["type","checkbox","formControlName","requiredToAdvance",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded"],[1,"pt-4","border-t","border-gray-200","space-y-3"],["type","button",1,"w-full","px-4","py-2","text-white","text-sm","rounded-lg","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["type","button","class","w-full px-4 py-2 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50 transition-colors",3,"click",4,"ngIf"],["type","text","formControlName","placeholder",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"placeholder"],["type","checkbox",1,"h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"change","checked"],["formControlName","options","rows","4","placeholder",`Digite uma op\xE7\xE3o por linha:
Op\xE7\xE3o 1
Op\xE7\xE3o 2
Op\xE7\xE3o 3`,1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],[1,"text-xs","text-gray-500","mt-1"],[1,"p-3","bg-blue-50","border","border-blue-200","rounded-md"],[1,"flex","items-start"],[1,"fas","fa-info-circle","text-blue-500","mr-2","mt-0.5"],[1,"text-sm","text-blue-700"],[1,"mt-2","space-y-1"],["type","text","formControlName","apiFieldName","placeholder","Se vazio, usar\xE1 o nome do campo",1,"w-full","px-3","py-2","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500"],["type","button",1,"w-full","px-4","py-2","border","border-gray-300","text-gray-700","text-sm","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-center","py-8"],[1,"fas","fa-mouse-pointer","text-gray-300","text-3xl","mb-3"],[1,"text-sm","text-gray-500"],[1,"bg-white","border-b","border-gray-200","flex-shrink-0"],[1,"px-4","py-2"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","text-gray-500","uppercase","tracking-wide"],["class","text-xs text-blue-500 hover:text-blue-700 flex items-center space-x-1","title","Ver Schema da API",3,"click",4,"ngIf"],["cdkDropList","",1,"space-y-1","max-h-32","overflow-y-auto",3,"cdkDropListDropped"],["cdkDrag","","class","field-item flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded text-xs hover:bg-gray-100 transition-colors",4,"ngFor","ngForOf"],["title","Ver Schema da API",1,"text-xs","text-blue-500","hover:text-blue-700","flex","items-center","space-x-1",3,"click"],[1,"fas","fa-code"],["cdkDrag","",1,"field-item","flex","items-center","justify-between","p-2","bg-gray-50","border","border-gray-200","rounded","text-xs","hover:bg-gray-100","transition-colors"],[1,"flex","items-center","space-x-2","flex-1"],["cdkDragHandle","",1,"cursor-move","text-gray-400"],[1,"fas","fa-grip-vertical"],[1,"text-gray-500"],[1,"font-medium","text-gray-900","truncate"],["class","text-red-500 text-xs",4,"ngIf"],["class","text-blue-500 text-xs","title","Inclu\xEDdo na API",4,"ngIf"],[1,"flex","items-center","space-x-1","flex-shrink-0"],["title","Editar",1,"p-1","text-gray-400","hover:text-blue-500",3,"click"],[1,"fas","fa-edit"],["title","Remover",1,"p-1","text-gray-400","hover:text-red-500",3,"click"],[1,"fas","fa-trash"],[1,"text-red-500","text-xs"],["title","Inclu\xEDdo na API",1,"text-blue-500","text-xs"],[1,"fas","fa-plug"],[1,"text-center","py-16"],[1,"w-16","h-16","bg-gray-200","rounded-full","mx-auto","mb-4","flex","items-center","justify-center"],[1,"fas","fa-wpforms","text-gray-400","text-2xl"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],[1,"max-w-2xl","mx-auto"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-6"],[1,"space-y-6"],["class","form-field",3,"bg-blue-50","border-blue-200","border","p-3","rounded","click",4,"ngFor","ngForOf"],[1,"form-field",3,"click"],[1,"block","text-sm","font-medium","text-gray-900","mb-2"],["class","text-red-500 ml-1",4,"ngIf"],["disabled","","class","w-full px-3 py-2 border border-gray-300 rounded-md text-gray-500 bg-gray-50",3,"type","placeholder","required",4,"ngIf"],["disabled","","rows","3","class","w-full px-3 py-2 border border-gray-300 rounded-md resize-none text-gray-500 bg-gray-50",3,"placeholder","required",4,"ngIf"],["disabled","","class","w-full px-3 py-2 border border-gray-300 rounded-md text-gray-500 bg-gray-50",3,"required",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"text-red-500","ml-1"],["disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"type","placeholder","required"],["disabled","","rows","3",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","resize-none","text-gray-500","bg-gray-50",3,"placeholder","required"],["disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"required"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"space-y-2"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["type","radio","disabled","",1,"mr-2","text-gray-400",3,"name","value","required"],[1,"text-gray-700"],["type","checkbox","disabled","",1,"mr-2","text-gray-400",3,"name","value","required"],["type","file","disabled","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","text-gray-500","bg-gray-50",3,"multiple","required"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-[60]",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","p-6",3,"click"],[1,"text-lg","font-bold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-6"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","rounded-lg","border","border-gray-300",3,"click"],[1,"px-4","py-2","rounded-lg","bg-red-600","text-white",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),c(4,"Tipos de Campo"),s()(),a(5,"div",4),b(6,Yo,9,6,"div",5),s()(),a(7,"div",6)(8,"div",2)(9,"h3",3),c(10),s()(),a(11,"div",7),b(12,ar,61,14,"form",8)(13,sr,4,0,"div",9),s()(),a(14,"div",10)(15,"div",11)(16,"h3",3),c(17," Visualiza\xE7\xE3o do Formul\xE1rio "),s()(),b(18,ur,8,3,"div",12),a(19,"div",13),b(20,pr,7,0,"div",14)(21,Mr,6,1,"div",15),s()(),b(22,Tr,11,0,"div",16),s()),e&2&&(l(6),m("ngForOf",i.fieldTypes),l(4),S(" ",i.selectedField?"Propriedades do Campo":"Configura\xE7\xF5es"," "),l(2),m("ngIf",i.selectedFieldType),l(),m("ngIf",!i.selectedFieldType),l(5),m("ngIf",i.fields.length>0),l(2),m("ngIf",i.fields.length===0),l(),m("ngIf",i.fields.length>0),l(),m("ngIf",i.showDeleteConfirm))},dependencies:[K,Z,Y,re,ue,ge,he,ie,Pe,ne,me,pe,fe,Kt,Ut,zt,jt],styles:[".form-builder[_ngcontent-%COMP%]{height:600px}.form-builder[_ngcontent-%COMP%]   .field-type-item[_ngcontent-%COMP%]{transition:all .2s ease}.form-builder[_ngcontent-%COMP%]   .field-type-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}.form-builder[_ngcontent-%COMP%]   .field-type-item.selected[_ngcontent-%COMP%]{border-color:#3b82f6;background-color:#ebf4ff;box-shadow:0 0 0 3px #3b82f61a}.form-builder[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]{transition:all .2s ease}.form-builder[_ngcontent-%COMP%]   .field-item[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;border-color:#d1d5db}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{transition:all .2s ease;cursor:pointer}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]:hover{background-color:#3b82f605}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}.form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled, .form-builder[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{cursor:pointer}.form-builder[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:6px;box-shadow:0 10px 25px #00000026;background:#fff;transform:rotate(5deg)}.form-builder[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#e5e7eb;border:2px dashed #9CA3AF}.form-builder[_ngcontent-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.form-builder[_ngcontent-%COMP%]   .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.form-builder[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]{transition:color .2s ease}.form-builder[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]:hover{color:#3b82f6!important}.form-builder[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]{background:linear-gradient(to right,#f9fafb,#f3f4f6)}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:2px}.form-builder[_ngcontent-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}button[_ngcontent-%COMP%]{transition:all .2s ease}button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.selected-field[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-blue 2s infinite}@keyframes _ngcontent-%COMP%_pulse-blue{0%,to{box-shadow:0 0 #3b82f666}50%{box-shadow:0 0 0 8px #3b82f600}}@media (max-width: 1024px){.form-builder[_ngcontent-%COMP%]   .w-64[_ngcontent-%COMP%]{width:200px}.form-builder[_ngcontent-%COMP%]   .w-80[_ngcontent-%COMP%]{width:240px}}@media (max-width: 768px){.form-builder[_ngcontent-%COMP%]{flex-direction:column;height:auto}.form-builder[_ngcontent-%COMP%]   .w-64[_ngcontent-%COMP%], .form-builder[_ngcontent-%COMP%]   .w-80[_ngcontent-%COMP%]{width:100%;max-height:300px}}"]})};var kr=["formBuilder"],gt=class o{firestoreService=I(J);subdomainService=I(Me);ownerId="";boardId="";formConfigSaved=new C;closeModal=new C;formBuilderComponent;isVisible=!1;isSaving=!1;currentColumn=null;currentConfig=null;formFields=[];showModal(t,e){this.currentColumn=t,this.currentConfig=e,this.isVisible=!0,e&&e.fields?this.formFields=e.fields.map(i=>(i.type==="temperatura"&&(!i.options||i.options.length===0)&&(i.options=["Quente","Morno","Frio"]),ee(R({},i),{includeInApi:i.includeInApi!==!1,showInCard:i.showInCard||!1,requiredToAdvance:!!i.requiredToAdvance,showInAllPhases:!!i.showInAllPhases,allowEditInAnyPhase:!!i.allowEditInAnyPhase,order:i.order||0}))).sort((i,n)=>(i.order||0)-(n.order||0)):this.formFields=[]}onFieldsChanged(t){this.formFields=t}saveFormConfig(){return D(this,null,function*(){if(!this.currentColumn||!this.ownerId||!this.boardId){console.error("Dados necess\xE1rios n\xE3o fornecidos");return}this.isSaving=!0;try{console.log("\u{1F4BE} Salvando configura\xE7\xE3o. Campos antes da limpeza:",this.formFields);let t={columnId:this.currentColumn.id,columnName:this.currentColumn.name,fields:this.formFields.map((e,i)=>{console.log(`\u{1F50D} Campo ${i}: ${e.name}, allowEditInAnyPhase:`,e.allowEditInAnyPhase);let n={name:e.name||"",label:e.label||"",type:e.type||"text",required:e.required||!1,order:i,includeInApi:e.includeInApi!==!1,showInCard:e.showInCard||!1,requiredToAdvance:!!e.requiredToAdvance,showInAllPhases:!!e.showInAllPhases,showInFilters:!!e.showInFilters,allowEditInAnyPhase:!!e.allowEditInAnyPhase};return console.log(`\u2705 Campo limpo ${i}:`,n),e.placeholder&&e.placeholder.trim()&&(n.placeholder=e.placeholder.trim()),e.apiFieldName&&e.apiFieldName.trim()&&(n.apiFieldName=e.apiFieldName.trim()),e.options&&Array.isArray(e.options)&&e.options.length>0&&(n.options=e.options),e.type==="temperatura"&&(!e.options||e.options.length===0)&&(n.options=["Quente","Morno","Frio"]),n}),createdAt:this.currentConfig?this.currentConfig.createdAt:new Date,updatedAt:new Date};this.currentConfig&&this.currentConfig.id?yield this.firestoreService.updatePhaseFormConfig(this.ownerId,this.boardId,this.currentConfig.id,t):yield this.firestoreService.createPhaseFormConfig(this.ownerId,this.boardId,t),console.log("\u2705 Configura\xE7\xE3o do formul\xE1rio salva com sucesso"),this.formConfigSaved.emit(),this.hideModal()}catch(t){console.error("\u274C Erro ao salvar configura\xE7\xE3o do formul\xE1rio:",t),alert("Erro ao salvar configura\xE7\xE3o. Tente novamente.")}finally{this.isSaving=!1}})}hideModal(){this.isVisible=!1,this.currentColumn=null,this.currentConfig=null,this.formFields=[]}onCloseModal(){this.hideModal(),this.closeModal.emit()}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-phase-form-modal"]],viewQuery:function(e,i){if(e&1&&Ce(kr,5),e&2){let n;we(n=Ee())&&(i.formBuilderComponent=n.first)}},inputs:{ownerId:"ownerId",boardId:"boardId"},outputs:{formConfigSaved:"formConfigSaved",closeModal:"closeModal"},decls:14,vars:8,consts:[["formBuilder",""],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-white","rounded-lg","p-6","w-full","max-w-7xl","max-h-[95vh]","overflow-hidden",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"fas","fa-times","text-xl"],[3,"fieldsChanged","fields"],[1,"flex","justify-end","space-x-3","mt-6","pt-4","border-t"],["type","button",1,"px-4","py-2","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-white","rounded-lg","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,i){if(e&1){let n=F();a(0,"div",1),x("click",function(){return _(n),v(i.onCloseModal())}),a(1,"div",2),x("click",function(d){return _(n),v(d.stopPropagation())}),a(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){return _(n),v(i.onCloseModal())}),g(6,"i",6),s()(),a(7,"app-visual-form-builder",7,0),x("fieldsChanged",function(d){return _(n),v(i.onFieldsChanged(d))}),s(),a(9,"div",8)(10,"button",9),x("click",function(){return _(n),v(i.onCloseModal())}),c(11," Cancelar "),s(),a(12,"button",10),x("click",function(){return _(n),v(i.saveFormConfig())}),c(13),s()()()()}e&2&&(A("hidden",!i.isVisible),l(4),S(" Configurar Formul\xE1rio da Fase: ",i.currentColumn==null?null:i.currentColumn.name," "),l(3),m("fields",i.formFields),l(5),W("background-color",i.getPrimaryColor()),m("disabled",i.isSaving),l(),S(" ",i.isSaving?"Salvando...":"Salvar Configura\xE7\xE3o"," "))},dependencies:[K,re,nt],styles:["[_nghost-%COMP%]{display:block}"]})};var Or=()=>({standalone:!0}),Nn=()=>[1,2,3],Ar=()=>[1,2],$n=()=>["Quente","Morno","Frio"],qt=()=>[];function Lr(o,t){if(o&1){let e=F();a(0,"div",44)(1,"span",45),c(2,"ID: "),a(3,"span",46),c(4),s()(),a(5,"button",47),x("click",function(){_(e);let n=u(2);return v(n.copyLeadId())}),c(6,"Copiar"),s()()}if(o&2){let e=u(2);l(4),P(e.currentLead==null?null:e.currentLead.id)}}function Rr(o,t){o&1&&(a(0,"div",50),g(1,"div",51)(2,"div",52),s())}function Vr(o,t){o&1&&(a(0,"div",48),b(1,Rr,3,0,"div",49),s()),o&2&&(l(),m("ngForOf",N(1,Nn)))}function Nr(o,t){if(o&1&&(a(0,"div",58),c(1),s()),o&2){let e=u().$implicit;l(),P(e.value)}}function $r(o,t){if(o&1&&g(0,"input",65),o&2){let e=u(2).$implicit;m("type",e.fieldType)("formControlName",e.formControlName)("placeholder",e.placeholder||"")}}function Br(o,t){if(o&1&&(a(0,"textarea",66),c(1,"                  "),s()),o&2){let e=u(2).$implicit;m("formControlName",e.formControlName)("placeholder",e.placeholder||"")}}function jr(o,t){if(o&1&&g(0,"input",67),o&2){let e=u(2).$implicit;m("formControlName",e.formControlName)("placeholder",e.placeholder||"")}}function zr(o,t){if(o&1&&g(0,"input",68),o&2){let e=u(2).$implicit;m("formControlName",e.formControlName)}}function Ur(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),P(e)}}function Kr(o,t){if(o&1&&(a(0,"select",69)(1,"option",70),c(2,"Selecione..."),s(),b(3,Ur,2,2,"option",71),s()),o&2){let e=u(2).$implicit;m("formControlName",e.formControlName),l(3),m("ngForOf",e.options)}}function Hr(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e.uid),l(),P(e.displayName||e.email)}}function qr(o,t){if(o&1&&(a(0,"select",69)(1,"option",70),c(2,"Selecione o respons\xE1vel..."),s(),b(3,Hr,2,2,"option",71),s()),o&2){let e=u(2).$implicit,i=u(3);m("formControlName",e.formControlName),l(3),m("ngForOf",i.users)}}function Gr(o,t){if(o&1&&(a(0,"div",59),b(1,$r,1,3,"input",60)(2,Br,2,2,"textarea",61)(3,jr,1,2,"input",62)(4,zr,1,1,"input",63)(5,Kr,4,2,"select",64)(6,qr,4,2,"select",64),s()),o&2){let e=u().$implicit,i=u(3);m("formGroup",i.leadForm),l(),m("ngIf",e.fieldType==="text"||e.fieldType==="email"||e.fieldType==="tel"||e.fieldType==="url"||e.fieldType==="cpf"||e.fieldType==="cnpj"),l(),m("ngIf",e.fieldType==="textarea"),l(),m("ngIf",e.fieldType==="number"),l(),m("ngIf",e.fieldType==="date"),l(),m("ngIf",e.fieldType==="select"||e.fieldType==="temperatura"),l(),m("ngIf",e.fieldType==="responsavel")}}function Wr(o,t){if(o&1&&(a(0,"div",54)(1,"div",55),c(2),s(),b(3,Nr,2,1,"div",56)(4,Gr,7,7,"div",57),s()),o&2){let e=t.$implicit;l(2),S(" ",e.label," "),l(),m("ngIf",!e.isEditable),l(),m("ngIf",e.isEditable)}}function Qr(o,t){if(o&1&&(a(0,"div",16),b(1,Wr,5,3,"div",53),s()),o&2){let e=u(2);l(),m("ngForOf",e.getInitialFieldsOnly())}}function Zr(o,t){if(o&1){let e=F();a(0,"div",73)(1,"button",74),x("click",function(){_(e);let n=u(2);return v(n.saveGlobalFields())}),c(2),s()()}if(o&2){let e=u(2);l(),m("disabled",e.isSaving),l(),S(" ",e.isSaving?"Salvando...":"Salvar altera\xE7\xF5es"," ")}}function Yr(o,t){o&1&&(a(0,"div",50)(1,"div",75)(2,"div",76),g(3,"div",77)(4,"div",78),s(),g(5,"div",79),s()())}function Jr(o,t){o&1&&(a(0,"div",48),b(1,Yr,6,0,"div",49),s()),o&2&&(l(),m("ngForOf",N(1,Ar)))}function Xr(o,t){o&1&&(a(0,"span",94),c(1,"ATUAL"),s())}function ea(o,t){if(o&1&&(a(0,"div",89),g(1,"i",95),a(2,"span"),c(3),s()()),o&2){let e=u().$implicit;l(3),S("Sa\xEDda: ",e.exitedAt)}}function ta(o,t){o&1&&(a(0,"div",96),g(1,"i",97),s())}function ia(o,t){if(o&1&&(a(0,"div",81)(1,"div",82)(2,"div",83),g(3,"div",84),a(4,"span",85),c(5),s(),b(6,Xr,2,0,"span",86),s(),a(7,"span",87),c(8),s()(),a(9,"div",88)(10,"div",89),g(11,"i",90),a(12,"span"),c(13),s()(),b(14,ea,4,1,"div",91),a(15,"div",89),g(16,"i",92),a(17,"span"),c(18),s()()(),b(19,ta,2,0,"div",93),s()),o&2){let e=t.$implicit,i=t.index,n=t.last;W("border-left-color",e.phaseColor),A("bg-blue-50",e.isCurrentPhase)("bg-gray-50",!e.isCurrentPhase),l(3),W("background-color",e.phaseColor),l(2),P(e.phaseName),l(),m("ngIf",e.isCurrentPhase),l(2),S("#",i+1),l(5),S("Entrada: ",e.enteredAt),l(),m("ngIf",e.exitedAt!=="Atual"),l(4),S("Dura\xE7\xE3o: ",e.duration),l(),m("ngIf",!n)}}function na(o,t){if(o&1&&(a(0,"div",48),b(1,ia,20,15,"div",80),s()),o&2){let e=u(2);l(),m("ngForOf",e.getPhaseHistoryItems())}}function oa(o,t){o&1&&(a(0,"div",98),g(1,"i",99),a(2,"div"),c(3,"Nenhum hist\xF3rico de fases dispon\xEDvel"),s(),a(4,"div",100),c(5,"O hist\xF3rico ser\xE1 registrado quando o lead for movido entre as fases"),s()())}function ra(o,t){o&1&&(a(0,"div",50),g(1,"div",101)(2,"div",102),s())}function aa(o,t){o&1&&(a(0,"div",14)(1,"h3",20),c(2,"Formul\xE1rio da Fase Atual"),s(),a(3,"div",16),b(4,ra,3,0,"div",49),s()()),o&2&&(l(4),m("ngForOf",N(1,Nn)))}function sa(o,t){o&1&&(a(0,"span",120),c(1,"*"),s())}function la(o,t){if(o&1&&g(0,"input",121),o&2){let e=u().$implicit;m("type",e.type)("formControlName",e.name)("placeholder",e.placeholder||"")}}function da(o,t){if(o&1&&(a(0,"textarea",122),c(1,"                "),s()),o&2){let e=u().$implicit;m("formControlName",e.name)("placeholder",e.placeholder||"")}}function ca(o,t){if(o&1&&g(0,"input",123),o&2){let e=u().$implicit;m("formControlName",e.name)("placeholder",e.placeholder||"")}}function ma(o,t){if(o&1&&g(0,"input",124),o&2){let e=u().$implicit;m("formControlName",e.name)}}function ua(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),P(e)}}function pa(o,t){if(o&1&&(a(0,"select",125)(1,"option",70),c(2,"Selecione..."),s(),b(3,ua,2,2,"option",71),s()),o&2){let e=u().$implicit;m("formControlName",e.name),l(3),m("ngForOf",e.type==="temperatura"&&(!e.options||e.options.length===0)?N(2,$n):e.options)}}function fa(o,t){if(o&1&&(a(0,"label",128),g(1,"input",129),a(2,"span"),c(3),s()()),o&2){let e=t.$implicit,i=u(2).$implicit;l(),m("value",(e==null?null:e.value)??e)("formControlName",i.name),ye("name",i.name),l(2),P((e==null?null:e.label)??e)}}function ga(o,t){if(o&1&&(a(0,"div",126),b(1,fa,4,4,"label",127),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options||N(1,qt))}}function ha(o,t){if(o&1&&(a(0,"label",128),g(1,"input",131),a(2,"span"),c(3),s()()),o&2){let e=t.$implicit,i=t.index,n=u(2).$implicit;l(),m("value",e)("formControlName",n.name+"_"+i),ye("name",n.name+"_"+i),l(2),P(e)}}function _a(o,t){if(o&1&&(a(0,"div",130),b(1,ha,4,4,"label",127),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options||N(1,qt))}}function va(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e.uid),l(),P(e.displayName||e.email)}}function ba(o,t){if(o&1&&(a(0,"select",125)(1,"option",70),c(2,"Selecione o respons\xE1vel..."),s(),b(3,va,2,2,"option",71),s()),o&2){let e=u().$implicit,i=u(4);m("formControlName",e.name),l(3),m("ngForOf",i.users)}}function xa(o,t){if(o&1&&(Ie(0),a(1,"div",110)(2,"label",111),c(3),b(4,sa,2,0,"span",112),s(),b(5,la,1,3,"input",113)(6,da,2,2,"textarea",114)(7,ca,1,2,"input",115)(8,ma,1,1,"input",116)(9,pa,4,3,"select",117)(10,ga,2,2,"div",118)(11,_a,2,2,"div",119)(12,ba,4,2,"select",117),s(),Fe()),o&2){let e=t.$implicit;l(3),S(" ",e.label," "),l(),m("ngIf",e.required),l(),m("ngIf",e.type==="text"||e.type==="email"||e.type==="tel"||e.type==="url"||e.type==="cpf"||e.type==="cnpj"),l(),m("ngIf",e.type==="textarea"),l(),m("ngIf",e.type==="number"),l(),m("ngIf",e.type==="date"),l(),m("ngIf",e.type==="select"||e.type==="temperatura"),l(),m("ngIf",e.type==="radio"),l(),m("ngIf",e.type==="checkbox"),l(),m("ngIf",e.type==="responsavel")}}function ya(o,t){if(o&1&&(a(0,"div",106)(1,"h3",20),g(2,"i",107),c(3," Formul\xE1rio da Fase Atual "),s(),a(4,"form",108),b(5,xa,13,10,"ng-container",109),s()()),o&2){let e=u(3);l(4),m("formGroup",e.leadForm),l(),m("ngForOf",e.getPhaseSpecificFields())}}function Ca(o,t){o&1&&(a(0,"span",120),c(1,"*"),s())}function wa(o,t){if(o&1&&g(0,"input",121),o&2){let e=u().$implicit;m("type",e.type)("formControlName",e.name)("placeholder",e.placeholder||"")}}function Ea(o,t){if(o&1&&(a(0,"textarea",122),c(1,"                  "),s()),o&2){let e=u().$implicit;m("formControlName",e.name)("placeholder",e.placeholder||"")}}function Sa(o,t){if(o&1&&g(0,"input",123),o&2){let e=u().$implicit;m("formControlName",e.name)("placeholder",e.placeholder||"")}}function Ia(o,t){if(o&1&&g(0,"input",124),o&2){let e=u().$implicit;m("formControlName",e.name)}}function Fa(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),P(e)}}function Da(o,t){if(o&1&&(a(0,"select",125)(1,"option",70),c(2,"Selecione..."),s(),b(3,Fa,2,2,"option",71),s()),o&2){let e=u().$implicit;m("formControlName",e.name),l(3),m("ngForOf",e.type==="temperatura"&&(!e.options||e.options.length===0)?N(2,$n):e.options)}}function Pa(o,t){if(o&1&&(a(0,"label",128),g(1,"input",129),a(2,"span"),c(3),s()()),o&2){let e=t.$implicit,i=u(2).$implicit;l(),m("value",(e==null?null:e.value)??e)("formControlName",i.name),ye("name",i.name),l(2),P((e==null?null:e.label)??e)}}function Ma(o,t){if(o&1&&(a(0,"div",126),b(1,Pa,4,4,"label",127),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options||N(1,qt))}}function Ta(o,t){if(o&1&&(a(0,"label",128),g(1,"input",131),a(2,"span"),c(3),s()()),o&2){let e=t.$implicit,i=t.index,n=u(2).$implicit;l(),m("value",e)("formControlName",n.name+"_"+i),ye("name",n.name+"_"+i),l(2),P(e)}}function ka(o,t){if(o&1&&(a(0,"div",126),b(1,Ta,4,4,"label",127),s()),o&2){let e=u().$implicit;l(),m("ngForOf",e.options||N(1,qt))}}function Oa(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e.email),l(),S(" ",e.displayName||e.email," ")}}function Aa(o,t){if(o&1&&(a(0,"select",125)(1,"option",70),c(2,"Selecione o respons\xE1vel..."),s(),b(3,Oa,2,2,"option",71),s()),o&2){let e=u().$implicit,i=u(4);m("formControlName",e.name),l(3),m("ngForOf",i.users)}}function La(o,t){if(o&1&&(Ie(0),a(1,"div",110)(2,"label",111),c(3),b(4,Ca,2,0,"span",112),s(),b(5,wa,1,3,"input",113)(6,Ea,2,2,"textarea",114)(7,Sa,1,2,"input",115)(8,Ia,1,1,"input",116)(9,Da,4,3,"select",117)(10,Ma,2,2,"div",118)(11,ka,2,2,"div",118)(12,Aa,4,2,"select",117),s(),Fe()),o&2){let e=t.$implicit;l(3),S(" ",e.label," "),l(),m("ngIf",e.required),l(),m("ngIf",e.type==="text"||e.type==="email"||e.type==="tel"||e.type==="url"||e.type==="cpf"||e.type==="cnpj"),l(),m("ngIf",e.type==="textarea"),l(),m("ngIf",e.type==="number"),l(),m("ngIf",e.type==="date"),l(),m("ngIf",e.type==="select"||e.type==="temperatura"),l(),m("ngIf",e.type==="radio"),l(),m("ngIf",e.type==="checkbox"),l(),m("ngIf",e.type==="responsavel")}}function Ra(o,t){if(o&1&&(a(0,"div",106)(1,"h3",20),g(2,"i",132),c(3," Campos Globais "),s(),a(4,"form",108),b(5,La,13,10,"ng-container",109),s()()),o&2){let e=u(3);l(4),m("formGroup",e.leadForm),l(),m("ngForOf",e.getGlobalFields())}}function Va(o,t){if(o&1){let e=F();a(0,"div",14),b(1,ya,6,2,"div",103)(2,Ra,6,2,"div",103),a(3,"div",104)(4,"button",105),x("click",function(){_(e);let n=u(2);return v(n.saveChanges())}),c(5),s()()()}if(o&2){let e=u(2);l(),m("ngIf",e.getPhaseSpecificFields().length>0),l(),m("ngIf",e.getGlobalFields().length>0),l(2),m("disabled",e.isSaving||e.isLoading),l(),S(" ",e.isSaving?"Salvando...":"Salvar altera\xE7\xF5es"," ")}}function Na(o,t){o&1&&g(0,"div",133)}function $a(o,t){if(o&1&&(a(0,"span",134),c(1),s()),o&2){let e=u(2);l(),P(e.attachmentPreview)}}function Ba(o,t){if(o&1){let e=F();a(0,"button",135),x("click",function(){_(e);let n=u(2);return v(n.clearAttachment())}),c(1,"Limpar"),s()}}function ja(o,t){if(o&1&&(a(0,"div",143)(1,"a",144),g(2,"i",145),c(3),s()()),o&2){let e=u().$implicit;l(),m("href",e.attachment.url,Ni),l(2),S(" ",e.attachment.name," ")}}function za(o,t){if(o&1&&(a(0,"div",136)(1,"div",137),g(2,"i",138),a(3,"span",139),c(4),s(),a(5,"span",140),c(6),s()(),g(7,"div",141),b(8,ja,4,2,"div",142),s()),o&2){let e=t.$implicit,i=u(2);l(2),Oe(i.getActivityIcon(e.type)),l(2),P(e.user),l(2),P(i.formatDateTime(e.timestamp)),l(),m("innerHTML",e.text,Vi),l(),m("ngIf",e.attachment)}}function Ua(o,t){if(o&1){let e=F();a(0,"button",150),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.moveLead(n.id))}),g(1,"div",151),a(2,"span",139),c(3),s()()}if(o&2){let e=t.$implicit,i=u(3);m("disabled",i.isLoading),l(),W("background-color",e.color),l(2),P(e.name)}}function Ka(o,t){if(o&1&&(a(0,"div",146)(1,"h4",147),c(2,"\u{1F680} Avan\xE7ar para:"),s(),a(3,"div",148),b(4,Ua,4,4,"button",149),s()()),o&2){let e=u(2);l(4),m("ngForOf",e.getAdvancePhases())}}function Ha(o,t){if(o&1){let e=F();a(0,"button",155),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.moveLead(n.id))}),g(1,"div",156),a(2,"span"),c(3),s()()}if(o&2){let e=t.$implicit,i=u(3);m("disabled",i.isLoading),l(),W("background-color",e.color),l(2),P(e.name)}}function qa(o,t){if(o&1&&(a(0,"div",146)(1,"h4",152),c(2,"\u{1F504} Retornar para:"),s(),a(3,"div",153),b(4,Ha,4,4,"button",154),s()()),o&2){let e=u(2);l(4),m("ngForOf",e.getRetreatPhases())}}function Ga(o,t){o&1&&(Ie(0),c(1," Para avan\xE7ar, preencha os campos obrigat\xF3rios da fase. "),Fe())}function Wa(o,t){o&1&&c(0,"Lead em fase final. N\xE3o \xE9 poss\xEDvel movimentar.")}function Qa(o,t){if(o&1&&(a(0,"div",157),b(1,Ga,2,0,"ng-container",158)(2,Wa,1,0,"ng-template",null,2,He),s()),o&2){let e=Re(3),i=u(2);l(),m("ngIf",i.hasRequiredToAdvance())("ngIfElse",e)}}function Za(o,t){if(o&1){let e=F();a(0,"div",159)(1,"p",160),c(2,"Compartilhe este link para permitir edi\xE7\xE3o externa:"),s(),a(3,"div",161),g(4,"input",162),a(5,"button",163),x("click",function(){_(e);let n=u(2);return v(n.copyPublicLink())}),g(6,"i",164),s()()()}if(o&2){let e=u(2);l(4),m("value",e.publicLink)}}function Ya(o,t){if(o&1&&(a(0,"div",165),c(1),s()),o&2){let e=u(2);l(),S(" ",e.errorMessage," ")}}function Ja(o,t){if(o&1){let e=F();a(0,"div",166),x("click",function(){_(e);let n=u(2);return v(n.cancelDelete())}),a(1,"div",167),x("click",function(n){return _(e),v(n.stopPropagation())}),a(2,"h3",168),c(3,"Confirmar exclus\xE3o"),s(),a(4,"p",169),c(5,"Esta a\xE7\xE3o n\xE3o pode ser desfeita. Deseja realmente apagar este registro?"),s(),a(6,"div",170)(7,"button",171),x("click",function(){_(e);let n=u(2);return v(n.cancelDelete())}),c(8,"Cancelar"),s(),a(9,"button",172),x("click",function(){_(e);let n=u(2);return v(n.confirmDelete())}),c(10,"Apagar"),s()()()()}}function Xa(o,t){if(o&1){let e=F();a(0,"div",4),x("click",function(n){_(e);let r=u();return v(r.onBackdropClick(n))}),a(1,"div",5)(2,"div",6)(3,"h2",7),c(4,"Dados"),s(),a(5,"div",8)(6,"button",9),x("click",function(){_(e);let n=u();return v(n.openDeleteConfirm())}),g(7,"i",10),s(),a(8,"button",11),x("click",function(){_(e);let n=u();return v(n.hide())}),c(9," \xD7 "),s()()(),a(10,"div",12)(11,"div",13)(12,"div",14),b(13,Lr,7,1,"div",15),a(14,"div",16),b(15,Vr,2,2,"div",17)(16,Qr,2,1,"div",18)(17,Zr,3,2,"div",19),s()(),a(18,"div",14)(19,"h3",20),c(20,"Hist\xF3rico de Fases"),s(),b(21,Jr,2,2,"div",17)(22,na,2,1,"div",21)(23,oa,6,0,"ng-template",null,0,He),s()(),a(25,"div",22),b(26,aa,5,2,"div",23)(27,Va,6,4,"div",23),a(28,"div")(29,"h3",20),c(30,"Coment\xE1rios"),s(),a(31,"div",16)(32,"div")(33,"textarea",24),ce("ngModelChange",function(n){_(e);let r=u();return de(r.commentText,n)||(r.commentText=n),v(n)}),c(34,"              "),s(),a(35,"div",25)(36,"button",26),x("click",function(){_(e);let n=u();return v(n.addComment())}),b(37,Na,1,0,"div",27),g(38,"i",28),c(39),s()()(),a(40,"div")(41,"div",8)(42,"button",29),x("click",function(){_(e);let n=Re(47);return v(n.click())}),g(43,"i",30),c(44,"Selecionar arquivo "),s(),b(45,$a,2,1,"span",31),a(46,"input",32,1),x("change",function(n){_(e);let r=u();return v(r.onFileSelected(n))}),s(),a(48,"button",33),x("click",function(){_(e);let n=u();return v(n.uploadAttachment())}),c(49),s(),b(50,Ba,2,0,"button",34),s()()()(),a(51,"div",35)(52,"h3",20),c(53,"Atividades Recentes"),s(),a(54,"div",36),b(55,za,9,6,"div",37),s()()(),a(56,"div",38)(57,"div")(58,"div",14)(59,"h3",20),c(60,"Mover registro"),s(),b(61,Ka,5,1,"div",39)(62,qa,5,1,"div",39)(63,Qa,4,2,"div",40),s(),a(64,"div",14)(65,"h3",20),c(66,"Link P\xFAblico"),s(),b(67,Za,7,1,"div",41),s()(),b(68,Ya,2,1,"div",42),s()()(),b(69,Ja,11,0,"div",43),s()}if(o&2){let e=Re(24),i=u();l(6),m("disabled",i.isLoading||i.isSaving),l(2),m("disabled",i.isLoading),l(5),m("ngIf",i.currentLead==null?null:i.currentLead.id),l(2),m("ngIf",i.isLoadingFields),l(),m("ngIf",!i.isLoadingFields&&i.fieldsReady),l(),m("ngIf",i.hasEditableGlobalFields()),l(4),m("ngIf",i.isLoadingHistory),l(),m("ngIf",!i.isLoadingHistory&&i.getPhaseHistoryItems().length>0)("ngIfElse",e),l(4),m("ngIf",i.isLoadingFields),l(),m("ngIf",!i.isLoadingFields&&i.fieldsReady&&i.getCentralFields().length>0),l(6),le("ngModel",i.commentText),m("ngModelOptions",N(27,Or)),l(3),m("disabled",i.isUploadingComment||!i.commentText.trim()),l(),m("ngIf",i.isUploadingComment),l(2),S(" ",i.isUploadingComment?"Enviando...":"Enviar coment\xE1rio"," "),l(6),m("ngIf",i.attachmentPreview),l(3),m("disabled",i.isUploadingAttachment||!i.selectedFile),l(),S(" ",i.isUploadingAttachment?"Anexando...":"Enviar anexo"," "),l(),m("ngIf",i.selectedFile),l(5),m("ngForOf",i.getActivityLog()),l(6),m("ngIf",i.getAdvancePhases().length>0),l(),m("ngIf",i.getRetreatPhases().length>0),l(),m("ngIf",i.getAdvancePhases().length===0&&i.getRetreatPhases().length===0),l(4),m("ngIf",i.publicLink),l(),m("ngIf",i.errorMessage),l(),m("ngIf",i.showDeleteConfirm)}}var ht=class o{authService=I($e);firestoreService=I(J);storageService=I(tt);subdomainService=I(Me);fb=I(_e);cdr=I(De);ownerId="";boardId="";columns=[];users=[];leadUpdated=new C;leadDeleted=new C;closeModal=new C;isVisible=!1;isLoading=!1;isSaving=!1;errorMessage="";currentLead=null;cachedInitialFields=[];formReady=!1;isLoadingFields=!1;isLoadingHistory=!1;fieldsReady=!1;leadHistory=[];phaseHistory={};flowConfig={allowed:{}};leadForm=this.fb.group({});commentText="";selectedFile=null;attachmentPreview="";isUploadingComment=!1;isUploadingAttachment=!1;showDeleteConfirm=!1;publicLink="";unsubscribeHistory=null;initialFormConfig=null;show(t){return D(this,null,function*(){this.fullStateReset(),this.currentLead=t,this.isVisible=!0,this.cdr.detectChanges(),setTimeout(()=>{this.loadLeadDataAsync()},10)})}loadLeadDataAsync(){return D(this,null,function*(){try{yield this.loadBasicLeadData(),this.generatePublicLink(),setTimeout(()=>{this.loadFormFieldsAsync()},50),setTimeout(()=>{this.loadHistoryAsync()},100)}catch{this.errorMessage="Erro ao carregar dados do lead",this.isLoadingFields=!1,this.isLoadingHistory=!1}})}loadBasicLeadData(){return D(this,null,function*(){if(this.currentLead)try{let t=yield this.firestoreService.getLead(this.ownerId,this.boardId,this.currentLead.id);t&&(this.currentLead=t)}catch{}})}loadFormFieldsAsync(){return D(this,null,function*(){try{this.isLoadingFields=!0,this.fieldsReady=!1,this.initialFormConfig=null,this.initialFormConfig=yield this.firestoreService.getInitialFormConfig(this.boardId),this.cdr.detectChanges(),yield this.loadCurrentPhaseForm(),this.isLoadingFields=!1,this.fieldsReady=!0,this.cdr.detectChanges()}catch{this.isLoadingFields=!1,this.fieldsReady=!0,this.cdr.detectChanges()}})}loadHistoryAsync(){return D(this,null,function*(){try{this.isLoadingHistory=!0;let t=yield this.firestoreService.getLeadHistory(this.ownerId,this.boardId,this.currentLead.id);this.leadHistory=t,this.unsubscribeHistory&&(this.unsubscribeHistory(),this.unsubscribeHistory=null),this.unsubscribeHistory=this.firestoreService.subscribeToLeadHistory(this.ownerId,this.boardId,this.currentLead.id,e=>{this.leadHistory=e}),this.isLoadingHistory=!1}catch{this.isLoadingHistory=!1}})}loadCurrentPhaseForm(){return D(this,null,function*(){try{this.phaseHistory=this.currentLead?.phaseHistory||{};let[t,e]=yield Promise.allSettled([this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,this.currentLead.columnId),this.firestoreService.getFlowConfig(this.boardId)]);t.status==="fulfilled"?this.currentFormFields=t.value?.fields||[]:this.currentFormFields=(this.initialFormConfig?.fields||[]).map(i=>R({},i)),yield this.loadGlobalFieldsAsync(),this.flowConfig=e.status==="fulfilled"&&e.value?e.value:{allowed:{}},this.setupFormFieldsOptimized()}catch{this.currentFormFields=[]}})}loadGlobalFieldsAsync(){return D(this,null,function*(){try{let t=[],e=new Set;this.initialFormConfig?.fields&&this.initialFormConfig.fields.forEach(i=>{e.add(i.name)});try{(this.currentFormFields||[]).forEach((n,r)=>{let d=n.allowEditInAnyPhase===!0,p=e.has(n.name);d&&!p&&t.push(n)})}catch{}try{for(let i of this.columns)if(i.id!==this.currentLead?.columnId)try{((yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,i.id))?.fields||[]).forEach(d=>{let p=d.allowEditInAnyPhase===!0,f=e.has(d.name),h=t.some(y=>y.name===d.name);p&&!f&&!h&&t.push(d)})}catch{}}catch{}this.globalFormFields=t}catch{this.globalFormFields=[]}})}setupFormFieldsOptimized(){try{this.leadForm=this.fb.group({}),this.formReady=!1;let t={},e=this.getCentralFields(),i=this.getInitialFieldsOnly().filter(p=>p.isEditable),n=[...e],r=new Set(e.map(p=>p.name||p.apiFieldName));i.forEach(p=>{r.has(p.name)||n.push({name:p.formControlName,apiFieldName:p.name,type:p.fieldType,label:p.label,placeholder:p.placeholder,options:p.options})}),n.forEach((p,f)=>{let h=p.apiFieldName||p.name,y=this.getFieldValue(h)??this.getFieldValue(p.name);if(p.type==="checkbox")(p.options||[]).forEach((E,k)=>{let T=p.name+"_"+k,M=!1;(Array.isArray(y)||typeof y=="string"&&y)&&(M=y.includes(E)),t[T]=[M]});else if(p.type==="responsavel"){let w="",E=this.users.find(k=>k.uid===this.currentLead?.responsibleUserId);if(E)w=E.email;else if(this.currentLead?.responsibleUserEmail)w=this.currentLead.responsibleUserEmail;else if(this.currentLead?.responsibleUserName){let k=this.users.find(T=>(T.displayName||"").toLowerCase()===this.currentLead?.responsibleUserName?.toLowerCase());k&&(w=k.email)}t[p.name]=[w]}else t[p.name]=[y??""]}),this.leadForm=this.fb.group(t);let d={};Object.keys(t).forEach(p=>{d[p]=t[p][0]}),this.leadForm.patchValue(d,{emitEvent:!1}),this.formReady=!0,this.cdr.detectChanges(),setTimeout(()=>{let p=n.find(f=>f.type==="responsavel");if(p&&this.currentLead?.responsibleUserId){let f=this.leadForm.get(p.name);f&&(f.setValue(this.currentLead.responsibleUserId,{emitEvent:!1}),f.markAsDirty(),f.updateValueAndValidity(),this.cdr.detectChanges(),setTimeout(()=>{let h=document.querySelector(`select[formcontrolname="${p.name}"]`);h&&(h.value=this.currentLead.responsibleUserId)},50))}},200)}catch{this.leadForm=this.fb.group({}),this.formReady=!0}}populateFormFields(){try{let t={};(this.currentFormFields||[]).forEach(e=>{let i=e.apiFieldName||e.name;t[e.name]=this.getFieldValue(i)??""}),Object.keys(t).length&&this.leadForm.patchValue(t,{emitEvent:!1})}catch{}}hide(){this.isVisible=!1,this.resetForm(),this.unsubscribeHistory&&(this.unsubscribeHistory(),this.unsubscribeHistory=null),this.closeModal.emit()}fullStateReset(){this.currentLead=null,this.initialFormConfig=null,this.currentFormFields=[],this.globalFormFields=[],this.cachedInitialFields=[],this.fieldsReady=!1,this.isLoadingFields=!0,this.isLoadingHistory=!0,this.formReady=!1,this.unsubscribeHistory&&(this.unsubscribeHistory(),this.unsubscribeHistory=null),this.leadHistory=[],this.phaseHistory={},this.resetForm(),this.flowConfig={allowed:{}}}resetForm(){this.leadForm=this.fb.group({}),this.commentText="",this.selectedFile=null,this.attachmentPreview="",this.errorMessage="",this.publicLink="",this.showDeleteConfirm=!1,this.isSaving=!1,this.isLoading=!1,this.isUploadingComment=!1,this.isUploadingAttachment=!1}loadLeadData(){return D(this,null,function*(){if(this.currentLead){this.cachedInitialFields=[];try{try{let e=yield this.firestoreService.getLead(this.ownerId,this.boardId,this.currentLead.id);e&&(this.currentLead=e)}catch{}let t=yield this.firestoreService.getLeadHistory(this.ownerId,this.boardId,this.currentLead.id);this.leadHistory=t,this.phaseHistory=this.currentLead.phaseHistory||{},this.initialFormConfig=yield this.firestoreService.getInitialFormConfig(this.boardId);try{let e=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,this.currentLead.columnId);this.currentFormFields=e?.fields||[]}catch{this.currentFormFields=(this.initialFormConfig?.fields||[]).map(i=>R({},i))}try{let e=yield this.firestoreService.getFlowConfig(this.boardId);this.flowConfig=e||{allowed:{}}}catch{this.flowConfig={allowed:{}}}yield this.buildDynamicForm(),this.formReady=!0,this.generatePublicLink()}catch{this.errorMessage="Erro ao carregar dados do lead."}}})}buildDynamicForm(){return D(this,null,function*(){if(!this.currentLead)return;let t={};this.formReady=!1,(this.currentFormFields||[]).forEach(e=>{let i=e.apiFieldName||e.name,n=this.getFieldValue(i);if((n==null||typeof n=="string"&&n.trim()==="")&&(n=this.getFieldValue(e.name)),e.type==="temperatura"){let r=e.options&&e.options.length?e.options:["Quente","Morno","Frio"];typeof n=="string"&&(n=r.find(p=>p.toLowerCase()===n.toLowerCase())||"")}if(e.type==="responsavel"){let r=this.currentLead?.responsibleUserId||n;t[e.name]=[r??""]}else t[e.name]=[n??""]}),this.leadForm=this.fb.group(t),this.formReady=!0})}getCurrentColumn(){return this.currentLead&&this.columns.find(t=>t.id===this.currentLead.columnId)||null}getInitialColumn(){return this.columns.find(t=>t.order===0)||null}formatFieldValue(t,e){if(t.type==="checkbox"){if(Array.isArray(e))return e.length>0?e.join(", "):"Nenhuma op\xE7\xE3o selecionada";if(e&&typeof e=="string"){try{let i=JSON.parse(e);if(Array.isArray(i))return i.length>0?i.join(", "):"Nenhuma op\xE7\xE3o selecionada"}catch{}if(e.includes(",")){let i=e.split(",").map(n=>n.trim()).filter(n=>n);return i.length>0?i.join(", "):"Nenhuma op\xE7\xE3o selecionada"}return e}return"Nenhuma op\xE7\xE3o selecionada"}return e!=null?String(e):"N\xE3o informado"}getInitialFields(){return this.getInitialFieldsOnly()}isFieldGlobal(t){if(!this.initialFormConfig?.fields)return!1;let e=this.initialFormConfig.fields.find(i=>i.name===t.name||i.apiFieldName===t.name||i.name===t.apiFieldName||i.apiFieldName===t.apiFieldName);return e&&e.allowEditInAnyPhase===!0}currentFormFields=[];globalFormFields=[];hasRequiredToAdvance(){try{return Array.isArray(this.currentFormFields)&&this.currentFormFields.some(t=>!!t?.requiredToAdvance)}catch{return!1}}getGlobalFields(){return this.globalFormFields.forEach((t,e)=>{let i=this.leadForm?.get(t.name)?.value;if(t.type==="responsavel"){let n=this.users.find(d=>d.email===i),r=this.leadForm?.get(t.name)}}),this.globalFormFields}getPhaseSpecificFields(){return this.currentFormFields.filter(e=>e.allowEditInAnyPhase!==!0)}getAllRelevantFields(){let t=this.currentFormFields||[],e=this.getGlobalFields()||[],i=[...t],n=new Set(t.map(r=>r.name||r.apiFieldName));return e.forEach(r=>{let d=r.name||r.apiFieldName;n.has(d)||i.push(r)}),i}getCentralFields(){let t=this.getPhaseSpecificFields()||[],e=this.getGlobalFields()||[],i=[...t],n=new Set(t.map(r=>r.name||r.apiFieldName));return e.forEach(r=>{let d=r.name||r.apiFieldName;i.push(r),n.add(d)}),i}getInitialFieldsOnly(){if(!this.currentLead)return[];if(!this.initialFormConfig)return[];try{return this.initialFormConfig?.fields?.length?this.initialFormConfig.fields.sort((i,n)=>(i.order||0)-(n.order||0)).map((i,n)=>{let r=i.apiFieldName||i.name,d=this.getFieldValue(r)??this.getFieldValue(i.name),p=d!=null?this.formatFieldValue(i,d):"N\xE3o informado",f=i.allowEditInAnyPhase===!0;return{name:r,label:i.label||i.name||i.apiFieldName,value:p,isEditable:f,fieldType:i.type,formControlName:i.name,placeholder:i.placeholder,options:i.options||(i.type==="temperatura"?["Quente","Morno","Frio"]:[])}}):this.buildDedupedDisplayFields().map(e=>ee(R({},e),{isEditable:!1,fieldType:"text",formControlName:e.name,placeholder:"",options:[]}))}catch{return[]}}hasEditableGlobalFields(){return this.getInitialFieldsOnly().some(e=>e.isEditable)}saveGlobalFields(){return D(this,null,function*(){yield this.saveChanges()})}getPhaseHistoryItems(){let t=[];if(Object.values(this.phaseHistory).forEach(i=>{let n=this.columns.find(r=>r.id===i.phaseId);if(n){let r=i.enteredAt?.toDate?i.enteredAt.toDate():new Date(i.enteredAt),d=i.exitedAt?.toDate?i.exitedAt.toDate():i.exitedAt?new Date(i.exitedAt):null,p="";if(i.duration){let h=Math.floor(i.duration/864e5),y=Math.floor(i.duration%(1e3*60*60*24)/(1e3*60*60));h>0?p=`${h}d ${y}h`:p=`${y}h`}else if(!d){let y=new Date().getTime()-r.getTime(),w=Math.floor(y/(1e3*60*60*24)),E=Math.floor(y%(1e3*60*60*24)/(1e3*60*60));w>0?p=`${w}d ${E}h (em andamento)`:p=`${E}h (em andamento)`}let f={phaseName:n.name,phaseColor:n.color,enteredAt:r.toLocaleString("pt-BR"),exitedAt:d?.toLocaleString("pt-BR")||"Atual",duration:p||"Em andamento",isCurrentPhase:!d&&this.currentLead?.columnId===i.phaseId};t.push(f)}}),t.length===0&&this.currentLead){let i=this.getCurrentColumn();if(i){let n=this.currentLead.movedToCurrentColumnAt?.toDate&&this.currentLead.movedToCurrentColumnAt.toDate()||this.currentLead.movedToCurrentColumnAt||this.currentLead.createdAt?.toDate&&this.currentLead.createdAt.toDate()||this.currentLead.createdAt||new Date,r={phaseName:i.name,phaseColor:i.color,enteredAt:(n instanceof Date?n:new Date(n)).toLocaleString("pt-BR"),exitedAt:"Atual",duration:"Em andamento",isCurrentPhase:!0};t.push(r)}}return t.sort((i,n)=>new Date(i.enteredAt).getTime()-new Date(n.enteredAt).getTime())}getActivityLog(){return this.leadHistory.sort((t,e)=>{let i=t.timestamp?.toDate?t.timestamp.toDate():new Date(t.timestamp);return(e.timestamp?.toDate?e.timestamp.toDate():new Date(e.timestamp)).getTime()-i.getTime()})}getAvailablePhases(){let t=this.getCurrentColumn();return t?t.endStageType&&t.endStageType!=="none"?[]:this.columns.filter(e=>e.id!==t.id):[]}getAdvancePhases(){let t=this.getCurrentColumn();if(!t)return[];if(t.endStageType&&t.endStageType!=="none")return[];if((this.currentFormFields||[]).filter(n=>{if(!n.requiredToAdvance)return!1;let r=n.apiFieldName||n.name,d=this.leadForm.get(n.name)?.value??this.getFieldValue(r);return d==null||`${d}`.trim()===""}).length)return[];let i=this.flowConfig.allowed[t.id]||[];return this.columns.filter(n=>n.id!==t.id&&n.order>t.order).filter(n=>i.includes(n.id)).sort((n,r)=>n.order-r.order)}getRetreatPhases(){let t=this.getCurrentColumn();if(!t)return[];if(t.order===0)return[];let e=this.flowConfig.allowed[t.id]||[];return this.columns.filter(i=>i.id!==t.id&&i.order<t.order).filter(i=>e.includes(i.id)).sort((i,n)=>n.order-i.order)}saveChanges(){return D(this,null,function*(){if(!(!this.currentLead||!this.leadForm.valid)){this.isSaving=!0,this.errorMessage="";try{let t=this.leadForm.value,e=R({},t),i=this.getAllRelevantFields();i.forEach(y=>{y.apiFieldName&&y.apiFieldName!==y.name&&e.hasOwnProperty(y.name)&&(e[y.apiFieldName]=e[y.name],delete e[y.name])});let n=this.authService.getCurrentUser();if(!n)throw new Error("Usu\xE1rio n\xE3o autenticado");let r={fields:R(R({},this.currentLead.fields),e)},p=i.find(y=>y.type==="responsavel")?.name,f=p?t[p]:t.responsibleUserId;if(f&&f!==this.currentLead.responsibleUserId){let y=this.users.find(w=>w.uid===f);r.responsibleUserId=f,r.responsibleUserName=y?.displayName||"",r.responsibleUserEmail=y?.email||"",yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"update",text:`Respons\xE1vel alterado para <strong>${y?.displayName||"Ningu\xE9m"}</strong>`,user:n.displayName||n.email})}try{let y=this.currentLead.fields||{},w=Object.keys(e).filter(E=>`${y[E]??""}`!=`${e[E]??""}`);if(w.length){let E=w.map(k=>{let M=i.find(L=>(L.apiFieldName||L.name)===k)?.label||this.humanizeKey(k),O=this.getGlobalFields().some(L=>(L.apiFieldName||L.name)===k),B=y[k]??"",z=e[k]??"";if(i.some(L=>(L.apiFieldName===k||L.name===k)&&(L.type==="responsavel"||L.originalType==="responsavel"))){let L=this.users.find(Q=>Q.uid===B||Q.email===B),H=this.users.find(Q=>Q.uid===z||Q.email===z);B=L?.displayName||B,z=H?.displayName||z}return`<li><strong>${M}${O?" (Global)":" (Fase atual)"}:</strong> "${B}" \u2192 "${z}"</li>`}).join("");yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"update",text:`Formul\xE1rio atualizado:<ul class="list-disc ml-4">${E}</ul>`,user:n.displayName||n.email})}}catch{}yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,r),this.currentLead.fields=R(R({},this.currentLead.fields||{}),e);let h={};i.forEach(y=>{let w=y.apiFieldName||y.name;h[y.name]=e.hasOwnProperty(w)?e[w]:this.getFieldValue(w)??""}),Object.keys(h).length&&this.leadForm.patchValue(h,{emitEvent:!1}),this.leadUpdated.emit()}catch{this.errorMessage="Erro ao salvar altera\xE7\xF5es. Tente novamente."}finally{this.isSaving=!1}}})}moveLead(t){return D(this,null,function*(){if(this.currentLead){this.isLoading=!0;try{let e=this.getCurrentColumn(),i=this.columns.find(f=>f.id===t),n=this.authService.getCurrentUser();if(!e||!i||!n)return;if(!(this.flowConfig.allowed[e.id]||[]).includes(t)){this.errorMessage="Transi\xE7\xE3o n\xE3o permitida pelo fluxo.";return}let d=new Date,p=R({},this.phaseHistory);if(p[e.id]){let f=p[e.id].enteredAt?.toDate()||new Date;p[e.id].exitedAt=d,p[e.id].duration=d.getTime()-f.getTime()}p[t]={phaseId:t,enteredAt:d},yield this.firestoreService.moveLead(this.ownerId,this.boardId,this.currentLead.id,t),yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"move",text:`Moveu de <strong>${e.name}</strong> para <strong>${i.name}</strong>`,user:n.displayName||n.email}),yield this.firestoreService.updateLead(this.ownerId,this.boardId,this.currentLead.id,{phaseHistory:p}),this.leadUpdated.emit(),this.hide()}catch{this.errorMessage="Erro ao mover lead. Tente novamente."}finally{this.isLoading=!1}}})}onFileSelected(t){let e=t.target.files[0];if(e){if(e.size>10485760){this.errorMessage="Arquivo muito grande. O tamanho m\xE1ximo \xE9 10MB.",t.target.value="";return}if(!["image/jpeg","image/jpg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/zip","application/x-rar-compressed"].includes(e.type)){this.errorMessage="Tipo de arquivo n\xE3o permitido. Use: PDF, DOC, DOCX, JPG, PNG, GIF, TXT, ZIP, RAR.",t.target.value="";return}this.selectedFile=e,this.attachmentPreview=`\u{1F4CE} ${e.name} (${(e.size/1024/1024).toFixed(2)} MB)`,this.errorMessage=""}}clearAttachment(){this.selectedFile=null,this.attachmentPreview=""}addComment(){return D(this,null,function*(){if(!this.currentLead||!this.commentText.trim()&&!this.selectedFile){this.errorMessage="Digite um coment\xE1rio ou anexe um arquivo.";return}this.isUploadingComment=!0,this.errorMessage="";try{let t=this.authService.getCurrentUser();if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado");let e=null;if(this.selectedFile){let n=`leads/${this.currentLead.id}/comments/${Date.now()}_${this.selectedFile.name}`;try{let r=yield this.storageService.uploadFile(this.selectedFile,n);e={name:this.selectedFile.name,url:r,type:this.selectedFile.type,size:this.selectedFile.size}}catch{throw new Error("Falha no upload do arquivo. Verifique sua conex\xE3o.")}}let i={type:"comment",text:this.commentText.trim()||"Anexou um arquivo",user:t.displayName||t.email,timestamp:new Date,attachment:e};yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,i),this.commentText="",this.clearAttachment(),yield this.loadLeadData()}catch(t){this.errorMessage=t.message||"Erro ao adicionar coment\xE1rio. Tente novamente."}finally{this.isUploadingComment=!1}})}uploadAttachment(){return D(this,null,function*(){if(!(!this.currentLead||!this.selectedFile)){this.isUploadingAttachment=!0,this.errorMessage="";try{let t=this.authService.getCurrentUser();if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado");let e=`leads/${this.currentLead.id}/attachments/${Date.now()}_${this.selectedFile.name}`,i=yield this.storageService.uploadFile(this.selectedFile,e);yield this.firestoreService.addLeadHistory(this.ownerId,this.boardId,this.currentLead.id,{type:"comment",text:"Anexou um arquivo",user:t.displayName||t.email,timestamp:new Date,attachment:{name:this.selectedFile.name,url:i,type:this.selectedFile.type,size:this.selectedFile.size}}),this.clearAttachment(),yield this.loadLeadData()}catch(t){this.errorMessage=t.message||"Erro ao anexar arquivo"}finally{this.isUploadingAttachment=!1}}})}generatePublicLink(){if(!this.currentLead)return;let t=this.getCurrentColumn();if(!t)return;let e=this.subdomainService.getCurrentCompany();if(e)if(this.subdomainService.isDevelopment()){let n=this.subdomainService.getBaseUrl();this.publicLink=`${n}/form?subdomain=${e.subdomain}&companyId=${e.id}&userId=${this.ownerId}&boardId=${this.boardId}&leadId=${this.currentLead.id}&columnId=${t.id}`}else this.publicLink=`https://${e.subdomain}.taskboard.com.br/form?companyId=${e.id}&userId=${this.ownerId}&boardId=${this.boardId}&leadId=${this.currentLead.id}&columnId=${t.id}`}copyPublicLink(){this.publicLink&&navigator.clipboard.writeText(this.publicLink)}deleteLead(){return D(this,null,function*(){if(this.currentLead){this.isLoading=!0;try{yield this.firestoreService.deleteLead(this.ownerId,this.boardId,this.currentLead.id),this.leadDeleted.emit(),this.hide()}catch{this.errorMessage="Erro ao excluir lead. Tente novamente."}finally{this.isLoading=!1}}})}openDeleteConfirm(){this.showDeleteConfirm=!0}cancelDelete(){this.showDeleteConfirm=!1}confirmDelete(){return D(this,null,function*(){yield this.deleteLead(),this.showDeleteConfirm=!1})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}formatDateTime(t){return(t?.toDate?t.toDate():new Date(t)).toLocaleString("pt-BR")}getActivityIcon(t){switch(t){case"move":return"fas fa-arrow-right";case"comment":return"fas fa-comment";case"update":return"fas fa-edit";default:return"fas fa-info-circle"}}copyLeadId(){this.currentLead?.id&&navigator.clipboard.writeText(this.currentLead.id)}isPlainObject(t){return t&&typeof t=="object"&&!Array.isArray(t)}flattenObject(t,e=3){let i={};if(!this.isPlainObject(t)||e<0)return i;for(let[n,r]of Object.entries(t))if(this.isPlainObject(r)&&e>0){let d=this.flattenObject(r,e-1);for(let[p,f]of Object.entries(d))i[p]===void 0&&(i[p]=f)}else r!=null&&(i[n]=r);return i}collectLeadFields(){let t=this.currentLead?.fields||{},e=["fields","leadData","data","payload"],i={},n=[t];e.forEach(d=>{this.isPlainObject(t[d])&&n.push(t[d])}),this.isPlainObject(t.fields?.fields)&&n.push(t.fields.fields);for(let d of n)for(let[p,f]of Object.entries(d))i[p]===void 0&&f!==void 0&&f!==null&&`${f}`.trim?.()!==""&&(i[p]=f);let r=this.flattenObject(t,3);for(let[d,p]of Object.entries(r))i[d]===void 0&&p!==void 0&&p!==null&&`${p}`.trim?.()!==""&&(i[d]=p);return i}getFieldValue(t){let e=this.collectLeadFields();if(!t)return;let i={companyName:["companyName","empresa","nomeEmpresa","nameCompany","company","company_name","empresa_nome","nameComapny"],cnpj:["cnpj","cnpjCompany"],contactName:["contactName","name","nome","nomeLead","nameLead","leadName"],contactEmail:["contactEmail","email","emailLead","contatoEmail","leadEmail"],contactPhone:["contactPhone","phone","telefone","celular","phoneLead","telefoneContato"],temperature:["temperature","temperatura","qualificacao","leadTemperature"]},n=Object.keys(e).reduce((f,h)=>(f[h.toLowerCase()]=h,f),{}),r=t.toLowerCase(),d=[t];i[t]&&d.push(...i[t]);for(let[f,h]of Object.entries(i))(f.toLowerCase()===r||h.some(y=>y.toLowerCase()===r))&&d.push(f,...h);let p=new Set;for(let f of d){let h=f.toLowerCase();if(p.has(h))continue;p.add(h);let y=n[h];if(y!==void 0){let w=e[y];if(w!=null&&(typeof w!="string"||w.trim()!==""))return w}}}humanizeKey(t){let e=t.replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return e.charAt(0).toUpperCase()+e.slice(1)}getLabelForOriginalKey(t,e){let i=this.initialFormConfig?.fields||[];if(Array.isArray(i)&&i.length){let r=i.find(d=>{let p=(d.apiFieldName||"").toString(),f=(d.name||"").toString();return p===t||f===t||p===e||f===e});if(r?.label)return r.label}let n=this.humanizeKey(t);return n||this.humanizeKey(e)}buildDedupedDisplayFields(){let t=this.collectLeadFields(),e={companyName:["companyName","empresa","nomeEmpresa","nameCompany","company","company_name","empresa_nome","nameComapny"],cnpj:["cnpj","cnpjCompany"],contactName:["contactName","name","nome","nomeLead","nameLead","leadName"],contactEmail:["contactEmail","email","emailLead","contatoEmail","leadEmail"],contactPhone:["contactPhone","phone","telefone","celular","phoneLead","telefoneContato"],temperature:["temperature","temperatura","qualificacao","leadTemperature"]},i={companyName:"Nome da empresa",cnpj:"CNPJ da empresa",contactName:"Nome do contato",contactEmail:"E-mail de contato",contactPhone:"Telefone",temperature:"Temperatura"},n=Object.keys(t).reduce((y,w)=>(y[w.toLowerCase()]=w,y),{}),r=new Set,d=[],p=y=>{for(let w of y){let E=n[w.toLowerCase()];if(E&&t[E]!==void 0&&t[E]!==null&&`${t[E]}`.trim()!=="")return r.add(E),{key:E,value:t[E]}}return null},f={companyName:1,cnpj:2,contactName:3,contactEmail:4,contactPhone:5,temperature:6};for(let y of Object.keys(e)){let w=p(e[y]);if(w){let E=this.getLabelForOriginalKey(w.key,y)||i[y]||this.humanizeKey(y);d.push({name:y,label:E,value:w.value,order:f[y]||999})}}let h=new Set(Object.values(e).flat().map(y=>y.toLowerCase()));return Object.keys(t).forEach(y=>{let w=h.has(y.toLowerCase());!r.has(y)&&!w&&d.push({name:y,label:this.humanizeKey(y),value:t[y],order:999})}),d.filter(y=>y.value!==void 0&&y.value!==null&&`${y.value}`.trim()!=="").sort((y,w)=>y.order-w.order||y.label.localeCompare(w.label)).map(E=>{var k=E,{order:y}=k,w=Pi(k,["order"]);return w})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-lead-detail-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId",columns:"columns",users:"users"},outputs:{leadUpdated:"leadUpdated",leadDeleted:"leadDeleted",closeModal:"closeModal"},decls:1,vars:1,consts:[["noPhaseHistory",""],["fileInput",""],["finalPhaseMsg",""],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-7xl","max-h-[95vh]","overflow-hidden"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"flex","items-center","gap-3"],["title","Apagar registro",1,"text-red-500","hover:text-red-600","text-xl",3,"click","disabled"],[1,"fas","fa-trash"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"grid","grid-cols-12","gap-6","p-6","max-h-[calc(95vh-120px)]","overflow-y-auto"],[1,"col-span-12","md:col-span-3","border-r","border-gray-200","pr-6"],[1,"mb-8"],["class","mb-2 text-[11px] text-gray-400 flex items-center gap-2",4,"ngIf"],[1,"space-y-4"],["class","space-y-3",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","mt-4 pt-3 border-t border-gray-200",4,"ngIf"],[1,"font-bold","text-lg","mb-3","text-gray-800"],["class","space-y-3",4,"ngIf","ngIfElse"],[1,"col-span-12","md:col-span-6"],["class","mb-8",4,"ngIf"],["placeholder","Escreva um coment\xE1rio...","rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex","justify-end","mt-2"],[1,"btn-primary","flex","items-center",3,"click","disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"fas","fa-paper-plane","mr-2"],["type","button",1,"btn-secondary","text-sm",3,"click"],[1,"fas","fa-paperclip","mr-2"],["class","text-sm text-gray-600",4,"ngIf"],["type","file","accept",".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.txt,.zip,.rar",1,"hidden",3,"change"],[1,"btn-primary-outline","text-sm",3,"click","disabled"],["class","text-gray-500 hover:text-gray-700 text-sm",3,"click",4,"ngIf"],[1,"mt-8"],[1,"space-y-3","max-h-64","overflow-y-auto"],["class","text-xs p-2 bg-gray-50 rounded",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-3","border-l","border-gray-200","pl-6","flex","flex-col","justify-between"],["class","mb-4",4,"ngIf"],["class","text-gray-500 text-sm italic p-3 bg-gray-50 rounded-lg",4,"ngIf"],["class","space-y-2",4,"ngIf"],["class","bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-sm mt-3",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",3,"click",4,"ngIf"],[1,"mb-2","text-[11px]","text-gray-400","flex","items-center","gap-2"],[1,"truncate"],[1,"select-all"],[1,"text-blue-500","hover:text-blue-700","text-xs",3,"click"],[1,"space-y-3"],["class","animate-pulse",4,"ngFor","ngForOf"],[1,"animate-pulse"],[1,"h-4","bg-gray-200","rounded","w-1/3","mb-1"],[1,"h-3","bg-gray-100","rounded","w-2/3"],["class","text-sm",4,"ngFor","ngForOf"],[1,"text-sm"],[1,"text-gray-800","font-semibold"],["class","break-all text-gray-600",4,"ngIf"],["class","mt-1",3,"formGroup",4,"ngIf"],[1,"break-all","text-gray-600"],[1,"mt-1",3,"formGroup"],["class","w-full p-2 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"type","formControlName","placeholder",4,"ngIf"],["rows","2","class","w-full p-2 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","number","class","w-full p-2 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","date","class","w-full p-2 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],["class","w-full p-2 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],[1,"w-full","p-2","text-xs","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"type","formControlName","placeholder"],["rows","2",1,"w-full","p-2","text-xs","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","number",1,"w-full","p-2","text-xs","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","date",1,"w-full","p-2","text-xs","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"w-full","p-2","text-xs","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-4","pt-3","border-t","border-gray-200"],[1,"btn-primary","w-full","text-xs",3,"click","disabled"],[1,"p-3","rounded-lg","border-l-4","border-gray-200"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-3","h-3","bg-gray-200","rounded-full"],[1,"h-4","bg-gray-200","rounded","w-1/4"],[1,"h-3","bg-gray-100","rounded","w-1/2"],["class","relative text-xs p-3 rounded-lg border-l-4 transition-all hover:shadow-sm",3,"border-left-color","bg-blue-50","bg-gray-50",4,"ngFor","ngForOf"],[1,"relative","text-xs","p-3","rounded-lg","border-l-4","transition-all","hover:shadow-sm"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded-full"],[1,"font-semibold","text-gray-800"],["class","px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-[10px] font-medium",4,"ngIf"],[1,"text-gray-500","text-[10px]"],[1,"space-y-1","text-gray-600"],[1,"flex","items-center","gap-1"],[1,"fas","fa-play","text-green-500","w-3"],["class","flex items-center gap-1",4,"ngIf"],[1,"fas","fa-clock","text-blue-500","w-3"],["class","absolute -bottom-2 left-1/2 transform -translate-x-1/2",4,"ngIf"],[1,"px-2","py-1","bg-blue-100","text-blue-800","rounded-full","text-[10px]","font-medium"],[1,"fas","fa-stop","text-red-500","w-3"],[1,"absolute","-bottom-2","left-1/2","transform","-translate-x-1/2"],[1,"fas","fa-chevron-down","text-gray-400","text-xs"],[1,"text-sm","text-gray-500","bg-gray-50","border","border-gray-200","rounded-lg","p-4","text-center"],[1,"fas","fa-info-circle","mb-2","text-gray-400"],[1,"text-xs","mt-1"],[1,"h-4","bg-gray-200","rounded","w-1/4","mb-2"],[1,"h-10","bg-gray-100","rounded"],["class","mb-6",4,"ngIf"],[1,"flex","justify-end","pt-4","border-t","border-gray-200"],["type","button",1,"btn-primary",3,"click","disabled"],[1,"mb-6"],[1,"fas","fa-clipboard-list","text-blue-500","mr-2"],[1,"space-y-3",3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["class","text-red-500",4,"ngIf"],["class","w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"type","formControlName","placeholder",4,"ngIf"],["rows","3","class","w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","number","class","w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName","placeholder",4,"ngIf"],["type","date","class","w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],["class","w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngIf"],["class","flex flex-wrap gap-4",4,"ngIf"],["class","flex flex-col gap-2",4,"ngIf"],[1,"text-red-500"],[1,"w-full","p-2","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"type","formControlName","placeholder"],["rows","3",1,"w-full","p-2","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","number",1,"w-full","p-2","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName","placeholder"],["type","date",1,"w-full","p-2","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"w-full","p-2","border","border-gray-300","rounded","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"flex","flex-wrap","gap-4"],["class","inline-flex items-center gap-2 text-sm text-gray-700",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-2","text-sm","text-gray-700"],["type","radio",1,"text-blue-600","focus:ring-blue-500",3,"value","formControlName"],[1,"flex","flex-col","gap-2"],["type","checkbox",1,"text-blue-600","focus:ring-blue-500",3,"value","formControlName"],[1,"fas","fa-globe","text-green-500","mr-2"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"],[1,"text-sm","text-gray-600"],[1,"text-gray-500","hover:text-gray-700","text-sm",3,"click"],[1,"text-xs","p-2","bg-gray-50","rounded"],[1,"flex","items-center","mb-1"],[1,"mr-2","text-blue-500"],[1,"font-medium"],[1,"ml-auto","text-gray-500"],[1,"text-gray-700",3,"innerHTML"],["class","mt-2",4,"ngIf"],[1,"mt-2"],["target","_blank",1,"text-blue-600","hover:underline","flex","items-center",3,"href"],[1,"fas","fa-paperclip","mr-1"],[1,"mb-4"],[1,"text-sm","font-semibold","text-green-700","mb-2"],[1,"grid","grid-cols-1","gap-2"],["class","text-left p-2 border border-green-200 rounded-md hover:bg-green-50 transition-colors flex items-center text-sm bg-white",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-left","p-2","border","border-green-200","rounded-md","hover:bg-green-50","transition-colors","flex","items-center","text-sm","bg-white",3,"click","disabled"],[1,"w-3","h-3","rounded-full","mr-2"],[1,"text-sm","font-medium","text-orange-600","mb-2"],[1,"grid","grid-cols-1","gap-1"],["class","text-left p-2 border border-orange-100 rounded-md hover:bg-orange-50 transition-colors flex items-center text-xs bg-orange-25 opacity-75",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-left","p-2","border","border-orange-100","rounded-md","hover:bg-orange-50","transition-colors","flex","items-center","text-xs","bg-orange-25","opacity-75",3,"click","disabled"],[1,"w-2","h-2","rounded-full","mr-2"],[1,"text-gray-500","text-sm","italic","p-3","bg-gray-50","rounded-lg"],[4,"ngIf","ngIfElse"],[1,"space-y-2"],[1,"text-xs","text-gray-600"],[1,"flex"],["type","text","readonly","",1,"flex-1","p-2","border","border-gray-300","rounded-l-lg","bg-gray-50","text-xs",3,"value"],[1,"btn-primary","rounded-l-none","rounded-r-lg","px-3",3,"click"],[1,"fas","fa-copy"],[1,"bg-red-50","border","border-red-200","text-red-700","px-3","py-2","rounded-lg","text-sm","mt-3"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-[60]",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","p-6",3,"click"],[1,"text-lg","font-bold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-6"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","rounded-lg","border","border-gray-300",3,"click"],[1,"px-4","py-2","rounded-lg","bg-red-600","text-white",3,"click"]],template:function(e,i){e&1&&b(0,Xa,70,28,"div",3),e&2&&m("ngIf",i.isVisible)},dependencies:[K,Z,Y,oe,ue,ge,he,ie,Xe,Pe,Ne,Pt,ne,me,Je,re,pe,fe],styles:['@charset "UTF-8";.btn-primary[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;font-weight:600;padding:.5rem 1rem;border-radius:.5rem;transition:filter .2s ease,opacity .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{filter:brightness(.9)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background-color:#f1f5f9;color:#334155;font-weight:600;padding:.5rem 1rem;border-radius:.5rem;transition:background-color .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#e2e8f0}.btn-primary-outline[_ngcontent-%COMP%]{background-color:transparent;color:var(--primary-color);font-weight:600;padding:.5rem 1rem;border-radius:.5rem;border:1px solid var(--primary-color);transition:all .2s ease}.btn-primary-outline[_ngcontent-%COMP%]:hover{background-color:#3b82f614}.modal-body[_ngcontent-%COMP%]{max-height:calc(95vh - 120px)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#374151;margin-bottom:.25rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{transition:border-color .2s ease,box-shadow .2s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.activity-item[_ngcontent-%COMP%]{padding:.75rem;background:#f9fafb;border-radius:.5rem;border-left:3px solid #e5e7eb}.phase-item[_ngcontent-%COMP%]{padding:.5rem;border-radius:.25rem;border-left:4px solid}.phase-item.current[_ngcontent-%COMP%]{background-color:#eff6ff;border-left-color:#3b82f6}.action-button[_ngcontent-%COMP%]{transition:all .2s ease;border:1px solid #d1d5db}.action-button[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#9ca3af}.public-link-container[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:.5rem;padding:1rem}.attachment-preview[_ngcontent-%COMP%]{background:#f1f5f9;border:1px solid #cbd5e1;padding:.5rem;border-radius:.375rem;font-size:.875rem;color:#475569}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-track, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.modal-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .activity-log[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}'],changeDetection:0})};var Gt=()=>{let o=typeof window<"u"?window:void 0;return o&&o.tinymce?o.tinymce:null},es=(()=>{class o{onBeforePaste=new C;onBlur=new C;onClick=new C;onCompositionEnd=new C;onCompositionStart=new C;onCompositionUpdate=new C;onContextMenu=new C;onCopy=new C;onCut=new C;onDblclick=new C;onDrag=new C;onDragDrop=new C;onDragEnd=new C;onDragGesture=new C;onDragOver=new C;onDrop=new C;onFocus=new C;onFocusIn=new C;onFocusOut=new C;onKeyDown=new C;onKeyPress=new C;onKeyUp=new C;onMouseDown=new C;onMouseEnter=new C;onMouseLeave=new C;onMouseMove=new C;onMouseOut=new C;onMouseOver=new C;onMouseUp=new C;onPaste=new C;onSelectionChange=new C;onActivate=new C;onAddUndo=new C;onBeforeAddUndo=new C;onBeforeExecCommand=new C;onBeforeGetContent=new C;onBeforeRenderUI=new C;onBeforeSetContent=new C;onChange=new C;onClearUndos=new C;onDeactivate=new C;onDirty=new C;onExecCommand=new C;onGetContent=new C;onHide=new C;onInit=new C;onInput=new C;onInitNgModel=new C;onLoadContent=new C;onNodeChange=new C;onPostProcess=new C;onPostRender=new C;onPreInit=new C;onPreProcess=new C;onProgressState=new C;onRedo=new C;onRemove=new C;onReset=new C;onResizeEditor=new C;onSaveContent=new C;onSetAttrib=new C;onObjectResizeStart=new C;onObjectResized=new C;onObjectSelected=new C;onSetContent=new C;onShow=new C;onSubmit=new C;onUndo=new C;onVisualAid=new C;static \u0275fac=function(i){return new(i||o)};static \u0275dir=Ke({type:o,outputs:{onBeforePaste:"onBeforePaste",onBlur:"onBlur",onClick:"onClick",onCompositionEnd:"onCompositionEnd",onCompositionStart:"onCompositionStart",onCompositionUpdate:"onCompositionUpdate",onContextMenu:"onContextMenu",onCopy:"onCopy",onCut:"onCut",onDblclick:"onDblclick",onDrag:"onDrag",onDragDrop:"onDragDrop",onDragEnd:"onDragEnd",onDragGesture:"onDragGesture",onDragOver:"onDragOver",onDrop:"onDrop",onFocus:"onFocus",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onKeyDown:"onKeyDown",onKeyPress:"onKeyPress",onKeyUp:"onKeyUp",onMouseDown:"onMouseDown",onMouseEnter:"onMouseEnter",onMouseLeave:"onMouseLeave",onMouseMove:"onMouseMove",onMouseOut:"onMouseOut",onMouseOver:"onMouseOver",onMouseUp:"onMouseUp",onPaste:"onPaste",onSelectionChange:"onSelectionChange",onActivate:"onActivate",onAddUndo:"onAddUndo",onBeforeAddUndo:"onBeforeAddUndo",onBeforeExecCommand:"onBeforeExecCommand",onBeforeGetContent:"onBeforeGetContent",onBeforeRenderUI:"onBeforeRenderUI",onBeforeSetContent:"onBeforeSetContent",onChange:"onChange",onClearUndos:"onClearUndos",onDeactivate:"onDeactivate",onDirty:"onDirty",onExecCommand:"onExecCommand",onGetContent:"onGetContent",onHide:"onHide",onInit:"onInit",onInput:"onInput",onInitNgModel:"onInitNgModel",onLoadContent:"onLoadContent",onNodeChange:"onNodeChange",onPostProcess:"onPostProcess",onPostRender:"onPostRender",onPreInit:"onPreInit",onPreProcess:"onPreProcess",onProgressState:"onProgressState",onRedo:"onRedo",onRemove:"onRemove",onReset:"onReset",onResizeEditor:"onResizeEditor",onSaveContent:"onSaveContent",onSetAttrib:"onSetAttrib",onObjectResizeStart:"onObjectResizeStart",onObjectResized:"onObjectResized",onObjectSelected:"onObjectSelected",onSetContent:"onSetContent",onShow:"onShow",onSubmit:"onSubmit",onUndo:"onUndo",onVisualAid:"onVisualAid"},standalone:!1})}return o})(),Bn=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onCompositionEnd","onCompositionStart","onCompositionUpdate","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onResizeEditor","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Wt=(o,t,e)=>ei(o,t).pipe(Te(e)),ts=(o,t,e)=>{is(o).forEach(n=>{let r=o[n];Wt(t,n.substring(2),e).subscribe(d=>{as(r)&&o.ngZone.run(()=>r.emit({event:d,editor:t}))})})},is=o=>{let t=jn(o.ignoreEvents,[]);return jn(o.allowedEvents,Bn).filter(i=>Bn.includes(i)&&!t.includes(i))},jn=(o,t)=>typeof o=="string"?o.split(",").map(e=>e.trim()):Array.isArray(o)?o:t,zn=0,ns=o=>{let e=new Date().getTime(),i=Math.floor(Math.random()*1e9);return zn++,o+"_"+i+zn+String(e)},Un=o=>typeof o<"u"&&o.tagName.toLowerCase()==="textarea",Kn=o=>typeof o>"u"||o===""?[]:Array.isArray(o)?o:o.split(" "),os=(o,t)=>Kn(o).concat(Kn(t)),rs=()=>{},Hn=o=>o==null,as=o=>o.observed||o.observers?.length>0,ss=()=>o=>o.pipe(Oi(),yt(()=>{})),ls=()=>{let o=new xt(null),t=o.pipe(wt(Boolean),rt(([e,i])=>{let n=e.createElement("script");return n.referrerPolicy="origin",n.type="application/javascript",n.src=i,e.head.appendChild(n),ei(n,"load").pipe(ss())}),ii({bufferSize:1,refCount:!0}));return{load:(...e)=>(o.getValue()||o.next(e),t),reinitialize:()=>{o.next(null)}}},ds=ls(),Fi=new be("TINYMCE_SCRIPT_SRC"),cs={provide:tn,useExisting:ni(()=>Qt),multi:!0},Qt=(()=>{class o extends es{cdRef;platformId;tinymceScriptSrc;cloudChannel="7";apiKey="no-api-key";licenseKey;init;id="";initialValue;outputFormat;inline;tagName;plugins;toolbar;modelEvents="change input undo redo";allowedEvents;ignoreEvents;set disabled(e){this._disabled=e,this._editor&&this._editor.initialized&&(typeof this._editor.mode?.set=="function"?this._editor.mode.set(e?"readonly":"design"):this._editor.setMode(e?"readonly":"design"))}get disabled(){return this._disabled}get editor(){return this._editor}ngZone;_elementRef;_element;_disabled;_editor;onTouchedCallback=rs;onChangeCallback;destroy$=new V;constructor(e,i,n,r,d){super(),this.cdRef=n,this.platformId=r,this.tinymceScriptSrc=d,this._elementRef=e,this.ngZone=i}writeValue(e){this._editor&&this._editor.initialized?this._editor.setContent(Hn(e)?"":e):this.initialValue=e===null?void 0:e}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngAfterViewInit(){Dt(this.platformId)&&(this.id=this.id||ns("tiny-angular"),this.inline=this.inline!==void 0?this.inline!==!1:!!this.init?.inline,this.createElement(),Gt()!==null?this.initialise():this._element&&this._element.ownerDocument&&ds.load(this._element.ownerDocument,this.getScriptSrc()).pipe(Te(this.destroy$)).subscribe(this.initialise))}ngOnDestroy(){this.destroy$.next(),Gt()!==null&&Gt().remove(this._editor)}createElement(){let e=typeof this.tagName=="string"?this.tagName:"div";if(this._element=document.createElement(this.inline?e:"textarea"),this._element){let i=document.getElementById(this.id);i&&i!==this._elementRef.nativeElement&&console.warn(`TinyMCE-Angular: an element with id [${this.id}] already exists. Editors with duplicate Id will not be able to mount`),this._element.id=this.id,Un(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element)}}initialise=()=>{let e=ee(R({},this.init),{selector:void 0,target:this._element,inline:this.inline,readonly:this.disabled,license_key:this.licenseKey,plugins:os(this.init&&this.init.plugins,this.plugins),toolbar:this.toolbar||this.init&&this.init.toolbar,setup:i=>{this._editor=i,Wt(i,"init",this.destroy$).subscribe(()=>{this.initEditor(i)}),ts(this,i,this.destroy$),this.init&&typeof this.init.setup=="function"&&this.init.setup(i)}});Un(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(()=>{Gt().init(e)})};getScriptSrc(){return Hn(this.tinymceScriptSrc)?`https://cdn.tiny.cloud/1/${this.apiKey}/tinymce/${this.cloudChannel}/tinymce.min.js`:this.tinymceScriptSrc}initEditor(e){Wt(e,"blur",this.destroy$).subscribe(()=>{this.cdRef.markForCheck(),this.ngZone.run(()=>this.onTouchedCallback())}),Wt(e,this.modelEvents,this.destroy$).subscribe(()=>{this.cdRef.markForCheck(),this.ngZone.run(()=>this.emitOnChange(e))}),typeof this.initialValue=="string"&&this.ngZone.run(()=>{e.setContent(this.initialValue),e.getContent()!==this.initialValue&&this.emitOnChange(e),this.onInitNgModel!==void 0&&this.onInitNgModel.emit(e)})}emitOnChange(e){this.onChangeCallback&&this.onChangeCallback(e.getContent({format:this.outputFormat}))}static \u0275fac=function(i){return new(i||o)(Le(ke),Le(xe),Le(De),Le(St),Le(Fi,8))};static \u0275cmp=j({type:o,selectors:[["editor"]],inputs:{cloudChannel:"cloudChannel",apiKey:"apiKey",licenseKey:"licenseKey",init:"init",id:"id",initialValue:"initialValue",outputFormat:"outputFormat",inline:"inline",tagName:"tagName",plugins:"plugins",toolbar:"toolbar",modelEvents:"modelEvents",allowedEvents:"allowedEvents",ignoreEvents:"ignoreEvents",disabled:"disabled"},features:[Ae([cs]),ri],decls:0,vars:0,template:function(i,n){},dependencies:[K,oe],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return o})(),qn=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Ye({type:o});static \u0275inj=We({imports:[Qt]})}return o})();function us(o,t){if(o&1){let e=F();a(0,"button",33),x("click",function(){let n=_(e).$implicit,r=u(2);return v(r.insertVariable(n.value))}),c(1),s()}if(o&2){let e=t.$implicit,i=u(2);m("disabled",i.isLoading),l(),S(" ",e.value," ")}}function ps(o,t){if(o&1&&(a(0,"div",34),c(1),s()),o&2){let e=u(2);l(),S(" ",e.errorMessage," ")}}function fs(o,t){o&1&&g(0,"div",35)}function gs(o,t){if(o&1){let e=F();a(0,"div",1),x("click",function(n){_(e);let r=u();return v(r.onBackdropClick(n))}),a(1,"div",2)(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){_(e);let n=u();return v(n.hide())}),c(6," \xD7 "),s()(),a(7,"form",6),x("ngSubmit",function(){_(e);let n=u();return v(n.saveTemplate())}),a(8,"div",7)(9,"div",8)(10,"label",9),c(11," Nome do Template "),a(12,"span",10),c(13,"*"),s()(),g(14,"input",11),s(),a(15,"div",8)(16,"label",12),c(17," Destinat\xE1rios "),s(),g(18,"input",13),s()(),a(19,"div",14)(20,"label",15),c(21," Assunto "),a(22,"span",10),c(23,"*"),s()(),g(24,"input",16),s(),a(25,"div",17)(26,"div",18)(27,"label",19),c(28," Corpo do Email "),a(29,"span",10),c(30,"*"),s()()(),a(31,"div",20)(32,"p",21),c(33,"Clique para inserir vari\xE1veis:"),s(),a(34,"div",22),b(35,us,2,2,"button",23),s(),a(36,"p",24),c(37," As vari\xE1veis ser\xE3o substitu\xEDdas automaticamente pelos dados reais do lead quando o email for enviado. "),s()(),a(38,"div",17)(39,"label",25),c(40," Corpo do E-mail "),a(41,"span",10),c(42,"*"),s()(),a(43,"div",26)(44,"editor",27),x("onInit",function(n){_(e);let r=u();return v(r.onEditorInit(n.editor))}),s()()()(),b(45,ps,2,1,"div",28),a(46,"div",29)(47,"button",30),x("click",function(){_(e);let n=u();return v(n.hide())}),c(48," Cancelar "),s(),a(49,"button",31),b(50,fs,1,0,"div",32),c(51),s()()()()()}if(o&2){let e=u();l(4),S(" ",e.isEditing?"Editar Template":"Criar Novo Template"," "),l(),m("disabled",e.isLoading),l(2),m("formGroup",e.templateForm),l(7),m("disabled",e.isLoading),l(4),m("placeholder",zi("Ex: ","{{","contactEmail","}}"))("disabled",e.isLoading),l(6),m("disabled",e.isLoading),l(11),m("ngForOf",e.variables),l(9),m("init",e.tinymceConfig),l(),m("ngIf",e.errorMessage),l(2),m("disabled",e.isLoading),l(2),m("disabled",e.isLoading||!e.templateForm.valid),l(),m("ngIf",e.isLoading),l(),S(" ",e.isLoading?"Salvando...":e.isEditing?"Atualizar Template":"Criar Template"," ")}}var _t=class o{firestoreService=I(J);fb=I(_e);ownerId="";boardId="";templateSaved=new C;closeModal=new C;isVisible=!1;isEditing=!1;isLoading=!1;errorMessage="";currentTemplate=null;tinymceEditor=null;tinymceConfig={height:400,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","help","wordcount"],toolbar:"undo redo | blocks | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | code | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }",placeholder:"Digite o conte\xFAdo do seu template de email aqui...",branding:!1,code_dialog_width:800,code_dialog_height:600};templateForm=this.fb.group({name:["",[q.required]],subject:["",[q.required]],recipients:[""],body:["",[q.required]]});variables=[];ngAfterViewInit(){}insertVariable(t){if(this.tinymceEditor)try{this.tinymceEditor.insertContent(t),this.tinymceEditor.focus();return}catch(n){console.warn("Falha ao inserir no TinyMCE, usando fallback:",n)}let i=(this.templateForm.get("body")?.value||"")+" "+t;this.templateForm.patchValue({body:i})}onEditorInit(t){this.tinymceEditor=t,console.log("TinyMCE Editor inicializado e pronto")}showCreateModal(){this.isEditing=!1,this.currentTemplate=null,this.isVisible=!0,this.resetForm(),this.loadDynamicVariables()}showEditModal(t){this.isEditing=!0,this.currentTemplate=t,this.isVisible=!0,this.populateForm(t),this.loadDynamicVariables()}hide(){this.isVisible=!1,this.resetForm(),this.closeModal.emit()}resetForm(){this.templateForm.reset({name:"",subject:"",recipients:"",body:""}),this.errorMessage="",this.isLoading=!1}populateForm(t){console.log("Carregando template:",t),this.templateForm.patchValue({name:t.name||"",subject:t.subject||"",recipients:t.recipients||"",body:t.body||""}),console.log("Template carregado:",t.body)}loadDynamicVariables(){return D(this,null,function*(){try{let t=[{name:"Nome do Respons\xE1vel",value:"{{nomeResponsavel}}"},{name:"Email do Respons\xE1vel",value:"{{emailResponsavel}}"},{name:"Nome da Fase Atual",value:"{{currentPhaseName}}"},{name:"Data Atual",value:"{{currentDate}}"},{name:"Link do Registro",value:"{{leadLink}}"}],e=yield this.firestoreService.getInitialFormConfig(this.boardId),i=[],n=r=>{let d=r.apiFieldName?.trim()||r.name?.trim();d&&i.push({name:r.label||d,value:`{{${d}}}`})};e?.fields&&Array.isArray(e.fields)&&e.fields.forEach(n),i.length===0&&i.push({name:"Nome",value:"{{name}}"},{name:"Email",value:"{{email}}"},{name:"Telefone",value:"{{phone}}"}),this.variables=[...i,...t]}catch{this.variables=[{name:"Nome",value:"{{name}}"},{name:"Email",value:"{{email}}"},{name:"Telefone",value:"{{phone}}"},{name:"Data Atual",value:"{{currentDate}}"}]}})}saveTemplate(){return D(this,null,function*(){if(!this.templateForm.valid){this.errorMessage="Por favor, preencha todos os campos obrigat\xF3rios.";return}this.isLoading=!0,this.errorMessage="";try{let t=this.templateForm.value,e={name:t.name,subject:t.subject,recipients:t.recipients||"",body:t.body||""};this.isEditing&&this.currentTemplate?yield this.firestoreService.updateEmailTemplate(this.ownerId,this.boardId,this.currentTemplate.id,e):yield this.firestoreService.createEmailTemplate(this.ownerId,this.boardId,e),this.templateSaved.emit(),this.hide()}catch(t){console.error("Erro ao salvar template:",t),this.errorMessage="Erro ao salvar template. Tente novamente."}finally{this.isLoading=!1}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-template-modal"]],inputs:{ownerId:"ownerId",boardId:"boardId"},outputs:{templateSaved:"templateSaved",closeModal:"closeModal"},features:[Ae([{provide:Fi,useValue:"tinymce/tinymce.min.js"}])],decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-6xl","max-h-[95vh]","overflow-hidden"],[1,"flex","justify-between","items-center","p-6","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"p-6","max-h-[calc(95vh-120px)]","overflow-y-auto",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"form-group"],["for","templateName",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","id","templateName","formControlName","name","placeholder","Ex: Template de boas-vindas, email promocional, etc.",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled"],["for","templateRecipients",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","templateRecipients","formControlName","recipients",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled","placeholder"],[1,"form-group","mb-4"],["for","templateSubject",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","templateSubject","formControlName","subject","placeholder","Ex: Obrigado por entrar em contato",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"disabled"],[1,"mb-4"],[1,"flex","justify-between","items-center","mb-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"bg-gray-50","p-3","rounded-md","mb-3"],[1,"text-xs","text-gray-600","mb-2"],[1,"flex","flex-wrap","gap-1"],["type","button","class","variable-tag px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded hover:bg-blue-200 transition-colors",3,"disabled","click",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500","mt-2"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"border","border-gray-300","rounded-lg","overflow-hidden"],["formControlName","body",3,"onInit","init"],["class","mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",4,"ngIf"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200"],["type","button",1,"px-6","py-3","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-3","bg-blue-500","hover:bg-blue-600","disabled:bg-blue-300","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],["type","button",1,"variable-tag","px-2","py-1","bg-blue-100","text-blue-800","text-xs","rounded","hover:bg-blue-200","transition-colors",3,"click","disabled"],[1,"mb-4","bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&b(0,gs,52,16,"div",0),e&2&&m("ngIf",i.isVisible)},dependencies:[K,Z,Y,oe,ue,ie,ne,me,re,pe,fe,qn,Qt],styles:[".form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{transition:border-color .2s ease,box-shadow .2s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.variable-tag[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.variable-tag[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}[_nghost-%COMP%]     .ql-editor{min-height:300px;font-size:14px;line-height:1.6}[_nghost-%COMP%]     .ql-toolbar{border-top:1px solid #d1d5db;border-left:1px solid #d1d5db;border-right:1px solid #d1d5db;background-color:#f9fafb}[_nghost-%COMP%]     .ql-container{border-bottom:1px solid #d1d5db;border-left:1px solid #d1d5db;border-right:1px solid #d1d5db}[_nghost-%COMP%]     .ql-editor.ql-blank:before{color:#9ca3af;content:attr(data-placeholder);font-style:italic}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};var bt=()=>({standalone:!0});function hs(o,t){o&1&&(Ie(0),a(1,"option",24),c(2,"Criar novo registro (apenas fase inicial)"),s(),a(3,"option",25),c(4,"Um card entrou na fase"),s(),a(5,"option",26),c(6,"Um card est\xE1 na fase por um tempo"),s(),a(7,"option",27),c(8,"Formul\xE1rio da fase n\xE3o respondido"),s(),a(9,"option",28),c(10,"SLA da fase venceu"),s(),Fe())}function _s(o,t){o&1&&(a(0,"option",24),c(1,"Criar novo registro (apenas fase inicial)"),s())}function vs(o,t){o&1&&(a(0,"option",25),c(1,"Um card entrou na fase"),s())}function bs(o,t){o&1&&(a(0,"option",26),c(1,"Um card est\xE1 na fase por um tempo"),s())}function xs(o,t){o&1&&(a(0,"option",27),c(1,"Formul\xE1rio da fase n\xE3o respondido"),s())}function ys(o,t){o&1&&(a(0,"option",28),c(1,"SLA da fase venceu"),s())}function Cs(o,t){if(o&1&&(Ie(0),b(1,_s,2,0,"option",29)(2,vs,2,0,"option",30)(3,bs,2,0,"option",31)(4,xs,2,0,"option",32)(5,ys,2,0,"option",33),Fe()),o&2){let e=u();l(),m("ngIf",e.allowedTriggerTypes.includes("new-lead-created")),l(),m("ngIf",e.allowedTriggerTypes.includes("card-enters-phase")),l(),m("ngIf",e.allowedTriggerTypes.includes("card-in-phase-for-time")),l(),m("ngIf",e.allowedTriggerTypes.includes("form-not-answered")),l(),m("ngIf",e.allowedTriggerTypes.includes("sla-overdue"))}}function ws(o,t){if(o&1&&(a(0,"option",36),c(1),s()),o&2){let e=t.$implicit;m("value",e.id),l(),P(e.name)}}function Es(o,t){if(o&1&&(Ie(0),a(1,"select",34),b(2,ws,2,2,"option",35),s(),Fe()),o&2){let e=u();l(2),m("ngForOf",e.phases)}}function Ss(o,t){if(o&1&&(a(0,"div",37),c(1),s()),o&2){let e=u();l(),S(" ",e.getFixedPhaseName()," ")}}function Is(o,t){o&1&&(a(0,"label",38),c(1,"Por (dias):"),s())}function Fs(o,t){o&1&&(a(0,"label",38),c(1,"Aguardar (dias):"),s())}function Ds(o,t){o&1&&(a(0,"div",39),c(1," Se, ap\xF3s esse prazo, nenhum campo do formul\xE1rio da fase tiver sido preenchido, a automa\xE7\xE3o ser\xE1 executada. "),s())}function Ps(o,t){if(o&1&&(a(0,"option",36),c(1),s()),o&2){let e=t.$implicit;m("value",e.id),l(),P(e.name)}}function Ms(o,t){if(o&1){let e=F();a(0,"div")(1,"select",51),ce("ngModelChange",function(n){_(e);let r=u().$implicit;return de(r.templateId,n)||(r.templateId=n),v(n)}),a(2,"option",52),c(3,"Selecione um template"),s(),b(4,Ps,2,2,"option",35),s()()}if(o&2){let e=u().$implicit,i=u();l(),le("ngModel",e.templateId),m("ngModelOptions",N(3,bt)),l(3),m("ngForOf",i.emailTemplates)}}function Ts(o,t){if(o&1&&(a(0,"option",36),c(1),s()),o&2){let e=t.$implicit;m("value",e.id),l(),P(e.name)}}function ks(o,t){if(o&1&&(a(0,"div",39),c(1),s()),o&2){let e=u(3);l(),S(" Origem: ",e.getFixedPhaseName()," ")}}function Os(o,t){if(o&1){let e=F();a(0,"div")(1,"select",51),ce("ngModelChange",function(n){_(e);let r=u().$implicit;return de(r.phaseId,n)||(r.phaseId=n),v(n)}),a(2,"option",52),c(3,"Selecione a fase de destino"),s(),b(4,Ts,2,2,"option",35),s(),b(5,ks,2,1,"div",16),s()}if(o&2){let e,i=u().$implicit,n=u();l(),le("ngModel",i.phaseId),m("ngModelOptions",N(4,bt)),l(3),m("ngForOf",n.getAllowedPhasesForMoveAction()),l(),m("ngIf",n.fixedPhaseId||((e=n.automationForm.get("triggerPhase"))==null?null:e.value))}}function As(o,t){if(o&1&&(a(0,"option",36),c(1),s()),o&2){let e=t.$implicit;m("value",e.id),l(),P(e.name)}}function Ls(o,t){if(o&1){let e=F();a(0,"div")(1,"select",51),ce("ngModelChange",function(n){_(e);let r=u().$implicit;return de(r.userId,n)||(r.userId=n),v(n)}),a(2,"option",52),c(3,"Selecione um usu\xE1rio"),s(),b(4,As,2,2,"option",35),s()()}if(o&2){let e=u().$implicit,i=u();l(),le("ngModel",e.userId),m("ngModelOptions",N(3,bt)),l(3),m("ngForOf",i.users)}}function Rs(o,t){if(o&1){let e=F();a(0,"div")(1,"textarea",53),ce("ngModelChange",function(n){_(e);let r=u().$implicit;return de(r.note,n)||(r.note=n),v(n)}),s()()}if(o&2){let e=u().$implicit;l(),le("ngModel",e.note),m("ngModelOptions",N(2,bt))}}function Vs(o,t){if(o&1){let e=F();a(0,"div",40)(1,"div",41)(2,"select",42),ce("ngModelChange",function(n){let r=_(e).$implicit;return de(r.type,n)||(r.type=n),v(n)}),a(3,"option",43),c(4,"Enviar e-mail"),s(),a(5,"option",44),c(6,"Mover para fase"),s(),a(7,"option",45),c(8,"Atribuir usu\xE1rio"),s(),a(9,"option",46),c(10,"Adicionar nota"),s()(),a(11,"button",47),x("click",function(){let n=_(e).index,r=u();return v(r.removeAction(n))}),g(12,"i",48),s()(),a(13,"div",49),b(14,Ms,5,4,"div",50)(15,Os,6,5,"div",50)(16,Ls,5,4,"div",50)(17,Rs,2,3,"div",50),s()()}if(o&2){let e=t.$implicit;l(2),le("ngModel",e.type),m("ngModelOptions",N(7,bt)),l(11),m("ngSwitch",e.type),l(),m("ngSwitchCase","send-email"),l(),m("ngSwitchCase","move-to-phase"),l(),m("ngSwitchCase","assign-user"),l(),m("ngSwitchCase","add-note")}}var vt=class o{constructor(t){this.fb=t;this.automationForm=this.createForm()}isVisible=!1;automation=null;phases=[];emailTemplates=[];users=[];allowedTriggerTypes=null;fixedPhaseId=null;allowedTransitions={};closeModalEvent=new C;saveAutomation=new C;automationForm;modalTitle="Criar Automa\xE7\xE3o";isEditing=!1;showTriggerPhase=!1;showTriggerTime=!1;getFixedPhaseName(){if(!this.fixedPhaseId||!Array.isArray(this.phases))return"Fase selecionada";let t=this.phases.find(e=>e&&e.id===this.fixedPhaseId);return t&&t.name?t.name:"Fase selecionada"}ngOnInit(){this.automation&&(this.isEditing=!0,this.modalTitle="Editar Automa\xE7\xE3o",this.loadAutomationData()),this.fixedPhaseId&&this.automationForm.get("triggerPhase")?.setValue(this.fixedPhaseId)}createForm(){return this.fb.group({id:[""],name:[""],triggerType:["new-lead-created",q.required],triggerPhase:[""],triggerDays:[1],actions:this.fb.array([])})}createActionGroup(t){let e=this.fb.group({type:["send-email"],templateId:[""],phaseId:[""],userId:[""],note:[""]});return t&&e.patchValue(t),e}loadAutomationData(){if(this.automation){this.automationForm.patchValue({id:this.automation.id,name:this.automation.name,triggerType:this.automation.triggerType,triggerPhase:this.automation.triggerPhase,triggerDays:this.automation.triggerDays});let t=this.automationForm.get("actions");t.clear(),this.automation.actions&&this.automation.actions.forEach(e=>{t.push(this.createActionGroup(e))}),this.onTriggerTypeChange()}}onTriggerTypeChange(){let t=this.automationForm.get("triggerType")?.value;this.showTriggerPhase=t==="card-enters-phase"||t==="card-in-phase-for-time"||t==="form-not-answered"||t==="sla-overdue",this.showTriggerTime=t==="card-in-phase-for-time"||t==="form-not-answered";let e=this.automationForm.get("triggerPhase"),i=this.automationForm.get("triggerDays");if(this.showTriggerPhase){e?.setValidators([q.required]);let n=e?.value,r=this.fixedPhaseId||n||this.phases&&this.phases[0]?.id||"";r&&e?.setValue(r)}else e?.clearValidators(),e?.setValue("");e?.updateValueAndValidity({emitEvent:!1}),this.showTriggerTime?i?.setValidators([q.required,q.min(1)]):(i?.clearValidators(),i?.setValue(1)),i?.updateValueAndValidity({emitEvent:!1})}getAllowedPhasesForMoveAction(){try{let t=this.fixedPhaseId||this.automationForm.get("triggerPhase")?.value||"";if(!t)return[];let e=this.allowedTransitions&&this.allowedTransitions[t]||[];return Array.isArray(e)&&e.length>0?(this.phases||[]).filter(i=>e.includes(i.id)):(this.phases||[]).filter(i=>i.id!==t)}catch{return this.phases||[]}}get actionsFormArray(){return this.automationForm.get("actions")}addAction(){this.actionsFormArray.push(this.createActionGroup())}removeAction(t){this.actionsFormArray.removeAt(t)}onSubmit(){if(this.automationForm.valid){let t=this.automationForm.value,e=ee(R({},t),{name:t.name||`Automa\xE7\xE3o ${this.getAutomationTypeName(t.triggerType)}`,actions:t.actions.filter(i=>this.isValidAction(i))});this.saveAutomation.emit(e),this.closeModal()}}isValidAction(t){switch(t.type){case"send-email":return!!t.templateId;case"move-to-phase":return!!t.phaseId;case"assign-user":return!!t.userId;case"add-note":return!!t.note&&t.note.trim().length>0;default:return!1}}canSubmit(){return this.automationForm.valid?(this.actionsFormArray?.value||[]).some(e=>this.isValidAction(e)):!1}getAutomationTypeName(t){return{"new-lead-created":"Criar novo registro (apenas fase inicial)","card-enters-phase":"Um card entrou na fase","card-in-phase-for-time":"Um card est\xE1 na fase por um tempo","form-not-answered":"Formul\xE1rio da fase n\xE3o respondido","sla-overdue":"SLA Vencido"}[t]||"Sem Nome"}closeModal(){this.automationForm.reset(),this.actionsFormArray.clear(),this.isEditing=!1,this.modalTitle="Criar Automa\xE7\xE3o",this.showTriggerPhase=!1,this.showTriggerTime=!1,this.closeModalEvent.emit()}static \u0275fac=function(e){return new(e||o)(Le(_e))};static \u0275cmp=j({type:o,selectors:[["app-automation-modal"]],inputs:{isVisible:"isVisible",automation:"automation",phases:"phases",emailTemplates:"emailTemplates",users:"users",allowedTriggerTypes:"allowedTriggerTypes",fixedPhaseId:"fixedPhaseId",allowedTransitions:"allowedTransitions"},outputs:{closeModalEvent:"closeModalEvent",saveAutomation:"saveAutomation"},decls:38,vars:16,consts:[["fixedPhase",""],[1,"modal-overlay",3,"click"],[1,"modal-content","modal-content-md","p-6",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold"],[1,"text-gray-500","hover:text-gray-800","text-2xl",3,"click"],[1,"modal-body","space-y-6",3,"ngSubmit","formGroup"],[1,"border","rounded-lg","p-4"],[1,"font-semibold","text-md","mb-3","text-gray-700"],["formControlName","triggerType",1,"w-full","p-2","border","rounded-md","mb-2","bg-white",3,"change"],[4,"ngIf"],["for","triggerPhase",1,"text-sm","font-medium","text-gray-700"],[4,"ngIf","ngIfElse"],[1,"mt-2"],["for","triggerDays","class","text-sm font-medium text-gray-700",4,"ngIf"],["type","number","formControlName","triggerDays","min","1","placeholder","Ex: 3",1,"w-full","p-2","border","rounded-md","mt-1"],["class","text-xs text-gray-500 mt-1",4,"ngIf"],[1,"space-y-3"],["class","border rounded-lg p-3 bg-gray-50",4,"ngFor","ngForOf"],["type","button",1,"mt-4","bg-gray-200","hover:bg-gray-300","text-gray-700","font-semibold","py-2","px-4","rounded-lg","text-sm",3,"click"],[1,"fas","fa-plus","mr-2"],[1,"mt-6","flex","justify-end","gap-4"],["type","button",1,"bg-gray-200","hover:bg-gray-300","text-gray-800","font-bold","py-2","px-4","rounded-lg",3,"click"],["type","submit",1,"bg-blue-500","hover:bg-blue-600","text-white","font-bold","py-2","px-4","rounded-lg","disabled:bg-gray-400",3,"disabled"],["value","new-lead-created"],["value","card-enters-phase"],["value","card-in-phase-for-time"],["value","form-not-answered"],["value","sla-overdue"],["value","new-lead-created",4,"ngIf"],["value","card-enters-phase",4,"ngIf"],["value","card-in-phase-for-time",4,"ngIf"],["value","form-not-answered",4,"ngIf"],["value","sla-overdue",4,"ngIf"],["formControlName","triggerPhase",1,"w-full","p-2","border","rounded-md","mt-1","bg-white"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-1","p-2","bg-gray-50","border","rounded","text-sm"],["for","triggerDays",1,"text-sm","font-medium","text-gray-700"],[1,"text-xs","text-gray-500","mt-1"],[1,"border","rounded-lg","p-3","bg-gray-50"],[1,"flex","justify-between","items-start","mb-2"],[1,"p-2","border","rounded-md","bg-white","flex-1","mr-2",3,"ngModelChange","ngModel","ngModelOptions"],["value","send-email"],["value","move-to-phase"],["value","assign-user"],["value","add-note"],["type","button",1,"text-red-500","hover:text-red-700",3,"click"],[1,"fas","fa-trash"],[1,"mt-2",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"w-full","p-2","border","rounded-md","bg-white",3,"ngModelChange","ngModel","ngModelOptions"],["value",""],["rows","3","placeholder","Digite a nota...",1,"w-full","p-2","border","rounded-md",3,"ngModelChange","ngModel","ngModelOptions"]],template:function(e,i){if(e&1){let n=F();a(0,"div",1),x("click",function(){return _(n),v(i.closeModal())}),a(1,"div",2),x("click",function(d){return _(n),v(d.stopPropagation())}),a(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){return _(n),v(i.closeModal())}),c(6,"\xD7"),s()(),a(7,"form",6),x("ngSubmit",function(){return _(n),v(i.onSubmit())}),a(8,"div",7)(9,"h3",8),c(10,"Gatilho (Quando...)"),s(),a(11,"select",9),x("change",function(){return _(n),v(i.onTriggerTypeChange())}),b(12,hs,11,0,"ng-container",10)(13,Cs,6,5,"ng-container",10),s(),a(14,"div")(15,"label",11),c(16,"Fase:"),s(),b(17,Es,3,1,"ng-container",12)(18,Ss,2,1,"ng-template",null,0,He),s(),a(20,"div",13),b(21,Is,2,0,"label",14)(22,Fs,2,0,"label",14),g(23,"input",15),b(24,Ds,2,0,"div",16),s()(),a(25,"div",7)(26,"h3",8),c(27,"A\xE7\xF5es (Fa\xE7a isso...)"),s(),a(28,"div",17),b(29,Vs,18,8,"div",18),s(),a(30,"button",19),x("click",function(){return _(n),v(i.addAction())}),g(31,"i",20),c(32,"Adicionar A\xE7\xE3o "),s()(),a(33,"div",21)(34,"button",22),x("click",function(){return _(n),v(i.closeModal())}),c(35,"Cancelar"),s(),a(36,"button",23),c(37),s()()()()()}if(e&2){let n,r,d,p,f=Re(19);l(4),P(i.modalTitle),l(3),m("formGroup",i.automationForm),l(5),m("ngIf",!i.allowedTriggerTypes),l(),m("ngIf",i.allowedTriggerTypes),l(),A("hidden",!i.showTriggerPhase),l(3),m("ngIf",!i.fixedPhaseId)("ngIfElse",f),l(3),A("hidden",!i.showTriggerTime),l(),m("ngIf",((n=i.automationForm.get("triggerType"))==null?null:n.value)==="card-in-phase-for-time"),l(),m("ngIf",((r=i.automationForm.get("triggerType"))==null?null:r.value)==="form-not-answered"),l(2),m("ngIf",((d=i.automationForm.get("triggerType"))==null?null:d.value)==="form-not-answered"),l(5),m("ngForOf",(p=i.automationForm.get("actions"))==null?null:p.value),l(7),m("disabled",!i.canSubmit()),l(),S(" ",i.isEditing?"Atualizar":"Salvar"," Automa\xE7\xE3o ")}},dependencies:[K,Z,Y,Gi,Wi,re,ue,ge,he,ie,Xe,Ne,ne,me,Mt,pe,fe,oe,Je],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 4px 6px #0000001a;max-height:90vh;overflow-y:auto}.modal-content-md[_ngcontent-%COMP%]{width:90%;max-width:600px}.hidden[_ngcontent-%COMP%]{display:none!important}form[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border:1px solid #e5e7eb}form[_ngcontent-%COMP%]   .rounded-lg[_ngcontent-%COMP%]{border-radius:8px}form[_ngcontent-%COMP%]   .p-4[_ngcontent-%COMP%]{padding:1rem}form[_ngcontent-%COMP%]   .p-6[_ngcontent-%COMP%]{padding:1.5rem}form[_ngcontent-%COMP%]   .space-y-6[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1.5rem}form[_ngcontent-%COMP%]   .space-y-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.75rem}form[_ngcontent-%COMP%]   select.w-full[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.w-full[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.w-full[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   select.p-2[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.p-2[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.p-2[_ngcontent-%COMP%]{padding:.5rem}form[_ngcontent-%COMP%]   select.border[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.border[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.border[_ngcontent-%COMP%]{border:1px solid #d1d5db}form[_ngcontent-%COMP%]   select.rounded-md[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.rounded-md[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.rounded-md[_ngcontent-%COMP%]{border-radius:6px}form[_ngcontent-%COMP%]   select.bg-white[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   input.bg-white[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   textarea.bg-white[_ngcontent-%COMP%]{background-color:#fff}form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}form[_ngcontent-%COMP%]   button.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}form[_ngcontent-%COMP%]   button.hover\\\\[_ngcontent-%COMP%]:bg-gray-300:hover{background-color:#d1d5db}form[_ngcontent-%COMP%]   button.bg-blue-500[_ngcontent-%COMP%]{background-color:#3b82f6}form[_ngcontent-%COMP%]   button.hover\\\\[_ngcontent-%COMP%]:bg-blue-600:hover{background-color:#2563eb}form[_ngcontent-%COMP%]   button.text-gray-700[_ngcontent-%COMP%]{color:#374151}form[_ngcontent-%COMP%]   button.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}form[_ngcontent-%COMP%]   button.text-white[_ngcontent-%COMP%]{color:#fff}form[_ngcontent-%COMP%]   button.font-semibold[_ngcontent-%COMP%]{font-weight:600}form[_ngcontent-%COMP%]   button.font-bold[_ngcontent-%COMP%]{font-weight:700}form[_ngcontent-%COMP%]   button.py-2[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem}form[_ngcontent-%COMP%]   button.px-4[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}form[_ngcontent-%COMP%]   button.rounded-lg[_ngcontent-%COMP%]{border-radius:8px}form[_ngcontent-%COMP%]   button.text-sm[_ngcontent-%COMP%]{font-size:.875rem}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}form[_ngcontent-%COMP%]   button.disabled\\\\[_ngcontent-%COMP%]:bg-gray-400:disabled{background-color:#9ca3af}.text-red-500[_ngcontent-%COMP%]{color:#ef4444}.hover\\\\[_ngcontent-%COMP%]:text-red-700:hover{color:#b91c1c}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.flex[_ngcontent-%COMP%]{display:flex}.justify-between[_ngcontent-%COMP%]{justify-content:space-between}.justify-end[_ngcontent-%COMP%]{justify-content:flex-end}.items-center[_ngcontent-%COMP%]{align-items:center}.items-start[_ngcontent-%COMP%]{align-items:flex-start}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mb-3[_ngcontent-%COMP%]{margin-bottom:.75rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.mt-1[_ngcontent-%COMP%]{margin-top:.25rem}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}.mt-4[_ngcontent-%COMP%]{margin-top:1rem}.mt-6[_ngcontent-%COMP%]{margin-top:1.5rem}.gap-4[_ngcontent-%COMP%]{gap:1rem}.flex-1[_ngcontent-%COMP%]{flex:1 1 0%}.text-2xl[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}.text-md[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.hover\\\\[_ngcontent-%COMP%]:text-gray-800:hover{color:#1f2937}"]})};function Ns(o,t){o&1&&(a(0,"tr")(1,"td",14),g(2,"i",15),c(3,"Carregando hist\xF3rico... "),s()())}function $s(o,t){o&1&&(a(0,"tr")(1,"td",14),c(2,"Nenhuma execu\xE7\xE3o registrada."),s()())}function Bs(o,t){if(o&1&&(a(0,"tr",16)(1,"td",17),c(2),s(),a(3,"td",17),c(4),s(),a(5,"td",17)(6,"span",18),c(7),s()(),a(8,"td",17),c(9),s()()),o&2){let e=t.$implicit,i=u(2);l(2),P(i.formatDate(e.timestamp)),l(2),P(i.getLeadName(e.leadId)),l(2),A("bg-green-100",e.status==="success")("text-green-800",e.status==="success")("bg-red-100",e.status==="error")("text-red-800",e.status==="error")("bg-yellow-100",e.status==="pending")("text-yellow-800",e.status==="pending"),l(),S(" ",i.getStatusText(e.status)," "),l(2),P(e.text||e.action||"A\xE7\xE3o executada")}}function js(o,t){if(o&1){let e=F();a(0,"div",19)(1,"button",20),x("click",function(){_(e);let n=u(2);return v(n.previousPage())}),g(2,"i",21),c(3,"Anterior "),s(),a(4,"span",22),c(5),s(),a(6,"button",20),x("click",function(){_(e);let n=u(2);return v(n.nextPage())}),c(7," Pr\xF3xima"),g(8,"i",23),s()()}if(o&2){let e=u(2);l(),m("disabled",e.currentPage===1),l(4),Ft(" P\xE1gina ",e.currentPage," de ",e.totalPages," (",e.historyItems.length," registros) "),l(),m("disabled",e.currentPage===e.totalPages)}}function zs(o,t){if(o&1){let e=F();a(0,"div",1),x("click",function(){_(e);let n=u();return v(n.closeModal())}),a(1,"div",2),x("click",function(n){return _(e),v(n.stopPropagation())}),a(2,"div",3)(3,"h2",4),c(4),s(),a(5,"button",5),x("click",function(){_(e);let n=u();return v(n.closeModal())}),c(6,"\xD7"),s()(),a(7,"div",6)(8,"table",7)(9,"thead",8)(10,"tr")(11,"th",9),c(12,"Data"),s(),a(13,"th",9),c(14,"Lead Afetado"),s(),a(15,"th",9),c(16,"Status"),s(),a(17,"th",9),c(18,"A\xE7\xE3o Executada"),s()()(),a(19,"tbody",10),b(20,Ns,4,0,"tr",11)(21,$s,3,0,"tr",11)(22,Bs,10,16,"tr",12),s()()(),b(23,js,9,5,"div",13),s()()}if(o&2){let e=u();l(4),S("Hist\xF3rico: ",e.automationName),l(16),m("ngIf",e.isLoading),l(),m("ngIf",!e.isLoading&&e.historyItems.length===0),l(),m("ngForOf",e.paginatedItems),l(),m("ngIf",e.totalPages>1)}}var Zt=class o{firestoreService=I(J);isVisible=!1;automationId="";automationName="";ownerId="";boardId="";leads=[];closeModalEvent=new C;historyItems=[];paginatedItems=[];isLoading=!1;currentPage=1;itemsPerPage=10;totalPages=0;subscription;ngOnInit(){this.isVisible&&this.automationId&&this.loadHistory()}ngOnDestroy(){this.unsubscribe()}ngOnChanges(){this.isVisible&&this.automationId?this.loadHistory():this.isVisible||this.unsubscribe()}unsubscribe(){this.subscription&&(this.subscription(),this.subscription=void 0)}loadHistory(){return D(this,null,function*(){this.isLoading=!0,this.unsubscribe();try{this.subscription=this.firestoreService.subscribeToAutomationHistory(this.ownerId,this.boardId,this.automationId,t=>{this.historyItems=t.sort((e,i)=>{let n=e.timestamp?.toMillis?e.timestamp.toMillis():0;return(i.timestamp?.toMillis?i.timestamp.toMillis():0)-n}),this.currentPage=1,this.updatePagination(),this.isLoading=!1})}catch(t){console.error("Erro ao carregar hist\xF3rico de automa\xE7\xE3o:",t),this.isLoading=!1}})}updatePagination(){this.totalPages=Math.ceil(this.historyItems.length/this.itemsPerPage);let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;this.paginatedItems=this.historyItems.slice(t,e)}previousPage(){this.currentPage>1&&(this.currentPage--,this.updatePagination())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updatePagination())}getLeadName(t){let e=this.leads.find(i=>i.id===t);return e?e.fields?.companyName||e.fields?.title||"Lead sem nome":"Lead removido"}formatDate(t){if(!t)return"N/A";let e;if(t.toDate)e=t.toDate();else if(t instanceof Date)e=t;else return"N/A";return e.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getStatusText(t){return{success:"Sucesso",error:"Erro",pending:"Pendente",scheduled:"Agendada"}[t]||"Desconhecido"}closeModal(){this.unsubscribe(),this.closeModalEvent.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-automation-history-modal"]],inputs:{isVisible:"isVisible",automationId:"automationId",automationName:"automationName",ownerId:"ownerId",boardId:"boardId",leads:"leads"},outputs:{closeModalEvent:"closeModalEvent"},features:[st],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content","modal-content-lg","p-6",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold"],[1,"text-gray-500","hover:text-gray-800","text-2xl",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white"],[1,"bg-gray-50"],[1,"text-left","py-3","px-4","uppercase","font-semibold","text-sm","text-gray-600"],[1,"text-gray-700","divide-y","divide-gray-200"],[4,"ngIf"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],["class","p-4 flex justify-between items-center",4,"ngIf"],["colspan","4",1,"text-center","p-6","text-gray-500"],[1,"fas","fa-spinner","fa-spin","mr-2"],[1,"hover:bg-gray-50"],[1,"py-3","px-4"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"p-4","flex","justify-between","items-center"],[1,"bg-gray-200","hover:bg-gray-300","disabled:bg-gray-100","disabled:text-gray-400","text-gray-700","font-medium","py-2","px-4","rounded-lg",3,"click","disabled"],[1,"fas","fa-chevron-left","mr-1"],[1,"text-sm","text-gray-600"],[1,"fas","fa-chevron-right","ml-1"]],template:function(e,i){e&1&&b(0,zs,24,5,"div",0),e&2&&m("ngIf",i.isVisible)},dependencies:[K,Z,Y],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 4px 6px #0000001a;max-height:90vh;overflow-y:auto}.modal-content-lg[_ngcontent-%COMP%]{width:95%;max-width:900px}.overflow-x-auto[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{min-width:100%;background-color:#fff}thead[_ngcontent-%COMP%]{background-color:#f9fafb}th[_ngcontent-%COMP%]{text-align:left;padding:.75rem 1rem;text-transform:uppercase;font-weight:600;font-size:.875rem;color:#4b5563}td[_ngcontent-%COMP%]{padding:.75rem 1rem}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{color:#374151}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e5e7eb}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.text-center[_ngcontent-%COMP%]{text-align:center}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-600[_ngcontent-%COMP%]{color:#4b5563}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}.text-2xl[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}.font-bold[_ngcontent-%COMP%]{font-weight:700}.font-medium[_ngcontent-%COMP%]{font-weight:500}.text-sm[_ngcontent-%COMP%]{font-size:.875rem}.text-xs[_ngcontent-%COMP%]{font-size:.75rem}.px-2[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}.py-1[_ngcontent-%COMP%]{padding-top:.25rem;padding-bottom:.25rem}.py-2[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem}.px-4[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.p-6[_ngcontent-%COMP%]{padding:1.5rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mr-1[_ngcontent-%COMP%]{margin-right:.25rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.ml-1[_ngcontent-%COMP%]{margin-left:.25rem}.rounded-full[_ngcontent-%COMP%]{border-radius:9999px}.rounded-lg[_ngcontent-%COMP%]{border-radius:.5rem}.bg-green-100[_ngcontent-%COMP%]{background-color:#dcfce7}.text-green-800[_ngcontent-%COMP%]{color:#166534}.bg-red-100[_ngcontent-%COMP%]{background-color:#fee2e2}.text-red-800[_ngcontent-%COMP%]{color:#991b1b}.bg-yellow-100[_ngcontent-%COMP%]{background-color:#fef3c7}.text-yellow-800[_ngcontent-%COMP%]{color:#92400e}.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}.bg-gray-100[_ngcontent-%COMP%]{background-color:#f3f4f6}button[_ngcontent-%COMP%]:hover.hover\\\\:bg-gray-300{background-color:#d1d5db}button[_ngcontent-%COMP%]:hover.hover\\\\:text-gray-800{color:#1f2937}button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}button[_ngcontent-%COMP%]:disabled.disabled\\\\:bg-gray-100{background-color:#f3f4f6}button[_ngcontent-%COMP%]:disabled.disabled\\\\:text-gray-400{color:#9ca3af}.flex[_ngcontent-%COMP%]{display:flex}.justify-between[_ngcontent-%COMP%]{justify-content:space-between}.items-center[_ngcontent-%COMP%]{align-items:center}.space-x-2[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}"]})};var Us=["flowScroller"],Gn=()=>[],Ks=(o,t,e)=>({"bg-red-500":o,"bg-yellow-500":t,"bg-blue-500":e}),Hs=()=>({});function qs(o,t){o&1&&(a(0,"div",20),g(1,"div",21),s())}function Gs(o,t){if(o&1&&(a(0,"span",39),c(1),s()),o&2){let e=u(3);l(),S(" ",e.getDynamicFilterCount()+(e.filterOnlyMine?1:0)," ")}}function Ws(o,t){if(o&1){let e=F();a(0,"div",33)(1,"input",34),ce("ngModelChange",function(n){_(e);let r=u(2);return de(r.filterQuery,n)||(r.filterQuery=n),v(n)}),x("ngModelChange",function(n){_(e);let r=u(2);return v(r.onFilterQueryChange(n))}),s(),g(2,"i",35),a(3,"button",36),x("click",function(){_(e);let n=u(2);return v(n.toggleAdvancedFilters())}),g(4,"i",37),b(5,Gs,2,1,"span",38),s()()}if(o&2){let e=u(2);l(),le("ngModel",e.filterQuery),l(2),A("text-blue-600",e.showAdvancedFilters)("bg-blue-50",e.showAdvancedFilters),l(2),m("ngIf",e.hasActiveFilters())}}function Qs(o,t){if(o&1){let e=F();a(0,"button",40),x("click",function(){let n=_(e).$implicit,r=u(2);return v(r.switchTab(n.id))}),g(1,"i"),c(2),s()}if(o&2){let e=t.$implicit,i=u(2);A("border-blue-500",i.activeTab===e.id)("text-blue-600",i.activeTab===e.id)("border-transparent",i.activeTab!==e.id)("text-gray-500",i.activeTab!==e.id)("hover:text-gray-700",i.activeTab!==e.id),l(),Oe(ji("fas ",e.icon," mr-2")),l(),S(" ",e.name," ")}}function Zs(o,t){if(o&1){let e=F();a(0,"button",41),x("click",function(){_(e);let n=u(2);return v(n.clearFilters())}),g(1,"i",42),c(2," Limpar "),s()}}function Ys(o,t){if(o&1){let e=F();a(0,"nav",22)(1,"div",23)(2,"div",24)(3,"div",25)(4,"button",26),x("click",function(){_(e);let n=u();return v(n.goToDashboard())}),g(5,"i",27),s(),b(6,Ws,6,6,"div",28),s()(),a(7,"div",29),b(8,Qs,3,14,"button",30),s(),a(9,"div",31),b(10,Zs,3,0,"button",32),s()()()}if(o&2){let e=u();l(6),m("ngIf",e.activeTab==="kanban"),l(2),m("ngForOf",e.tabs),l(2),m("ngIf",e.hasActiveFilters()&&e.activeTab==="kanban")}}function Js(o,t){if(o&1){let e=F();a(0,"input",67),x("input",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),s()}if(o&2){let e=u().$implicit,i=u(3);m("type",e.type==="number"?"number":"text")("value",i.dynamicFilters[e.name]||"")("placeholder","Filtrar por "+e.label.toLowerCase())}}function Xs(o,t){if(o&1){let e=F();a(0,"input",68),x("input",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),s()}if(o&2){let e=u().$implicit,i=u(3);m("value",i.dynamicFilters[e.name]||"")}}function el(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" ",e," ")}}function tl(o,t){if(o&1){let e=F();a(0,"select",69),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),a(1,"option",70),c(2,"Todos"),s(),b(3,el,2,2,"option",71),s()}if(o&2){let e=u().$implicit,i=u(3);m("value",i.dynamicFilters[e.name]||""),l(3),m("ngForOf",i.getFieldOptions(e))}}function il(o,t){if(o&1){let e=F();a(0,"select",69),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),a(1,"option",70),c(2,"Todas as temperaturas"),s(),a(3,"option",73),c(4,"\u{1F525} Quente"),s(),a(5,"option",74),c(6,"\u{1F321}\uFE0F Morno"),s(),a(7,"option",75),c(8,"\u2744\uFE0F Frio"),s()()}if(o&2){let e=u().$implicit,i=u(3);m("value",i.dynamicFilters[e.name]||"")}}function nl(o,t){if(o&1){let e=F();a(0,"div",76)(1,"input",77),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.checked))}),s(),a(2,"span",78),c(3,"Apenas marcados"),s()()}if(o&2){let e=u().$implicit,i=u(3);l(),m("checked",i.dynamicFilters[e.name]===!0)}}function ol(o,t){if(o&1&&(a(0,"div",61)(1,"label",62),c(2),s(),b(3,Js,1,3,"input",63)(4,Xs,1,1,"input",64)(5,tl,4,2,"select",65)(6,il,9,1,"select",65)(7,nl,4,1,"div",66),s()),o&2){let e=t.$implicit;l(2),S(" ",e.label," "),l(),m("ngIf",e.type==="text"||e.type==="email"||e.type==="tel"||e.type==="number"||e.type==="cnpj"||e.type==="cpf"),l(),m("ngIf",e.type==="date"),l(),m("ngIf",e.type==="select"||e.type==="radio"),l(),m("ngIf",e.type==="temperatura"),l(),m("ngIf",e.type==="checkbox")}}function rl(o,t){if(o&1&&(a(0,"div",58)(1,"h4",59),c(2,"Filtros Din\xE2micos"),s(),b(3,ol,8,6,"div",60),s()),o&2){let e=u(2);l(3),m("ngForOf",e.availableFilterFields)}}function al(o,t){o&1&&(a(0,"div",79),g(1,"i",80),a(2,"p",81),c(3," Nenhum campo configurado para filtros."),g(4,"br"),c(5,' Configure campos com "Mostrar em filtros" ativado no formul\xE1rio. '),s()())}function sl(o,t){if(o&1){let e=F();a(0,"div",43)(1,"div",44)(2,"div",45)(3,"h3",46),c(4,"Filtros Avan\xE7ados"),s(),a(5,"button",47),x("click",function(){_(e);let n=u();return v(n.toggleAdvancedFilters())}),g(6,"i",48),s()(),a(7,"div",49)(8,"label",50)(9,"input",51),ce("ngModelChange",function(n){_(e);let r=u();return de(r.filterOnlyMine,n)||(r.filterOnlyMine=n),v(n)}),x("ngModelChange",function(){_(e);let n=u();return v(n.toggleOnlyMine())}),s(),a(10,"span",52),c(11,"Mostrar apenas meus registros"),s()()(),b(12,rl,4,1,"div",53)(13,al,6,0,"div",54),a(14,"div",55)(15,"button",56),x("click",function(){_(e);let n=u();return v(n.clearFilters())}),c(16," Limpar "),s(),a(17,"button",57),x("click",function(){_(e);let n=u();return v(n.toggleAdvancedFilters())}),c(18," Aplicar "),s()()()()}if(o&2){let e=u();l(9),le("ngModel",e.filterOnlyMine),l(3),m("ngIf",e.availableFilterFields.length>0),l(),m("ngIf",e.availableFilterFields.length===0)}}function ll(o,t){if(o&1&&(a(0,"span",94),g(1,"i",95),c(2),s()),o&2){let e=u().$implicit,i=u(2);l(2),S("",i.getAutomationCount(e.id)," ")}}function dl(o,t){if(o&1&&(a(0,"div",109),c(1),s()),o&2){let e=u().$implicit,i=u(3);l(),S(" CNPJ: ",i.getCnpj(e)," ")}}function cl(o,t){if(o&1&&(a(0,"div")(1,"div",111),c(2),s(),a(3,"div",112),c(4),s()()),o&2){let e=u().$implicit;l(2),P(e.label),l(2),P(e.value)}}function ml(o,t){if(o&1&&(a(0,"div",110),b(1,cl,5,2,"div",11),s()),o&2){let e=t.$implicit;l(),m("ngIf",e.type!=="temperatura")}}function ul(o,t){if(o&1&&(a(0,"div",113)(1,"div",114),g(2,"i",115),a(3,"span"),c(4),s()()()),o&2){let e=u().$implicit,i=u(3);l(),Oe(i.getSlaStatus(e).colorClass),l(3),P(i.getSlaStatus(e).text)}}function pl(o,t){if(o&1&&(a(0,"div",113)(1,"div",114),g(2,"span",116),a(3,"span"),c(4),s()()()),o&2){let e=t.ngIf;l(2),m("ngClass",Ui(2,Ks,e.value==="Quente",e.value==="Morno",e.value==="Frio")),l(2),P(e.value)}}function fl(o,t){if(o&1&&(a(0,"div",87),g(1,"i",117),a(2,"span"),c(3),s()()),o&2){let e=t.ngIf;l(3),P(e||0)}}function gl(o,t){if(o&1&&(a(0,"div",87),g(1,"i",118),a(2,"span"),c(3),s()()),o&2){let e=t.ngIf;l(3),P(e||0)}}function hl(o,t){if(o&1&&(a(0,"div",119)(1,"p",120),c(2),s()()),o&2){let e=u().$implicit;l(2),S(" ",e.fields.description," ")}}function _l(o,t){if(o&1){let e=F();a(0,"div",96),x("cdkDragStarted",function(){_(e);let n=u(3);return v(n.onLeadDragStarted())})("cdkDragEnded",function(){_(e);let n=u(3);return v(n.onLeadDragEnded())})("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.onCardClick(r,n))}),a(1,"div",97)(2,"div",98)(3,"h4",99),c(4),s(),b(5,dl,2,1,"div",100),s()(),a(6,"div",101),b(7,ml,2,1,"div",102),s(),b(8,ul,5,3,"div",103)(9,pl,5,6,"div",103),a(10,"div",86)(11,"div",104),b(12,fl,4,1,"div",105)(13,gl,4,1,"div",105),s(),a(14,"div",106),g(15,"i",107),a(16,"span"),c(17),s()()(),b(18,hl,3,1,"div",108),s()}if(o&2){let e=t.$implicit,i=u(3);Oe(i.getSlaStatus(e).borderClass||i.getLeadPriorityClass(e)),m("cdkDragDisabled",!i.cardMoveEnabled)("cdkDragData",e.id),l(4),S(" ",i.getCompanyName(e)," "),l(),m("ngIf",i.getCnpj(e)),l(2),m("ngForOf",i.getCardFieldsForLead(e)),l(),m("ngIf",i.getSlaStatus(e).text),l(),m("ngIf",i.getTemperatureGlobalItem(e)),l(3),m("ngIf",e.historyCommentsCount),l(),m("ngIf",e.attachmentsCount),l(4),P(i.formatDateTime(e.createdAt)),l(),m("ngIf",e.fields==null?null:e.fields.description)}}function vl(o,t){o&1&&(a(0,"div",121),g(1,"i",122),a(2,"p",123),c(3,"Nenhum registro nesta fase"),s()())}function bl(o,t){if(o&1){let e=F();a(0,"div",84)(1,"div",85)(2,"div",86)(3,"div",87)(4,"h3",88),c(5),s(),a(6,"span",89),c(7),s(),b(8,ll,3,1,"span",90),s()()(),a(9,"div",91),x("cdkDropListDropped",function(n){_(e);let r=u(2);return v(r.onLeadDrop(n))}),b(10,_l,19,13,"div",92)(11,vl,4,0,"div",93),s()()}if(o&2){let e=t.$implicit,i=u(2);W("background-color","#e2e8f0"),l(),W("border-top-color",i.getColumnBorderColor(e)),l(4),P(e.name),l(2),S(" ",i.getLeadsForColumn(e.id).length," "),l(),m("ngIf",i.getAutomationCount(e.id)>0),l(),m("id","column-"+e.id)("cdkDropListData",i.displayedLeadsByColumn[e.id]||N(13,Gn))("cdkDropListConnectedTo",i.getColumnConnectedTo()),l(),m("ngForOf",i.displayedLeadsByColumn[e.id]||N(14,Gn))("ngForTrackBy",i.trackByLeadId),l(),m("ngIf",i.getLeadsForColumn(e.id).length===0)}}function xl(o,t){if(o&1&&(a(0,"div",82),b(1,bl,12,15,"div",83),s()),o&2){let e=u();l(),m("ngForOf",e.columns)}}function yl(o,t){if(o&1){let e=F();a(0,"button",124),x("click",function(){_(e);let n=u();return v(n.showCreateLeadModal())}),g(1,"i",125),c(2," Novo registro "),s()}}function Cl(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",127)(2,"h2",128),c(3,"Formul\xE1rio inicial do quadro"),s(),a(4,"app-visual-form-builder",129),x("fieldsChanged",function(n){_(e);let r=u();return v(r.onInitialFieldsChanged(n))}),s(),a(5,"div",130)(6,"button",131),x("click",function(){_(e);let n=u();return v(n.saveInitialForm())}),c(7," Salvar "),s()()()()}if(o&2){let e=u();l(4),m("fields",e.initialFormFields),l(2),W("background-color",e.getPrimaryColor())}}function wl(o,t){o&1&&(a(0,"div",132)(1,"div",133),g(2,"i",134),a(3,"h3",135),c(4,"Nenhuma coluna encontrada"),s(),a(5,"p",136),c(6," Este quadro ainda n\xE3o possui colunas configuradas. "),s()()())}function El(o,t){if(o&1&&(a(0,"span"),g(1,"i",155),c(2),s()),o&2){let e=u().$implicit,i=u(3);l(2),S(" Atualizado em ",i.formatDate(e.updatedAt)," ")}}function Sl(o,t){if(o&1){let e=F();a(0,"div",145)(1,"div",146)(2,"div",147)(3,"h3",148),c(4),s(),a(5,"p",149)(6,"strong"),c(7,"Assunto:"),s(),c(8),s(),a(9,"p",150)(10,"strong"),c(11,"Para:"),s(),c(12),s(),a(13,"div",151)(14,"span"),g(15,"i",152),c(16),s(),b(17,El,3,1,"span",11),s()(),a(18,"div",153)(19,"button",154),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.editTemplate(n))}),g(20,"i",155),c(21," Editar "),s(),a(22,"button",156),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.deleteTemplate(n))}),g(23,"i",157),c(24," Excluir "),s()()()()}if(o&2){let e=t.$implicit,i=u(3);l(4),S(" ",e.name||"Template sem nome"," "),l(4),S(" ",e.subject||"Sem assunto"," "),l(4),S(" ",e.recipients||"N\xE3o especificado"," "),l(4),S(" Criado em ",i.formatDate(e.createdAt)," "),l(),m("ngIf",e.updatedAt)}}function Il(o,t){if(o&1&&(a(0,"div",143),b(1,Sl,25,5,"div",144),s()),o&2){let e=u(2);l(),m("ngForOf",e.emailTemplates)}}function Fl(o,t){o&1&&(a(0,"div",158)(1,"div",159),g(2,"i",160),a(3,"h3",161),c(4,"Nenhum template encontrado"),s(),a(5,"p"),c(6,"Crie templates personalizados para automa\xE7\xF5es de email"),s()()())}function Dl(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",127)(2,"div",137)(3,"h2",138),c(4,"Templates de Email"),s(),a(5,"button",139),x("click",function(){_(e);let n=u();return v(n.createTemplate())}),g(6,"i",140),c(7," Novo Template "),s()(),b(8,Il,2,1,"div",141)(9,Fl,7,0,"div",142),s()()}if(o&2){let e=u();l(8),m("ngIf",e.emailTemplates.length>0),l(),m("ngIf",e.emailTemplates.length===0)}}function Pl(o,t){if(o&1&&(a(0,"span"),g(1,"i",174),c(2),s()),o&2){let e=u().$implicit,i=u(3);l(2),S(" \xDAltima execu\xE7\xE3o: ",i.formatDate(e.lastExecuted)," ")}}function Ml(o,t){if(o&1){let e=F();a(0,"div",145)(1,"div",146)(2,"div",147)(3,"div",163)(4,"h3",164),c(5),s(),a(6,"span",165),c(7),s()(),a(8,"div",166)(9,"p",167),g(10,"i",168),a(11,"strong"),c(12,"Gatilho:"),s(),c(13),s(),a(14,"p",167),g(15,"i",169),a(16,"strong"),c(17,"A\xE7\xF5es:"),s(),c(18),s()(),a(19,"div",151)(20,"span"),g(21,"i",152),c(22),s(),b(23,Pl,3,1,"span",11),s()(),a(24,"div",153)(25,"button",170),x("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.showAutomationHistory(r,n))}),g(26,"i",171),c(27," Hist\xF3rico "),s(),a(28,"button",154),x("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.editAutomation(r,n))}),g(29,"i",155),c(30," Editar "),s(),a(31,"button",172),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.toggleAutomation(n))}),g(32,"i",173),c(33),s(),a(34,"button",156),x("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.openDeleteAutomationConfirm(r,n))}),g(35,"i",157),c(36," Excluir "),s()()()()}if(o&2){let e=t.$implicit,i=u(3);l(5),S(" ",e.name," "),l(),A("bg-green-100",e.active)("text-green-800",e.active)("bg-red-100",!e.active)("text-red-800",!e.active),l(),S(" ",e.active?"Ativa":"Inativa"," "),l(6),S(" ",i.getTriggerDescription(e.trigger)," "),l(5),S(" ",i.getActionsCount(e.actions)," a\xE7\xE3o(\xF5es) configurada(s) "),l(4),S(" Criada em ",i.formatDate(e.createdAt)," "),l(),m("ngIf",e.lastExecuted),l(8),A("text-red-600",e.active)("hover:text-red-800",e.active)("text-green-600",!e.active)("hover:text-green-800",!e.active),l(),A("fa-pause",e.active)("fa-play",!e.active),l(),S(" ",e.active?"Pausar":"Ativar"," ")}}function Tl(o,t){if(o&1&&(a(0,"div",143),b(1,Ml,37,27,"div",144),s()),o&2){let e=u(2);l(),m("ngForOf",e.getValidAutomations())}}function kl(o,t){o&1&&(a(0,"div",158)(1,"div",159),g(2,"i",175),a(3,"h3",161),c(4,"Nenhuma automa\xE7\xE3o encontrada"),s(),a(5,"p"),c(6,"Configure automa\xE7\xF5es para disparar a\xE7\xF5es quando leads mudarem de fase"),s()()())}function Ol(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",127)(2,"div",137)(3,"h2",138),c(4,"Automa\xE7\xF5es"),s(),a(5,"button",162),x("click",function(n){_(e);let r=u();return v(r.createAutomation(n))}),g(6,"i",140),c(7," Nova Automa\xE7\xE3o "),s()(),b(8,Tl,2,1,"div",141)(9,kl,7,0,"div",142),s()()}if(o&2){let e=u();l(8),m("ngIf",e.getValidAutomations().length>0),l(),m("ngIf",e.getValidAutomations().length===0)}}function Al(o,t){if(o&1){let e=F();a(0,"button",202),x("click",function(n){_(e);let r=u().index,d=u(2);return v(d.movePhaseUp(r,n))}),g(1,"i",203),s()}}function Ll(o,t){if(o&1){let e=F();a(0,"button",204),x("click",function(n){_(e);let r=u().index,d=u(2);return v(d.movePhaseDown(r,n))}),g(1,"i",205),s()}}function Rl(o,t){if(o&1){let e=F();a(0,"div",210)(1,"span",211),c(2),s(),a(3,"button",212),x("click",function(n){let r=_(e).$implicit;return u(4).removeEdge(r),v(n.stopPropagation())}),g(4,"i",213),s()()}if(o&2){let e,i=t.$implicit,n=u(4);l(2),Bi("",n.getEdgeArrow(i)," ",((e=n.getColumnById(i.toId))==null?null:e.name)||i.toId)}}function Vl(o,t){if(o&1&&(a(0,"div",206)(1,"div",207),c(2,"Conex\xF5es:"),s(),a(3,"div",208),b(4,Rl,5,2,"div",209),s()()),o&2){let e=u().$implicit,i=u(2);l(4),m("ngForOf",i.getOutgoingConnections(e))}}function Nl(o,t){o&1&&(a(0,"div",214),c(1,"Sem conex\xF5es para esta fase"),s())}function $l(o,t){if(o&1){let e=F();a(0,"button",215),x("click",function(n){_(e);let r=u().$implicit;return u(2).beginEdge(r),v(n.stopPropagation())}),g(1,"i",216),s()}}function Bl(o,t){if(o&1){let e=F();a(0,"button",217),x("click",function(n){_(e);let r=u().$implicit;return u(2).completeEdge(r),v(n.stopPropagation())}),g(1,"i",218),s()}}function jl(o,t){if(o&1){let e=F();Ie(0),a(1,"div",187),x("cdkDragStarted",function(){let n=_(e).$implicit,r=u(2);return v(r.onDragStarted(n))})("cdkDragEnded",function(){let n=_(e).$implicit,r=u(2);return v(r.onDragEnded(n))})("click",function(n){let r=_(e).$implicit,d=u(2);return v(d.onPhaseCardClick(r,n))}),a(2,"div",188)(3,"div",189),c(4),s(),a(5,"div",177),b(6,Al,2,0,"button",190)(7,Ll,2,0,"button",191),g(8,"i",192),s()(),a(9,"div",193),b(10,Vl,5,1,"div",194)(11,Nl,2,0,"ng-template",null,2,He),a(13,"div",195)(14,"button",196),x("click",function(n){let r=_(e).$implicit,d=u(2);return d.showColumnForm(d.getColumnById(r)),v(n.stopPropagation())}),g(15,"i",197),s(),a(16,"button",198),x("click",function(n){let r=_(e).$implicit;return u(2).openPhaseAutomations(r),v(n.stopPropagation())}),g(17,"i",199),s(),b(18,$l,2,0,"button",200)(19,Bl,2,0,"button",201),s()()(),Fe()}if(o&2){let e,i,n=t.$implicit,r=t.index,d=Re(12),p=u(2);l(),W("--phase-color",((e=p.getColumnById(n))==null?null:e.color)||"#94a3b8"),ye("id","phase-"+n),l(3),P((i=p.getColumnById(n))==null?null:i.name),l(2),m("ngIf",r>0),l(),m("ngIf",r<p.flowOrder.length-1),l(3),m("ngIf",p.hasOutgoingConnections(n))("ngIfElse",d),l(8),m("ngIf",!p.pendingFromId),l(),m("ngIf",p.pendingFromId&&p.pendingFromId!==n)}}function zl(o,t){if(o&1){let e=F();a(0,"div",227)(1,"div",23)(2,"div")(3,"div",228),c(4),s(),a(5,"div",109),c(6),s()(),a(7,"div",177)(8,"label",229)(9,"input",230),x("change",function(){let n=_(e).$implicit,r=u(3);return v(r.toggleAutomation(n))}),s(),c(10," Ativa "),s(),a(11,"button",231),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.editAutomation(n))}),c(12,"Editar"),s(),a(13,"button",232),x("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.openDeleteAutomationConfirm(r,n))}),c(14,"Excluir"),s()()()()}if(o&2){let e=t.$implicit,i=u(3);l(4),P(e.name||"Automa\xE7\xE3o sem nome"),l(2),S("Trigger: ",i.getTriggerDescription(e)),l(3),m("checked",e.active)}}function Ul(o,t){if(o&1){let e=F();a(0,"div",219)(1,"div",220)(2,"div",221),c(3),s(),a(4,"button",222),x("click",function(){_(e);let n=u(2);return v(n.closePhaseAutomations())}),g(5,"i",48),s()(),a(6,"div",61),b(7,zl,15,3,"div",223),a(8,"div",224)(9,"button",225),x("click",function(){_(e);let n=u(2);return v(n.createAutomationForPhase(n.selectedPhaseIdForAutomations))}),g(10,"i",226),c(11," Nova automa\xE7\xE3o nesta fase "),s()()()()}if(o&2){let e,i=u(2);l(3),S("Automa\xE7\xF5es da fase: ",(e=i.getColumnById(i.selectedPhaseIdForAutomations))==null?null:e.name),l(4),m("ngForOf",i.getAutomationsForPhase(i.selectedPhaseIdForAutomations))}}function Kl(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",176)(2,"div",137)(3,"h2",138),c(4,"Fluxo de Transi\xE7\xF5es"),s(),a(5,"div",177)(6,"button",178),x("click",function(){_(e);let n=u();return v(n.showCreateColumnModal())}),g(7,"i",140),c(8," Nova Fase "),s(),a(9,"button",139),x("click",function(){_(e);let n=u();return v(n.saveFlowConfig())}),g(10,"i",179),c(11," Salvar Fluxo "),s()()(),a(12,"div",180)(13,"div",181,0)(15,"div",182),x("cdkDropListDropped",function(n){_(e);let r=u();return v(r.onFlowReorder(n))})("cdkDropListEntered",function(){_(e);let n=u();return v(n.onDragEntered())})("cdkDropListExited",function(){_(e);let n=u();return v(n.onDragExited())}),b(16,jl,20,10,"ng-container",183),s()(),a(17,"div",184,1),x("mousedown",function(n){_(e);let r=u();return v(r.onFlowBarPointerDown(n))})("touchstart",function(n){_(e);let r=u();return v(r.onFlowBarTouchStart(n))}),g(19,"div",185),s()(),b(20,Ul,12,2,"div",186),s()()}if(o&2){let e=u();l(15),m("cdkDropListData",e.flowOrder),l(),m("ngForOf",e.flowOrder),l(3),W("width",e.flowThumbPercent,"%")("left",e.flowThumbLeftPercent,"%"),l(),m("ngIf",e.selectedPhaseIdForAutomations)}}function Hl(o,t){if(o&1){let e=F();a(0,"div",233),x("click",function(){_(e);let n=u();return v(n.cancelDeleteAutomation())}),a(1,"div",234),x("click",function(n){return _(e),v(n.stopPropagation())}),a(2,"h3",235),c(3,"Excluir automa\xE7\xE3o"),s(),a(4,"p",236),c(5,"Tem certeza que deseja excluir a automa\xE7\xE3o "),a(6,"strong"),c(7),s(),c(8,"? Esta a\xE7\xE3o n\xE3o pode ser desfeita."),s(),a(9,"div",237)(10,"button",238),x("click",function(){_(e);let n=u();return v(n.cancelDeleteAutomation())}),c(11,"Cancelar"),s(),a(12,"button",239),x("click",function(){_(e);let n=u();return v(n.confirmDeleteAutomation())}),c(13,"Excluir"),s()()()()}if(o&2){let e=u();l(7),P((e.automationPendingDelete==null?null:e.automationPendingDelete.name)||"sem nome")}}function ql(o,t){if(o&1&&(a(0,"div"),g(1,"app-reports",240),s()),o&2){let e=u();l(),m("boardId",e.boardId)("ownerId",e.ownerId)}}function Gl(o,t){if(o&1){let e=F();a(0,"button",40),x("click",function(){let n=_(e).$implicit,r=u(2);return v(r.activeEmailStatus=n.id)}),c(1),a(2,"span",89),c(3),s()()}if(o&2){let e=t.$implicit,i=u(2);A("border-blue-500",i.activeEmailStatus===e.id)("text-blue-600",i.activeEmailStatus===e.id)("border-transparent",i.activeEmailStatus!==e.id)("text-gray-500",i.activeEmailStatus!==e.id),l(),S(" ",e.name," "),l(2),S(" ",e.count," ")}}function Wl(o,t){o&1&&(a(0,"div",159),g(1,"i",250),a(2,"h3",161),c(3,"Nenhum email encontrado"),s(),a(4,"p"),c(5,"Emails enviados aparecer\xE3o aqui"),s()())}function Ql(o,t){if(o&1){let e=F();a(0,"button",264),x("click",function(){_(e);let n=u().$implicit,r=u(3);return v(r.retryEmail(n))}),g(1,"i",265),s()}}function Zl(o,t){if(o&1){let e=F();a(0,"div",252)(1,"div",86)(2,"div",147)(3,"div",25),g(4,"div",253),a(5,"h4",254),c(6),s(),a(7,"span",255),c(8),s()(),a(9,"div",256)(10,"span"),g(11,"i",257),c(12),s(),a(13,"span"),g(14,"i",258),c(15),s()()(),a(16,"div",76)(17,"button",259),x("click",function(){let n=_(e).$implicit,r=u(3);return v(r.viewEmail(n))}),g(18,"i",260),s(),b(19,Ql,2,0,"button",261),a(20,"button",262),x("click",function(n){let r=_(e).$implicit,d=u(3);return v(d.openOutboxDeleteConfirm(r,n))}),g(21,"i",263),s()()()()}if(o&2){let e=t.$implicit,i=u(3);l(4),A("bg-yellow-400",!e.delivery||e.delivery.state==="PENDING")("bg-green-400",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("bg-red-400",(e.delivery==null?null:e.delivery.state)==="ERROR"),l(2),P(e.subject||"Sem assunto"),l(),A("bg-yellow-100",!e.delivery||e.delivery.state==="PENDING")("text-yellow-800",!e.delivery||e.delivery.state==="PENDING")("bg-green-100",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("text-green-800",(e.delivery==null?null:e.delivery.state)==="SUCCESS")("bg-red-100",(e.delivery==null?null:e.delivery.state)==="ERROR")("text-red-800",(e.delivery==null?null:e.delivery.state)==="ERROR"),l(),S(" ",i.getEmailStatusLabel(e)," "),l(4),S("Para: ",e.to),l(3),P(i.formatDateTime(i.getEmailDisplayDate(e))),l(4),m("ngIf",(e.delivery==null?null:e.delivery.state)==="ERROR"||!e.delivery)}}function Yl(o,t){if(o&1&&(a(0,"div",58),b(1,Zl,22,23,"div",251),s()),o&2){let e=u(2);l(),m("ngForOf",e.getFilteredEmails())}}function Jl(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",241)(2,"div",137)(3,"h2",138),c(4,"Caixa de Sa\xEDda"),s(),a(5,"div",242)(6,"button",243),x("click",function(){_(e);let n=u();return v(n.clearOutbox())}),g(7,"i",244),c(8," Limpar "),s()()(),a(9,"div",245)(10,"div",246)(11,"nav",247),b(12,Gl,4,10,"button",248),s()(),a(13,"div",44),b(14,Wl,6,0,"div",249)(15,Yl,2,1,"div",53),s()()()()}if(o&2){let e=u();l(12),m("ngForOf",e.emailStatuses),l(2),m("ngIf",e.getFilteredEmails().length===0),l(),m("ngIf",e.getFilteredEmails().length>0)}}function Xl(o,t){if(o&1){let e=F();a(0,"div",233),x("click",function(){_(e);let n=u();return v(n.cancelOutboxDelete())}),a(1,"div",234),x("click",function(n){return _(e),v(n.stopPropagation())}),a(2,"h3",235),c(3,"Excluir mensagem"),s(),a(4,"p",236),c(5,"Tem certeza que deseja excluir esta mensagem da Caixa de Sa\xEDda? Esta a\xE7\xE3o n\xE3o pode ser desfeita."),s(),a(6,"div",237)(7,"button",238),x("click",function(){_(e);let n=u();return v(n.cancelOutboxDelete())}),c(8,"Cancelar"),s(),a(9,"button",239),x("click",function(){_(e);let n=u();return v(n.confirmOutboxDelete())}),c(10,"Excluir"),s()()()()}}function ed(o,t){if(o&1){let e=F();a(0,"div",126)(1,"div",127)(2,"div",137)(3,"h2",138),c(4,"Configura\xE7\xE3o da API"),s(),a(5,"div",76)(6,"span",167),c(7,"Status:"),s(),a(8,"span",266),g(9,"i",267),c(10,"Ativa "),s()()(),a(11,"div",268)(12,"div",269)(13,"h3",148),g(14,"i",270),c(15,"Endpoint para Novos Leads "),s(),a(16,"p",271),c(17," Use este endpoint para enviar novos leads diretamente para o seu kanban via API REST. "),s(),a(18,"div",272)(19,"div",273)(20,"span",274),c(21,"URL do Endpoint:"),s(),a(22,"button",275),x("click",function(){_(e);let n=u();return v(n.copyToClipboard(n.apiEndpoint))}),g(23,"i",276),c(24,"Copiar "),s()(),a(25,"code",277),c(26),s()()(),a(27,"div",269)(28,"h4",278),g(29,"i",279),c(30,"Token de Autentica\xE7\xE3o "),s(),a(31,"p",149),c(32," Inclua este token no header "),a(33,"code",280),c(34,"Authorization"),s(),c(35," de suas requisi\xE7\xF5es. "),s(),a(36,"div",272)(37,"div",273)(38,"span",274),c(39,"Bearer Token:"),s(),a(40,"button",275),x("click",function(){_(e);let n=u();return v(n.copyToClipboard(n.apiToken))}),g(41,"i",276),c(42,"Copiar "),s()(),a(43,"code",281),c(44),s()()(),a(45,"div",44)(46,"h4",278),g(47,"i",282),c(48,"Exemplo de Requisi\xE7\xE3o "),s(),a(49,"p",149),c(50," Exemplo de como enviar um novo lead via POST request: "),s(),a(51,"div",283)(52,"pre",123)(53,"code"),c(54),s()()()()(),a(55,"div",268)(56,"div",269)(57,"h3",148),g(58,"i",284),c(59,"Webhooks (Em breve) "),s(),a(60,"p",167),c(61," Receba notifica\xE7\xF5es quando leads mudarem de fase, forem criados ou atualizados. "),s()(),a(62,"div",44)(63,"div",285),g(64,"i",286),a(65,"h4",287),c(66,"Funcionalidade em Desenvolvimento"),s(),a(67,"p",123),c(68,"Webhooks estar\xE3o dispon\xEDveis em breve para integra\xE7\xE3o avan\xE7ada."),s()()()(),a(69,"div",288)(70,"h3",289),g(71,"i",290),c(72,"Documenta\xE7\xE3o da API "),s(),a(73,"div",291)(74,"div",292),g(75,"i",293),a(76,"div")(77,"strong"),c(78,"M\xE9todo:"),s(),c(79," POST para criar novos leads "),s()(),a(80,"div",292),g(81,"i",293),a(82,"div")(83,"strong"),c(84,"Content-Type:"),s(),c(85," application/json obrigat\xF3rio "),s()(),a(86,"div",292),g(87,"i",293),a(88,"div")(89,"strong"),c(90,"Autentica\xE7\xE3o:"),s(),c(91," Bearer token no header Authorization "),s()(),a(92,"div",292),g(93,"i",293),a(94,"div")(95,"strong"),c(96,"Campos obrigat\xF3rios:"),s(),c(97," companyName, contactName, contactEmail "),s()(),a(98,"div",292),g(99,"i",293),a(100,"div")(101,"strong"),c(102,"Resposta de sucesso:"),s(),c(103," Status 201 com dados do lead criado "),s()()()()()()}if(o&2){let e=u();l(26),S(" ",e.apiEndpoint," "),l(18),S(" ",e.apiToken," "),l(10),Ft("POST ",e.apiEndpoint,`
Content-Type: application/json
Authorization: Bearer `,e.apiToken,`

`,e.apiExampleJson)}}function td(o,t){if(o&1&&(a(0,"span",314),c(1),s()),o&2){let e=u(2);l(),S(" ",(e.filterOnlyMine?1:0)+e.getActiveDynamicFiltersCount()," ")}}function id(o,t){if(o&1){let e=F();a(0,"button",315),x("click",function(){_(e);let n=u(2);return n.filterQuery="",v(n.applyFilters())}),g(1,"i",316),s()}}function nd(o,t){if(o&1){let e=F();a(0,"button",317),x("click",function(){_(e);let n=u(2);return v(n.clearFilters())}),g(1,"i",48),c(2," Limpar "),s()}}function od(o,t){if(o&1){let e=F();a(0,"input",333),x("input",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),s()}if(o&2){let e=u().$implicit,i=u(3);m("placeholder","Filtrar por "+e.label.toLowerCase())("value",i.getDynamicFilterValue(e.name))}}function rd(o,t){if(o&1){let e=F();a(0,"input",334),x("input",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),s()}if(o&2){let e=u().$implicit,i=u(3);m("placeholder","Filtrar por "+e.label.toLowerCase())("value",i.getDynamicFilterValue(e.name))}}function ad(o,t){if(o&1){let e=F();a(0,"input",335),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.value))}),s()}if(o&2){let e=u().$implicit,i=u(3);m("value",i.getDynamicFilterValue(e.name))}}function sd(o,t){if(o&1){let e=F();a(0,"label",336)(1,"input",337),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.setDynamicFilter(r.name,n.target.checked))}),s(),a(2,"span",167),c(3,"Apenas marcados"),s()()}if(o&2){let e=u().$implicit,i=u(3);l(),m("checked",i.getDynamicFilterValue(e.name))}}function ld(o,t){if(o&1&&(a(0,"option",72),c(1),s()),o&2){let e=t.$implicit;m("value",e),l(),S(" ",e," ")}}function dd(o,t){if(o&1){let e=F();a(0,"select",338),x("change",function(n){_(e);let r=u().$implicit,d=u(3);return v(d.onDynamicFilterChange(r.name,n))}),a(1,"option",70),c(2,"Todos"),s(),b(3,ld,2,2,"option",71),s()}if(o&2){let e=u().$implicit,i=u(3);m("value",i.getDynamicFilterValue(e.name)),l(3),m("ngForOf",i.getFieldOptions(e))}}function cd(o,t){if(o&1){let e=F();a(0,"button",339),x("click",function(){_(e);let n=u().$implicit,r=u(3);return v(r.removeDynamicFilter(n.name))}),g(1,"i",316),s()}}function md(o,t){if(o&1&&(a(0,"div",325)(1,"label",326),c(2),s(),b(3,od,1,2,"input",327)(4,rd,1,2,"input",328)(5,ad,1,1,"input",329)(6,sd,4,1,"label",330)(7,dd,4,2,"select",331)(8,cd,2,0,"button",332),s()),o&2){let e=t.$implicit,i=u(3);l(2),S(" ",e.label," "),l(),m("ngIf",e.type==="text"||e.type==="email"||e.type==="tel"),l(),m("ngIf",e.type==="number"),l(),m("ngIf",e.type==="date"),l(),m("ngIf",e.type==="checkbox"),l(),m("ngIf",e.type==="select"||e.type==="radio"||e.type==="temperatura"),l(),m("ngIf",i.getDynamicFilterValue(e.name))}}function ud(o,t){if(o&1&&(a(0,"div",340),g(1,"i",341),a(2,"span"),c(3),s()()),o&2){let e=u(3);l(3),S("",e.getActiveDynamicFiltersCount()," filtro(s) ativo(s) por campos")}}function pd(o,t){if(o&1){let e=F();a(0,"div",318)(1,"div",86)(2,"h4",319),g(3,"i",320),c(4," Filtros por Campos "),s(),a(5,"button",321),x("click",function(){_(e);let n=u(2);return v(n.showAdvancedFilters=!1)}),g(6,"i",48),s()(),a(7,"div",322),b(8,md,9,7,"div",323),s(),b(9,ud,4,1,"div",324),s()}if(o&2){let e=u(2);l(8),m("ngForOf",e.availableFilterFields),l(),m("ngIf",e.getActiveDynamicFiltersCount()>0)}}function fd(o,t){if(o&1&&(a(0,"div",342),g(1,"i",343),a(2,"span"),c(3,"Filtros ativos"),s(),a(4,"span",344),c(5),s()()),o&2){let e=u(2);l(5),S(" ",(e.filterQuery?1:0)+(e.filterOnlyMine?1:0)+e.getActiveDynamicFiltersCount()," ")}}function gd(o,t){if(o&1&&(a(0,"div",365),c(1),s()),o&2){let e=u().$implicit,i=u(4);l(),S(" ",i.getLeadResponsibleName(e)," ")}}function hd(o,t){if(o&1&&(a(0,"div",78)(1,"span",366),c(2,"NOME DO CONTATO"),s(),g(3,"br"),c(4),s()),o&2){let e=u().$implicit;l(4),S(" ",e.fields.contactName," ")}}function _d(o,t){if(o&1&&(a(0,"div",360),g(1,"i",367),c(2),s()),o&2){let e=u().$implicit,i=u(4);l(2),S(" ",i.getLeadDueDateLabel(e))}}function vd(o,t){if(o&1&&(a(0,"div",355)(1,"div",356),c(2),s(),b(3,gd,2,1,"div",357)(4,hd,5,1,"div",358),a(5,"div",359)(6,"div",360),g(7,"i",361),c(8," 1"),s(),a(9,"div",360),g(10,"i",362),c(11),s(),a(12,"div",360),g(13,"i",363),c(14),s(),b(15,_d,3,1,"div",364),s()()),o&2){let e=t.$implicit,i=u(4);l(2),P(e.fields.companyName||"Sem t\xEDtulo"),l(),m("ngIf",i.getLeadResponsibleName(e)),l(),m("ngIf",e.fields==null?null:e.fields.contactName),l(7),S(" ",i.getDaysSince(e.createdAt),"d"),l(3),S(" ",i.getDaysSince(e.movedToCurrentColumnAt),"d"),l(),m("ngIf",i.getLeadDueDateLabel(e))}}function bd(o,t){o&1&&(a(0,"div",368),c(1,"Nenhum registro nesta fase"),s())}function xd(o,t){if(o&1&&(a(0,"div",351)(1,"div",352),b(2,vd,16,6,"div",353)(3,bd,2,0,"div",354),s()()),o&2){let e=u().$implicit,i=u(2);l(2),m("ngForOf",i.getLeadsForColumn(e.id)),l(),m("ngIf",i.getLeadsForColumn(e.id).length===0)}}function yd(o,t){if(o&1){let e=F();a(0,"div",345)(1,"button",346),x("click",function(){let n=_(e).$implicit,r=u(2);return v(r.toggleMobileColumn(n.id))}),a(2,"div",325),g(3,"span",347),a(4,"div",88),c(5),s()(),a(6,"div",177)(7,"span",348),c(8),s(),g(9,"i",349),s()(),b(10,xd,4,2,"div",350),s()}if(o&2){let e=t.$implicit,i=u(2);l(3),W("background-color",e.color||"#22c55e"),l(2),P(e.name),l(3),P(i.getLeadsForColumn(e.id).length),l(),A("fa-chevron-down",!i.isMobileColumnOpen(e.id))("fa-chevron-up",i.isMobileColumnOpen(e.id)),l(),m("ngIf",i.isMobileColumnOpen(e.id))}}function Cd(o,t){if(o&1&&(a(0,"div",365),c(1),s()),o&2){let e=u().$implicit,i=u(2);l(),S(" ",i.getLeadResponsibleName(e)," ")}}function wd(o,t){if(o&1&&(a(0,"div",78)(1,"span",366),c(2,"NOME DO CONTATO"),s(),g(3,"br"),c(4),s()),o&2){let e=u().$implicit;l(4),S(" ",e.fields.contactName," ")}}function Ed(o,t){if(o&1&&(a(0,"div",360),g(1,"i",367),c(2),s()),o&2){let e=u().$implicit,i=u(2);l(2),S(" ",i.getLeadDueDateLabel(e))}}function Sd(o,t){if(o&1&&(a(0,"div",369)(1,"div",356),c(2),s(),b(3,Cd,2,1,"div",357)(4,wd,5,1,"div",358),a(5,"div",359)(6,"div",360),g(7,"i",361),c(8," 1"),s(),a(9,"div",360),g(10,"i",362),c(11),s(),a(12,"div",360),g(13,"i",363),c(14),s(),b(15,Ed,3,1,"div",364),s()()),o&2){let e=t.$implicit,i=u(2);l(2),P(e.fields.companyName||"Sem t\xEDtulo"),l(),m("ngIf",i.getLeadResponsibleName(e)),l(),m("ngIf",e.fields==null?null:e.fields.contactName),l(7),S(" ",i.getDaysSince(e.createdAt),"d"),l(3),S(" ",i.getDaysSince(e.movedToCurrentColumnAt),"d"),l(),m("ngIf",i.getLeadDueDateLabel(e))}}function Id(o,t){if(o&1){let e=F();a(0,"div",294)(1,"div",295)(2,"div",33)(3,"div",296)(4,"div",297)(5,"input",298),ce("ngModelChange",function(n){_(e);let r=u();return de(r.filterQuery,n)||(r.filterQuery=n),v(n)}),x("input",function(){_(e);let n=u();return v(n.applyFilters())}),s(),g(6,"i",299),a(7,"button",300),x("click",function(){_(e);let n=u();return v(n.showAdvancedFilters=!n.showAdvancedFilters)}),g(8,"i",301),b(9,td,2,1,"span",302),s(),b(10,id,2,0,"button",303),s(),b(11,nd,3,0,"button",304),s(),b(12,pd,10,2,"div",305)(13,fd,6,1,"div",306),a(14,"div",61),b(15,yd,11,9,"div",307),s(),a(16,"div",308),b(17,Sd,16,6,"div",309),s()(),a(18,"div",310)(19,"button",311),x("click",function(){_(e);let n=u();return v(n.showCreateLeadModal())}),a(20,"span",312),g(21,"i",313),s(),c(22," Novo lead "),s()()()()}if(o&2){let e=u();l(5),A("border-blue-300",e.filterQuery)("bg-white",e.filterQuery),le("ngModel",e.filterQuery),l(2),A("bg-blue-50",e.hasActiveFilters()||e.showAdvancedFilters)("text-blue-600",e.hasActiveFilters()||e.showAdvancedFilters)("text-gray-400",!e.hasActiveFilters()&&!e.showAdvancedFilters),l(2),m("ngIf",e.getActiveDynamicFiltersCount()>0||e.filterOnlyMine),l(),m("ngIf",e.filterQuery),l(),m("ngIf",e.hasActiveFilters()),l(),m("ngIf",e.showAdvancedFilters&&e.availableFilterFields.length>0),l(),m("ngIf",e.hasActiveFilters()),l(2),m("ngForOf",e.columns),l(2),m("ngForOf",e.leads)}}function Fd(o,t){if(o&1){let e=F();a(0,"app-automation-modal",370),x("closeModalEvent",function(){_(e);let n=u();return v(n.onCloseAutomationModal())})("saveAutomation",function(n){_(e);let r=u();return v(r.onSaveAutomation(n))}),s()}if(o&2){let e=u();m("isVisible",e.showAutomationModal)("automation",e.selectedAutomation)("phases",e.columns)("allowedTriggerTypes",e.selectedPhaseIdForAutomations?e.getAllowedTriggerTypesForPhase(e.selectedPhaseIdForAutomations):null)("fixedPhaseId",e.selectedPhaseIdForAutomations||null)("allowedTransitions",e.flowConfig.allowed||N(8,Hs))("emailTemplates",e.emailTemplates)("users",e.users)}}var Wn=class o{authService=I($e);firestoreService=I(J);subdomainService=I(Me);companyService=I(Tt);automationService=I(kt);apiService=I(an);toast=I(on);route=I(Qi);router=I(Zi);ngZone=I(xe);cdr=I(De);leadModal;columnModal;phaseFormModal;leadDetailModal;templateModal;automationModal;flowScrollerRef;flowThumbPercent=10;flowThumbLeftPercent=0;isDraggingFlowBar=!1;isManualReorder=!1;board=null;columns=[];leads=[];isDraggingLead=!1;displayedLeadsByColumn={};leadOrderByColumn={};cardMoveEnabled=!0;currentUser=null;boardId="";ownerId="";phaseCardFields={};subscriptions=[];isLoading=!0;activeTab="kanban";tabs=[{id:"kanban",name:"Kanban",icon:"fa-columns"},{id:"initial-form",name:"Formul\xE1rio inicial",icon:"fa-list"},{id:"flow",name:"Fluxo",icon:"fa-project-diagram"},{id:"reports",name:"Relat\xF3rios",icon:"fa-chart-bar"},{id:"outbox",name:"Caixa de Sa\xEDda",icon:"fa-paper-plane"},{id:"templates",name:"Templates",icon:"fa-envelope"},{id:"api",name:"API",icon:"fa-code"}];apiEndpoint="";apiToken="KzB47@p!qR9$tW2m&e*J";timeAutomationIntervalId=null;ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.boardId=this.route.snapshot.paramMap.get("boardId")||"";try{localStorage.setItem("last-board-id",this.boardId)}catch{}this.ownerId=this.route.snapshot.queryParamMap.get("ownerId")||this.currentUser?.uid||"";let t=this.subdomainService.getCurrentCompany();if(t?this.firestoreService.setCompanyContext(t):console.warn("Empresa n\xE3o encontrada no contexto"),this.currentUser&&this.boardId&&this.ownerId){this.loadFilterState(),this.loadBoardData(),this.subscribeToRealtimeUpdates(),this.initializeApiEndpoint(),this.loadInitialForm(),this.loadFlowConfig();try{this.timeAutomationIntervalId=setInterval(()=>D(this,null,function*(){try{this.leads&&this.leads.length>0&&this.columns&&this.columns.length>0&&(yield this.automationService.processTimeBasedAutomations(this.leads,this.columns,this.boardId,this.ownerId))}catch(e){console.warn("Erro nas automa\xE7\xF5es de tempo:",e)}}),6e4)}catch(e){console.error("Erro ao configurar automa\xE7\xF5es de tempo:",e)}}else console.error("Par\xE2metros faltando:",{currentUser:!!this.currentUser,boardId:this.boardId,ownerId:this.ownerId})}ngOnDestroy(){if(this.subscriptions.forEach(t=>t.unsubscribe()),this.timeAutomationIntervalId){try{clearInterval(this.timeAutomationIntervalId)}catch{}this.timeAutomationIntervalId=null}}initializeApiEndpoint(){let e=this.subdomainService.getCurrentCompany()?.id||"{COMPANY_ID}";this.apiEndpoint=this.apiService.getLeadIntakeUrl(e,this.boardId)}getFunctionsPort(){let t=localStorage.getItem("firebase-functions-port");if(t)return parseInt(t,10);try{let e=window.__FIREBASE_DEFAULTS__;if(e?.emulatorHosts?.functions){let n=e.emulatorHosts.functions.match(/:(\d+)$/);if(n)return parseInt(n[1],10)}}catch{}return 3001}hasCompanyLogo(){let t=this.subdomainService.getCurrentCompany();return!!(t?.brandingConfig?.logo&&t.brandingConfig.logo.trim()!==""||t?.subdomain==="gobuyer")}getCompanyLogo(){let t=this.subdomainService.getCurrentCompany();return t?.brandingConfig?.logo&&t.brandingConfig.logo.trim()!==""?t.brandingConfig.logo:t?.subdomain==="gobuyer"?"https://apps.gobuyer.com.br/sso/assets/images/logos/logo-gobuyer.png":""}getPrimaryColor(){return this.subdomainService.getCurrentCompany()?.brandingConfig?.primaryColor||"#3B82F6"}getCompanyInitials(){let e=this.subdomainService.getCurrentCompany()?.name||"Task Board";if(!e||e==="Task Board")return"TB";let i=e.split(" ").filter(n=>n.length>0);return i.length===1?i[0].charAt(0).toUpperCase():i.length>=2?i[0].charAt(0).toUpperCase()+i[1].charAt(0).toUpperCase():"TB"}loadBoardData(){return D(this,null,function*(){try{yield this.loadUsers(),yield this.debugFirestoreCollections(),this.isLoading=!1}catch(t){console.error("Erro ao carregar dados do quadro:",t),this.isLoading=!1}})}debugFirestoreCollections(){return D(this,null,function*(){try{let t=yield this.firestoreService.getEmailTemplates(this.ownerId,this.boardId),e=yield this.firestoreService.getAutomations(this.ownerId,this.boardId);try{let i=yield this.firestoreService.getEmailTemplates("",this.boardId)}catch{}}catch(t){console.error("Erro no debug das cole\xE7\xF5es:",t)}})}loadUsers(){return D(this,null,function*(){try{let t=this.subdomainService.getCurrentCompany();if(!t||!t.id){console.warn("Empresa n\xE3o encontrada para carregar usu\xE1rios"),this.users=[];return}let e=yield this.companyService.getAllCompanyUsers(t.id);this.users=e.filter(i=>!i.inviteStatus||i.inviteStatus==="accepted").map(i=>({uid:i.uid,displayName:i.displayName||this.extractNameFromEmail(i.email),email:i.email})),console.log("Usu\xE1rios carregados:",this.users.length)}catch(t){console.error("Erro ao carregar usu\xE1rios:",t),this.users=[{uid:this.currentUser?.uid,displayName:this.currentUser?.displayName,email:this.currentUser?.email}]}})}extractNameFromEmail(t){return t.split("@")[0].replace(/[._]/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ")}subscribeToRealtimeUpdates(){let t=this.firestoreService.subscribeToColumns(this.ownerId,this.boardId,d=>{this.columns=d,this.loadCardFieldConfigs(),this.loadAllPhaseFormConfigs();try{this.syncFlowOrderWithColumns()}catch{}});this.subscriptions.push({unsubscribe:t});let e=this.firestoreService.subscribeToLeads(this.ownerId,this.boardId,d=>D(this,null,function*(){let p=Object.create(null);for(let f of d)p[f.id]=f;if(!this._leadsStreamInitialized)this._lastLeadsById=p,this._leadsStreamInitialized=!0;else{let f=[],h=[],y=this._lastLeadsById||{};for(let[w,E]of Object.entries(p)){let k=y[w];k?k.columnId!==E.columnId&&h.push({lead:E,from:k.columnId,to:E.columnId}):f.push(E)}this._lastLeadsById=p;try{for(let w of f)try{yield this.automationService.processNewLeadAutomations(w,this.boardId,this.ownerId)}catch(E){console.warn("Falha ao processar automa\xE7\xE3o de novo lead:",E)}for(let w of h)try{yield this.automationService.processPhaseChangeAutomations(w.lead,w.to,w.from,this.boardId,this.ownerId)}catch(E){console.warn("Falha ao processar automa\xE7\xE3o de mudan\xE7a de fase:",E)}}catch{}}this.leads=d.map(f=>ee(R({},f),{historyCommentsCount:f.historyCommentsCount??0,attachmentsCount:f.attachmentsCount??0})),this.isLoading=!1,this.ensureLeadOrderLoaded(),this.rebuildDisplayedLeads()}));this.subscriptions.push({unsubscribe:e});let i=this.firestoreService.subscribeToOutboxEmails(this.ownerId,this.boardId,d=>{this.outboxEmails=d,this.updateEmailStatusCounts()});this.subscriptions.push({unsubscribe:i});let n=this.firestoreService.subscribeToEmailTemplates(this.ownerId,this.boardId,d=>{this.emailTemplates=d});this.subscriptions.push({unsubscribe:n});let r=this.firestoreService.subscribeToAutomations(this.ownerId,this.boardId,d=>{d&&d.length>0,this.automations=d||[],this.cleanupInvalidAutomations()});this.subscriptions.push({unsubscribe:r})}loadCardFieldConfigs(){return D(this,null,function*(){try{let t={};for(let e of this.columns)try{let r=((yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,e.id))?.fields||[]).filter(d=>!!d?.showInCard||!!d?.showInAllPhases);t[e.id]=r.sort((d,p)=>(d.order||0)-(p.order||0))}catch{t[e.id]=[]}this.phaseCardFields=t}catch{this.phaseCardFields={}}})}isPlainObject(t){return t&&typeof t=="object"&&!Array.isArray(t)}flattenObject(t,e=3){let i={};if(!this.isPlainObject(t)||e<0)return i;for(let[n,r]of Object.entries(t))if(this.isPlainObject(r)&&e>0){let d=this.flattenObject(r,e-1);for(let[p,f]of Object.entries(d))i[p]===void 0&&(i[p]=f)}else r!=null&&(i[n]=r);return i}collectLeadFields(t){let e=t.fields||{},i=["fields","leadData","data","payload"],n={},r=[e];i.forEach(p=>{this.isPlainObject(e[p])&&r.push(e[p])}),this.isPlainObject(e.fields?.fields)&&r.push(e.fields.fields);for(let p of r)for(let[f,h]of Object.entries(p))n[f]===void 0&&h!==void 0&&h!==null&&`${h}`.trim?.()!==""&&(n[f]=h);let d=this.flattenObject(e,3);for(let[p,f]of Object.entries(d))n[p]===void 0&&f!==void 0&&f!==null&&`${f}`.trim?.()!==""&&(n[p]=f);return n}readFieldValue(t,e,i){let n=this.collectLeadFields(t);if(!e&&!i)return;let r=[];e&&r.push(e);let d={companyName:["companyName","empresa","nomeEmpresa","nameCompany","company","company_name","empresa_nome","nameComapny"],contactName:["contactName","name","nome","nomeLead","nameLead","leadName"],contactEmail:["contactEmail","email","emailLead","contatoEmail","leadEmail"],contactPhone:["contactPhone","phone","telefone","celular","phoneLead","telefoneContato"],cnpj:["cnpj","cnpjCompany","cnpjEmpresa","companyCnpj"]},p=(e||"").toLowerCase();Object.values(d).forEach(T=>{T.some(M=>M.toLowerCase()===p)&&T.forEach(M=>{r.includes(M)||r.push(M)})});let f=(i||"").toLowerCase(),h=[{words:["empresa"],groupKey:"companyName"},{words:["contato","nome do contato","respons\xE1vel","responsavel"],groupKey:"contactName"},{words:["email","e-mail"],groupKey:"contactEmail"},{words:["telefone","celular","whatsapp","whats"],groupKey:"contactPhone"},{words:["cnpj"],groupKey:"cnpj"}];for(let T of h)T.words.some(M=>f.includes(M))&&d[T.groupKey].forEach(M=>{r.includes(M)||r.push(M)});let y=Object.keys(n).reduce((T,M)=>(T[M.toLowerCase()]=M,T),{}),w=T=>T.toLowerCase().replace(/[^a-z0-9]/g,""),E=Object.keys(n).reduce((T,M)=>(T[w(M)]=M,T),{}),k=new Set;for(let T of r){let M=T.toLowerCase();if(k.has(M))continue;k.add(M);let O=y[M]||E[w(T)]||T,B=n[O];if(B!=null&&`${B}`.trim?.()!=="")return B}}loadAllPhaseFormConfigs(){return D(this,null,function*(){for(let t of this.columns)try{let e=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,t.id);e?.fields&&(this.phaseFormConfigs[t.id]=e)}catch{}this.loadAvailableFilterFields()})}getAllFieldsForDisplay(){let t=[],e=[];return(this.initialFormFields||[]).forEach(r=>{let d=r?.showInCard,p=r?.showInAllPhases;r.name==="nameContact"||r.name==="emailContact"||(d===!0||p===!0)&&t.push(r)}),Object.values(this.phaseFormConfigs).forEach(r=>{r?.fields&&r.fields.forEach(d=>{d?.showInAllPhases===!0&&e.push(d)})}),[...t,...e].filter((r,d,p)=>p.findIndex(f=>f.name===r.name)===d)}getCardFieldsForLead(t){let e=this.getAllFieldsForDisplay(),i=[];if(t.columnId&&this.phaseFormConfigs[t.columnId]){let h=this.phaseFormConfigs[t.columnId];h?.fields&&h.fields.forEach(y=>{y?.showInCard===!0&&i.push(y)})}let d=[...e,...i].filter((h,y,w)=>w.findIndex(E=>E.name===h.name)===y).sort((h,y)=>(h.order||0)-(y.order||0)),p=[],f=h=>{let y=(h.apiFieldName||h.name||"").toLowerCase(),w=(h.label||h.name||"").toLowerCase(),E=B=>B.replace(/[^a-z0-9]/g,""),k=["companyname","empresa","nomeempresa","namecompany","company","company_name","empresa_nome","namecomapny"],T=["cnpj","cnpjcompany","cnpjempresa","companycnpj"],M=E(y),O=E(w);return k.includes(M)||k.includes(O)||T.includes(M)||T.includes(O)};for(let h of d){let y=f(h),w=this.readFieldValue(t,h.apiFieldName||h.name,h.label||h.name),E=w!=null&&`${w}`.trim()!=="";if(!y&&E){let k={label:h.label||h.name||h.apiFieldName,value:w,type:(h.type||"").toLowerCase()};p.push(k)}}return p}getTemperatureGlobalItem(t){try{let e=[...this.initialFormFields||[],...this.phaseCardFields[t.columnId]||[]];Object.values(this.phaseFormConfigs).forEach(d=>{d?.fields&&d.fields.forEach(p=>{p?.showInAllPhases===!0&&e.push(p)})});let i=e.find(d=>{let p=(d.type||"").toLowerCase()==="temperatura",f=d.showInCard||d.showInAllPhases;return p&&f});if(!i)return null;let n=this.readFieldValue(t,i.apiFieldName||i.name,i.label||i.name);return n==null||`${n}`.trim()===""?null:{label:i.label||"Temperatura",value:n}}catch(e){return console.error("\u{1F321}\uFE0F getTemperatureGlobalItem error:",e),null}}getTemperatureCardItem(t){try{let i=this.getCardFieldsForLead(t).find(n=>(n.type||"").toLowerCase()==="temperatura");return i?{label:i.label,value:i.value}:null}catch{return null}}getLeadsForColumn(t){let i=this.leads.filter(r=>r.columnId===t).filter(r=>this.leadMatchesFilters?this.leadMatchesFilters(r):!0),n=this.leadOrderByColumn[t]||[];return i.sort((r,d)=>n.indexOf(r.id)-n.indexOf(d.id)||0)}getColumnConnectedTo(){return this.columns.map(t=>`column-${t.id}`)}onLeadDrop(t){return D(this,null,function*(){this.isDraggingLead=!1;let e=t.item.data,i=t.container.id.replace("column-",""),n=t.previousContainer.id.replace("column-","");if(t.previousContainer===t.container){qe(t.container.data,t.previousIndex,t.currentIndex);let r=t.container.data.map(f=>f.id),p=(this.leadOrderByColumn[i]||[]).filter(f=>!r.includes(f));this.leadOrderByColumn[i]=[...r,...p],this.saveLeadOrder();return}else{Bt(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex);let r=this.leads.find(p=>p.id===e);try{let p=yield this.getRequiredToAdvanceMissing(r,n);if(p.length>0){Bt(t.container.data,t.previousContainer.data,t.currentIndex,t.previousIndex),this.toast.error(`Preencha os campos obrigat\xF3rios para avan\xE7ar: ${p.join(", ")}`);return}}catch{}if(!(this.flowConfig.allowed[n]||[]).includes(i)){Bt(t.container.data,t.previousContainer.data,t.currentIndex,t.previousIndex),this.toast.error("Transi\xE7\xE3o n\xE3o permitida pelo fluxo.");return}try{yield this.firestoreService.moveLead(this.ownerId,this.boardId,e,i);let p=t.container.data.map(T=>T.id),f=t.previousContainer.data.map(T=>T.id),h=this.leadOrderByColumn[n]||[],y=this.leadOrderByColumn[i]||[],w=String(e),E=h.filter(T=>T!==w),k=y.filter(T=>!p.includes(T)&&T!==w);this.leadOrderByColumn[n]=[...f,...E.filter(T=>!f.includes(T))],this.leadOrderByColumn[i]=[...p,...k],this.saveLeadOrder();try{if(r){let T=new Date,M=R({},r.phaseHistory||{});if(M[n]){let O=M[n].enteredAt?.toDate&&M[n].enteredAt.toDate()||new Date(M[n].enteredAt||T);M[n].exitedAt=T,M[n].duration=T.getTime()-O.getTime()}M[i]={phaseId:i,enteredAt:T},yield this.firestoreService.updateLead(this.ownerId,this.boardId,r.id,{phaseHistory:M})}}catch{}}catch(p){console.error("Erro ao mover lead:",p),this.subscribeToRealtimeUpdates()}}})}getRequiredToAdvanceMissing(t,e){return D(this,null,function*(){try{let i=e||t.columnId,d=((yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,i))?.fields||[]).filter(f=>!!f?.requiredToAdvance),p=[];for(let f of d){let h=f.apiFieldName||f.name,y=this.readFieldValue(t,h,f.label||f.name);(y==null||typeof y=="string"&&y.trim()==="")&&p.push(f.label||f.name||h)}return p}catch{return[]}})}trackByLeadId(t,e){return e.id}ensureLeadOrderLoaded(){let t=`lead-order-${this.boardId}`;try{let e=localStorage.getItem(t);e&&(this.leadOrderByColumn=JSON.parse(e)||{})}catch{}}saveLeadOrder(){let t=`lead-order-${this.boardId}`;try{localStorage.setItem(t,JSON.stringify(this.leadOrderByColumn))}catch{}}rebuildDisplayedLeads(){let t={};for(let e of this.columns){let n=this.leads.filter(f=>f.columnId===e.id).filter(f=>this.leadMatchesFilters?this.leadMatchesFilters(f):!0),r=this.leadOrderByColumn[e.id]||[],d=n.filter(f=>r.includes(f.id)).sort((f,h)=>r.indexOf(f.id)-r.indexOf(h.id)),p=n.filter(f=>!r.includes(f.id));t[e.id]=[...d,...p],this.leadOrderByColumn[e.id]||(this.leadOrderByColumn[e.id]=t[e.id].map(f=>f.id))}this.displayedLeadsByColumn=t,this.saveLeadOrder()}logout(){return D(this,null,function*(){(yield this.authService.logout()).success&&this.router.navigate(["/login"])})}goToDashboard(){this.router.navigate(["/dashboard"])}formatDate(t){if(!t)return console.log("formatDate: timestamp is null/undefined"),"Data n\xE3o dispon\xEDvel";try{return t.seconds?new Date(t.seconds*1e3).toLocaleDateString("pt-BR"):t.toDate?t.toDate().toLocaleDateString("pt-BR"):t instanceof Date?t.toLocaleDateString("pt-BR"):new Date(t).toLocaleDateString("pt-BR")}catch{return"Data inv\xE1lida"}}formatDateTime(t){if(!t)return"\u2014";try{return t.seconds?new Date(t.seconds*1e3).toLocaleString("pt-BR"):t.toDate?t.toDate().toLocaleString("pt-BR"):t instanceof Date?t.toLocaleString("pt-BR"):new Date(t).toLocaleString("pt-BR")}catch{return"\u2014"}}getEmailDisplayDate(t){let e=t?.delivery?.endTime;return e||t?.createdAt||null}getColumnBorderColor(t){return t.color||"#e5e7eb"}getLeadPriorityClass(t){let e=t.fields?.temperature;return e==="quente"?"border-l-red-500":e==="morno"?"border-l-yellow-500":"border-l-transparent"}getLeadInitials(t){return(t.fields?.companyName||t.fields?.contactName||"").split(" ").map(i=>i.charAt(0)).join("").substring(0,2).toUpperCase()}getCompanyName(t){let e=this.readFieldValue(t,"companyName");return e!=null&&`${e}`.trim()!==""?`${e}`:"Empresa n\xE3o informada"}getCnpj(t){let e=this.readFieldValue(t,"cnpj","CNPJ");if(e==null)return null;let i=`${e}`.trim();return i||null}showCreateLeadModal(){this.leadModal.showCreateModal()}showEditLeadModal(t){this.leadModal.showEditModal(t)}showLeadDetailModal(t){this.leadDetailModal.show(t)}onCardClick(t,e){this.isDraggingLead||this.showLeadDetailModal(t)}onLeadDragStarted(){this.isDraggingLead=!0}onLeadDragEnded(){setTimeout(()=>{this.isDraggingLead=!1},0)}toggleCardMove(){this.cardMoveEnabled=!this.cardMoveEnabled,this.cardMoveEnabled||(this.isDraggingLead=!1)}onWindowMouseUpForCards(){this.isDraggingLead=!1}onWindowTouchEndForCards(){this.isDraggingLead=!1}onLeadCreated(){return D(this,null,function*(){console.log("Novo lead criado!")})}onLeadUpdated(){console.log("Lead atualizado!")}onLeadDeleted(){console.log("Lead exclu\xEDdo!")}switchTab(t){this.activeTab=t}getActiveLeads(){return this.leads.filter(t=>{let e=this.columns.find(i=>i.id===t.columnId);return e&&(!e.endStageType||e.endStageType==="none")})}outboxEmails=[];activeEmailStatus="all";emailStatuses=[{id:"all",name:"Todos",count:0},{id:"scheduled",name:"Agendados",count:0},{id:"success",name:"Enviados",count:0},{id:"error",name:"Com Erro",count:0}];emailTemplates=[];automations=[];_leadsStreamInitialized=!1;_lastLeadsById={};initialFormFields=[];phaseFormConfigs={};apiExampleJson="";flowConfig={allowed:{}};flowOrder=[];flowTogglesByPhase={};flowEdges=[];connectMode=!1;pendingFromId=null;loadFlowConfig(){return D(this,null,function*(){try{let t=yield this.firestoreService.getFlowConfig(this.boardId);this.flowConfig=t||{allowed:{}};let e=[...this.columns].sort((r,d)=>(r.order||0)-(d.order||0)).map(r=>r.id);this.isManualReorder||(this.flowOrder=e),this.flowTogglesByPhase={};for(let r=0;r<this.flowOrder.length;r++){let d=this.flowOrder[r],p=this.flowOrder[r-1],f=this.flowOrder[r+1],h=this.flowConfig.allowed[d]||[];this.flowTogglesByPhase[d]={allowNext:!!(f&&h.includes(f)),allowPrev:!!(p&&h.includes(p))}}let i=[],n=this.flowConfig.allowed||{};Object.keys(n).forEach(r=>{(n[r]||[]).forEach(d=>i.push({fromId:r,toId:d}))}),this.flowEdges=i}catch{this.flowConfig={allowed:{}},this.isManualReorder||(this.flowOrder=[...this.columns].sort((t,e)=>(t.order||0)-(e.order||0)).map(t=>t.id))}})}saveFlowConfig(){return D(this,null,function*(){try{let t=r=>typeof r=="string"?r.trim():String(r||"").trim(),e={};for(let r of this.flowEdges||[]){let d=t(r.fromId),p=t(r.toId);!d||!p||(e[d]||(e[d]=[]),e[d].includes(p)||e[d].push(p))}let i=new Set(this.columns.map(r=>r.id));Object.keys(e).forEach(r=>{i.has(r)?e[r]=(e[r]||[]).filter(d=>i.has(d)):delete e[r]});let n=(this.flowOrder||[]).map(t).filter(r=>i.has(r));this.flowConfig={allowed:e},yield this.firestoreService.saveFlowConfig(this.boardId,{allowed:e,order:n}),this.toast.success("Fluxo salvo.")}catch(t){console.error("Erro ao salvar fluxo",{error:t});let e=t?.message||"Erro ao salvar fluxo.";this.toast.error(e)}})}saveCurrentFlowConfig(){return D(this,null,function*(){try{console.log("\u{1F4BE} Salvando configura\xE7\xE3o atual do fluxo:",{allowed:this.flowConfig.allowed,order:this.flowOrder});let t=r=>typeof r=="string"?r.trim():String(r||"").trim(),e=new Set(this.columns.map(r=>r.id)),i={};Object.entries(this.flowConfig.allowed||{}).forEach(([r,d])=>{let p=t(r);e.has(p)&&(i[p]=(d||[]).map(f=>t(f)).filter(f=>e.has(f)))});let n=(this.flowOrder||[]).map(t).filter(r=>e.has(r));yield this.firestoreService.saveFlowConfig(this.boardId,{allowed:i,order:n}),console.log("\u2705 Configura\xE7\xE3o do fluxo salva com sucesso")}catch(t){throw console.error("\u274C Erro ao salvar configura\xE7\xE3o do fluxo:",t),t}})}getAllowedTargets(t){let e=this.flowConfig.allowed[t]||[];return this.columns.filter(i=>e.includes(i.id))}getAvailableTargets(t){let e=this.flowConfig.allowed[t]||[];return this.columns.filter(i=>i.id!==t&&!e.includes(i.id))}onFlowDropToAllowed(t,e){return D(this,null,function*(){let i=e.item.data,n=this.flowConfig.allowed[t]||(this.flowConfig.allowed[t]=[]);if(!n.includes(i.id)){console.log("\u2795 Adicionando conex\xE3o:",{from:this.getColumnById(t)?.name,to:i.name,beforeAdd:[...n]}),n.push(i.id),console.log("\u2795 Ap\xF3s adi\xE7\xE3o:",{newList:[...n]});try{yield this.saveCurrentFlowConfig(),console.log("\u2705 Configura\xE7\xE3o salva ap\xF3s adi\xE7\xE3o da conex\xE3o")}catch(r){console.error("\u274C Erro ao salvar configura\xE7\xE3o ap\xF3s adi\xE7\xE3o:",r)}}})}onFlowDropToAvailable(t,e){return D(this,null,function*(){let i=e.item.data,n=this.flowConfig.allowed[t]||[];console.log("\u{1F5D1}\uFE0F Removendo conex\xE3o:",{from:this.getColumnById(t)?.name,to:i.name,beforeRemoval:[...n],droppedId:i.id}),this.flowConfig.allowed[t]=n.filter(r=>r!==i.id),console.log("\u{1F5D1}\uFE0F Ap\xF3s remo\xE7\xE3o:",{newList:[...this.flowConfig.allowed[t]]});try{yield this.saveCurrentFlowConfig(),console.log("\u2705 Configura\xE7\xE3o salva ap\xF3s remo\xE7\xE3o da conex\xE3o")}catch(r){console.error("\u274C Erro ao salvar configura\xE7\xE3o ap\xF3s remo\xE7\xE3o:",r)}})}onFlowReorder(t){return D(this,null,function*(){if(console.log("\u{1F3AF} onFlowReorder CHAMADO!",{previousIndex:t.previousIndex,currentIndex:t.currentIndex,isEqual:t.previousIndex===t.currentIndex,movedPhaseId:this.flowOrder[t.previousIndex],allPhases:this.flowOrder.map((i,n)=>({index:n,id:i,name:this.getColumnById(i)?.name})),containerData:t.container.data,previousContainer:t.previousContainer.data}),t.previousIndex===t.currentIndex){console.log("\u274C onFlowReorder - Movimento aparentemente para o mesmo \xEDndice"),console.log("\u26A0\uFE0F Vamos investigar se realmente \xE9 o mesmo local...");let i=t.container.data,n=t.previousContainer.data;console.log("\u{1F50D} Container atual:",i),console.log("\u{1F50D} Container anterior:",n),console.log("\u{1F50D} Fases com nomes:",i.map((r,d)=>`${d}: ${this.getColumnById(r)?.name}`)),t.container!==t.previousContainer||JSON.stringify(i)!==JSON.stringify(n)?console.log("\u2705 Detectada mudan\xE7a real, continuando reordena\xE7\xE3o..."):(console.log("\u274C Nenhuma mudan\xE7a real detectada"),console.log("\u{1F4A1} Tentativa: Vou tentar for\xE7ar o movimento manualmente..."),console.log("\u26A0\uFE0F FOR\xC7ANDO movimento para testar..."))}this.isManualReorder=!0,console.log("\u{1F504} Flow Reorder - Iniciando reordena\xE7\xE3o",{from:t.previousIndex,to:t.currentIndex,previousOrder:[...this.flowOrder],movedColumnId:this.flowOrder[t.previousIndex],targetPosition:t.currentIndex});let e=[...this.flowOrder];qe(this.flowOrder,t.previousIndex,t.currentIndex),console.log("\u{1F504} Flow Reorder - flowOrder imediatamente ap\xF3s moveItemInArray:",[...this.flowOrder]),this.cdr.detectChanges(),console.log("\u{1F504} Flow Reorder - DOM atualizado, ordem visual deve refletir:",[...this.flowOrder]),console.log("\u{1F504} Flow Reorder - Nova ordem local:",{newOrder:[...this.flowOrder],changes:this.flowOrder.map((i,n)=>{let r=e.indexOf(i);return{id:i,from:r,to:n,changed:r!==n}})});try{let i=this.flowOrder.map((n,r)=>D(this,null,function*(){let d=this.columns.find(f=>f.id===n),p=e.indexOf(n);d&&p!==r&&(console.log(`\u{1F504} Atualizando coluna "${d.name}" - posi\xE7\xE3o: ${p} \u2192 ${r}`),yield this.firestoreService.updateColumn(this.ownerId,this.boardId,n,{order:r}),d.order=r)}));yield Promise.all(i),this.columns.sort((n,r)=>(n.order||0)-(r.order||0)),console.log("\u2705 Flow Reorder - Reordena\xE7\xE3o salva com sucesso",{finalOrder:this.columns.map(n=>({id:n.id,name:n.name,order:n.order}))}),console.log("\u2705 Flow Reorder - Aguardando para resetar flag isManualReorder"),setTimeout(()=>{console.log("\u{1F504} Flow Reorder - Resetando flag isManualReorder para false"),this.isManualReorder=!1},500)}catch(i){console.error("\u274C Flow Reorder - Erro ao salvar nova ordem:",i),this.flowOrder=e,this.isManualReorder=!1,alert("Erro ao reordenar fases. Tente novamente.")}})}syncFlowOrderWithColumns(){if(this.isManualReorder){console.log("\u{1F504} syncFlowOrderWithColumns - Pulando sincroniza\xE7\xE3o durante reordena\xE7\xE3o manual");return}let t=[...this.columns].sort((r,d)=>(r.order||0)-(d.order||0)).map(r=>r.id);if(!Array.isArray(this.flowOrder)||this.flowOrder.length===0){this.flowOrder=t;return}if(this.flowOrder.every((r,d)=>t[d]===r)){console.log("\u{1F504} syncFlowOrderWithColumns - FlowOrder j\xE1 est\xE1 sincronizado, n\xE3o alterando");return}let i=new Set(this.flowOrder),n=new Set(t);this.flowOrder=this.flowOrder.filter(r=>n.has(r));for(let r of t)if(!i.has(r)){let d=this.getColumnById(r)?.name||"Nome n\xE3o encontrado";this.flowOrder.push(r),console.log(`\u{1F504} syncFlowOrderWithColumns - Adicionada nova fase: ${r} (${d})`)}this.flowOrder.length!==i.size&&(console.log("\u{1F504} syncFlowOrderWithColumns - For\xE7ando atualiza\xE7\xE3o visual ap\xF3s mudan\xE7as"),this.cdr.detectChanges()),console.log("\u{1F504} syncFlowOrderWithColumns - Sincroniza\xE7\xE3o conclu\xEDda",{finalFlowOrder:[...this.flowOrder]})}scrollFlowBy(t){try{let e=this.flowScrollerRef?.nativeElement;e&&e.scrollBy({left:t,behavior:"smooth"})}catch{}}updateFlowThumb(){try{let t=this.flowScrollerRef?.nativeElement;if(!t)return;let e=t.scrollWidth,i=t.clientWidth,n=t.scrollLeft,r=Math.max(5,Math.min(100,i/e*100)),d=Math.max(0,Math.min(100-r,n/(e-i)*100));this.flowThumbPercent=r,this.flowThumbLeftPercent=isFinite(d)?d:0,this.cdr.markForCheck()}catch{}}onWindowResizeFlow(){this.updateFlowThumb()}ngAfterViewInit(){setTimeout(()=>this.updateFlowThumb(),0);try{let t=this.flowScrollerRef?.nativeElement;t&&this.ngZone.runOutsideAngular(()=>{t.addEventListener("scroll",()=>{this.ngZone.run(()=>this.updateFlowThumb())},{passive:!0})})}catch{}}onFlowBarPointerDown(t){t.preventDefault();let e=this.flowScrollerRef?.nativeElement,i=t.currentTarget;if(!e||!i)return;let n=i.getBoundingClientRect(),r=f=>{let h=Math.max(0,Math.min(1,(f-n.left)/n.width));e.scrollLeft=(e.scrollWidth-e.clientWidth)*h,this.updateFlowThumb()};r(t.clientX),this.isDraggingFlowBar=!0;let d=f=>r(f.clientX),p=()=>{this.isDraggingFlowBar=!1,window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",p)};this.ngZone.runOutsideAngular(()=>{window.addEventListener("mousemove",d,{passive:!0}),window.addEventListener("mouseup",p,{once:!0})})}onFlowBarTouchStart(t){let e=this.flowScrollerRef?.nativeElement,i=t.currentTarget;if(!e||!i||t.touches.length===0)return;let n=i.getBoundingClientRect(),r=f=>{let h=Math.max(0,Math.min(1,(f-n.left)/n.width));e.scrollLeft=(e.scrollWidth-e.clientWidth)*h,this.updateFlowThumb()};r(t.touches[0].clientX);let d=f=>{f.touches.length>0&&r(f.touches[0].clientX)},p=()=>{window.removeEventListener("touchmove",d),window.removeEventListener("touchend",p)};this.ngZone.runOutsideAngular(()=>{window.addEventListener("touchmove",d,{passive:!0}),window.addEventListener("touchend",p,{once:!0})})}toggleConnectMode(){this.connectMode=!this.connectMode,this.pendingFromId=null}beginEdge(t){this.pendingFromId=t}completeEdge(t){if(!this.pendingFromId)return;let e=this.pendingFromId;e!==t&&!this.flowEdges.some(i=>i.fromId===e&&i.toId===t)&&this.flowEdges.push({fromId:e,toId:t}),this.pendingFromId=null}removeEdge(t){this.flowEdges=this.flowEdges.filter(e=>!(e.fromId===t.fromId&&e.toId===t.toId))}hasOutgoingConnections(t){return Array.isArray(this.flowEdges)&&this.flowEdges.some(e=>e.fromId===t)}getOutgoingConnections(t){return(this.flowEdges||[]).filter(e=>e.fromId===t)}getEdgeArrow(t){let e=this.columns.find(n=>n.id===t.fromId),i=this.columns.find(n=>n.id===t.toId);return!e||!i||i.order>e.order?"\u2192":"\u2190"}onFlowMouseMove(t){}startConnect(t,e){}endConnect(t,e){}cancelConnect(){}getNodeById(t){return{id:t,name:"",x:0,y:0}}buildCurvePath(t,e){let i=this.getNodeById(t),n=this.getNodeById(e);if(!i||!n)return"";let r=i.x+120,d=i.y+30,p=n.x,f=n.y+30,h=Math.max(40,Math.abs(p-r)*.5),y=r+h,w=d,E=p-h;return`M ${r},${d} C ${y},${w} ${E},${f} ${p},${f}`}buildTempCurve(){return""}getEdgeColor(t,e){let i=this.columns.find(r=>r.id===t),n=this.columns.find(r=>r.id===e);return!i||!n?"#9CA3AF":n.order>i.order?"#16a34a":"#ea580c"}getEdgeMarker(t,e){let i=this.columns.find(r=>r.id===t),n=this.columns.find(r=>r.id===e);return!i||!n?"":n.order>i.order?"url(#arrow-green)":"url(#arrow-orange)"}onNodeDragStart(t,e){}onFlowMouseUp(t){}onWindowMouseUp(t){}onWindowTouchEnd(t){}onNodeMouseEnter(t){}onNodeMouseLeave(t){}autoAlignFlow(){this.toast.success("Fluxo alinhado")}toggleFlowMove(){}getColumnById(t){return this.columns.find(e=>e.id===t)}getAutomationCount(t){try{let e=this.isInitialPhaseId(t);return(this.automations||[]).filter(i=>{if(!(i?.active!==!1))return!1;let r=i?.trigger||{},d=i?.triggerType??r.type,p=i?.triggerPhase??r.phase;return d==="new-lead-created"?p?p===t:e:p===t}).length}catch{return 0}}isInitialPhaseId(t){let e=this.getColumnById(t);if(!e)return!1;let i=Math.min(...this.columns.map(n=>n.order||0));return!!e.isInitialPhase||(e.order||0)===i}getAllowedTriggerTypesForPhase(t){return["new-lead-created","card-enters-phase","card-in-phase-for-time","form-not-answered","sla-overdue"]}selectedPhaseIdForAutomations=null;openPhaseAutomations(t){this.selectedPhaseIdForAutomations=t}closePhaseAutomations(){this.selectedPhaseIdForAutomations=null}getAutomationsForPhase(t){return(this.automations||[]).filter(e=>{let i=e?.trigger||{},n=e?.triggerType??i.type,r=e?.triggerPhase??i.phase;return n==="new-lead-created"?r?r===t:this.isInitialPhaseId(t):r===t})}createAutomationForPhase(t){let e=this.isInitialPhaseId(t)?"new-lead-created":"card-enters-phase";this.selectedAutomation={name:"Automa\xE7\xE3o da fase",active:!0,trigger:{type:e,phase:t},triggerType:e,triggerPhase:t,actions:[]},this.showAutomationModal=!0}loadInitialForm(){return D(this,null,function*(){try{let t=yield this.firestoreService.getInitialFormConfig(this.boardId);this.initialFormFields=t?.fields||[];let e=this.initialFormFields.filter(i=>i.type==="temperatura"||i.name?.toLowerCase().includes("temp"));this.buildApiExampleFromFields(),this.loadAvailableFilterFields()}catch{this.initialFormFields=[],this.buildApiExampleFromFields()}})}saveInitialForm(){return D(this,null,function*(){try{console.log("\u{1F4BE} saveInitialForm INICIADO"),console.log("\u{1F4BE} this.initialFormFields antes de salvar:",this.initialFormFields),this.initialFormFields?.forEach((e,i)=>{console.log(`\u{1F4BE} Campo ${i+1} a ser salvo:`,{name:e.name,type:e.type,showInFilters:e.showInFilters,hasShowInFilters:"showInFilters"in e,completeField:e})});let t={fields:this.initialFormFields};console.log("\u{1F4BE} Dados que ser\xE3o enviados ao Firestore:",t),yield this.firestoreService.saveInitialFormConfig(this.boardId,t),console.log("\u{1F4BE} Recarregando filtros ap\xF3s salvar formul\xE1rio inicial..."),this.loadAvailableFilterFields(),this.toast.success("Formul\xE1rio inicial salvo.")}catch(t){console.error("\u{1F4BE} saveInitialForm ERRO:",t),this.toast.error("Erro ao salvar formul\xE1rio inicial.")}})}onInitialFieldsChanged(t){console.log("\u{1F504} onInitialFieldsChanged CHAMADO com:",t),t.forEach((e,i)=>{console.log(`\u{1F504} Campo recebido ${i+1}:`,{name:e.name,label:e.label,type:e.type,showInFilters:e.showInFilters,completeField:e})}),this.initialFormFields=t,console.log("\u{1F504} Recarregando filtros ap\xF3s mudan\xE7a de campos..."),this.loadAvailableFilterFields(),this.buildApiExampleFromFields()}buildApiExampleFromFields(){let t={};for(let e of this.initialFormFields||[]){let i=e.apiFieldName&&e.apiFieldName.trim()?e.apiFieldName.trim():e.name||"campo";t[i]=this.getSampleForField(e)}this.apiExampleJson=JSON.stringify(t,null,2)}getSampleForField(t){let e=(t.type||"text").toLowerCase();return e==="email"?"email@exemplo.com":e==="tel"||e==="phone"?"(11) 99999-9999":e==="number"?123:e==="select"&&Array.isArray(t.options)&&t.options.length?t.options[0]:e==="temperatura"?"Quente":e==="textarea"?"Texto livre":"Valor de exemplo"}users=[];expandedMobileColumnId=null;toggleMobileColumn(t){this.expandedMobileColumnId=this.expandedMobileColumnId===t?null:t}isMobileColumnOpen(t){return this.expandedMobileColumnId===t}filterQuery="";filterOnlyMine=!1;dynamicFilters={};availableFilterFields=[];showAdvancedFilters=!1;toggleOnlyMine(){this.filterOnlyMine=!this.filterOnlyMine,this.applyFilters()}clearFilters(){this.filterQuery="",this.filterOnlyMine=!1,this.dynamicFilters={},this.applyFilters()}migrateFieldsToIncludeShowInFilters(){if(this.initialFormFields){let t=!1;this.initialFormFields.forEach(e=>{"showInFilters"in e||(e.showInFilters=!1,t=!0,console.log(`\u{1F527} Adicionado showInFilters: false ao campo ${e.name} (campo antigo)`))}),t&&console.log("\u{1F527} Alguns campos do formul\xE1rio inicial foram migrados em mem\xF3ria")}Object.entries(this.phaseFormConfigs||{}).forEach(([t,e])=>{if(e?.fields){let i=!1;e.fields.forEach(n=>{"showInFilters"in n?console.log(`\u2705 Campo ${n.name} da fase ${t} j\xE1 tem showInFilters: ${n.showInFilters}`):(n.showInFilters=!1,i=!0,console.log(`\u{1F527} Adicionado showInFilters: false ao campo ${n.name} da fase ${t} (campo antigo)`))}),console.log(i?`\u{1F527} Alguns campos da fase ${t} foram migrados em mem\xF3ria`:`\u2705 Todos os campos da fase ${t} j\xE1 t\xEAm showInFilters`)}})}loadAvailableFilterFields(){this.migrateFieldsToIncludeShowInFilters();let t=[];this.initialFormFields?this.initialFormFields.forEach((e,i)=>{if(e.name&&e.type&&e.showInFilters){let n={name:e.name,label:e.label||e.name,type:e.type,source:"initial"};t.push(n)}}):console.log("\u26A0\uFE0F Nenhum initialFormFields encontrado"),Object.entries(this.phaseFormConfigs||{}).forEach(([e,i])=>{i?.fields&&i.fields.forEach((n,r)=>{if(n.name&&n.type&&n.showInFilters&&!t.find(d=>d.name===n.name)){let d={name:n.name,label:n.label||n.name,type:n.type,source:"phase",phaseId:e};t.push(d)}})}),this.availableFilterFields=t.filter(e=>["text","email","select","radio","checkbox","date","number","tel","cnpj","cpf","temperatura"].includes(e.type.toLowerCase()))}getFieldOptions(t){if(t.type==="select"||t.type==="radio"){let e=this.findOriginalField(t.name,t.source);if(e&&e.options&&Array.isArray(e.options))return e.options}if(t.type==="temperatura"){let e=this.findOriginalField(t.name,t.source);return e&&e.options&&Array.isArray(e.options)?e.options:["Quente","Morno","Frio"]}return this.getUniqueValuesFromLeads(t.name)}findOriginalField(t,e){if(e==="initial")return this.initialFormFields?.find(i=>i.name===t);if(e==="phase")for(let i of Object.values(this.phaseFormConfigs||{})){let n=i?.fields?.find(r=>r.name===t);if(n)return n}return null}getUniqueValuesFromLeads(t){let e=new Set;return this.leads.forEach(i=>{let n=this.getLeadFieldValue(i,t);n!=null&&n!==""&&e.add(String(n))}),Array.from(e).sort()}leadMatchesFilters(t){if(this.filterOnlyMine){let e=this.currentUser?.email,i=this.currentUser?.uid,n=t.responsibleUserEmail,r=t.responsibleUserId;if(!(e&&n&&n.toLowerCase()===e.toLowerCase()||i&&r&&r===i))return!1}if(this.filterQuery&&this.filterQuery.trim()){let e=this.filterQuery.toLowerCase().trim(),i=t.fields||{},n=[t.responsibleUserName,t.responsibleUserEmail];i&&typeof i=="object"&&Object.values(i).forEach(f=>{f!=null&&f!==""&&n.push(String(f))}),t.phaseHistory&&typeof t.phaseHistory=="object"&&Object.values(t.phaseHistory).forEach(f=>{f&&typeof f=="object"&&Object.values(f).forEach(h=>{h!=null&&h!==""&&n.push(String(h))})});let r=n.filter(f=>f!=null&&f!=="").map(f=>String(f).toLowerCase()).join(" ");if(!e.split(" ").filter(f=>f.length>0).every(f=>r.includes(f)))return!1}for(let[e,i]of Object.entries(this.dynamicFilters)){if(!i||i==="")continue;let n=this.getLeadFieldValue(t,e);if(n==null||n==="")return!1;let r=this.availableFilterFields.find(d=>d.name===e);if(r&&!this.matchesDynamicFilter(n,i,r.type))return!1}return!0}getLeadFieldValue(t,e){if(!t||!e)return;if(t.fields&&t.fields[e]!==void 0)return t.fields[e];if(t.phaseHistory){for(let[n,r]of Object.entries(t.phaseHistory))if(r&&typeof r=="object"&&r[e]!==void 0)return r[e]}let i=t;if(i[e]!==void 0)return i[e]}matchesDynamicFilter(t,e,i){if(!t&&!e)return!0;if(!t||!e)return!1;let n=String(t).toLowerCase(),r=String(e).toLowerCase();switch(i.toLowerCase()){case"text":case"email":case"tel":return n.includes(r);case"select":case"radio":return n===r;case"checkbox":return e===!0?t===!0||t==="true"||t==="on":!0;case"number":let d=parseFloat(t),p=parseFloat(e);return!isNaN(d)&&!isNaN(p)&&d===p;case"date":try{let f=new Date(t).toDateString(),h=new Date(e).toDateString();return f===h}catch{return!1}default:return n.includes(r)}}applyFilters(){this.rebuildDisplayedLeads(),this.cdr.detectChanges(),this.saveFilterState()}saveFilterState(){if(this.boardId)try{let t={filterQuery:this.filterQuery,filterOnlyMine:this.filterOnlyMine,dynamicFilters:this.dynamicFilters};localStorage.setItem(`kanban-filters-${this.boardId}`,JSON.stringify(t))}catch(t){console.warn("Could not save filter state to localStorage:",t)}}loadFilterState(){if(this.boardId)try{let t=localStorage.getItem(`kanban-filters-${this.boardId}`);if(t){let e=JSON.parse(t);this.filterQuery=e.filterQuery||"",this.filterOnlyMine=e.filterOnlyMine||!1,this.dynamicFilters=e.dynamicFilters||{}}}catch(t){console.warn("Could not load filter state from localStorage:",t)}}hasActiveFilters(){let t=Object.keys(this.dynamicFilters).some(e=>this.dynamicFilters[e]&&this.dynamicFilters[e]!=="");return!!(this.filterQuery||this.filterOnlyMine||t)}setDynamicFilter(t,e){e==null||e===""?delete this.dynamicFilters[t]:this.dynamicFilters[t]=e,this.applyFilters()}onDynamicFilterChange(t,e){let i=e.target.value;this.setDynamicFilter(t,i)}getDynamicFilterValue(t){return this.dynamicFilters[t]||""}removeDynamicFilter(t){delete this.dynamicFilters[t],this.applyFilters()}getActiveDynamicFiltersCount(){return Object.keys(this.dynamicFilters).filter(t=>this.dynamicFilters[t]&&this.dynamicFilters[t]!=="").length}updateEmailStatusCounts(){let t={all:this.outboxEmails.length,scheduled:this.outboxEmails.filter(e=>!e.delivery||e.delivery.state==="PENDING").length,success:this.outboxEmails.filter(e=>e.delivery?.state==="SUCCESS").length,error:this.outboxEmails.filter(e=>e.delivery?.state==="ERROR").length};this.emailStatuses=[{id:"all",name:"Todos",count:t.all},{id:"scheduled",name:"Na Fila",count:t.scheduled},{id:"success",name:"Enviados",count:t.success},{id:"error",name:"Com Erro",count:t.error}]}getFilteredEmails(){return this.activeEmailStatus==="all"?this.outboxEmails:this.outboxEmails.filter(t=>{switch(this.activeEmailStatus){case"scheduled":return!t.delivery||t.delivery.state==="PENDING";case"success":return t.delivery?.state==="SUCCESS";case"error":return t.delivery?.state==="ERROR";default:return!1}})}getEmailStatusLabel(t){if(!t.delivery)return"Na Fila";switch(t.delivery.state){case"SUCCESS":return"Enviado";case"ERROR":return"Erro";case"PENDING":return"Na Fila";default:return t.delivery.state||"Desconhecido"}}viewEmail(t){let e=t.delivery?.endTime?new Date(t.delivery.endTime.seconds*1e3).toLocaleString("pt-BR"):"---",i=t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleString("pt-BR"):"---";alert(`Visualizar Email:

Para: ${t.to||"N\xE3o especificado"}
Assunto: ${t.subject||"Sem assunto"}
Status: ${this.getEmailStatusLabel(t)}
Criado em: ${i}
Enviado em: ${e}

Conte\xFAdo:
${t.html||t.text||"Sem conte\xFAdo dispon\xEDvel"}`)}retryEmail(t){return D(this,null,function*(){try{yield this.firestoreService.updateOutboxEmail(this.ownerId,this.boardId,t.id,{status:"scheduled",scheduledAt:new Date,retryCount:(t.retryCount||0)+1}),console.log("Email reagendado para reenvio");try{this.toast.success("Email reagendado para reenvio.")}catch{}}catch(e){console.error("Erro ao reenviar email:",e);try{this.toast.error("Erro ao reenviar email. Tente novamente.")}catch{}}})}showOutboxDeleteConfirm=!1;emailPendingDelete=null;openOutboxDeleteConfirm(t,e){e&&(e.preventDefault(),e.stopPropagation()),this.emailPendingDelete=t,this.showOutboxDeleteConfirm=!0}cancelOutboxDelete(){this.showOutboxDeleteConfirm=!1,this.emailPendingDelete=null}confirmOutboxDelete(){return D(this,null,function*(){if(this.emailPendingDelete)try{let t=this.emailPendingDelete;yield this.firestoreService.deleteOutboxEmail(this.ownerId,this.boardId,t.id),console.log("Email exclu\xEDdo com sucesso");try{this.toast.success("Mensagem exclu\xEDda.")}catch{}}catch(t){console.error("Erro ao excluir email:",t);try{this.toast.error("Erro ao excluir mensagem. Tente novamente.")}catch{}}finally{this.cancelOutboxDelete()}})}showCreateColumnModal(){this.columnModal.showCreateModal()}editColumn(t){this.columnModal.showEditModal(t)}onPhaseCardClick(t,e){let i=this.getColumnById(t);i&&this.editColumn(i)}deleteColumn(t){return D(this,null,function*(){if(confirm(`Tem certeza que deseja excluir a fase "${t.name}"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.`))try{yield this.firestoreService.deleteColumn(this.ownerId,this.boardId,t.id),console.log("Fase exclu\xEDda com sucesso")}catch(e){console.error("Erro ao excluir fase:",e),alert("Erro ao excluir fase. Tente novamente.")}})}onColumnCreated(){console.log("Nova fase criada!")}onColumnUpdated(){console.log("Fase atualizada!")}onColumnDeleted(){console.log("Fase exclu\xEDda!");try{this.syncFlowOrderWithColumns(),this.updateFlowThumb()}catch{}}onDragEntered(){console.log("\u{1F504} Drag entered flow area")}onDragExited(){console.log("\u{1F504} Drag exited flow area")}onDragStarted(t){let e=this.getColumnById(t)?.name,i=this.flowOrder.indexOf(t);console.log("\u{1F504} Drag started for phase:",e,"at index:",i)}onDragEnded(t){console.log("\u{1F504} Drag ended for phase:",this.getColumnById(t)?.name)}movePhaseUp(t,e){return D(this,null,function*(){e.stopPropagation(),!(t<=0)&&(console.log("\u2B05\uFE0F Movendo fase para esquerda:",{from:t,to:t-1,phaseName:this.getColumnById(this.flowOrder[t])?.name}),yield this.movePhase(t,t-1))})}movePhaseDown(t,e){return D(this,null,function*(){e.stopPropagation(),!(t>=this.flowOrder.length-1)&&(console.log("\u27A1\uFE0F Movendo fase para direita:",{from:t,to:t+1,phaseName:this.getColumnById(this.flowOrder[t])?.name}),yield this.movePhase(t,t+1))})}movePhase(t,e){return D(this,null,function*(){this.isManualReorder=!0;let i=[...this.flowOrder],n=this.flowOrder.splice(t,1)[0];this.flowOrder.splice(e,0,n),console.log("\u{1F504} Movimento executado:",{originalOrder:i.map((r,d)=>`${d}: ${this.getColumnById(r)?.name}`),newOrder:this.flowOrder.map((r,d)=>`${d}: ${this.getColumnById(r)?.name}`)}),this.cdr.detectChanges();try{let r=this.flowOrder.map((d,p)=>D(this,null,function*(){let f=this.columns.find(h=>h.id===d);f&&f.order!==p&&(console.log(`\u{1F4BE} Salvando ${f.name} na posi\xE7\xE3o ${p}`),yield this.firestoreService.updateColumn(this.ownerId,this.boardId,d,{order:p}),f.order=p)}));yield Promise.all(r),console.log("\u2705 Reordena\xE7\xE3o salva com sucesso!"),setTimeout(()=>{this.isManualReorder=!1},500)}catch(r){console.error("\u274C Erro ao salvar reordena\xE7\xE3o:",r),this.flowOrder=i,this.isManualReorder=!1,this.cdr.detectChanges()}})}showColumnForm(t){return D(this,null,function*(){try{let e=yield this.firestoreService.getPhaseFormConfig(this.ownerId,this.boardId,t.id);this.phaseFormModal.showModal(t,e||void 0)}catch(e){console.error("Erro ao carregar configura\xE7\xE3o do formul\xE1rio:",e),this.phaseFormModal.showModal(t,void 0)}})}onPhaseFormConfigSaved(){console.log("Configura\xE7\xE3o de formul\xE1rio salva! Recarregando campos de card por fase..."),this.loadCardFieldConfigs();try{this.toast.success("Configura\xE7\xE3o salva. Cards atualizados.")}catch{}}getSlaStatus(t){let e=this.columns.find(f=>f.id===t.columnId);if(!e||!e.slaDays||e.slaDays<=0||!t.movedToCurrentColumnAt)return{status:"none",text:"",colorClass:"",borderClass:""};let i=t.movedToCurrentColumnAt.seconds?new Date(t.movedToCurrentColumnAt.seconds*1e3):new Date(t.movedToCurrentColumnAt),n=new Date,d=new Date(i.getTime()+e.slaDays*24*60*60*1e3).getTime()-n.getTime(),p=d/(1e3*60*60*24);return p<0?{status:"overdue",text:`Atrasado ${Math.abs(Math.floor(p))}d`,colorClass:"text-red-600",borderClass:"border-l-red-500"}:p<e.slaDays*.25?{status:"at-risk",text:`${Math.ceil(d/36e5)}h restantes`,colorClass:"text-yellow-600",borderClass:"border-l-yellow-500"}:{status:"ok",text:`${Math.ceil(p)}d restantes`,colorClass:"text-green-600",borderClass:"border-l-green-500"}}getLeadStatusColor(t){let e=t.fields?.temperature;return e==="quente"?"bg-red-100 text-red-800":e==="morno"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}getTemperatureColorClass(t){let i=(n=>n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))(String(t||""));return i.includes("quente")||i.includes("hot")?"text-red-600":i.includes("morno")||i.includes("morna")||i.includes("warm")?"text-yellow-600":(i.includes("frio")||i.includes("fria")||i.includes("cold"),"text-blue-600")}getDaysSince(t){if(!t)return 0;let e;t.seconds?e=new Date(t.seconds*1e3):t.toDate?e=t.toDate():t instanceof Date?e=t:e=new Date(t);let i=Date.now()-e.getTime();return Math.max(0,Math.floor(i/(1e3*60*60*24)))}getLeadResponsibleName(t){return(t.responsibleUserName||t.responsibleUserEmail||"").toString()}getLeadDueDateLabel(t){let e=t.fields?.dueDate||t.dueDate;if(!e)return null;try{if(e.seconds)return new Date(e.seconds*1e3).toLocaleDateString("pt-BR");if(e.toDate)return e.toDate().toLocaleDateString("pt-BR");let i=new Date(e);return isNaN(i.getTime())?null:i.toLocaleDateString("pt-BR")}catch{return null}}getTriggerDescription(t){if(!t)return"N\xE3o especificado";let e=t.trigger?t.trigger:t,i={"new-lead-created":"Quando um novo lead \xE9 criado","card-enters-phase":"Quando lead entra em uma fase","card-in-phase-for-time":"Quando lead fica muito tempo na fase","form-not-answered":"Quando formul\xE1rio n\xE3o \xE9 respondido","sla-overdue":"Quando SLA da fase vence"},n=e.type||t.triggerType,r=i[n]||n||"N\xE3o especificado",d=e.phase||t.triggerPhase;if(d&&this.columns.length>0){let f=this.columns.find(h=>h.id===d);f&&(r+=` (${f.name})`)}let p=e.days||t.triggerDays;return p&&(r+=` (${p} dias)`),r}toggleAutomationStatus(t,e){return D(this,null,function*(){try{yield this.firestoreService.updateAutomation(this.ownerId,this.boardId,t,{active:!e})}catch(i){console.error("Erro ao alterar status da automa\xE7\xE3o:",i)}})}showAutomationDeleteConfirm=!1;automationPendingDelete=null;openDeleteAutomationConfirm(t,e){e&&(e.preventDefault(),e.stopPropagation()),this.automationPendingDelete=t,this.showAutomationDeleteConfirm=!0}cancelDeleteAutomation(){this.showAutomationDeleteConfirm=!1,this.automationPendingDelete=null}confirmDeleteAutomation(){return D(this,null,function*(){if(this.automationPendingDelete)try{let t=this.automationPendingDelete,e=t?.id||t?.docId||(t?.path?String(t.path).split("/").pop():null);if(!e){console.error("Automa\xE7\xE3o sem id para exclus\xE3o:",t),this.toast.error("N\xE3o foi poss\xEDvel identificar esta automa\xE7\xE3o. Atualize a p\xE1gina e tente novamente.");return}yield this.firestoreService.deleteAutomation(this.ownerId,this.boardId,e),this.toast.success("Automa\xE7\xE3o exclu\xEDda.")}catch(t){console.error("Erro ao excluir automa\xE7\xE3o:",t),this.toast.error("Erro ao excluir automa\xE7\xE3o.")}finally{this.cancelDeleteAutomation()}})}toggleAutomation(t){this.toggleAutomationStatus(t.id,t.active)}getActionsCount(t){return t?t.length:0}getValidAutomations(){return this.automations.filter(t=>t&&t.name&&t.name.trim()!==""&&t.name!=="Automa\xE7\xE3o sem nome")}cleanupInvalidAutomations(){return D(this,null,function*(){let t=this.automations.filter(e=>!e||!e.name||e.name.trim()===""||e.name==="Automa\xE7\xE3o sem nome");if(t.length>0){for(let e of t)if(e.id)try{yield this.firestoreService.deleteAutomation(this.ownerId,this.boardId,e.id)}catch(i){console.error("Erro ao remover automa\xE7\xE3o inv\xE1lida:",i)}}})}createTemplate(){this.templateModal.showCreateModal()}editTemplate(t){this.templateModal.showEditModal(t)}deleteTemplate(t){return D(this,null,function*(){if(confirm("Tem certeza que deseja excluir este template?"))try{yield this.firestoreService.deleteEmailTemplate(this.ownerId,this.boardId,t.id),console.log("Template exclu\xEDdo com sucesso!")}catch(e){console.error("Erro ao excluir template:",e)}})}onTemplateSaved(){}showAutomationModal=!1;selectedAutomation=null;showHistoryModal=!1;selectedAutomationForHistory=null;createAutomation(t){t&&(t.preventDefault(),t.stopPropagation()),console.log("=== BOT\xC3O NOVA AUTOMA\xC7\xC3O CLICADO ==="),this.selectedAutomation=null,this.showAutomationModal=!0}editAutomation(t,e){e&&(e.preventDefault(),e.stopPropagation()),this.selectedAutomation=JSON.parse(JSON.stringify(t)),this.showAutomationModal=!0}onCloseAutomationModal(){this.showAutomationModal=!1,this.selectedAutomation=null}onSaveAutomation(t){return D(this,null,function*(){try{let e=n=>{let r={};return Object.keys(n||{}).forEach(d=>{let p=n[d];p!==void 0&&(r[d]=p)}),r},i=e(R({},t));delete i.id,Array.isArray(i.actions)&&(i.actions=i.actions.map(n=>e(n))),t.id?yield this.firestoreService.updateAutomation(this.ownerId,this.boardId,t.id,i):yield this.firestoreService.createAutomation(this.ownerId,this.boardId,i),this.toast.success("Automa\xE7\xE3o salva com sucesso."),this.onCloseAutomationModal()}catch(e){console.error("Erro ao salvar automa\xE7\xE3o:",e),this.toast.error("Erro ao salvar automa\xE7\xE3o. Tente novamente.")}})}showAutomationHistory(t,e){e&&(e.preventDefault(),e.stopPropagation()),this.selectedAutomationForHistory=t,this.showHistoryModal=!0}onCloseHistoryModal(){this.showHistoryModal=!1,this.selectedAutomationForHistory=null}clearOutbox(){return D(this,null,function*(){if(confirm("Deseja excluir todos os emails da caixa de sa\xEDda? Esta a\xE7\xE3o n\xE3o pode ser desfeita."))try{yield this.firestoreService.clearOutboxEmails(this.ownerId,this.boardId),console.log("\u2705 Caixa de sa\xEDda limpa com sucesso")}catch(t){console.error("\u274C Erro ao limpar caixa de sa\xEDda:",t),alert("Erro ao limpar caixa de sa\xEDda. Tente novamente.")}})}onFilterQueryChange(t){this.filterQuery=t,this.applyFilters()}toggleAdvancedFilters(){this.showAdvancedFilters=!this.showAdvancedFilters}getDynamicFilterCount(){return Object.keys(this.dynamicFilters).filter(t=>this.dynamicFilters[t]&&this.dynamicFilters[t]!=="").length}copyToClipboard(t){navigator.clipboard.writeText(t).then(()=>{console.log("Texto copiado:",t)}).catch(e=>{console.error("Erro ao copiar texto:",e)})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-kanban"]],viewQuery:function(e,i){if(e&1&&(Ce(pt,5),Ce(ft,5),Ce(gt,5),Ce(ht,5),Ce(_t,5),Ce(vt,5),Ce(Us,5)),e&2){let n;we(n=Ee())&&(i.leadModal=n.first),we(n=Ee())&&(i.columnModal=n.first),we(n=Ee())&&(i.phaseFormModal=n.first),we(n=Ee())&&(i.leadDetailModal=n.first),we(n=Ee())&&(i.templateModal=n.first),we(n=Ee())&&(i.automationModal=n.first),we(n=Ee())&&(i.flowScrollerRef=n.first)}},hostBindings:function(e,i){e&1&&x("mouseup",function(r){return i.onWindowMouseUp(r)},It)("touchend",function(r){return i.onWindowTouchEnd(r)},It)("resize",function(){return i.onWindowResizeFlow()},It)},decls:24,vars:37,consts:[["flowScroller",""],["flowCustomBar",""],["noConnections",""],["class","flex justify-center items-center py-20",4,"ngIf"],["class","bg-white px-4 md:px-8 border-b border-gray-200 sticky top-0 z-30",4,"ngIf"],["class","fixed top-20 left-4 w-full max-w-lg bg-white rounded-xl shadow-xl border border-gray-200 z-[9999]",4,"ngIf"],["class","kanban-board desktop-board",4,"ngIf"],["class","fixed left-4 bottom-4 z-40 bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-full shadow-lg flex items-center gap-2",3,"click",4,"ngIf"],["class","p-4 md:p-8",4,"ngIf"],["class","text-center py-20",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",3,"click",4,"ngIf"],[4,"ngIf"],["class","mobile-board",4,"ngIf"],[3,"leadCreated","leadUpdated","closeModal","ownerId","boardId","columns"],[3,"columnCreated","columnUpdated","columnDeleted","closeModal","ownerId","boardId","columns"],[3,"formConfigSaved","closeModal","ownerId","boardId"],[3,"leadUpdated","leadDeleted","closeModal","ownerId","boardId","columns","users"],[3,"templateSaved","closeModal","ownerId","boardId"],[3,"isVisible","automation","phases","allowedTriggerTypes","fixedPhaseId","allowedTransitions","emailTemplates","users","closeModalEvent","saveAutomation",4,"ngIf"],[3,"closeModalEvent","isVisible","automationId","automationName","ownerId","boardId","leads"],[1,"flex","justify-center","items-center","py-20"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"bg-white","px-4","md:px-8","border-b","border-gray-200","sticky","top-0","z-30"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","space-x-4"],[1,"flex","items-center","space-x-3"],[1,"text-gray-500","hover:text-gray-700","p-1","rounded","hover:bg-gray-100","transition-colors",3,"click"],[1,"fas","fa-arrow-left"],["class","relative",4,"ngIf"],[1,"hidden","md:flex","space-x-8"],["class","py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",3,"border-blue-500","text-blue-600","border-transparent","text-gray-500","hover:text-gray-700","click",4,"ngFor","ngForOf"],[1,"hidden","md:flex","items-center","space-x-2"],["class","px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 border border-red-300 rounded text-xs transition-colors",3,"click",4,"ngIf"],[1,"relative"],["type","text","placeholder","Pesquisar...",1,"w-64","pl-8","pr-10","py-1.5","text-sm","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"fas","fa-search","absolute","left-2.5","top-1/2","transform","-translate-y-1/2","text-gray-400","text-xs"],[1,"absolute","right-2","top-1/2","transform","-translate-y-1/2","p-1","hover:bg-gray-100","rounded","transition-colors",3,"click"],[1,"fas","fa-filter","text-xs"],["class","absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center","style","font-size: 8px;",4,"ngIf"],[1,"absolute","-top-1","-right-1","bg-blue-500","text-white","text-xs","rounded-full","w-3","h-3","flex","items-center","justify-center",2,"font-size","8px"],[1,"py-4","px-1","border-b-2","font-medium","text-sm","transition-colors","duration-200",3,"click"],[1,"px-2","py-1","bg-red-100","hover:bg-red-200","text-red-700","border","border-red-300","rounded","text-xs","transition-colors",3,"click"],[1,"fas","fa-times","mr-1"],[1,"fixed","top-20","left-4","w-full","max-w-lg","bg-white","rounded-xl","shadow-xl","border","border-gray-200","z-[9999]"],[1,"p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"fas","fa-times"],[1,"mb-6","p-3","bg-gray-50","rounded-lg"],[1,"flex","items-center","space-x-2","cursor-pointer"],["type","checkbox",1,"rounded","border-gray-300","text-blue-600","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-700","font-medium"],["class","space-y-4",4,"ngIf"],["class","text-center py-6",4,"ngIf"],[1,"flex","justify-end","space-x-3","mt-6","pt-4","border-t","border-gray-200"],[1,"px-4","py-2","text-gray-600","bg-gray-100","hover:bg-gray-200","rounded-lg","transition-colors",3,"click"],[1,"px-4","py-2","bg-blue-600","hover:bg-blue-700","text-white","rounded-lg","transition-colors",3,"click"],[1,"space-y-4"],[1,"text-sm","font-medium","text-gray-700","mb-3"],["class","space-y-2",4,"ngFor","ngForOf"],[1,"space-y-2"],[1,"block","text-sm","font-medium","text-gray-700"],["class","w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",3,"type","value","placeholder","input",4,"ngIf"],["type","date","class","w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",3,"value","input",4,"ngIf"],["class","w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",3,"value","change",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"input","type","value","placeholder"],["type","date",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"input","value"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["value","Quente"],["value","Morno"],["value","Frio"],[1,"flex","items-center","space-x-2"],["type","checkbox",1,"rounded","border-gray-300","text-blue-600","focus:ring-blue-500",3,"change","checked"],[1,"text-sm","text-gray-700"],[1,"text-center","py-6"],[1,"fas","fa-filter","text-gray-300","text-3xl","mb-3"],[1,"text-gray-500","text-sm"],[1,"kanban-board","desktop-board"],["class","kanban-column",3,"background-color",4,"ngFor","ngForOf"],[1,"kanban-column"],[1,"kanban-column-header"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"font-semibold","text-gray-800"],[1,"ml-2","bg-gray-200","text-gray-600","text-xs","px-2","py-1","rounded-full"],["class","ml-2 inline-flex items-center text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800","title","Automa\xE7\xF5es ativas nesta fase",4,"ngIf"],["cdkDropList","",1,"kanban-cards",3,"cdkDropListDropped","id","cdkDropListData","cdkDropListConnectedTo"],["class","bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 cursor-pointer mb-3 p-4 border-l-4","cdkDrag","",3,"class","cdkDragDisabled","cdkDragData","cdkDragStarted","cdkDragEnded","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center py-6 text-gray-400",4,"ngIf"],["title","Automa\xE7\xF5es ativas nesta fase",1,"ml-2","inline-flex","items-center","text-xs","px-2","py-1","rounded-full","bg-yellow-100","text-yellow-800"],[1,"fas","fa-bolt","mr-1"],["cdkDrag","",1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","hover:shadow-md","transition-all","duration-200","cursor-pointer","mb-3","p-4","border-l-4",3,"cdkDragStarted","cdkDragEnded","click","cdkDragDisabled","cdkDragData"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900","text-sm","truncate","mb-1"],["class","text-xs text-gray-500",4,"ngIf"],[1,"space-y-2","mb-3"],["class","text-xs",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"flex","items-center","gap-3","text-xs","text-gray-500"],["class","flex items-center",4,"ngIf"],[1,"flex","items-center","text-xs","text-gray-500"],[1,"far","fa-calendar-alt","w-3","h-3","mr-1"],["class","mt-2 pt-2 border-t border-gray-100",4,"ngIf"],[1,"text-xs","text-gray-500"],[1,"text-xs"],[1,"font-medium","text-gray-600","mb-0.5"],[1,"text-gray-900","truncate"],[1,"mb-3"],[1,"flex","items-center","text-xs","font-medium"],[1,"fas","fa-clock","w-3","h-3","mr-1"],[1,"w-2","h-2","rounded-full","mr-1",3,"ngClass"],[1,"far","fa-comment","mr-1"],[1,"fas","fa-paperclip","mr-1"],[1,"mt-2","pt-2","border-t","border-gray-100"],[1,"text-xs","text-gray-600","line-clamp-2"],[1,"text-center","py-6","text-gray-400"],[1,"fas","fa-inbox","text-2xl","mb-2"],[1,"text-sm"],[1,"fixed","left-4","bottom-4","z-40","bg-green-500","hover:bg-green-600","text-white","px-4","py-3","rounded-full","shadow-lg","flex","items-center","gap-2",3,"click"],[1,"fas","fa-plus"],[1,"p-4","md:p-8"],[1,"max-w-4xl","mx-auto"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[3,"fieldsChanged","fields"],[1,"flex","justify-end","mt-6"],[1,"px-4","py-2","text-white","rounded-lg",3,"click"],[1,"text-center","py-20"],[1,"max-w-md","mx-auto"],[1,"fas","fa-columns","text-6xl","text-gray-300","mb-4"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"fas","fa-plus","mr-2"],["class","grid gap-4",4,"ngIf"],["class","bg-white rounded-lg shadow p-6",4,"ngIf"],[1,"grid","gap-4"],["class","bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",4,"ngFor","ngForOf"],[1,"bg-white","border","border-gray-200","rounded-lg","p-6","hover:shadow-md","transition-shadow"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-3"],[1,"text-xs","text-gray-500","mb-4"],[1,"flex","items-center","text-xs","text-gray-500","space-x-4"],[1,"far","fa-calendar-alt","mr-1"],[1,"flex","items-center","space-x-2","ml-4"],[1,"text-blue-600","hover:text-blue-800","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-edit","mr-1"],[1,"text-red-600","hover:text-red-800","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-trash","mr-1"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-center","py-12","text-gray-500"],[1,"fas","fa-envelope","text-6xl","mb-4"],[1,"text-xl","font-semibold","mb-2"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"flex","items-center","mb-2"],[1,"text-lg","font-semibold","text-gray-900","mr-3"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"space-y-2","mb-4"],[1,"text-sm","text-gray-600"],[1,"fas","fa-bolt","mr-2"],[1,"fas","fa-play","mr-2"],["title","Ver Hist\xF3rico",1,"text-gray-500","hover:text-blue-600","px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","fa-history","mr-1"],[1,"px-3","py-1","text-sm","font-medium",3,"click"],[1,"fas","mr-1"],[1,"fas","fa-play","mr-1"],[1,"fas","fa-cogs","text-6xl","mb-4"],[1,"w-full","mx-auto"],[1,"flex","items-center","gap-2"],["title","Nova fase",1,"bg-gray-400","hover:bg-gray-500","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"fas","fa-save","mr-2"],[1,"relative","w-full"],[1,"flow-scroll"],["cdkDropList","",1,"inline-flex","items-center","gap-6","p-2","whitespace-nowrap","min-w-max","flow-row","w-max",3,"cdkDropListDropped","cdkDropListEntered","cdkDropListExited","cdkDropListData"],[4,"ngFor","ngForOf"],[1,"flow-custombar","mt-1",3,"mousedown","touchstart"],[1,"flow-thumb"],["class","mt-4 p-4 border rounded-lg bg-white shadow",4,"ngIf"],["cdkDrag","",1,"min-w-[300px]","max-w-[340px]","flow-phase-card","cursor-pointer",3,"cdkDragStarted","cdkDragEnded","click"],[1,"px-3","py-2","bg-gray-50","rounded-t-lg","flex","items-center","justify-between"],[1,"font-medium","text-gray-800","truncate"],["class","p-1 text-gray-400 hover:text-blue-600 transition-colors","title","Mover para esquerda",3,"click",4,"ngIf"],["class","p-1 text-gray-400 hover:text-blue-600 transition-colors","title","Mover para direita",3,"click",4,"ngIf"],["cdkDragHandle","","title","Arraste para reordenar",1,"fas","fa-grip-vertical","text-gray-400"],[1,"p-3","text-sm","space-y-3"],["class","pt-0",4,"ngIf","ngIfElse"],[1,"pt-2","border-t","border-gray-100","flex","items-center","justify-end","gap-3","text-base"],["title","Formul\xE1rio da fase",1,"text-blue-600","hover:text-blue-700",3,"click"],[1,"fas","fa-list-check"],["title","Automa\xE7\xF5es da fase",1,"text-purple-600","hover:text-purple-700",3,"click"],[1,"fas","fa-gears"],["class","text-indigo-600 hover:text-indigo-700","title","Iniciar conex\xE3o",3,"click",4,"ngIf"],["class","text-indigo-600 hover:text-indigo-700","title","Conectar aqui",3,"click",4,"ngIf"],["title","Mover para esquerda",1,"p-1","text-gray-400","hover:text-blue-600","transition-colors",3,"click"],[1,"fas","fa-chevron-left","text-xs"],["title","Mover para direita",1,"p-1","text-gray-400","hover:text-blue-600","transition-colors",3,"click"],[1,"fas","fa-chevron-right","text-xs"],[1,"pt-0"],[1,"text-xs","text-gray-500","mb-1"],[1,"space-y-1"],["class","flex items-center justify-between text-xs",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","text-xs"],[1,"truncate"],["title","Remover",1,"text-red-600","hover:text-red-700",3,"click"],[1,"fas","fa-xmark"],[1,"text-xs","text-gray-400"],["title","Iniciar conex\xE3o",1,"text-indigo-600","hover:text-indigo-700",3,"click"],[1,"fas","fa-circle-dot"],["title","Conectar aqui",1,"text-indigo-600","hover:text-indigo-700",3,"click"],[1,"fas","fa-bullseye"],[1,"mt-4","p-4","border","rounded-lg","bg-white","shadow"],[1,"flex","justify-between","items-center","mb-3"],[1,"font-semibold"],[1,"text-gray-600","hover:text-gray-900",3,"click"],["class","p-3 border rounded",4,"ngFor","ngForOf"],[1,"pt-2"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-3","py-2","rounded","text-sm",3,"click"],[1,"fas","fa-plus","mr-1"],[1,"p-3","border","rounded"],[1,"font-medium"],[1,"text-xs","flex","items-center","gap-1"],["type","checkbox",3,"change","checked"],[1,"text-blue-600","text-sm",3,"click"],[1,"text-red-600","text-sm",3,"click"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-[60]",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","p-6",3,"click"],[1,"text-lg","font-bold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-6"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","rounded-lg","border","border-gray-300",3,"click"],[1,"px-4","py-2","rounded-lg","bg-red-600","text-white",3,"click"],[3,"boardId","ownerId"],[1,"max-w-6xl","mx-auto"],[1,"flex","space-x-2"],[1,"bg-red-500","hover:bg-red-600","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"fas","fa-trash","mr-2"],[1,"bg-white","rounded-lg","shadow"],[1,"border-b","border-gray-200"],[1,"flex","space-x-8","px-6"],["class","py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",3,"border-blue-500","text-blue-600","border-transparent","text-gray-500","click",4,"ngFor","ngForOf"],["class","text-center py-12 text-gray-500",4,"ngIf"],[1,"fas","fa-paper-plane","text-6xl","mb-4"],["class","border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-gray-900"],[1,"px-2","py-1","text-xs","rounded-full"],[1,"mt-2","flex","items-center","space-x-4","text-sm","text-gray-500"],[1,"fas","fa-envelope","mr-1"],[1,"fas","fa-clock","mr-1"],[1,"text-blue-600","hover:text-blue-800",3,"click"],[1,"fas","fa-eye"],["class","text-green-600 hover:text-green-800",3,"click",4,"ngIf"],[1,"text-red-600","hover:text-red-800",3,"click"],[1,"fas","fa-trash"],[1,"text-green-600","hover:text-green-800",3,"click"],[1,"fas","fa-redo"],[1,"px-2","py-1","bg-green-100","text-green-800","text-xs","font-medium","rounded"],[1,"fas","fa-check-circle","mr-1"],[1,"bg-white","rounded-lg","shadow","mb-6"],[1,"p-6","border-b","border-gray-200"],[1,"fas","fa-link","mr-2","text-blue-500"],[1,"text-sm","text-gray-600","mb-4"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-blue-600","hover:text-blue-800","text-sm",3,"click"],[1,"fas","fa-copy","mr-1"],[1,"bg-blue-50","text-blue-800","text-sm","p-2","rounded","border","block"],[1,"text-md","font-semibold","text-gray-900","mb-2"],[1,"fas","fa-key","mr-2","text-yellow-500"],[1,"bg-gray-100","px-1","rounded"],[1,"bg-yellow-50","text-yellow-800","text-sm","p-2","rounded","border","block","font-mono"],[1,"fas","fa-code","mr-2","text-green-500"],[1,"bg-gray-900","text-gray-100","rounded-lg","p-4","overflow-x-auto"],[1,"fas","fa-broadcast-tower","mr-2","text-purple-500"],[1,"text-center","py-8","text-gray-500"],[1,"fas","fa-construction","text-4xl","mb-3"],[1,"font-semibold","mb-2"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-6"],[1,"text-lg","font-semibold","text-blue-900","mb-3"],[1,"fas","fa-book","mr-2"],[1,"space-y-3","text-sm","text-blue-800"],[1,"flex","items-start","space-x-3"],[1,"fas","fa-check-circle","mt-0.5","text-blue-600"],[1,"mobile-board"],[1,"p-4","space-y-3"],[1,"flex","gap-2","overflow-x-auto","pb-2"],[1,"relative","flex-1","max-w-xs"],["type","text","placeholder","Buscar nos cards...",1,"w-full","pl-8","pr-10","py-2","border","border-gray-300","rounded-full","text-sm","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","bg-gray-50","focus:bg-white",3,"ngModelChange","input","ngModel"],[1,"fas","fa-search","absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400","text-xs"],[1,"absolute","right-2","top-1/2","transform","-translate-y-1/2","p-1","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],[1,"fas","fa-sliders-h","text-xs"],["class","absolute -top-1 -right-1 bg-blue-500 text-white rounded-full w-3 h-3 flex items-center justify-center text-xs",4,"ngIf"],["class","absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1",3,"click",4,"ngIf"],["class","px-3 py-2 bg-red-100 text-red-700 rounded-full text-sm hover:bg-red-200 transition-colors flex items-center gap-1",3,"click",4,"ngIf"],["class","bg-gray-50 rounded-lg p-4 space-y-3 border",4,"ngIf"],["class","mt-2 text-xs text-blue-600 flex items-center gap-1",4,"ngIf"],["class","rounded-2xl border border-gray-200 bg-white",4,"ngFor","ngForOf"],[1,"mt-4","space-y-3"],["class","bg-white rounded-2xl border border-gray-200 p-4 shadow-sm",4,"ngFor","ngForOf"],[1,"fixed","bottom-4","inset-x-4","z-40","md:hidden"],[1,"w-full","h-12","bg-blue-600","hover:bg-blue-700","text-white","rounded-2xl","font-semibold","shadow-lg","flex","items-center","justify-center","gap-2",3,"click"],[1,"inline-flex","w-6","h-6","items-center","justify-center","bg-blue-700/60","rounded-full"],[1,"fas","fa-plus","text-xs"],[1,"absolute","-top-1","-right-1","bg-blue-500","text-white","rounded-full","w-3","h-3","flex","items-center","justify-center","text-xs"],[1,"absolute","right-8","top-1/2","transform","-translate-y-1/2","text-gray-400","hover:text-gray-600","p-1",3,"click"],[1,"fas","fa-times","text-xs"],[1,"px-3","py-2","bg-red-100","text-red-700","rounded-full","text-sm","hover:bg-red-200","transition-colors","flex","items-center","gap-1",3,"click"],[1,"bg-gray-50","rounded-lg","p-4","space-y-3","border"],[1,"text-sm","font-medium","text-gray-700","flex","items-center","gap-2"],[1,"fas","fa-filter","text-purple-600"],[1,"text-gray-400","hover:text-gray-600","p-1",3,"click"],[1,"grid","grid-cols-1","gap-3"],["class","flex items-center gap-3",4,"ngFor","ngForOf"],["class","text-xs text-purple-600 flex items-center gap-1 pt-2 border-t",4,"ngIf"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-600","min-w-0","flex-1"],["type","text","class","flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",3,"placeholder","value","input",4,"ngIf"],["type","number","class","flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",3,"placeholder","value","input",4,"ngIf"],["type","date","class","flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",3,"value","change",4,"ngIf"],["class","flex items-center gap-2 flex-1",4,"ngIf"],["class","flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",3,"value","change",4,"ngIf"],["class","p-1 text-red-400 hover:text-red-600 transition-colors",3,"click",4,"ngIf"],["type","text",1,"flex-1","px-2","py-1","border","border-gray-300","rounded","text-sm","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"input","placeholder","value"],["type","number",1,"flex-1","px-2","py-1","border","border-gray-300","rounded","text-sm","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"input","placeholder","value"],["type","date",1,"flex-1","px-2","py-1","border","border-gray-300","rounded","text-sm","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"change","value"],[1,"flex","items-center","gap-2","flex-1"],["type","checkbox",1,"rounded","border-gray-300","text-purple-600","focus:ring-purple-500",3,"change","checked"],[1,"flex-1","px-2","py-1","border","border-gray-300","rounded","text-sm","focus:ring-2","focus:ring-purple-500","focus:border-transparent",3,"change","value"],[1,"p-1","text-red-400","hover:text-red-600","transition-colors",3,"click"],[1,"text-xs","text-purple-600","flex","items-center","gap-1","pt-2","border-t"],[1,"fas","fa-info-circle"],[1,"mt-2","text-xs","text-blue-600","flex","items-center","gap-1"],[1,"fas","fa-filter"],[1,"bg-blue-100","text-blue-700","px-2","py-0.5","rounded-full"],[1,"rounded-2xl","border","border-gray-200","bg-white"],[1,"w-full","px-4","py-3","flex","items-center","justify-between",3,"click"],[1,"inline-block","w-3","h-3","rounded-full"],[1,"text-sm","text-gray-500"],[1,"fas"],["class","px-4 pb-4",4,"ngIf"],[1,"px-4","pb-4"],[1,"space-y-3"],["class","bg-white rounded-xl border border-gray-100 p-4 shadow-sm",4,"ngFor","ngForOf"],["class","text-center text-gray-400 text-sm py-2",4,"ngIf"],[1,"bg-white","rounded-xl","border","border-gray-100","p-4","shadow-sm"],[1,"text-base","font-bold","text-gray-900","mb-1"],["class","text-[13px] text-gray-500 mb-2",4,"ngIf"],["class","text-sm text-gray-700",4,"ngIf"],[1,"mt-3","flex","items-center","gap-5","text-xs","text-gray-500"],[1,"flex","items-center","gap-1"],[1,"far","fa-comment"],[1,"far","fa-clock","text-orange-400"],[1,"fas","fa-history","text-blue-500"],["class","flex items-center gap-1",4,"ngIf"],[1,"text-[13px]","text-gray-500","mb-2"],[1,"uppercase","tracking-wide","text-gray-400","text-[11px]"],[1,"far","fa-calendar-check","text-green-500"],[1,"text-center","text-gray-400","text-sm","py-2"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-4","shadow-sm"],[3,"closeModalEvent","saveAutomation","isVisible","automation","phases","allowedTriggerTypes","fixedPhaseId","allowedTransitions","emailTemplates","users"]],template:function(e,i){e&1&&(a(0,"app-main-layout"),b(1,qs,2,0,"div",3)(2,Ys,11,3,"nav",4)(3,sl,19,3,"div",5)(4,xl,2,1,"div",6)(5,yl,3,0,"button",7)(6,Cl,8,3,"div",8)(7,wl,7,0,"div",9)(8,Dl,10,2,"div",8)(9,Ol,10,2,"div",8)(10,Kl,21,7,"div",8)(11,Hl,14,1,"div",10)(12,ql,2,2,"div",11)(13,Jl,16,3,"div",8)(14,Xl,11,0,"div",10)(15,ed,104,5,"div",8)(16,Id,23,18,"div",12),s(),a(17,"app-lead-modal",13),x("leadCreated",function(){return i.onLeadCreated()})("leadUpdated",function(){return i.onLeadUpdated()})("closeModal",function(){return i.onLeadUpdated()}),s(),a(18,"app-column-modal",14),x("columnCreated",function(){return i.onColumnCreated()})("columnUpdated",function(){return i.onColumnUpdated()})("columnDeleted",function(){return i.onColumnDeleted()})("closeModal",function(){return i.onColumnUpdated()}),s(),a(19,"app-phase-form-modal",15),x("formConfigSaved",function(){return i.onPhaseFormConfigSaved()})("closeModal",function(){return i.onPhaseFormConfigSaved()}),s(),a(20,"app-lead-detail-modal",16),x("leadUpdated",function(){return i.onLeadUpdated()})("leadDeleted",function(){return i.onLeadDeleted()})("closeModal",function(){return i.onLeadUpdated()}),s(),a(21,"app-template-modal",17),x("templateSaved",function(){return i.onTemplateSaved()})("closeModal",function(){return i.onTemplateSaved()}),s(),b(22,Fd,1,9,"app-automation-modal",18),a(23,"app-automation-history-modal",19),x("closeModalEvent",function(){return i.onCloseHistoryModal()}),s()),e&2&&(l(),m("ngIf",i.isLoading),l(),m("ngIf",!i.isLoading),l(),m("ngIf",i.showAdvancedFilters&&i.activeTab==="kanban"),l(),m("ngIf",!i.isLoading&&i.activeTab==="kanban"),l(),m("ngIf",!i.isLoading&&i.activeTab==="kanban"),l(),m("ngIf",!i.isLoading&&i.activeTab==="initial-form"),l(),m("ngIf",!i.isLoading&&i.activeTab==="kanban"&&i.columns.length===0),l(),m("ngIf",!i.isLoading&&i.activeTab==="templates"),l(),m("ngIf",!i.isLoading&&i.activeTab==="automations"),l(),m("ngIf",!i.isLoading&&i.activeTab==="flow"),l(),m("ngIf",i.showAutomationDeleteConfirm),l(),m("ngIf",!i.isLoading&&i.activeTab==="reports"),l(),m("ngIf",!i.isLoading&&i.activeTab==="outbox"),l(),m("ngIf",i.showOutboxDeleteConfirm),l(),m("ngIf",!i.isLoading&&i.activeTab==="api"),l(),m("ngIf",!i.isLoading&&i.activeTab==="kanban"),l(),m("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns),l(),m("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns),l(),m("ownerId",i.ownerId)("boardId",i.boardId),l(),m("ownerId",i.ownerId)("boardId",i.boardId)("columns",i.columns)("users",i.users),l(),m("ownerId",i.ownerId)("boardId",i.boardId),l(),m("ngIf",i.showAutomationModal),l(),m("isVisible",i.showHistoryModal)("automationId",(i.selectedAutomationForHistory==null?null:i.selectedAutomationForHistory.id)||"")("automationName",(i.selectedAutomationForHistory==null?null:i.selectedAutomationForHistory.name)||"")("ownerId",i.ownerId)("boardId",i.boardId)("leads",i.leads))},dependencies:[K,qi,Z,Y,oe,ge,he,ie,Pe,ne,Je,Kt,Ut,zt,jt,pt,ft,gt,ht,_t,vt,Zt,rn,nt,sn],styles:['@charset "UTF-8";.kanban-board[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;padding:12px;overflow-x:auto;min-height:calc(100vh - 80px);scroll-snap-type:x mandatory;position:relative;justify-content:flex-start;align-items:stretch}.mobile-board[_ngcontent-%COMP%]{display:none}.kanban-column[_ngcontent-%COMP%]{flex:0 0 340px;min-width:340px;max-width:380px;background-color:#f8fafc;border-radius:12px;display:flex;flex-direction:column;transition:opacity .2s ease-in-out;scroll-snap-align:start}.kanban-column-header[_ngcontent-%COMP%]{padding:10px 14px;font-weight:600;display:flex;justify-content:space-between;align-items:center;border-top-width:4px;border-top-style:solid;border-top-left-radius:12px;border-top-right-radius:12px;transition:background-color .3s}.kanban-cards[_ngcontent-%COMP%]{flex-grow:1;padding:6px 10px 8px;overflow-y:auto;min-height:calc(100vh - 220px)}.kanban-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:8px;margin-bottom:10px;cursor:pointer;box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;transition:box-shadow .2s,transform .2s;border-left:5px solid transparent;position:relative}.kanban-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;transform:translateY(-1px)}.card-avatar[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:8px;width:28px;height:28px;background-color:#94a3b8;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;border:2px solid white}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.flow-scroll[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:hidden;padding-bottom:8px;min-height:1px;border-bottom:0;-ms-overflow-style:none;scrollbar-width:none}.flow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{height:0px;background:transparent}.flow-row[_ngcontent-%COMP%]{min-width:calc(100% + 2px)}.flow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px}.flow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#e5e7eb;border-radius:8px}.flow-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:8px}.flow-phase-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-top-width:4px;border-top-color:var(--phase-color, #94a3b8);border-radius:12px;transition:box-shadow .2s ease,transform .1s ease;box-shadow:inset 0 0 0 1px #00000005}.flow-custombar[_ngcontent-%COMP%]{height:8px;background:#e5e7eb;border-radius:6px;position:relative;margin:6px 12px 0;cursor:pointer}.flow-thumb[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;background:#9ca3af;border-radius:6px}.flow-phase-card[_ngcontent-%COMP%]:hover{box-shadow:0 6px 20px -10px #00000040;transform:translateY(-1px)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:8px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .kanban-card[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}@media (max-width: 768px){.desktop-board[_ngcontent-%COMP%]{display:none}.mobile-board[_ngcontent-%COMP%]{display:block}.kanban-board[_ngcontent-%COMP%]{gap:8px;padding:8px}.kanban-column[_ngcontent-%COMP%]{min-width:260px;max-width:320px}.kanban-card[_ngcontent-%COMP%]{padding:8px}}@media (max-width: 480px){.desktop-board[_ngcontent-%COMP%]{display:none}.mobile-board[_ngcontent-%COMP%]{display:block}.kanban-board[_ngcontent-%COMP%]{gap:6px;padding:6px}.kanban-column[_ngcontent-%COMP%]{min-width:240px;max-width:280px}.kanban-card[_ngcontent-%COMP%]{padding:8px}}']})};export{Wn as KanbanComponent};
