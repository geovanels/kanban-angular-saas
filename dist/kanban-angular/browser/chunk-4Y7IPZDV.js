import{$ as l}from"./chunk-3VCHQSRR.js";import{_ as s,da as u,f as a,m as r}from"./chunk-CM3JQ4U2.js";var c=class n{companyService=u(l);currentCompanySubject=new r(null);currentCompany$=this.currentCompanySubject.asObservable();isInitializedSubject=new r(!1);isInitialized$=this.isInitializedSubject.asObservable();initializeFromSubdomain(){return a(this,null,function*(){try{let t=this.extractSubdomain();if(!t)return this.isInitializedSubject.next(!0),null;let e=yield this.companyService.getCompanyBySubdomain(t);if(!e&&t==="gobuyer")try{yield this.companyService.seedGobuyerCompany(),e=yield this.companyService.getCompanyBySubdomain(t)}catch{}return e?this.currentCompanySubject.next(e):this.handleInvalidSubdomain(t),this.isInitializedSubject.next(!0),e}catch{return this.isInitializedSubject.next(!0),null}})}extractSubdomain(){if(typeof window>"u")return null;let t=window.location.hostname;if(t==="localhost"||t==="127.0.0.1"){let e=localStorage.getItem("dev-subdomain");if(e)return e;let i=new URLSearchParams(window.location.search).get("subdomain");return i?(localStorage.setItem("dev-subdomain",i),i):(localStorage.setItem("dev-subdomain","gobuyer"),"gobuyer")}if(t.includes("taskboard.com.br")){let e=t.split(".");if(e.length>=3&&e[0]!=="www"&&e[0]!=="taskboard")return e[0]}if(t==="taskboard.com.br"||t==="www.taskboard.com.br")return null;if(t.includes(".")){let e=t.split(".");if(e.length>=2&&e[0]!=="www"&&e[0]!=="taskboard")return e[0]}return null}handleInvalidSubdomain(t){typeof window<"u"&&(window.location.href="https://taskboard.com.br/empresa-nao-encontrada?subdomain="+encodeURIComponent(t))}getCurrentCompany(){return this.currentCompanySubject.value}setCurrentCompany(t){this.currentCompanySubject.next(t)}setDevSubdomain(t){typeof window<"u"&&(localStorage.setItem("dev-subdomain",t),window.location.reload())}clearDevSubdomain(){typeof window<"u"&&(localStorage.removeItem("dev-subdomain"),window.location.reload())}isDevelopment(){if(typeof window>"u")return!1;let t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"}getCompanyUrl(t){return this.isDevelopment()?`http://localhost:${typeof window<"u"?window.location.port:"4200"}?subdomain=${t}`:`https://${t}.taskboard.com.br`}getApiUrl(){let t=this.getCurrentCompany();return t?this.isDevelopment()?`http://localhost:5000/api/v1/companies/${t.id}`:`https://api.taskboard.com.br/v1/companies/${t.id}`:null}getPublicFormUrl(){let t=this.getCurrentCompany();return t?this.isDevelopment()?`http://localhost:4200/form/${t.subdomain}`:`https://${t.subdomain}.taskboard.com.br/form`:null}static \u0275fac=function(e){return new(e||n)};static \u0275prov=s({token:n,factory:n.\u0275fac,providedIn:"root"})};export{c as a};
