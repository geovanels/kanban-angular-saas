import{$ as m}from"./chunk-3VCHQSRR.js";import{_ as u,da as c,f as s,m as r}from"./chunk-CM3JQ4U2.js";var l=class i{companyService=c(m);currentCompanySubject=new r(null);currentCompany$=this.currentCompanySubject.asObservable();isInitializedSubject=new r(!1);isInitialized$=this.isInitializedSubject.asObservable();initializeFromSubdomain(){return s(this,null,function*(){try{let t=this.extractSubdomain();if(!t)return this.isInitializedSubject.next(!0),null;let e=yield this.companyService.getCompanyBySubdomain(t);if(!e&&t==="gobuyer")try{yield this.companyService.seedGobuyerCompany(),e=yield this.companyService.getCompanyBySubdomain(t)}catch{}return e?this.currentCompanySubject.next(e):this.handleInvalidSubdomain(t),this.isInitializedSubject.next(!0),e}catch{return this.isInitializedSubject.next(!0),null}})}extractSubdomain(){if(typeof window>"u")return null;let t=window.location.hostname,e=new URLSearchParams(window.location.search);if(t==="localhost"||t==="127.0.0.1"){let n=localStorage.getItem("dev-subdomain");if(n)return n;let o=e.get("subdomain");return o?(localStorage.setItem("dev-subdomain",o),o):(localStorage.setItem("dev-subdomain","gobuyer"),"gobuyer")}let a=e.get("company");if(a)return a;if(t.includes("taskboard.com.br")){let n=t.split(".");if(n.length>=3&&n[0]!=="www"&&n[0]!=="apps")return n[0]}if(t==="taskboard.com.br"||t==="www.taskboard.com.br")return null;if(t.includes(".")){let n=t.split(".");if(n.length>=2&&n[0]!=="www"&&n[0]!=="apps")return n[0]}return null}handleInvalidSubdomain(t){typeof window<"u"&&(window.location.href="https://taskboard.com.br/empresa-nao-encontrada?subdomain="+encodeURIComponent(t))}getCurrentCompany(){return this.currentCompanySubject.value}setCurrentCompany(t){this.currentCompanySubject.next(t)}setDevSubdomain(t){typeof window<"u"&&(localStorage.setItem("dev-subdomain",t),window.location.reload())}clearDevSubdomain(){typeof window<"u"&&(localStorage.removeItem("dev-subdomain"),window.location.reload())}isDevelopment(){if(typeof window>"u")return!1;let t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"}getCompanyUrl(t){return this.isDevelopment()?`http://localhost:${typeof window<"u"?window.location.port:"4200"}?subdomain=${t}`:`https://taskboard.com.br?company=${t}`}getApiUrl(){let t=this.getCurrentCompany();return t?this.isDevelopment()?`http://localhost:5000/api/v1/companies/${t.id}`:`https://api.taskboard.com.br/v1/companies/${t.id}`:null}getPublicFormUrl(){let t=this.getCurrentCompany();return t?this.isDevelopment()?`http://localhost:4200/form/${t.subdomain}`:`https://taskboard.com.br/form?company=${t.subdomain}`:null}static \u0275fac=function(e){return new(e||i)};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a};
