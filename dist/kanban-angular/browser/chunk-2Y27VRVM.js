import{a as q}from"./chunk-6ZCF74V7.js";import{a as F}from"./chunk-4R3SDE5O.js";import{a as B}from"./chunk-AI2JU4OL.js";import"./chunk-OWB4XDBK.js";import"./chunk-W3OFA55M.js";import{J as U,i as M,l as L,s as P}from"./chunk-QT4WKFE7.js";import"./chunk-ZBJHR7UR.js";import{F as N,I as D}from"./chunk-OUCFDODB.js";import{$b as C,Ab as h,Eb as m,Fb as i,Gb as o,Hb as l,Oc as I,Pb as c,Rb as k,Vc as T,Ya as a,a as v,ac as s,cc as g,dc as w,f as y,fa as f,fc as S,gb as x,gc as A,hc as E,lb as _,wa as u,zb as b}from"./chunk-HM7IHYI7.js";function R(r,e){r&1&&(l(0,"i",31),s(1," Salvando... "))}function W(r,e){r&1&&(l(0,"i",32),s(1," Salvar Configura\xE7\xF5es "))}function j(r,e){if(r&1&&(i(0,"div",3),l(1,"i",33),s(2),o()),r&2){let n=k();a(2),g(" ",n.successMessage()," ")}}function V(r,e){if(r&1&&(i(0,"div",4),l(1,"i",34),s(2),o()),r&2){let n=k();a(2),g(" ",n.errorMessage()," ")}}function z(r,e){if(r&1&&(i(0,"p",25),s(1),o()),r&2){let n=k();a(),g("URL para envio de leads neste quadro (",n.getCurrentBoardId(),")")}}function H(r,e){r&1&&(i(0,"p",25),s(1),o()),r&2&&(a(),w("URL base para envio de leads. Adicione /","{","boardId","}"," ao final para especificar o quadro"))}var O=class r{companyService=f(D);subdomainService=f(N);apiService=f(q);currentCompany=u(null);apiEnabled=u(!1);apiToken=u("");webhookUrl=u("");showApiToken=u(!1);isSaving=u(!1);successMessage=u(null);errorMessage=u(null);ngOnInit(){this.loadApiConfiguration(),this.generateCompanyLinks()}loadApiConfiguration(){let e=this.subdomainService.getCurrentCompany();e&&(this.currentCompany.set(e),this.apiEnabled.set(e.apiConfig?.enabled||!1),this.apiToken.set(e.apiConfig?.token||this.generateApiToken()),this.webhookUrl.set(e.apiConfig?.webhookUrl||""))}saveApiConfig(){return y(this,null,function*(){let e=this.currentCompany();if(!e){this.showError("Empresa n\xE3o encontrada");return}this.isSaving.set(!0),this.clearMessages();try{let n={apiConfig:{enabled:this.apiEnabled(),token:this.apiToken(),endpoint:this.getLeadIntakeUrl(),webhookUrl:this.webhookUrl()}};yield this.companyService.updateCompany(e.id,n);let t=v(v({},e),n);this.subdomainService.setCurrentCompany(t),this.currentCompany.set(t),this.showSuccess("Configura\xE7\xF5es de API salvas com sucesso!")}catch(n){console.error("Erro ao salvar configura\xE7\xF5es de API:",n),this.showError("Erro ao salvar configura\xE7\xF5es. Tente novamente.")}finally{this.isSaving.set(!1)}})}toggleApiStatus(e){this.apiEnabled.set(e)}toggleTokenVisibility(){this.showApiToken.set(!this.showApiToken())}regenerateApiToken(){if(confirm("Tem certeza que deseja regenerar o token da API? Isso invalidar\xE1 o token atual.")){let e=this.generateApiToken();this.apiToken.set(e),this.showSuccess("Novo token gerado! Lembre-se de atualizar suas integra\xE7\xF5es.")}}getLeadIntakeUrl(){try{let e=this.getCurrentBoardId(),n=this.currentCompany()?.id||"{COMPANY_ID}";return this.apiService.getLeadIntakeUrl(n,e)}catch{return"Erro: empresa n\xE3o configurada"}}getCurrentBoardId(){let n=window.location.pathname.match(/\/(?:kanban|board)\/([^\/\?]+)/);if(n)return n[1];let d=new URLSearchParams(window.location.search).get("boardId");if(d)return d;let p=localStorage.getItem("lastBoardId");if(p)return p}companyLinks=u([]);generateCompanyLinks(){}getLinkIconClass(e){let n="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm";switch(e){case"app":return n+" bg-blue-500";case"form":return n+" bg-green-500";case"api":return n+" bg-purple-500";case"webhook":return n+" bg-orange-500";default:return n+" bg-gray-500"}}getStatusText(){return this.currentCompany()?.status==="active"?"Ativo":"Inativo"}openLink(e){e&&e!=="N\xE3o configurado"&&window.open(e,"_blank")}copyToClipboard(e){e&&e!=="N\xE3o configurado"&&navigator.clipboard.writeText(e).then(()=>{this.showSuccess("Copiado para a \xE1rea de transfer\xEAncia!")}).catch(()=>{this.showError("Erro ao copiar para a \xE1rea de transfer\xEAncia.")})}generateApiToken(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let t=0;t<32;t++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}showSuccess(e){this.successMessage.set(e),this.errorMessage.set(null),setTimeout(()=>this.successMessage.set(null),5e3)}showError(e){this.errorMessage.set(e),this.successMessage.set(null),setTimeout(()=>this.errorMessage.set(null),5e3)}clearMessages(){this.successMessage.set(null),this.errorMessage.set(null)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=x({type:r,selectors:[["app-api-links-config"]],decls:61,vars:15,consts:[["title","API e Integra\xE7\xF5es"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-6","p-4","bg-green-50","border","border-green-200","rounded-lg","text-green-800"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-800"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","mb-8"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center"],[1,"fas","fa-plug","text-blue-500","mr-2"],[1,"text-sm","text-gray-600","mt-1"],[1,"p-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","space-x-3"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-gray-200","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-300","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-600"],[1,"flex","space-x-2"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","bg-gray-50","text-gray-600",3,"value"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"fas","fa-copy"],["class","text-xs text-gray-500 mt-1",4,"ngIf"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","font-mono","text-sm",3,"value"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"text-xs","text-gray-500","mt-1"],[1,"w-full","bg-orange-500","hover:bg-orange-600","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click"],[1,"fas","fa-sync-alt","mr-1"],[1,"mt-6","pt-6","border-t","border-gray-200"],[1,"text-md","font-medium","text-gray-900","mb-4"],["type","url","placeholder","https://exemplo.com/webhook",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","input","ngModel"],[1,"fas","fa-spinner","fa-spin","mr-1"],[1,"fas","fa-save","mr-1"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-exclamation-circle","mr-2"]],template:function(n,t){n&1&&(i(0,"app-main-layout")(1,"app-config-header",0)(2,"button",1),c("click",function(){return t.saveApiConfig()}),b(3,R,2,0)(4,W,2,0),o()(),i(5,"div",2),b(6,j,3,1,"div",3),b(7,V,3,1,"div",4),i(8,"div",5)(9,"div",6)(10,"h3",7),l(11,"i",8),s(12," Configura\xE7\xE3o da API "),o(),i(13,"p",9),s(14,"Configure e gerencie sua API para receber leads externos"),o()(),i(15,"div",10)(16,"div",11)(17,"div",12)(18,"div")(19,"label",13),s(20,"Status da API"),o(),i(21,"div",14)(22,"span"),s(23),o(),i(24,"label",15)(25,"input",16),c("change",function(p){return t.toggleApiStatus(p.target.checked)}),o(),l(26,"div",17),o()()(),i(27,"div")(28,"label",13),s(29,"Endpoint da API"),o(),i(30,"div",18),l(31,"input",19),i(32,"button",20),c("click",function(){return t.copyToClipboard(t.getLeadIntakeUrl())}),l(33,"i",21),o()(),_(34,z,2,1,"p",22)(35,H,2,2,"p",22),o()(),i(36,"div",12)(37,"div")(38,"label",13),s(39,"Token de API"),o(),i(40,"div",18),l(41,"input",23),i(42,"button",20),c("click",function(){return t.toggleTokenVisibility()}),l(43,"i"),o(),i(44,"button",24),c("click",function(){return t.copyToClipboard(t.apiToken())}),l(45,"i",21),o()(),i(46,"p",25),s(47,"Token para autentica\xE7\xE3o nas requisi\xE7\xF5es API"),o()(),i(48,"div")(49,"button",26),c("click",function(){return t.regenerateApiToken()}),l(50,"i",27),s(51," Regenerar Token "),o()()()(),i(52,"div",28)(53,"h4",29),s(54,"Webhook (Opcional)"),o(),i(55,"div")(56,"label",13),s(57,"URL do Webhook"),o(),i(58,"input",30),E("ngModelChange",function(p){return A(t.webhookUrl,p)||(t.webhookUrl=p),p}),c("input",function(p){return t.webhookUrl.set(p.target.value)}),o(),i(59,"p",25),s(60,"URL que receber\xE1 notifica\xE7\xF5es quando um novo lead for criado via API"),o()()()()()()()),n&2&&(a(2),m("disabled",t.isSaving()),a(),h(t.isSaving()?3:4),a(3),h(t.successMessage()?6:-1),a(),h(t.errorMessage()?7:-1),a(15),C(t.apiEnabled()?"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800":"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a(),g(" ",t.apiEnabled()?"Ativa":"Inativa"," "),a(2),m("checked",t.apiEnabled()),a(6),m("value",t.getLeadIntakeUrl()),a(3),m("ngIf",t.getCurrentBoardId()),a(),m("ngIf",!t.getCurrentBoardId()),a(6),m("value",t.showApiToken()?t.apiToken():"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),a(2),C(t.showApiToken()?"fas fa-eye-slash":"fas fa-eye"),a(15),S("ngModel",t.webhookUrl))},dependencies:[T,I,U,M,L,P,F,B],styles:["[_nghost-%COMP%]{display:block}"]})};export{O as ApiLinksConfigComponent};
