import{a as pe}from"./chunk-W3OFA55M.js";import{A as ne,C as re,I as ae,K as le,c as Q,h as H,i as J,l as W,m as X,t as Y,u as Z,v as ee,x as te,y as ie,z as oe}from"./chunk-QT4WKFE7.js";import"./chunk-ZBJHR7UR.js";import{F as se,H as me,I as ce}from"./chunk-77VQYYTZ.js";import{Eb as o,Fb as l,Gb as s,Hb as _,Lb as I,Mb as E,Nc as R,Ob as A,Oc as B,Pb as D,Pc as j,Qc as q,Rb as c,Rc as z,Va as O,Vc as K,Xb as M,Ya as n,Yb as V,a as S,ac as p,b as T,bc as b,cc as G,f as N,fa as v,gb as k,la as $,lb as d,ma as L,mc as F,uc as U,wa as h,wb as w}from"./chunk-HM7IHYI7.js";var P=()=>[],_e=()=>["Quente","Morno","Frio"];function be(t,i){if(t&1&&(l(0,"div",12),_(1,"img",13),s()),t&2){let e=c();n(),o("src",e.companyLogo,O)}}function ye(t,i){if(t&1&&(l(0,"span",14),p(1),s()),t&2){let e=c();n(),b(e.companyName())}}function ve(t,i){t&1&&(l(0,"div",15),p(1,"Carregando..."),s())}function xe(t,i){t&1&&(l(0,"div",15),p(1,"Nenhum campo configurado para esta fase."),s())}function Ce(t,i){if(t&1&&_(0,"input",31),t&2){let e=c().$implicit;o("formControlName",e.name)}}function he(t,i){if(t&1&&_(0,"input",32),t&2){let e=c().$implicit;o("formControlName",e.name)}}function Fe(t,i){if(t&1&&_(0,"input",33),t&2){let e=c().$implicit;o("formControlName",e.name)}}function Se(t,i){if(t&1&&_(0,"input",34),t&2){let e=c().$implicit;o("formControlName",e.name)}}function Ne(t,i){if(t&1&&_(0,"textarea",35),t&2){let e=c().$implicit;o("formControlName",e.name)}}function we(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e.value),n(),b(e.label)}}function Ie(t,i){if(t&1&&(I(0),d(1,we,2,2,"option",39),E()),t&2){let e=c(2).$implicit;n(),o("ngForOf",e.options)}}function Ee(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e),n(),b(e)}}function Pe(t,i){if(t&1&&d(0,Ee,2,2,"option",39),t&2){let e=c(2).$implicit;o("ngForOf",e.options||F(1,P))}}function Te(t,i){if(t&1&&(l(0,"select",36)(1,"option",37),p(2,"Selecione..."),s(),d(3,Ie,2,1,"ng-container",38)(4,Pe,1,2,"ng-template",null,0,U),s()),t&2){let e=M(5),r=c().$implicit;o("formControlName",r.name),n(3),o("ngIf",r.options&&r.options.length&&typeof r.options[0]=="object")("ngIfElse",e)}}function $e(t,i){if(t&1&&(l(0,"label",43),_(1,"input",44),l(2,"span"),p(3),s()()),t&2){let e=i.$implicit,r=c(2).$implicit;n(),o("value",(e==null?null:e.value)??e)("formControlName",r.name),w("name",r.name),n(2),b((e==null?null:e.label)??e)}}function Le(t,i){if(t&1&&(l(0,"div",41),d(1,$e,4,4,"label",42),s()),t&2){let e=c().$implicit;n(),o("ngForOf",e.options||F(1,P))}}function Oe(t,i){if(t&1&&(l(0,"label",43),_(1,"input",45),l(2,"span"),p(3),s()()),t&2){let e=i.$implicit,r=i.index,a=c(2).$implicit;n(),o("value",e)("formControlName",a.name+"_"+r),w("name",a.name+"_"+r),n(2),b(e)}}function ke(t,i){if(t&1&&(l(0,"div",41),d(1,Oe,4,4,"label",42),s()),t&2){let e=c().$implicit;n(),o("ngForOf",e.options||F(1,P))}}function Ae(t,i){if(t&1&&(l(0,"option",40),p(1),s()),t&2){let e=i.$implicit;o("value",e),n(),b(e)}}function De(t,i){if(t&1&&(l(0,"select",36)(1,"option",37),p(2,"Selecione..."),s(),d(3,Ae,2,2,"option",39),s()),t&2){let e=c().$implicit;o("formControlName",e.name),n(3),o("ngForOf",e.options&&e.options.length?e.options:F(2,_e))}}function Me(t,i){if(t&1&&_(0,"input",31),t&2){let e=c().$implicit;o("formControlName",e.name)}}function Ve(t,i){if(t&1&&(l(0,"div",20)(1,"label",21),p(2),s(),I(3,22),d(4,Ce,1,1,"input",23)(5,he,1,1,"input",24)(6,Fe,1,1,"input",25)(7,Se,1,1,"input",26)(8,Ne,1,1,"textarea",27)(9,Te,6,3,"select",28)(10,Le,2,2,"div",29)(11,ke,2,2,"div",29)(12,De,4,3,"select",28)(13,Me,1,1,"input",30),E(),s()),t&2){let e=i.$implicit;n(2),b(e.label),n(),o("ngSwitch",e.type),n(),o("ngSwitchCase","text"),n(),o("ngSwitchCase","email"),n(),o("ngSwitchCase","tel"),n(),o("ngSwitchCase","number"),n(),o("ngSwitchCase","textarea"),n(),o("ngSwitchCase","select"),n(),o("ngSwitchCase","radio"),n(),o("ngSwitchCase","checkbox"),n(),o("ngSwitchCase","temperatura")}}function Ge(t,i){if(t&1){let e=A();l(0,"form",16),D("ngSubmit",function(){$(e);let a=c();return L(a.onSubmit())}),d(1,Ve,14,11,"div",17),l(2,"div",18)(3,"button",19),p(4),s()()()}if(t&2){let e=c();o("formGroup",e.form),n(),o("ngForOf",e.currentFields),n(2),V("background-color",e.primaryColor()),o("disabled",e.saving()),n(),G(" ",e.saving()?"Salvando...":"Salvar"," ")}}var de=class t{route=v(Q);fs=v(me);subdomain=v(se);toast=v(pe);fb=v(ae);companyService=v(ce);form=this.fb.group({});loading=h(!0);saving=h(!1);fieldsLoaded=h(!1);companyName=h(null);primaryColor=h(this.subdomain.getCurrentCompany()?.brandingConfig?.primaryColor||"#3B82F6");companyLogo=null;userId="";boardId="";columnId="";leadId="";currentFields=[];lead=null;companyUsers=[];ngOnInit(){return N(this,null,function*(){let i=this.route.snapshot.queryParamMap,e=i.get("subdomain")||void 0,r=i.get("companyId")||"";this.userId=i.get("userId")||"",this.boardId=i.get("boardId")||"",this.leadId=i.get("leadId")||"",this.columnId=i.get("columnId")||"";try{let a=null;if(r&&(a=yield this.companyService.getCompany(r)),!a&&e&&(a=yield this.companyService.getCompanyBySubdomain(e)),a||(a=yield this.subdomain.initializeFromSubdomain()),a){this.subdomain.setCurrentCompany(a),this.companyName.set(a.name||e||null),this.primaryColor.set(a.brandingConfig?.primaryColor||"#3B82F6");let u=a.subdomain;this.companyLogo=(a.brandingConfig?.logo&&a.brandingConfig.logo.trim()!==""?a.brandingConfig.logo:null)||(u==="gobuyer"?"https://apps.gobuyer.com.br/sso/assets/images/logos/logo-gobuyer.png":null)}else e&&this.companyName.set(e)}catch{this.companyName.set(e||null)}try{this.leadId&&(this.lead=yield this.fs.getLead(this.userId,this.boardId,this.leadId))}catch{}try{let u=(yield this.fs.getPhaseFormConfig(this.userId,this.boardId,this.columnId))?.fields||[];if(this.currentFields=u.sort((m,C)=>(m.order||0)-(C.order||0)),this.currentFields.some(m=>m.type==="responsavel")){let m=this.subdomain.getCurrentCompany();if(m?.id)try{let C=yield this.companyService.getAllCompanyUsers(m.id);this.companyUsers=C||[],this.currentFields=this.currentFields.map(y=>y.type==="responsavel"?T(S({},y),{type:"select",originalType:"responsavel",options:C.map(f=>({value:f.uid||f.email,label:f.displayName||f.email}))}):y)}catch{}}let g={};this.currentFields.forEach(m=>{let C=m.apiFieldName||m.name,y=this.lead?.fields?.[C]??"";m.type==="checkbox"?(m.options||[]).forEach((f,ue)=>{let fe=m.name+"_"+ue,ge=Array.isArray(y)?y.includes(f):!1;g[fe]=[ge]}):g[m.name]=[y],m.type==="radio"&&Array.isArray(m.options)&&(m.options=m.options.map(f=>typeof f=="object"?f:{value:f,label:f}))}),this.form=this.fb.group(g),this.fieldsLoaded.set(this.currentFields.length>0)}catch{this.currentFields=[],this.fieldsLoaded.set(!1)}this.loading.set(!1)})}mapFormToLeadFields(){let i=this.form.value,e={};return this.currentFields.forEach(r=>{let a=r.apiFieldName||r.name;if(r.type==="checkbox"){let u=[];(r.options||[]).forEach((x,g)=>{let m=r.name+"_"+g;i[m]&&u.push(x)}),e[a]=u}else e[a]=i[r.name]}),e}onSubmit(){return N(this,null,function*(){if(!(!this.lead||!this.leadId)){this.saving.set(!0);try{let i=this.mapFormToLeadFields(),e={fields:S(S({},this.lead.fields||{}),i)};try{let r=this.currentFields.find(a=>a.originalType==="responsavel"||a.type==="responsavel"||(a.name||"").toLowerCase()==="responsavel");if(r){let a=r.name,u=this.form.get(a)?.value;if(u){let x=this.companyUsers.find(g=>g.uid&&g.uid===u||g.email&&g.email===u);e.responsibleUserId=x?.uid||u,e.responsibleUserName=x?.displayName||"",e.responsibleUserEmail=x?.email||""}}}catch{}yield this.fs.updateLead(this.userId,this.boardId,this.leadId,e);try{this.toast.success("Formul\xE1rio salvo.")}catch{}}catch(i){console.error(i);try{this.toast.error("Erro ao salvar formul\xE1rio.")}catch{}}finally{this.saving.set(!1)}}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=k({type:t,selectors:[["app-public-form"]],decls:16,vars:5,consts:[["simpleOpts",""],[1,"min-h-screen","bg-gray-50","py-10","px-4"],[1,"max-w-2xl","mx-auto"],["class","mb-6 text-center",4,"ngIf"],[1,"bg-white","border","border-gray-200","rounded-xl","shadow-sm"],[1,"px-6","py-4","border-b","border-gray-200","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900"],["class","text-xs text-gray-500",4,"ngIf"],[1,"p-6"],["class","text-sm text-gray-500",4,"ngIf"],["class","space-y-4",3,"formGroup","ngSubmit",4,"ngIf"],[1,"mt-6","text-center","text-xs","text-gray-400"],[1,"mb-6","text-center"],["alt","Logo da empresa",1,"h-10","inline-block",3,"src"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-500"],[1,"space-y-4",3,"ngSubmit","formGroup"],["class","space-y-1",4,"ngFor","ngForOf"],[1,"pt-2"],["type","submit",1,"px-4","py-2","text-white","rounded-lg",3,"disabled"],[1,"space-y-1"],[1,"block","text-sm","font-medium","text-gray-700"],[3,"ngSwitch"],["type","text","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","email","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","tel","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["type","number","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["rows","3","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchCase"],["class","flex flex-col gap-2",4,"ngSwitchCase"],["type","text","class","w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",3,"formControlName",4,"ngSwitchDefault"],["type","text",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","email",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","tel",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["type","number",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["rows","3",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"formControlName"],["value",""],[4,"ngIf","ngIfElse"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-col","gap-2"],["class","inline-flex items-center gap-2 text-sm text-gray-700",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-2","text-sm","text-gray-700"],["type","radio",1,"text-blue-600","focus:ring-blue-500",3,"value","formControlName"],["type","checkbox",1,"text-blue-600","focus:ring-blue-500",3,"value","formControlName"]],template:function(e,r){e&1&&(l(0,"div",1)(1,"div",2),d(2,be,2,1,"div",3),l(3,"div",4)(4,"div",5)(5,"h1",6),p(6,"Formul\xE1rio"),s(),d(7,ye,2,1,"span",7),s(),l(8,"div",8),d(9,ve,2,0,"div",9)(10,xe,2,0,"div",9)(11,Ge,5,6,"form",10),s()(),l(12,"div",11),p(13," Powered by "),l(14,"strong"),p(15,"Task Board"),s()()()()),e&2&&(n(2),o("ngIf",r.companyLogo),n(5),o("ngIf",r.companyName()),n(2),o("ngIf",r.loading()),n(),o("ngIf",!r.loading()&&!r.fieldsLoaded()),n(),o("ngIf",r.fieldsLoaded()))},dependencies:[K,R,B,j,q,z,le,Y,ne,re,J,Z,H,oe,ee,W,X,te,ie],encapsulation:2})};export{de as PublicFormComponent};
