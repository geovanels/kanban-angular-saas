import{a as P}from"./chunk-RHNPUN54.js";import{a as N}from"./chunk-4RPGT7VY.js";import{K as L,M as U,j as E,m as T,u as M}from"./chunk-XFXMLSII.js";import{R as I}from"./chunk-4U6ZKXZY.js";import{Ab as n,Bb as o,Cb as s,Lb as d,Lc as A,Nb as v,Ta as r,Wb as y,Xb as a,Zb as b,a as h,ac as _,bb as x,bc as w,cc as S,da as k,f as C,ta as p,ub as g,vb as f,zb as c}from"./chunk-O3JLSHCU.js";function F(l,e){l&1&&(s(0,"i",30),a(1," Salvando... "))}function O(l,e){l&1&&(s(0,"i",31),a(1," Salvar Configura\xE7\xF5es "))}function W(l,e){if(l&1&&(n(0,"div",3),s(1,"i",32),a(2),o()),l&2){let i=v();r(2),b(" ",i.successMessage()," ")}}function q(l,e){if(l&1&&(n(0,"div",4),s(1,"i",33),a(2),o()),l&2){let i=v();r(2),b(" ",i.errorMessage()," ")}}var D=class l{companyService=k(I);subdomainService=k(U);currentCompany=p(null);apiEnabled=p(!1);apiToken=p("");webhookUrl=p("");showApiToken=p(!1);isSaving=p(!1);successMessage=p(null);errorMessage=p(null);ngOnInit(){this.loadApiConfiguration(),this.generateCompanyLinks()}loadApiConfiguration(){let e=this.subdomainService.getCurrentCompany();e&&(this.currentCompany.set(e),this.apiEnabled.set(e.apiConfig?.enabled||!1),this.apiToken.set(e.apiConfig?.token||this.generateApiToken()),this.webhookUrl.set(e.apiConfig?.webhookUrl||""))}saveApiConfig(){return C(this,null,function*(){let e=this.currentCompany();if(!e){this.showError("Empresa n\xE3o encontrada");return}this.isSaving.set(!0),this.clearMessages();try{let i={apiConfig:{enabled:this.apiEnabled(),token:this.apiToken(),endpoint:this.getLeadIntakeUrl(),webhookUrl:this.webhookUrl()}};yield this.companyService.updateCompany(e.id,i);let t=h(h({},e),i);this.subdomainService.setCurrentCompany(t),this.currentCompany.set(t),this.showSuccess("Configura\xE7\xF5es de API salvas com sucesso!")}catch(i){console.error("Erro ao salvar configura\xE7\xF5es de API:",i),this.showError("Erro ao salvar configura\xE7\xF5es. Tente novamente.")}finally{this.isSaving.set(!1)}})}toggleApiStatus(e){this.apiEnabled.set(e)}toggleTokenVisibility(){this.showApiToken.set(!this.showApiToken())}regenerateApiToken(){if(confirm("Tem certeza que deseja regenerar o token da API? Isso invalidar\xE1 o token atual.")){let e=this.generateApiToken();this.apiToken.set(e),this.showSuccess("Novo token gerado! Lembre-se de atualizar suas integra\xE7\xF5es.")}}getLeadIntakeUrl(){let e=this.currentCompany();return e?this.subdomainService.isDevelopment()?`http://localhost:5000/api/v1/companies/${e.id}/leads`:`https://api.taskboard.com.br/v1/companies/${e.id}/leads`:""}companyLinks=p([]);generateCompanyLinks(){}getLinkIconClass(e){let i="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm";switch(e){case"app":return i+" bg-blue-500";case"form":return i+" bg-green-500";case"api":return i+" bg-purple-500";case"webhook":return i+" bg-orange-500";default:return i+" bg-gray-500"}}getStatusText(){return this.currentCompany()?.status==="active"?"Ativo":"Inativo"}openLink(e){e&&e!=="N\xE3o configurado"&&window.open(e,"_blank")}copyToClipboard(e){e&&e!=="N\xE3o configurado"&&navigator.clipboard.writeText(e).then(()=>{this.showSuccess("Copiado para a \xE1rea de transfer\xEAncia!")}).catch(()=>{this.showError("Erro ao copiar para a \xE1rea de transfer\xEAncia.")})}generateApiToken(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="";for(let t=0;t<32;t++)i+=e.charAt(Math.floor(Math.random()*e.length));return i}showSuccess(e){this.successMessage.set(e),this.errorMessage.set(null),setTimeout(()=>this.successMessage.set(null),5e3)}showError(e){this.errorMessage.set(e),this.successMessage.set(null),setTimeout(()=>this.errorMessage.set(null),5e3)}clearMessages(){this.successMessage.set(null),this.errorMessage.set(null)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=x({type:l,selectors:[["app-api-links-config"]],decls:61,vars:13,consts:[["title","API e Integra\xE7\xF5es"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-6","p-4","bg-green-50","border","border-green-200","rounded-lg","text-green-800"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-800"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","mb-8"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center"],[1,"fas","fa-plug","text-blue-500","mr-2"],[1,"text-sm","text-gray-600","mt-1"],[1,"p-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","space-x-3"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-gray-200","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-300","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-600"],[1,"flex","space-x-2"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","bg-gray-50","text-gray-600",3,"value"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"fas","fa-copy"],[1,"text-xs","text-gray-500","mt-1"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","font-mono","text-sm",3,"value"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"w-full","bg-orange-500","hover:bg-orange-600","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click"],[1,"fas","fa-sync-alt","mr-1"],[1,"mt-6","pt-6","border-t","border-gray-200"],[1,"text-md","font-medium","text-gray-900","mb-4"],["type","url","placeholder","https://exemplo.com/webhook",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","input","ngModel"],[1,"fas","fa-spinner","fa-spin","mr-1"],[1,"fas","fa-save","mr-1"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-exclamation-circle","mr-2"]],template:function(i,t){i&1&&(n(0,"app-main-layout")(1,"app-config-header",0)(2,"button",1),d("click",function(){return t.saveApiConfig()}),g(3,F,2,0)(4,O,2,0),o()(),n(5,"div",2),g(6,W,3,1,"div",3),g(7,q,3,1,"div",4),n(8,"div",5)(9,"div",6)(10,"h3",7),s(11,"i",8),a(12," Configura\xE7\xE3o da API "),o(),n(13,"p",9),a(14,"Configure e gerencie sua API para receber leads externos"),o()(),n(15,"div",10)(16,"div",11)(17,"div",12)(18,"div")(19,"label",13),a(20,"Status da API"),o(),n(21,"div",14)(22,"span"),a(23),o(),n(24,"label",15)(25,"input",16),d("change",function(m){return t.toggleApiStatus(m.target.checked)}),o(),s(26,"div",17),o()()(),n(27,"div")(28,"label",13),a(29,"Endpoint da API"),o(),n(30,"div",18),s(31,"input",19),n(32,"button",20),d("click",function(){return t.copyToClipboard(t.getLeadIntakeUrl())}),s(33,"i",21),o()(),n(34,"p",22),a(35,"URL para envio de leads via API"),o()()(),n(36,"div",12)(37,"div")(38,"label",13),a(39,"Token de API"),o(),n(40,"div",18),s(41,"input",23),n(42,"button",20),d("click",function(){return t.toggleTokenVisibility()}),s(43,"i"),o(),n(44,"button",24),d("click",function(){return t.copyToClipboard(t.apiToken())}),s(45,"i",21),o()(),n(46,"p",22),a(47,"Token para autentica\xE7\xE3o nas requisi\xE7\xF5es API"),o()(),n(48,"div")(49,"button",25),d("click",function(){return t.regenerateApiToken()}),s(50,"i",26),a(51," Regenerar Token "),o()()()(),n(52,"div",27)(53,"h4",28),a(54,"Webhook (Opcional)"),o(),n(55,"div")(56,"label",13),a(57,"URL do Webhook"),o(),n(58,"input",29),S("ngModelChange",function(m){return w(t.webhookUrl,m)||(t.webhookUrl=m),m}),d("input",function(m){return t.webhookUrl.set(m.target.value)}),o(),n(59,"p",22),a(60,"URL que receber\xE1 notifica\xE7\xF5es quando um novo lead for criado via API"),o()()()()()()()),i&2&&(r(2),c("disabled",t.isSaving()),r(),f(t.isSaving()?3:4),r(3),f(t.successMessage()?6:-1),r(),f(t.errorMessage()?7:-1),r(15),y(t.apiEnabled()?"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800":"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),r(),b(" ",t.apiEnabled()?"Ativa":"Inativa"," "),r(2),c("checked",t.apiEnabled()),r(6),c("value",t.getLeadIntakeUrl()),r(10),c("value",t.showApiToken()?t.apiToken():"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),r(2),y(t.showApiToken()?"fas fa-eye-slash":"fas fa-eye"),r(15),_("ngModel",t.webhookUrl))},dependencies:[A,L,E,T,M,P,N],styles:["[_nghost-%COMP%]{display:block}"]})};export{D as ApiLinksConfigComponent};
