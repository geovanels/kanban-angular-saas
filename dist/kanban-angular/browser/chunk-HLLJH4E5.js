import{C as d,D as c,F as y,G as w,H as f,I as U,K as D,Q as a,R as h,X as i,y as p,z as g}from"./chunk-3VCHQSRR.js";import{_ as m,da as n,f as t,z as l}from"./chunk-CM3JQ4U2.js";var b=class o{auth=n(g);firestore=n(D);user$=d(this.auth);signInWithEmail(e,r){return t(this,null,function*(){try{return{success:!0,user:(yield y(this.auth,e,r)).user}}catch(s){return{success:!1,error:s.message}}})}createUserWithEmail(e,r){return t(this,null,function*(){try{return{success:!0,user:(yield c(this.auth,e,r)).user}}catch(s){return{success:!1,error:s.message}}})}updateUserProfile(e){return t(this,null,function*(){try{let r=this.auth.currentUser;if(!r)throw new Error("Usu\xE1rio n\xE3o autenticado");return yield U(r,{displayName:e.displayName,photoURL:e.photoURL}),yield i(a(this.firestore,"users",r.uid),{email:r.email,displayName:e.displayName||r.displayName,phoneNumber:e.phoneNumber,photoURL:e.photoURL||r.photoURL,createdAt:new Date,lastLogin:new Date}),{success:!0}}catch(r){return{success:!1,error:r.message}}})}signUpWithEmail(e,r,s){return t(this,null,function*(){try{let u=yield c(this.auth,e,r);return yield this.updateUserProfile({displayName:s}),{success:!0,user:u.user}}catch(u){return{success:!1,error:u.message}}})}signInWithGoogle(){return t(this,null,function*(){try{let e=new p,r=yield w(this.auth,e);return(yield h(a(this.firestore,"users",r.user.uid))).exists()?yield i(a(this.firestore,"users",r.user.uid),{lastLogin:new Date},{merge:!0}):yield i(a(this.firestore,"users",r.user.uid),{email:r.user.email,displayName:r.user.displayName,createdAt:new Date,lastLogin:new Date}),{success:!0,user:r.user}}catch(e){return{success:!1,error:e.message}}})}logout(){return t(this,null,function*(){try{return yield f(this.auth),{success:!0}}catch(e){return{success:!1,error:e.message}}})}getCurrentUser(){return this.auth.currentUser}isAuthenticated(){return this.user$.pipe(l(e=>!!e))}getUserCompany(e){return t(this,null,function*(){try{let r=yield h(a(this.firestore,"users",e));return r.exists()&&r.data().companyId||null}catch(r){return console.error("Erro ao buscar empresa do usu\xE1rio:",r),null}})}linkUserToCompany(e,r){return t(this,null,function*(){try{yield i(a(this.firestore,"users",e),{companyId:r,updatedAt:new Date},{merge:!0})}catch(s){throw console.error("Erro ao associar usu\xE1rio \xE0 empresa:",s),s}})}static \u0275fac=function(r){return new(r||o)};static \u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a};
