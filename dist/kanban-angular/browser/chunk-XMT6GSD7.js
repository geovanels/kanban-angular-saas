import{Bc as md,Cc as gd,Dc as ga,Ha as pd,a as M,aa as lt,b as Z,da as Gn,e as Kt,f as m,fa as he,ga as Hn,i as yn,ja as fd,ka as k,m as fa,n as ld,o as hd,pb as ht,qa as $e,r as rs,s as pa,t as ma,ya as is,z as dd,za as He}from"./chunk-FTRINZK6.js";var yd=()=>{};var vd=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ay=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},ss={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,l=i+2<n.length,h=l?n[i+2]:0,f=s>>2,y=(s&3)<<4|c>>4,_=(c&15)<<2|h>>6,S=h&63;l||(S=64,a||(_=64)),r.push(t[f],t[y],t[_],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(vd(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ay(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let y=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||y==null)throw new _a;let _=s<<2|c>>4;if(r.push(_),h!==64){let S=c<<4&240|h>>2;if(r.push(S),y!==64){let D=h<<6&192|y;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},_a=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Cy=function(n){let e=vd(n);return ss.encodeByteArray(e,!0)},Yr=function(n){return Cy(n).replace(/\./g,"")},os=function(n){try{return ss.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function va(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Sy=()=>va().__FIREBASE_DEFAULTS__,Ry=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Py=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&os(n[1]);return e&&JSON.parse(e)},as=()=>{try{return yd()||Sy()||Ry()||Py()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},wa=n=>{var e,t;return(t=(e=as())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},wd=n=>{let e=wa(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Ea=()=>{var n;return(n=as())===null||n===void 0?void 0:n.config},Ta=n=>{var e;return(e=as())===null||e===void 0?void 0:e[`_${n}`]};var _n=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Qt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function cs(n){return m(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Ed(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Yr(JSON.stringify(t)),Yr(JSON.stringify(a)),""].join(".")}var Qr={};function ky(){let n={prod:[],emulator:[]};for(let e of Object.keys(Qr))Qr[e]?n.emulator.push(e):n.prod.push(e);return n}function Dy(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var _d=!1;function us(n,e){if(typeof window>"u"||typeof document>"u"||!Qt(window.location.host)||Qr[n]===e||Qr[n]||_d)return;Qr[n]=e;function t(_){return`__firebase__banner__${_}`}let r="__firebase__banner",s=ky().prod.length>0;function a(){let _=document.getElementById(r);_&&_.remove()}function c(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function l(_,S){_.setAttribute("width","24"),_.setAttribute("id",S),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function h(){let _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{_d=!0,a()},_}function f(_,S){_.setAttribute("id",S),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function y(){let _=Dy(r),S=t("text"),D=document.getElementById(S)||document.createElement("span"),V=t("learnmore"),N=document.getElementById(V)||document.createElement("a"),G=t("preprendIcon"),j=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){let H=_.element;c(H),f(N,V);let ie=h();l(j,G),H.append(j,D,N,ie),document.body.appendChild(H)}s?(D.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function Ee(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Td(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ee())}function Ny(){var n;let e=(n=as())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bd(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Ad(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Cd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Sd(){let n=Ee();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Rd(){return!Ny()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Jr(){try{return typeof indexedDB=="object"}catch{return!1}}function Pd(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var xy="FirebaseError",qe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=xy,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,et.prototype.create)}},et=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Oy(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new qe(i,c,r)}};function Oy(n,e){return n.replace(Vy,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Vy=/\{\$([^}]+)}/g;function kd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function dt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Id(s)&&Id(a)){if(!dt(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Id(n){return n!==null&&typeof n=="object"}function Kn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Qn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Yn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Dd(n,e){let t=new Ia(n,e);return t.subscribe.bind(t)}var Ia=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ly(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=ya),i.error===void 0&&(i.error=ya),i.complete===void 0&&(i.complete=ya);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Ly(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ya(){}var ab=14400*1e3;function ue(n){return n&&n._delegate?n._delegate:n}var Fe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var In="[DEFAULT]";var ba=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new _n;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Fy(e))try{this.getOrInitializeService({instanceIdentifier:In})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=In){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return m(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=In){return this.instances.has(e)}getOptions(e=In){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:My(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=In){return this.component?this.component.multipleInstances?e:In:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function My(n){return n===In?void 0:n}function Fy(n){return n.instantiationMode==="EAGER"}var ls=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ba(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Uy=[],Q=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(Q||{}),$y={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},By=Q.INFO,jy={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},qy=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=jy[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ft=class{constructor(e){this.name=e,this._logLevel=By,this._logHandler=qy,this._userLogHandler=null,Uy.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$y[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}};var zy=(n,e)=>e.some(t=>n instanceof t),Nd,xd;function Wy(){return Nd||(Nd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gy(){return xd||(xd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Od=new WeakMap,Ca=new WeakMap,Vd=new WeakMap,Aa=new WeakMap,Ra=new WeakMap;function Hy(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(pt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Od.set(t,n)}).catch(()=>{}),Ra.set(e,n),e}function Ky(n){if(Ca.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});Ca.set(n,e)}var Sa={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ca.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Vd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ld(n){Sa=n(Sa)}function Qy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(hs(this),e,...t);return Vd.set(r,e.sort?e.sort():[e]),pt(r)}:Gy().includes(n)?function(...e){return n.apply(hs(this),e),pt(Od.get(this))}:function(...e){return pt(n.apply(hs(this),e))}}function Yy(n){return typeof n=="function"?Qy(n):(n instanceof IDBTransaction&&Ky(n),zy(n,Wy())?new Proxy(n,Sa):n)}function pt(n){if(n instanceof IDBRequest)return Hy(n);if(Aa.has(n))return Aa.get(n);let e=Yy(n);return e!==n&&(Aa.set(n,e),Ra.set(e,n)),e}var hs=n=>Ra.get(n);function Fd(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),c=pt(a);return r&&a.addEventListener("upgradeneeded",l=>{r(pt(a.result),l.oldVersion,l.newVersion,pt(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}var Jy=["get","getKey","getAll","getAllKeys","count"],Xy=["put","add","delete","clear"],Pa=new Map;function Md(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Pa.get(e))return Pa.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Xy.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Jy.includes(t)))return;let s=function(a,...c){return m(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),h=l.store;return r&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&l.done]))[0]})};return Pa.set(e,s),s}Ld(n=>Z(M({},n),{get:(e,t,r)=>Md(e,t)||n.get(e,t,r),has:(e,t)=>!!Md(e,t)||n.has(e,t)}));var Da=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Zy(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Zy(n){let e=n.getComponent();return e?.type==="VERSION"}var Na="@firebase/app",Ud="0.13.2";var St=new ft("@firebase/app"),e_="@firebase/app-compat",t_="@firebase/analytics-compat",n_="@firebase/analytics",r_="@firebase/app-check-compat",i_="@firebase/app-check",s_="@firebase/auth",o_="@firebase/auth-compat",a_="@firebase/database",c_="@firebase/data-connect",u_="@firebase/database-compat",l_="@firebase/functions",h_="@firebase/functions-compat",d_="@firebase/installations",f_="@firebase/installations-compat",p_="@firebase/messaging",m_="@firebase/messaging-compat",g_="@firebase/performance",y_="@firebase/performance-compat",__="@firebase/remote-config",I_="@firebase/remote-config-compat",v_="@firebase/storage",w_="@firebase/storage-compat",E_="@firebase/firestore",T_="@firebase/ai",b_="@firebase/firestore-compat",A_="firebase",C_="11.10.0";var xa="[DEFAULT]",S_={[Na]:"fire-core",[e_]:"fire-core-compat",[n_]:"fire-analytics",[t_]:"fire-analytics-compat",[i_]:"fire-app-check",[r_]:"fire-app-check-compat",[s_]:"fire-auth",[o_]:"fire-auth-compat",[a_]:"fire-rtdb",[c_]:"fire-data-connect",[u_]:"fire-rtdb-compat",[l_]:"fire-fn",[h_]:"fire-fn-compat",[d_]:"fire-iid",[f_]:"fire-iid-compat",[p_]:"fire-fcm",[m_]:"fire-fcm-compat",[g_]:"fire-perf",[y_]:"fire-perf-compat",[__]:"fire-rc",[I_]:"fire-rc-compat",[v_]:"fire-gcs",[w_]:"fire-gcs-compat",[E_]:"fire-fst",[b_]:"fire-fst-compat",[T_]:"fire-vertex","fire-js":"fire-js",[A_]:"fire-js-all"};var Xr=new Map,R_=new Map,Oa=new Map;function $d(n,e){try{n.container.addComponent(e)}catch(t){St.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function tt(n){let e=n.name;if(Oa.has(e))return St.debug(`There were multiple attempts to register component ${e}.`),!1;Oa.set(e,n);for(let t of Xr.values())$d(t,n);for(let t of R_.values())$d(t,n);return!0}function Jn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ue(n){return n==null?!1:n.settings!==void 0}var P_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yt=new et("app","Firebase",P_);var Va=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Fe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Yt.create("app-deleted",{appName:this._name})}};var Jt=C_;function Fa(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:xa,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Yt.create("bad-app-name",{appName:String(i)});if(t||(t=Ea()),!t)throw Yt.create("no-options");let s=Xr.get(i);if(s){if(dt(t,s.options)&&dt(r,s.config))return s;throw Yt.create("duplicate-app",{appName:i})}let a=new ls(i);for(let l of Oa.values())a.addComponent(l);let c=new Va(t,r,a);return Xr.set(i,c),c}function vn(n=xa){let e=Xr.get(n);if(!e&&n===xa&&Ea())return Fa();if(!e)throw Yt.create("no-app",{appName:n});return e}function ds(){return Array.from(Xr.values())}function fe(n,e,t){var r;let i=(r=S_[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),St.warn(c.join(" "));return}tt(new Fe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var k_="firebase-heartbeat-database",D_=1,Zr="firebase-heartbeat-store",ka=null;function zd(){return ka||(ka=Fd(k_,D_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Zr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Yt.create("idb-open",{originalErrorMessage:n.message})})),ka}function N_(n){return m(this,null,function*(){try{let t=(yield zd()).transaction(Zr),r=yield t.objectStore(Zr).get(Wd(n));return yield t.done,r}catch(e){if(e instanceof qe)St.warn(e.message);else{let t=Yt.create("idb-get",{originalErrorMessage:e?.message});St.warn(t.message)}}})}function Bd(n,e){return m(this,null,function*(){try{let r=(yield zd()).transaction(Zr,"readwrite");yield r.objectStore(Zr).put(e,Wd(n)),yield r.done}catch(t){if(t instanceof qe)St.warn(t.message);else{let r=Yt.create("idb-set",{originalErrorMessage:t?.message});St.warn(r.message)}}})}function Wd(n){return`${n.name}!${n.options.appId}`}var x_=1024,O_=30,La=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ma(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return m(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=jd();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>O_){let a=L_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){St.warn(r)}})}getHeartbeatsHeader(){return m(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=jd(),{heartbeatsToSend:r,unsentEntries:i}=V_(this._heartbeatsCache.heartbeats),s=Yr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return St.warn(t),""}})}};function jd(){return new Date().toISOString().substring(0,10)}function V_(n,e=x_){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),qd(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),qd(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Ma=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return m(this,null,function*(){return Jr()?Pd().then(()=>!0).catch(()=>!1):!1})}read(){return m(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield N_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Bd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return m(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Bd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function qd(n){return Yr(JSON.stringify({version:2,heartbeats:n})).length}function L_(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function M_(n){tt(new Fe("platform-logger",e=>new Da(e),"PRIVATE")),tt(new Fe("heartbeat",e=>new La(e),"PRIVATE")),fe(Na,Ud,n),fe(Na,Ud,"esm2017"),fe("fire-js","")}M_("");var F_="firebase",U_="11.10.0";fe(F_,U_,"app");function Gd(n){n===void 0&&(n=he($e));let e=n.get(is);return t=>new yn(r=>{let i=e.add(),s=!1;function a(){s||(i(),s=!0)}let c=t.subscribe({next:l=>{r.next(l),a()},complete:()=>{r.complete(),a()},error:l=>{r.error(l),a()}});return c.add(()=>{r.unsubscribe(),a()}),c})}var Xt=new md("ANGULARFIRE2_VERSION");function ei(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Zn=(n,e)=>{let t=e?[e]:ds(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},Xn=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(Xn||{}),Hd=ga()&&typeof Zone<"u"?Xn.WARN:Xn.SILENT;var fs=class{zone;delegate;constructor(e,t=hd){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(s,t,r)}},Zt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=he(ht);this.outsideAngular=t.runOutsideAngular(()=>new fs(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new fs(typeof Zone>"u"?void 0:Zone.current,ld))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Kd=!1;function $_(n,e){!Kd&&(Hd>Xn.SILENT||ga())&&(Kd=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Hd>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function B_(n){let e=he(ht,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function wn(n){let e=he(ht,{optional:!0});return e?e.run(()=>n()):n()}var j_=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),k(t,()=>wn(()=>n.apply(void 0,r)))),ee=(n,e,t)=>(t||=e?Xn.WARN:Xn.VERBOSE,function(){let r,i=arguments,s,a,c;try{s=he(Zt),a=he(is),c=he(fd)}catch{return $_(n,t),n.apply(this,i)}for(let h=0;h<arguments.length;h++)typeof i[h]=="function"&&(e&&(r||=wn(()=>a.add())),i[h]=j_(i[h],r,c));let l=B_(()=>n.apply(this,i));return e?l instanceof yn?l.pipe(ma(s.outsideAngular),pa(s.insideAngular),Gd(c)):l instanceof Promise?wn(()=>{let h=a.add();return new Promise((f,y)=>{l.then(_=>k(c,()=>wn(()=>f(_))),_=>k(c,()=>wn(()=>y(_)))).finally(h)})}):typeof l=="function"&&r?function(){return setTimeout(r,0),l.apply(this,arguments)}:wn(()=>l):l instanceof yn?l.pipe(ma(s.outsideAngular),pa(s.insideAngular)):wn(()=>l)});var Rt=class{constructor(e){return e}},En=class{constructor(){return ds()}};function q_(n){return n&&n.length===1?n[0]:new Rt(vn())}var Ua=new Gn("angularfire2._apps"),z_={provide:Rt,useFactory:q_,deps:[[new He,Ua]]},W_={provide:En,deps:[[new He,Ua]]};function G_(n){return(e,t)=>{let r=t.get(pd);fe("angularfire",Xt.full,"core"),fe("angularfire",Xt.full,"app"),fe("angular",gd.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Rt(i)}}function sA(n,...e){return Hn([z_,W_,{provide:Ua,useFactory:G_(n),multi:!0,deps:[ht,$e,Zt,...e]}])}var oA=ee(Fa,!0);var H_=new Map,K_={activated:!1,tokenObservers:[]},Q_={initialized:!1,enabled:!1};function nt(n){return H_.get(n)||Object.assign({},K_)}function Xd(){return Q_}var Y_="https://content-firebaseappcheck.googleapis.com/v1";var J_="exchangeDebugToken",Qd={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},mA=1440*60*1e3;var ja=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new _n,this.pending.promise.catch(t=>{}),yield X_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new _n,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function X_(n){return new Promise(e=>{setTimeout(e,n)})}var Z_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},en=new et("appCheck","AppCheck",Z_);function Zd(n){if(!nt(n).activated)throw en.create("use-before-activation",{appName:n.name})}function ef(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let S=yield a.getHeartbeatsHeader();S&&(s["X-Firebase-Client"]=S)}let c={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,c)}catch(S){throw en.create("fetch-network-error",{originalErrorMessage:S?.message})}if(l.status!==200)throw en.create("fetch-status-error",{httpStatus:l.status});let h;try{h=yield l.json()}catch(S){throw en.create("fetch-parse-error",{originalErrorMessage:S?.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw en.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let y=Number(f[1])*1e3,_=Date.now();return{token:h.token,expireTimeMillis:_+y,issuedAtTimeMillis:_}})}function tf(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${Y_}/projects/${t}/apps/${r}:${J_}?key=${i}`,body:{debug_token:e}}}var eI="firebase-app-check-database",tI=1,qa="firebase-app-check-store";var ms=null;function nI(){return ms||(ms=new Promise((n,e)=>{try{let t=indexedDB.open(eI,tI);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(en.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(qa,{keyPath:"compositeKey"})}}}catch(t){e(en.create("storage-open",{originalErrorMessage:t?.message}))}}),ms)}function rI(n,e){return iI(sI(n),e)}function iI(n,e){return m(this,null,function*(){let r=(yield nI()).transaction(qa,"readwrite"),s=r.objectStore(qa).put({compositeKey:n,value:e});return new Promise((a,c)=>{s.onsuccess=l=>{a()},r.onerror=l=>{var h;c(en.create("storage-set",{originalErrorMessage:(h=l.target.error)===null||h===void 0?void 0:h.message}))}})})}function sI(n){return`${n.options.appId}-${n.name}`}var ti=new ft("@firebase/app-check");function $a(n,e){return Jr()?rI(n,e).catch(t=>{ti.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function nf(){return Xd().enabled}function rf(){return m(this,null,function*(){let n=Xd();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var oI={error:"UNKNOWN_ERROR"};function aI(n){return ss.encodeString(JSON.stringify(n),!1)}function za(n,e=!1,t=!1){return m(this,null,function*(){let r=n.app;Zd(r);let i=nt(r),s=i.token,a;if(s&&!ni(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(ni(h)?s=h:yield $a(r,void 0))}if(!e&&s&&ni(s))return{token:s.token};let c=!1;if(nf())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=ef(tf(r,yield rf()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let h=yield i.exchangeTokenPromise;return yield $a(r,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?ti.warn(h.message):t&&ti.error(h),Ba(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield nt(r).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?ti.warn(h.message):t&&ti.error(h),a=h}let l;return s?a?ni(s)?l={token:s.token,internalError:a}:l=Ba(a):(l={token:s.token},i.token=s,yield $a(r,s)):l=Ba(a),c&&hI(r,l),l})}function cI(n){return m(this,null,function*(){let e=n.app;Zd(e);let{provider:t}=nt(e);if(nf()){let r=yield rf(),{token:i}=yield ef(tf(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function uI(n,e,t,r){let{app:i}=n,s=nt(i),a={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&ni(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),Yd(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Yd(n))}function sf(n,e){let t=nt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Yd(n){let{app:e}=n,t=nt(e),r=t.tokenRefresher;r||(r=lI(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function lI(n){let{app:e}=n;return new ja(()=>m(null,null,function*(){let t=nt(e),r;if(t.token?r=yield za(n,!0):r=yield za(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=nt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Qd.RETRIAL_MIN_WAIT,Qd.RETRIAL_MAX_WAIT)}function hI(n,e){let t=nt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ni(n){return n.expireTimeMillis-Date.now()>0}function Ba(n){return{token:aI(oI),error:n}}var Wa=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=nt(this.app);for(let t of e)sf(this.app,t.next);return Promise.resolve()}};function dI(n,e){return new Wa(n,e)}function fI(n){return{getToken:e=>za(n,e),getLimitedUseToken:()=>cI(n),addTokenListener:e=>uI(n,"INTERNAL",e),removeTokenListener:e=>sf(n.app,e)}}var pI="@firebase/app-check",mI="0.10.1";var gI="app-check",Jd="app-check-internal";function yI(){tt(new Fe(gI,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return dI(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Jd).initialize()})),tt(new Fe(Jd,n=>{let e=n.getProvider("app-check").getImmediate();return fI(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),fe(pI,mI)}yI();var _I="app-check";var er=class{constructor(){return Zn(_I)}};var II=["localhost","0.0.0.0","127.0.0.1"],RA=typeof window<"u"&&II.includes(window.location.hostname);function wf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Ef=wf,Tf=new et("auth","Firebase",wf());var ws=new ft("@firebase/auth");function vI(n,...e){ws.logLevel<=Q.WARN&&ws.warn(`Auth (${Jt}): ${n}`,...e)}function ys(n,...e){ws.logLevel<=Q.ERROR&&ws.error(`Auth (${Jt}): ${n}`,...e)}function Ke(n,...e){throw fc(n,...e)}function rt(n,...e){return fc(n,...e)}function dc(n,e,t){let r=Object.assign(Object.assign({},Ef()),{[e]:t});return new et("auth","Firebase",r).create(e,{appName:n.name})}function Dt(n){return dc(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wI(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ke(n,"argument-error"),dc(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fc(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Tf.create(n,...e)}function F(n,e,...t){if(!n)throw fc(e,...t)}function Pt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw ys(e),new Error(e)}function Nt(n,e){n||Pt(e)}function Ka(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function EI(){return of()==="http:"||of()==="https:"}function of(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function TI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(EI()||Ad()||"connection"in navigator)?navigator.onLine:!0}function bI(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Tn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Nt(t>e,"Short delay should be less than long delay!"),this.isMobile=Td()||Cd()}get(){return TI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function pc(n,e){Nt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Es=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var AI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var CI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],SI=new Tn(3e4,6e4);function xt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function gt(s,a,c,l){return m(this,arguments,function*(n,e,t,r,i={}){return bf(n,i,()=>m(null,null,function*(){let h={},f={};r&&(e==="GET"?f=r:h={body:JSON.stringify(r)});let y=Kn(Object.assign({key:n.config.apiKey},f)).slice(1),_=yield n._getAdditionalHeaders();_["Content-Type"]="application/json",n.languageCode&&(_["X-Firebase-Locale"]=n.languageCode);let S=Object.assign({method:e,headers:_},h);return bd()||(S.referrerPolicy="no-referrer"),n.emulatorConfig&&Qt(n.emulatorConfig.host)&&(S.credentials="include"),Es.fetch()(yield Af(n,n.config.apiHost,t,y),S)}))})}function bf(n,e,t){return m(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},AI),e);try{let i=new Qa(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw gs(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let c=s.ok?a.errorMessage:a.error.message,[l,h]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw gs(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw gs(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw gs(n,"user-disabled",a);let f=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw dc(n,f,h);Ke(n,f)}}catch(i){if(i instanceof qe)throw i;Ke(n,"network-request-failed",{message:String(i)})}})}function li(s,a,c,l){return m(this,arguments,function*(n,e,t,r,i={}){let h=yield gt(n,e,t,r,i);return"mfaPendingCredential"in h&&Ke(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function Af(n,e,t,r){return m(this,null,function*(){let i=`${e}${t}?${r}`,s=n,a=s.config.emulator?pc(n.config,i):`${n.config.apiScheme}://${i}`;return CI.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a})}function RI(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Qa=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(rt(this.auth,"network-request-failed")),SI.get())})}};function gs(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=rt(n,e,r);return i.customData._tokenResponse=t,i}function af(n){return n!==void 0&&n.enterprise!==void 0}var Ya=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return RI(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function PI(n,e){return m(this,null,function*(){return gt(n,"GET","/v2/recaptchaConfig",xt(n,e))})}function kI(n,e){return m(this,null,function*(){return gt(n,"POST","/v1/accounts:delete",e)})}function Ts(n,e){return m(this,null,function*(){return gt(n,"POST","/v1/accounts:lookup",e)})}function ii(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function mc(n,e=!1){return m(this,null,function*(){let t=ue(n),r=yield t.getIdToken(e),i=gc(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:ii(Ga(i.auth_time)),issuedAtTime:ii(Ga(i.iat)),expirationTime:ii(Ga(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Ga(n){return Number(n)*1e3}function gc(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ys("JWT malformed, contained fewer than 3 sections"),null;try{let i=os(t);return i?JSON.parse(i):(ys("Failed to decode base64 JWT payload"),null)}catch(i){return ys("Caught error parsing JWT payload as JSON",i?.toString()),null}}function cf(n){let e=gc(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function nr(n,e,t=!1){return m(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof qe&&DI(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function DI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Ja=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>m(this,null,function*(){yield this.iteration()}),t)}iteration(){return m(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var oi=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ii(this.lastLoginAt),this.creationTime=ii(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function bs(n){return m(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield nr(n,Ts(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Cf(s.providerUserInfo):[],c=NI(n.providerData,a),l=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!c?.length,f=l?h:!1,y={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new oi(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,y)})}function yc(n){return m(this,null,function*(){let e=ue(n);yield bs(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function NI(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Cf(n){return n.map(e=>{var{providerId:t}=e,r=rs(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function xI(n,e){return m(this,null,function*(){let t=yield bf(n,{},()=>m(null,null,function*(){let r=Kn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=yield Af(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:c,body:r};return n.emulatorConfig&&Qt(n.emulatorConfig.host)&&(l.credentials="include"),Es.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function OI(n,e){return m(this,null,function*(){return gt(n,"POST","/v2/accounts:revokeToken",xt(n,e))})}var si=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=cf(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return m(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return m(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield xI(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Pt("not implemented")}};function tn(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var nn=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=rs(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ja(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new oi(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return m(this,null,function*(){let t=yield nr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return mc(this,e)}reload(){return yc(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return m(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield bs(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return m(this,null,function*(){if(Ue(this.auth.app))return Promise.reject(Dt(this.auth));let e=yield this.getIdToken();return yield nr(this,kI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,c,l,h,f;let y=(r=t.displayName)!==null&&r!==void 0?r:void 0,_=(i=t.email)!==null&&i!==void 0?i:void 0,S=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,D=(a=t.photoURL)!==null&&a!==void 0?a:void 0,V=(c=t.tenantId)!==null&&c!==void 0?c:void 0,N=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,G=(h=t.createdAt)!==null&&h!==void 0?h:void 0,j=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:H,emailVerified:ie,isAnonymous:Ve,providerData:re,stsTokenManager:E}=t;F(H&&E,e,"internal-error");let g=si.fromJSON(this.name,E);F(typeof H=="string",e,"internal-error"),tn(y,e.name),tn(_,e.name),F(typeof ie=="boolean",e,"internal-error"),F(typeof Ve=="boolean",e,"internal-error"),tn(S,e.name),tn(D,e.name),tn(V,e.name),tn(N,e.name),tn(G,e.name),tn(j,e.name);let v=new n({uid:H,auth:e,email:_,emailVerified:ie,displayName:y,isAnonymous:Ve,photoURL:D,phoneNumber:S,tenantId:V,stsTokenManager:g,createdAt:G,lastLoginAt:j});return re&&Array.isArray(re)&&(v.providerData=re.map(w=>Object.assign({},w))),N&&(v._redirectEventId=N),v}static _fromIdTokenResponse(e,t,r=!1){return m(this,null,function*(){let i=new si;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield bs(s),s})}static _fromGetAccountInfoResponse(e,t,r){return m(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Cf(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new si;c.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new oi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,h),l})}};var uf=new Map;function kt(n){Nt(n instanceof Function,"Expected a class definition");let e=uf.get(n);return e?(Nt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,uf.set(n,e),e)}var VI=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return m(this,null,function*(){return!0})}_set(t,r){return m(this,null,function*(){this.storage[t]=r})}_get(t){return m(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return m(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Xa=VI;function _s(n,e,t){return`firebase:${n}:${e}:${t}`}var As=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=_s(this.userKey,i.apiKey,s),this.fullPersistenceKey=_s("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return m(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Ts(this.auth,{idToken:e}).catch(()=>{});return t?nn._fromGetAccountInfoResponse(this.auth,t,e):null}return nn._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return m(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return m(this,null,function*(){if(!t.length)return new n(kt(Xa),e,r);let i=(yield Promise.all(t.map(h=>m(null,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||kt(Xa),a=_s(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(a);if(f){let y;if(typeof f=="string"){let _=yield Ts(e,{idToken:f}).catch(()=>{});if(!_)break;y=yield nn._fromGetAccountInfoResponse(e,_,f)}else y=nn._fromJSON(e,f);h!==s&&(c=y),s=h;break}}catch{}let l=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],c&&(yield s._set(a,c.toJSON())),yield Promise.all(t.map(h=>m(null,null,function*(){if(h!==s)try{yield h._remove(a)}catch{}}))),new n(s,e,r))})}};function lf(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Sf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Nf(e))return"Blackberry";if(xf(e))return"Webos";if(Rf(e))return"Safari";if((e.includes("chrome/")||Pf(e))&&!e.includes("edge/"))return"Chrome";if(Df(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Sf(n=Ee()){return/firefox\//i.test(n)}function Rf(n=Ee()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pf(n=Ee()){return/crios\//i.test(n)}function kf(n=Ee()){return/iemobile/i.test(n)}function Df(n=Ee()){return/android/i.test(n)}function Nf(n=Ee()){return/blackberry/i.test(n)}function xf(n=Ee()){return/webos/i.test(n)}function _c(n=Ee()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function LI(n=Ee()){var e;return _c(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function MI(){return Sd()&&document.documentMode===10}function Of(n=Ee()){return _c(n)||Df(n)||xf(n)||Nf(n)||/windows phone/i.test(n)||kf(n)}function Vf(n,e=[]){let t;switch(n){case"Browser":t=lf(Ee());break;case"Worker":t=`${lf(Ee())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Jt}/${r}`}var Za=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,c)=>{try{let l=e(s);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return m(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function FI(t){return m(this,arguments,function*(n,e={}){return gt(n,"GET","/v2/passwordPolicy",xt(n,e))})}var UI=6,ec=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:UI,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,c;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(c=l.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var tc=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Cs(this),this.idTokenSubscription=new Cs(this),this.beforeStateQueue=new Za(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Tf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=kt(t)),this._initializationPromise=this.queue(()=>m(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield As.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return m(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return m(this,null,function*(){try{let t=yield Ts(this,{idToken:e}),r=yield nn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return m(this,null,function*(){var t;if(Ue(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return m(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return m(this,null,function*(){try{yield bs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=bI()}_delete(){return m(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return m(this,null,function*(){if(Ue(this.app))return Promise.reject(Dt(this));let t=e?ue(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return m(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>m(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return m(this,null,function*(){return Ue(this.app)?Promise.reject(Dt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ue(this.app)?Promise.reject(Dt(this)):this.queue(()=>m(this,null,function*(){yield this.assertedPersistence.setPersistence(kt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return m(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return m(this,null,function*(){let e=yield FI(this),t=new ec(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new et("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return m(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield OI(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return m(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return m(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&kt(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield As.create(this,[kt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return m(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>m(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return m(this,null,function*(){if(e===this.currentUser)return this.queue(()=>m(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return m(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return m(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return m(this,null,function*(){var e;if(Ue(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&vI(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Ot(n){return ue(n)}var Cs=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Dd(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Ls={loadJS(){return m(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $I(n){Ls=n}function Lf(n){return Ls.loadJS(n)}function BI(){return Ls.recaptchaEnterpriseScript}function jI(){return Ls.gapiScript}function Mf(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var nc=class{constructor(){this.enterprise=new rc}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},rc=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var qI="recaptcha-enterprise",Ff="NO_RECAPTCHA",ic=class{constructor(e){this.type=qI,this.auth=Ot(e)}verify(e="verify",t=!1){return m(this,null,function*(){function r(s){return m(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,c)=>m(null,null,function*(){PI(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Ya(l);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,a(h.siteKey)}}).catch(l=>{c(l)})}))})}function i(s,a,c){let l=window.grecaptcha;af(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(h=>{a(h)}).catch(()=>{a(Ff)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nc().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(c=>{if(!t&&af(window.grecaptcha))i(c,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=BI();l.length!==0&&(l+=c),Lf(l).then(()=>{i(c,s,a)}).catch(h=>{a(h)})}}).catch(c=>{a(c)})})})}};function ri(n,e,t,r=!1,i=!1){return m(this,null,function*(){let s=new ic(n),a;if(i)a=Ff;else try{a=yield s.verify(t)}catch{a=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let l=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let l=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function Ss(n,e,t,r,i){return m(this,null,function*(){var s,a;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield ri(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(c=>m(null,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let l=yield ri(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("PHONE_PROVIDER")){let c=yield ri(n,e,t);return r(n,c).catch(l=>m(null,null,function*(){var h;if(((h=n._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=yield ri(n,e,t,!1,!0);return r(n,f)}return Promise.reject(l)}))}else{let c=yield ri(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")})}function Ic(n,e){let t=Jn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(dt(s,e??{}))return i;Ke(i,"already-initialized")}return t.initialize({options:e})}function zI(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(kt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ms(n,e,t){let r=Ot(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=Uf(e),{host:a,port:c}=WI(e),l=c===null?"":`:${c}`,h={url:`${s}//${a}${l}/`},f=Object.freeze({host:a,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(dt(h,r.config.emulator)&&dt(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Qt(a)?(cs(`${s}//${a}${l}`),us("Auth",!0)):i||GI()}function Uf(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function WI(n){let e=Uf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:hf(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:hf(a)}}}function hf(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function GI(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var rr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Pt("not implemented")}_getIdTokenResponse(e){return Pt("not implemented")}_linkToIdToken(e,t){return Pt("not implemented")}_getReauthenticationResolver(e){return Pt("not implemented")}};function HI(n,e){return m(this,null,function*(){return gt(n,"POST","/v1/accounts:signUp",e)})}function KI(n,e){return m(this,null,function*(){return li(n,"POST","/v1/accounts:signInWithPassword",xt(n,e))})}function QI(n,e){return m(this,null,function*(){return gt(n,"POST","/v1/accounts:sendOobCode",xt(n,e))})}function YI(n,e){return m(this,null,function*(){return QI(n,e)})}function JI(n,e){return m(this,null,function*(){return li(n,"POST","/v1/accounts:signInWithEmailLink",xt(n,e))})}function XI(n,e){return m(this,null,function*(){return li(n,"POST","/v1/accounts:signInWithEmailLink",xt(n,e))})}var ai=class n extends rr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return m(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ss(e,t,"signInWithPassword",KI,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return JI(e,{email:this._email,oobCode:this._password});default:Ke(e,"internal-error")}})}_linkToIdToken(e,t){return m(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ss(e,r,"signUpPassword",HI,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return XI(e,{idToken:t,email:this._email,oobCode:this._password});default:Ke(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function tr(n,e){return m(this,null,function*(){return li(n,"POST","/v1/accounts:signInWithIdp",xt(n,e))})}var ZI="http://localhost",Rs=class n extends rr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ke("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=rs(t,["providerId","signInMethod"]);if(!r||!i)return null;let a=new n(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){let t=this.buildRequest();return tr(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,tr(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,tr(e,t)}buildRequest(){let e={requestUri:ZI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Kn(t)}return e}};function ev(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tv(n){let e=Qn(Yn(n)).link,t=e?Qn(Yn(e)).deep_link_id:null,r=Qn(Yn(n)).deep_link_id;return(r?Qn(Yn(r)).link:null)||r||t||e||n}var Ps=class n{constructor(e){var t,r,i,s,a,c;let l=Qn(Yn(e)),h=(t=l.apiKey)!==null&&t!==void 0?t:null,f=(r=l.oobCode)!==null&&r!==void 0?r:null,y=ev((i=l.mode)!==null&&i!==void 0?i:null);F(h&&f&&y,"argument-error"),this.apiKey=h,this.operation=y,this.code=f,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.lang)!==null&&a!==void 0?a:null,this.tenantId=(c=l.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=tv(e);try{return new n(t)}catch{return null}}};var $f=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return ai._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=Ps.parseLink(r);return F(i,"argument-error"),ai._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),ci=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var ks=class extends ci{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var vc=(()=>{class n extends ks{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Rs._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();function nv(n,e){return m(this,null,function*(){return li(n,"POST","/v1/accounts:signUp",xt(n,e))})}var ir=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return m(this,null,function*(){let s=yield nn._fromIdTokenResponse(e,r,i),a=df(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return m(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=df(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function df(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var sc=class n extends qe{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Bf(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?sc._fromErrorAndOperation(n,s,e,r):s})}function rv(n,e,t=!1){return m(this,null,function*(){let r=yield nr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return ir._forOperation(n,"link",r)})}function iv(n,e,t=!1){return m(this,null,function*(){let{auth:r}=n;if(Ue(r.app))return Promise.reject(Dt(r));let i="reauthenticate";try{let s=yield nr(n,Bf(r,i,e,n),t);F(s.idToken,r,"internal-error");let a=gc(s.idToken);F(a,r,"internal-error");let{sub:c}=a;return F(n.uid===c,r,"user-mismatch"),ir._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ke(r,"user-mismatch"),s}})}function jf(n,e,t=!1){return m(this,null,function*(){if(Ue(n.app))return Promise.reject(Dt(n));let r="signIn",i=yield Bf(n,r,e),s=yield ir._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function wc(n,e){return m(this,null,function*(){return jf(Ot(n),e)})}function sv(n,e,t){var r;F(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),F(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),F(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(F(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(F(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function qf(n){return m(this,null,function*(){let e=Ot(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Ec(n,e,t){return m(this,null,function*(){let r=Ot(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&sv(r,i,t),yield Ss(r,i,"getOobCode",YI,"EMAIL_PASSWORD_PROVIDER")})}function Tc(n,e,t){return m(this,null,function*(){if(Ue(n.app))return Promise.reject(Dt(n));let r=Ot(n),a=yield Ss(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nv,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&qf(n),l}),c=yield ir._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(c.user),c})}function bc(n,e,t){return Ue(n.app)?Promise.reject(Dt(n)):wc(ue(n),$f.credential(e,t)).catch(r=>m(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&qf(n),r}))}function ov(n,e){return m(this,null,function*(){return gt(n,"POST","/v1/accounts:update",e)})}function Ac(r,i){return m(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ue(n),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},l=yield nr(s,ov(s.auth,c));s.displayName=l.displayName||null,s.photoURL=l.photoUrl||null;let h=s.providerData.find(({providerId:f})=>f==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(l)})}function hi(n,e,t,r){return ue(n).onIdTokenChanged(e,t,r)}function Cc(n,e,t){return ue(n).beforeAuthStateChanged(e,t)}function Sc(n){return ue(n).signOut()}var Ds="__sak";var Ns=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ds,"1"),this.storage.removeItem(Ds),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var av=1e3,cv=10,uv=(()=>{class n extends Ns{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Of(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,l,h)=>{this.notifyListeners(c,h)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},a=this.storage.getItem(i);MI()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,cv):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},av)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return m(this,null,function*(){yield Kt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return m(this,null,function*(){let r=yield Kt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return m(this,null,function*(){yield Kt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),zf=uv;var lv=(()=>{class n extends Ns{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Rc=lv;function hv(n){return Promise.all(n.map(e=>m(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var dv=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return m(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let l=Array.from(c).map(f=>m(this,null,function*(){return f(r.origin,a)})),h=yield hv(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Pc(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var oc=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return m(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((c,l)=>{let h=Pc("",20);i.port1.start();let f=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(y){let _=y;if(_.data.eventId===h)switch(_.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(_.data.response);break;default:clearTimeout(f),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function mt(){return window}function fv(n){mt().location.href=n}function Wf(){return typeof mt().WorkerGlobalScope<"u"&&typeof mt().importScripts=="function"}function pv(){return m(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function mv(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function gv(){return Wf()?self:null}var Gf="firebaseLocalStorageDb",yv=1,xs="firebaseLocalStorage",Hf="fbase_key",bn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Fs(n,e){return n.transaction([xs],e?"readwrite":"readonly").objectStore(xs)}function _v(){let n=indexedDB.deleteDatabase(Gf);return new bn(n).toPromise()}function ac(){let n=indexedDB.open(Gf,yv);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(xs,{keyPath:Hf})}catch(i){t(i)}}),n.addEventListener("success",()=>m(null,null,function*(){let r=n.result;r.objectStoreNames.contains(xs)?e(r):(r.close(),yield _v(),e(yield ac()))}))})}function ff(n,e,t){return m(this,null,function*(){let r=Fs(n,!0).put({[Hf]:e,value:t});return new bn(r).toPromise()})}function Iv(n,e){return m(this,null,function*(){let t=Fs(n,!1).get(e),r=yield new bn(t).toPromise();return r===void 0?null:r.value})}function pf(n,e){let t=Fs(n,!0).delete(e);return new bn(t).toPromise()}var vv=800,wv=3,Ev=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return m(this,null,function*(){return this.db?this.db:(this.db=yield ac(),this.db)})}_withRetries(t){return m(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>wv)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return m(this,null,function*(){return Wf()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return m(this,null,function*(){this.receiver=dv._getInstance(gv()),this.receiver._subscribe("keyChanged",(t,r)=>m(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>m(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return m(this,null,function*(){var t,r;if(this.activeServiceWorker=yield pv(),!this.activeServiceWorker)return;this.sender=new oc(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return m(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||mv()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return m(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ac();return yield ff(t,Ds,"1"),yield pf(t,Ds),!0}catch{}return!1})}_withPendingWrite(t){return m(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(i=>ff(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return m(this,null,function*(){let r=yield this._withRetries(i=>Iv(i,t));return this.localCache[t]=r,r})}_remove(t){return m(this,null,function*(){return this._withPendingWrite(()=>m(this,null,function*(){return yield this._withRetries(r=>pf(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return m(this,null,function*(){let t=yield this._withRetries(s=>{let a=Fs(s,!1).getAll();return new bn(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>m(this,null,function*(){return this._poll()}),vv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Kf=Ev;var LA=Mf("rcb"),MA=new Tn(3e4,6e4);function Qf(n,e){return e?kt(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var ui=class extends rr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return tr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return tr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Tv(n){return jf(n.auth,new ui(n),n.bypassAuthState)}function bv(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),iv(t,new ui(n),n.bypassAuthState)}function Av(n){return m(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),rv(t,new ui(n),n.bypassAuthState)})}var Os=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>m(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return m(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:c}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(l))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Tv;case"linkViaPopup":case"linkViaRedirect":return Av;case"reauthViaPopup":case"reauthViaRedirect":return bv;default:Ke(this.auth,"internal-error")}}resolve(e){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Cv=new Tn(2e3,1e4);function kc(n,e,t){return m(this,null,function*(){if(Ue(n.app))return Promise.reject(rt(n,"operation-not-supported-in-this-environment"));let r=Ot(n);wI(n,e,ci);let i=Qf(r,t);return new Sv(r,"signInViaPopup",e,i).executeNotNull()})}var Sv=(()=>{class n extends Os{constructor(t,r,i,s,a){super(t,r,s,a),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return m(this,null,function*(){let t=yield this.execute();return F(t,this.auth,"internal-error"),t})}onExecution(){return m(this,null,function*(){Nt(this.filter.length===1,"Popup operations only handle one event");let t=Pc();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(rt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(rt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Cv.get())};t()}}n.currentPopupAction=null;return n})(),Rv="pendingRedirect",Is=new Map,cc=class n extends Os{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return m(this,null,function*(){let e=Is.get(this.auth._key());if(!e){try{let r=(yield Pv(this.resolver,this.auth))?yield Kt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Is.set(this.auth._key(),e)}return this.bypassAuthState||Is.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return m(this,null,function*(){if(e.type==="signInViaRedirect")return Kt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Kt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return m(this,null,function*(){})}cleanUp(){}};function Pv(n,e){return m(this,null,function*(){let t=Nv(e),r=Dv(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function kv(n,e){Is.set(n._key(),e)}function Dv(n){return kt(n._redirectPersistence)}function Nv(n){return _s(Rv,n.config.apiKey,n.name)}function xv(n,e,t=!1){return m(this,null,function*(){if(Ue(n.app))return Promise.reject(Dt(n));let r=Ot(n),i=Qf(r,e),a=yield new cc(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var Ov=600*1e3,uc=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Vv(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Yf(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(rt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Ov&&this.cachedEventUids.clear(),this.cachedEventUids.has(mf(e))}saveEventToCache(e){this.cachedEventUids.add(mf(e)),this.lastProcessedEventTime=Date.now()}};function mf(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Yf({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Vv(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yf(n);default:return!1}}function Lv(t){return m(this,arguments,function*(n,e={}){return gt(n,"GET","/v1/projects",e)})}var Mv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Fv=/^https?/;function Uv(n){return m(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield Lv(n);for(let t of e)try{if($v(t))return}catch{}Ke(n,"unauthorized-domain")})}function $v(n){let e=Ka(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Fv.test(t))return!1;if(Mv.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Bv=new Tn(3e4,6e4);function gf(){let n=mt().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function jv(n){return new Promise((e,t)=>{var r,i,s;function a(){gf(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gf(),t(rt(n,"network-request-failed"))},timeout:Bv.get()})}if(!((i=(r=mt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=mt().gapi)===null||s===void 0)&&s.load)a();else{let c=Mf("iframefcb");return mt()[c]=()=>{gapi.load?a():t(rt(n,"network-request-failed"))},Lf(`${jI()}?onload=${c}`).catch(l=>t(l))}}).catch(e=>{throw vs=null,e})}var vs=null;function qv(n){return vs=vs||jv(n),vs}var zv=new Tn(5e3,15e3),Wv="__/auth/iframe",Gv="emulator/auth/iframe",Hv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Qv(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?pc(e,Gv):`https://${n.config.authDomain}/${Wv}`,r={apiKey:e.apiKey,appName:n.name,v:Jt},i=Kv.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Kn(r).slice(1)}`}function Yv(n){return m(this,null,function*(){let e=yield qv(n),t=mt().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:Qv(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Hv,dontclear:!0},r=>new Promise((i,s)=>m(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=rt(n,"network-request-failed"),c=mt().setTimeout(()=>{s(a)},zv.get());function l(){mt().clearTimeout(c),i(r)}r.ping(l).then(l,()=>{s(a)})})))})}var Jv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Xv=500,Zv=600,ew="_blank",tw="http://localhost",Vs=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function nw(n,e,t,r=Xv,i=Zv){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",l=Object.assign(Object.assign({},Jv),{width:r.toString(),height:i.toString(),top:s,left:a}),h=Ee().toLowerCase();t&&(c=Pf(h)?ew:t),Sf(h)&&(e=e||tw,l.scrollbars="yes");let f=Object.entries(l).reduce((_,[S,D])=>`${_}${S}=${D},`,"");if(LI(h)&&c!=="_self")return rw(e||"",c),new Vs(null);let y=window.open(e||"",c,f);F(y,n,"popup-blocked");try{y.focus()}catch{}return new Vs(y)}function rw(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var iw="__/auth/handler",sw="emulator/auth/handler",ow=encodeURIComponent("fac");function yf(n,e,t,r,i,s){return m(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Jt,eventId:i};if(e instanceof ci){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",kd(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,y]of Object.entries(s||{}))a[f]=y}if(e instanceof ks){let f=e.getScopes().filter(y=>y!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);let c=a;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let l=yield n._getAppCheckToken(),h=l?`#${ow}=${encodeURIComponent(l)}`:"";return`${aw(n)}?${Kn(c).slice(1)}${h}`})}function aw({config:n}){return n.emulator?pc(n,sw):`https://${n.authDomain}/${iw}`}var Ha="webStorageSupport",lc=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Rc,this._completeRedirectFn=xv,this._overrideRedirectResult=kv}_openPopup(e,t,r,i){return m(this,null,function*(){var s;Nt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield yf(e,t,r,Ka(),i);return nw(e,a,Pc())})}_openRedirect(e,t,r,i){return m(this,null,function*(){yield this._originValidation(e);let s=yield yf(e,t,r,Ka(),i);return fv(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Nt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return m(this,null,function*(){let t=yield Yv(e),r=new uc(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ha,{type:Ha},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[Ha];a!==void 0&&t(!!a),Ke(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Uv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Of()||Rf()||_c()}},Jf=lc;var _f="@firebase/auth",If="1.10.8";var hc=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return m(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function cw(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function uw(n){tt(new Fe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vf(n)},h=new tc(r,i,s,l);return zI(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),tt(new Fe("auth-internal",e=>{let t=Ot(e.getProvider("auth").getImmediate());return(r=>new hc(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fe(_f,If,cw(n)),fe(_f,If,"esm2017")}var lw=300,hw=Ta("authIdTokenMaxAge")||lw,vf=null,dw=n=>e=>m(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>hw)return;let i=t?.token;vf!==i&&(vf=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Dc(n=vn()){let e=Jn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Ic(n,{popupRedirectResolver:Jf,persistence:[Kf,zf,Rc]}),r=Ta("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=dw(s.toString());Cc(t,a,()=>a(t.currentUser)),hi(t,c=>a(c))}}let i=wa("auth");return i&&Ms(t,`http://${i}`),t}function fw(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}$I({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=rt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",fw().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});uw("Browser");function ep(n){return new yn(function(e){var t=hi(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var tp="auth",An=class{constructor(e){return e}},di=class{constructor(){return Zn(tp)}};var Nc=new Gn("angularfire2.auth-instances");function Jw(n,e){let t=ei(tp,n,e);return t&&new An(t)}function Xw(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new An(r)}}var Zw={provide:di,deps:[[new He,Nc]]},eE={provide:An,useFactory:Jw,deps:[[new He,Nc],Rt]};function PC(n,...e){return fe("angularfire",Xt.full,"auth"),Hn([eE,Zw,{provide:Nc,useFactory:Xw(n),multi:!0,deps:[ht,$e,Zt,En,[new He,er],...e]}])}var np=ee(ep,!0);var kC=ee(Ms,!0),xc=ee(Tc,!0,2);var DC=ee(Dc,!0);var rp=ee(Ec,!0,2);var ip=ee(bc,!0,2);var sp=ee(kc,!0,2);var Oc=ee(Sc,!0,2);var op=ee(Ac,!0,2);var ap=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cp={};var Vt,Vc;(function(){var n;function e(E,g){function v(){}v.prototype=g.prototype,E.D=g.prototype,E.prototype=new v,E.prototype.constructor=E,E.C=function(w,T,A){for(var I=Array(arguments.length-2),bt=2;bt<arguments.length;bt++)I[bt-2]=arguments[bt];return g.prototype[T].apply(w,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,g,v){v||(v=0);var w=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)w[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;16>T;++T)w[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=E.g[0],v=E.g[1],T=E.g[2];var A=E.g[3],I=g+(A^v&(T^A))+w[0]+3614090360&4294967295;g=v+(I<<7&4294967295|I>>>25),I=A+(T^g&(v^T))+w[1]+3905402710&4294967295,A=g+(I<<12&4294967295|I>>>20),I=T+(v^A&(g^v))+w[2]+606105819&4294967295,T=A+(I<<17&4294967295|I>>>15),I=v+(g^T&(A^g))+w[3]+3250441966&4294967295,v=T+(I<<22&4294967295|I>>>10),I=g+(A^v&(T^A))+w[4]+4118548399&4294967295,g=v+(I<<7&4294967295|I>>>25),I=A+(T^g&(v^T))+w[5]+1200080426&4294967295,A=g+(I<<12&4294967295|I>>>20),I=T+(v^A&(g^v))+w[6]+2821735955&4294967295,T=A+(I<<17&4294967295|I>>>15),I=v+(g^T&(A^g))+w[7]+4249261313&4294967295,v=T+(I<<22&4294967295|I>>>10),I=g+(A^v&(T^A))+w[8]+1770035416&4294967295,g=v+(I<<7&4294967295|I>>>25),I=A+(T^g&(v^T))+w[9]+2336552879&4294967295,A=g+(I<<12&4294967295|I>>>20),I=T+(v^A&(g^v))+w[10]+4294925233&4294967295,T=A+(I<<17&4294967295|I>>>15),I=v+(g^T&(A^g))+w[11]+2304563134&4294967295,v=T+(I<<22&4294967295|I>>>10),I=g+(A^v&(T^A))+w[12]+1804603682&4294967295,g=v+(I<<7&4294967295|I>>>25),I=A+(T^g&(v^T))+w[13]+4254626195&4294967295,A=g+(I<<12&4294967295|I>>>20),I=T+(v^A&(g^v))+w[14]+2792965006&4294967295,T=A+(I<<17&4294967295|I>>>15),I=v+(g^T&(A^g))+w[15]+1236535329&4294967295,v=T+(I<<22&4294967295|I>>>10),I=g+(T^A&(v^T))+w[1]+4129170786&4294967295,g=v+(I<<5&4294967295|I>>>27),I=A+(v^T&(g^v))+w[6]+3225465664&4294967295,A=g+(I<<9&4294967295|I>>>23),I=T+(g^v&(A^g))+w[11]+643717713&4294967295,T=A+(I<<14&4294967295|I>>>18),I=v+(A^g&(T^A))+w[0]+3921069994&4294967295,v=T+(I<<20&4294967295|I>>>12),I=g+(T^A&(v^T))+w[5]+3593408605&4294967295,g=v+(I<<5&4294967295|I>>>27),I=A+(v^T&(g^v))+w[10]+38016083&4294967295,A=g+(I<<9&4294967295|I>>>23),I=T+(g^v&(A^g))+w[15]+3634488961&4294967295,T=A+(I<<14&4294967295|I>>>18),I=v+(A^g&(T^A))+w[4]+3889429448&4294967295,v=T+(I<<20&4294967295|I>>>12),I=g+(T^A&(v^T))+w[9]+568446438&4294967295,g=v+(I<<5&4294967295|I>>>27),I=A+(v^T&(g^v))+w[14]+3275163606&4294967295,A=g+(I<<9&4294967295|I>>>23),I=T+(g^v&(A^g))+w[3]+4107603335&4294967295,T=A+(I<<14&4294967295|I>>>18),I=v+(A^g&(T^A))+w[8]+1163531501&4294967295,v=T+(I<<20&4294967295|I>>>12),I=g+(T^A&(v^T))+w[13]+2850285829&4294967295,g=v+(I<<5&4294967295|I>>>27),I=A+(v^T&(g^v))+w[2]+4243563512&4294967295,A=g+(I<<9&4294967295|I>>>23),I=T+(g^v&(A^g))+w[7]+1735328473&4294967295,T=A+(I<<14&4294967295|I>>>18),I=v+(A^g&(T^A))+w[12]+2368359562&4294967295,v=T+(I<<20&4294967295|I>>>12),I=g+(v^T^A)+w[5]+4294588738&4294967295,g=v+(I<<4&4294967295|I>>>28),I=A+(g^v^T)+w[8]+2272392833&4294967295,A=g+(I<<11&4294967295|I>>>21),I=T+(A^g^v)+w[11]+1839030562&4294967295,T=A+(I<<16&4294967295|I>>>16),I=v+(T^A^g)+w[14]+4259657740&4294967295,v=T+(I<<23&4294967295|I>>>9),I=g+(v^T^A)+w[1]+2763975236&4294967295,g=v+(I<<4&4294967295|I>>>28),I=A+(g^v^T)+w[4]+1272893353&4294967295,A=g+(I<<11&4294967295|I>>>21),I=T+(A^g^v)+w[7]+4139469664&4294967295,T=A+(I<<16&4294967295|I>>>16),I=v+(T^A^g)+w[10]+3200236656&4294967295,v=T+(I<<23&4294967295|I>>>9),I=g+(v^T^A)+w[13]+681279174&4294967295,g=v+(I<<4&4294967295|I>>>28),I=A+(g^v^T)+w[0]+3936430074&4294967295,A=g+(I<<11&4294967295|I>>>21),I=T+(A^g^v)+w[3]+3572445317&4294967295,T=A+(I<<16&4294967295|I>>>16),I=v+(T^A^g)+w[6]+76029189&4294967295,v=T+(I<<23&4294967295|I>>>9),I=g+(v^T^A)+w[9]+3654602809&4294967295,g=v+(I<<4&4294967295|I>>>28),I=A+(g^v^T)+w[12]+3873151461&4294967295,A=g+(I<<11&4294967295|I>>>21),I=T+(A^g^v)+w[15]+530742520&4294967295,T=A+(I<<16&4294967295|I>>>16),I=v+(T^A^g)+w[2]+3299628645&4294967295,v=T+(I<<23&4294967295|I>>>9),I=g+(T^(v|~A))+w[0]+4096336452&4294967295,g=v+(I<<6&4294967295|I>>>26),I=A+(v^(g|~T))+w[7]+1126891415&4294967295,A=g+(I<<10&4294967295|I>>>22),I=T+(g^(A|~v))+w[14]+2878612391&4294967295,T=A+(I<<15&4294967295|I>>>17),I=v+(A^(T|~g))+w[5]+4237533241&4294967295,v=T+(I<<21&4294967295|I>>>11),I=g+(T^(v|~A))+w[12]+1700485571&4294967295,g=v+(I<<6&4294967295|I>>>26),I=A+(v^(g|~T))+w[3]+2399980690&4294967295,A=g+(I<<10&4294967295|I>>>22),I=T+(g^(A|~v))+w[10]+4293915773&4294967295,T=A+(I<<15&4294967295|I>>>17),I=v+(A^(T|~g))+w[1]+2240044497&4294967295,v=T+(I<<21&4294967295|I>>>11),I=g+(T^(v|~A))+w[8]+1873313359&4294967295,g=v+(I<<6&4294967295|I>>>26),I=A+(v^(g|~T))+w[15]+4264355552&4294967295,A=g+(I<<10&4294967295|I>>>22),I=T+(g^(A|~v))+w[6]+2734768916&4294967295,T=A+(I<<15&4294967295|I>>>17),I=v+(A^(T|~g))+w[13]+1309151649&4294967295,v=T+(I<<21&4294967295|I>>>11),I=g+(T^(v|~A))+w[4]+4149444226&4294967295,g=v+(I<<6&4294967295|I>>>26),I=A+(v^(g|~T))+w[11]+3174756917&4294967295,A=g+(I<<10&4294967295|I>>>22),I=T+(g^(A|~v))+w[2]+718787259&4294967295,T=A+(I<<15&4294967295|I>>>17),I=v+(A^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(I<<21&4294967295|I>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.u=function(E,g){g===void 0&&(g=E.length);for(var v=g-this.blockSize,w=this.B,T=this.h,A=0;A<g;){if(T==0)for(;A<=v;)i(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(w[T++]=E.charCodeAt(A++),T==this.blockSize){i(this,w),T=0;break}}else for(;A<g;)if(w[T++]=E[A++],T==this.blockSize){i(this,w),T=0;break}}this.h=T,this.o+=g},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;var v=8*this.o;for(g=E.length-8;g<E.length;++g)E[g]=v&255,v/=256;for(this.u(E),E=Array(16),g=v=0;4>g;++g)for(var w=0;32>w;w+=8)E[v++]=this.g[g]>>>w&255;return E};function s(E,g){var v=c;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=g(E)}function a(E,g){this.h=g;for(var v=[],w=!0,T=E.length-1;0<=T;T--){var A=E[T]|0;w&&A==g||(v[T]=A,w=!1)}this.g=v}var c={};function l(E){return-128<=E&&128>E?s(E,function(g){return new a([g|0],0>g?-1:0)}):new a([E|0],0>E?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return y;if(0>E)return N(h(-E));for(var g=[],v=1,w=0;E>=v;w++)g[w]=E/v|0,v*=4294967296;return new a(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return N(f(E.substring(1),g));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(g,8)),w=y,T=0;T<E.length;T+=8){var A=Math.min(8,E.length-T),I=parseInt(E.substring(T,T+A),g);8>A?(A=h(Math.pow(g,A)),w=w.j(A).add(h(I))):(w=w.j(v),w=w.add(h(I)))}return w}var y=l(0),_=l(1),S=l(16777216);n=a.prototype,n.m=function(){if(V(this))return-N(this).m();for(var E=0,g=1,v=0;v<this.g.length;v++){var w=this.i(v);E+=(0<=w?w:4294967296+w)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(D(this))return"0";if(V(this))return"-"+N(this).toString(E);for(var g=h(Math.pow(E,6)),v=this,w="";;){var T=ie(v,g).g;v=G(v,T.j(g));var A=((0<v.g.length?v.g[0]:v.h)>>>0).toString(E);if(v=T,D(v))return A+w;for(;6>A.length;)A="0"+A;w=A+w}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function D(E){if(E.h!=0)return!1;for(var g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function V(E){return E.h==-1}n.l=function(E){return E=G(this,E),V(E)?-1:D(E)?0:1};function N(E){for(var g=E.g.length,v=[],w=0;w<g;w++)v[w]=~E.g[w];return new a(v,~E.h).add(_)}n.abs=function(){return V(this)?N(this):this},n.add=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0,T=0;T<=g;T++){var A=w+(this.i(T)&65535)+(E.i(T)&65535),I=(A>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=I>>>16,A&=65535,I&=65535,v[T]=I<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function G(E,g){return E.add(N(g))}n.j=function(E){if(D(this)||D(E))return y;if(V(this))return V(E)?N(this).j(N(E)):N(N(this).j(E));if(V(E))return N(this.j(N(E)));if(0>this.l(S)&&0>E.l(S))return h(this.m()*E.m());for(var g=this.g.length+E.g.length,v=[],w=0;w<2*g;w++)v[w]=0;for(w=0;w<this.g.length;w++)for(var T=0;T<E.g.length;T++){var A=this.i(w)>>>16,I=this.i(w)&65535,bt=E.i(T)>>>16,kr=E.i(T)&65535;v[2*w+2*T]+=I*kr,j(v,2*w+2*T),v[2*w+2*T+1]+=A*kr,j(v,2*w+2*T+1),v[2*w+2*T+1]+=I*bt,j(v,2*w+2*T+1),v[2*w+2*T+2]+=A*bt,j(v,2*w+2*T+2)}for(w=0;w<g;w++)v[w]=v[2*w+1]<<16|v[2*w];for(w=g;w<2*g;w++)v[w]=0;return new a(v,0)};function j(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function H(E,g){this.g=E,this.h=g}function ie(E,g){if(D(g))throw Error("division by zero");if(D(E))return new H(y,y);if(V(E))return g=ie(N(E),g),new H(N(g.g),N(g.h));if(V(g))return g=ie(E,N(g)),new H(N(g.g),g.h);if(30<E.g.length){if(V(E)||V(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,w=g;0>=w.l(E);)v=Ve(v),w=Ve(w);var T=re(v,1),A=re(w,1);for(w=re(w,2),v=re(v,2);!D(w);){var I=A.add(w);0>=I.l(E)&&(T=T.add(v),A=I),w=re(w,1),v=re(v,1)}return g=G(E,T.j(g)),new H(T,g)}for(T=y;0<=E.l(g);){for(v=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(v)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),A=h(v),I=A.j(g);V(I)||0<I.l(E);)v-=w,A=h(v),I=A.j(g);D(A)&&(A=_),T=T.add(A),E=G(E,I)}return new H(T,E)}n.A=function(E){return ie(this,E).h},n.and=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)&E.i(w);return new a(v,this.h&E.h)},n.or=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)|E.i(w);return new a(v,this.h|E.h)},n.xor=function(E){for(var g=Math.max(this.g.length,E.g.length),v=[],w=0;w<g;w++)v[w]=this.i(w)^E.i(w);return new a(v,this.h^E.h)};function Ve(E){for(var g=E.g.length+1,v=[],w=0;w<g;w++)v[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(v,E.h)}function re(E,g){var v=g>>5;g%=32;for(var w=E.g.length-v,T=[],A=0;A<w;A++)T[A]=0<g?E.i(A+v)>>>g|E.i(A+v+1)<<32-g:E.i(A+v);return new a(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Vc=cp.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Vt=cp.Integer=a}).apply(typeof ap<"u"?ap:typeof self<"u"?self:typeof window<"u"?window:{});var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lt={};var Lc,tE,sr,Mc,fi,$s,Fc,Uc,$c;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,d){return o==Array.prototype||o==Object.prototype||(o[u]=d.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Us=="object"&&Us];for(var u=0;u<o.length;++u){var d=o[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(o,u){if(u)e:{var d=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var b=o[p];if(!(b in d))break e;d=d[b]}o=o[o.length-1],p=d[o],u=u(p),u!=p&&u!=null&&e(d,o,{configurable:!0,writable:!0,value:u})}}function s(o,u){o instanceof String&&(o+="");var d=0,p=!1,b={next:function(){if(!p&&d<o.length){var C=d++;return{value:u(C,o[C]),done:!1}}return p=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(o){return o||function(){return s(this,function(u,d){return d})}});var a=a||{},c=this||self;function l(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function h(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function f(o,u,d){return o.call.apply(o.bind,arguments)}function y(o,u,d){if(!o)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,p),o.apply(u,b)}}return function(){return o.apply(u,arguments)}}function _(o,u,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:y,_.apply(null,arguments)}function S(o,u){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function D(o,u){function d(){}d.prototype=u.prototype,o.aa=u.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(p,b,C){for(var x=Array(arguments.length-2),se=2;se<arguments.length;se++)x[se-2]=arguments[se];return u.prototype[b].apply(p,x)}}function V(o){let u=o.length;if(0<u){let d=Array(u);for(let p=0;p<u;p++)d[p]=o[p];return d}return[]}function N(o,u){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(l(p)){let b=o.length||0,C=p.length||0;o.length=b+C;for(let x=0;x<C;x++)o[b+x]=p[x]}else o.push(p)}}class G{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function j(o){return/^[\s\xa0]*$/.test(o)}function H(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function ie(o){return ie[" "](o),o}ie[" "]=function(){};var Ve=H().indexOf("Gecko")!=-1&&!(H().toLowerCase().indexOf("webkit")!=-1&&H().indexOf("Edge")==-1)&&!(H().indexOf("Trident")!=-1||H().indexOf("MSIE")!=-1)&&H().indexOf("Edge")==-1;function re(o,u,d){for(let p in o)u.call(d,o[p],p,o)}function E(o,u){for(let d in o)u.call(void 0,o[d],d,o)}function g(o){let u={};for(let d in o)u[d]=o[d];return u}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,u){let d,p;for(let b=1;b<arguments.length;b++){p=arguments[b];for(d in p)o[d]=p[d];for(let C=0;C<v.length;C++)d=v[C],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function T(o){var u=1;o=o.split(":");let d=[];for(;0<u&&o.length;)d.push(o.shift()),u--;return o.length&&d.push(o.join(":")),d}function A(o){c.setTimeout(()=>{throw o},0)}function I(){var o=jo;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class bt{constructor(){this.h=this.g=null}add(u,d){let p=kr.get();p.set(u,d),this.h?this.h.next=p:this.g=p,this.h=p}}var kr=new G(()=>new Wg,o=>o.reset());class Wg{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Dr,Nr=!1,jo=new bt,uh=()=>{let o=c.Promise.resolve(void 0);Dr=()=>{o.then(Gg)}};var Gg=()=>{for(var o;o=I();){try{o.h.call(o.g)}catch(d){A(d)}var u=kr;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}Nr=!1};function zt(){this.s=this.s,this.C=this.C}zt.prototype.s=!1,zt.prototype.ma=function(){this.s||(this.s=!0,this.N())},zt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Re(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}Re.prototype.h=function(){this.defaultPrevented=!0};var Hg=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};c.addEventListener("test",d,u),c.removeEventListener("test",d,u)}catch{}return o})();function xr(o,u){if(Re.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(Ve){e:{try{ie(u.nodeName);var b=!0;break e}catch{}b=!1}b||(u=null)}}else d=="mouseover"?u=o.fromElement:d=="mouseout"&&(u=o.toElement);this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Kg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&xr.aa.h.call(this)}}D(xr,Re);var Kg={2:"touch",3:"pen",4:"mouse"};xr.prototype.h=function(){xr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Or="closure_listenable_"+(1e6*Math.random()|0),Qg=0;function Yg(o,u,d,p,b){this.listener=o,this.proxy=null,this.src=u,this.type=d,this.capture=!!p,this.ha=b,this.key=++Qg,this.da=this.fa=!1}function $i(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Bi(o){this.src=o,this.g={},this.h=0}Bi.prototype.add=function(o,u,d,p,b){var C=o.toString();o=this.g[C],o||(o=this.g[C]=[],this.h++);var x=zo(o,u,p,b);return-1<x?(u=o[x],d||(u.fa=!1)):(u=new Yg(u,this.src,C,!!p,b),u.fa=d,o.push(u)),u};function qo(o,u){var d=u.type;if(d in o.g){var p=o.g[d],b=Array.prototype.indexOf.call(p,u,void 0),C;(C=0<=b)&&Array.prototype.splice.call(p,b,1),C&&($i(u),o.g[d].length==0&&(delete o.g[d],o.h--))}}function zo(o,u,d,p){for(var b=0;b<o.length;++b){var C=o[b];if(!C.da&&C.listener==u&&C.capture==!!d&&C.ha==p)return b}return-1}var Wo="closure_lm_"+(1e6*Math.random()|0),Go={};function lh(o,u,d,p,b){if(p&&p.once)return dh(o,u,d,p,b);if(Array.isArray(u)){for(var C=0;C<u.length;C++)lh(o,u[C],d,p,b);return null}return d=Yo(d),o&&o[Or]?o.K(u,d,h(p)?!!p.capture:!!p,b):hh(o,u,d,!1,p,b)}function hh(o,u,d,p,b,C){if(!u)throw Error("Invalid event type");var x=h(b)?!!b.capture:!!b,se=Ko(o);if(se||(o[Wo]=se=new Bi(o)),d=se.add(u,d,p,x,C),d.proxy)return d;if(p=Jg(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)Hg||(b=x),b===void 0&&(b=!1),o.addEventListener(u.toString(),p,b);else if(o.attachEvent)o.attachEvent(ph(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Jg(){function o(d){return u.call(o.src,o.listener,d)}let u=Xg;return o}function dh(o,u,d,p,b){if(Array.isArray(u)){for(var C=0;C<u.length;C++)dh(o,u[C],d,p,b);return null}return d=Yo(d),o&&o[Or]?o.L(u,d,h(p)?!!p.capture:!!p,b):hh(o,u,d,!0,p,b)}function fh(o,u,d,p,b){if(Array.isArray(u))for(var C=0;C<u.length;C++)fh(o,u[C],d,p,b);else p=h(p)?!!p.capture:!!p,d=Yo(d),o&&o[Or]?(o=o.i,u=String(u).toString(),u in o.g&&(C=o.g[u],d=zo(C,d,p,b),-1<d&&($i(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete o.g[u],o.h--)))):o&&(o=Ko(o))&&(u=o.g[u.toString()],o=-1,u&&(o=zo(u,d,p,b)),(d=-1<o?u[o]:null)&&Ho(d))}function Ho(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Or])qo(u.i,o);else{var d=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(d,p,o.capture):u.detachEvent?u.detachEvent(ph(d),p):u.addListener&&u.removeListener&&u.removeListener(p),(d=Ko(u))?(qo(d,o),d.h==0&&(d.src=null,u[Wo]=null)):$i(o)}}}function ph(o){return o in Go?Go[o]:Go[o]="on"+o}function Xg(o,u){if(o.da)o=!0;else{u=new xr(u,this);var d=o.listener,p=o.ha||o.src;o.fa&&Ho(o),o=d.call(p,u)}return o}function Ko(o){return o=o[Wo],o instanceof Bi?o:null}var Qo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yo(o){return typeof o=="function"?o:(o[Qo]||(o[Qo]=function(u){return o.handleEvent(u)}),o[Qo])}function Pe(){zt.call(this),this.i=new Bi(this),this.M=this,this.F=null}D(Pe,zt),Pe.prototype[Or]=!0,Pe.prototype.removeEventListener=function(o,u,d,p){fh(this,o,u,d,p)};function Le(o,u){var d,p=o.F;if(p)for(d=[];p;p=p.F)d.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new Re(u,o);else if(u instanceof Re)u.target=u.target||o;else{var b=u;u=new Re(p,o),w(u,b)}if(b=!0,d)for(var C=d.length-1;0<=C;C--){var x=u.g=d[C];b=ji(x,p,!0,u)&&b}if(x=u.g=o,b=ji(x,p,!0,u)&&b,b=ji(x,p,!1,u)&&b,d)for(C=0;C<d.length;C++)x=u.g=d[C],b=ji(x,p,!1,u)&&b}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var d=o.g[u],p=0;p<d.length;p++)$i(d[p]);delete o.g[u],o.h--}}this.F=null},Pe.prototype.K=function(o,u,d,p){return this.i.add(String(o),u,!1,d,p)},Pe.prototype.L=function(o,u,d,p){return this.i.add(String(o),u,!0,d,p)};function ji(o,u,d,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var b=!0,C=0;C<u.length;++C){var x=u[C];if(x&&!x.da&&x.capture==d){var se=x.listener,Ae=x.ha||x.src;x.fa&&qo(o.i,x),b=se.call(Ae,p)!==!1&&b}}return b&&!p.defaultPrevented}function mh(o,u,d){if(typeof o=="function")d&&(o=_(o,d));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function gh(o){o.g=mh(()=>{o.g=null,o.i&&(o.i=!1,gh(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class Zg extends zt{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:gh(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vr(o){zt.call(this),this.h=o,this.g={}}D(Vr,zt);var yh=[];function _h(o){re(o.g,function(u,d){this.g.hasOwnProperty(d)&&Ho(u)},o),o.g={}}Vr.prototype.N=function(){Vr.aa.N.call(this),_h(this)},Vr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Jo=c.JSON.stringify,ey=c.JSON.parse,ty=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function Xo(){}Xo.prototype.h=null;function Ih(o){return o.h||(o.h=o.i())}function vh(){}var Lr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Zo(){Re.call(this,"d")}D(Zo,Re);function ea(){Re.call(this,"c")}D(ea,Re);var fn={},wh=null;function qi(){return wh=wh||new Pe}fn.La="serverreachability";function Eh(o){Re.call(this,fn.La,o)}D(Eh,Re);function Mr(o){let u=qi();Le(u,new Eh(u))}fn.STAT_EVENT="statevent";function Th(o,u){Re.call(this,fn.STAT_EVENT,o),this.stat=u}D(Th,Re);function Me(o){let u=qi();Le(u,new Th(u,o))}fn.Ma="timingevent";function bh(o,u){Re.call(this,fn.Ma,o),this.size=u}D(bh,Re);function Fr(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function Ur(){this.g=!0}Ur.prototype.xa=function(){this.g=!1};function ny(o,u,d,p,b,C){o.info(function(){if(o.g)if(C)for(var x="",se=C.split("&"),Ae=0;Ae<se.length;Ae++){var X=se[Ae].split("=");if(1<X.length){var ke=X[0];X=X[1];var De=ke.split("_");x=2<=De.length&&De[1]=="type"?x+(ke+"="+X+"&"):x+(ke+"=redacted&")}}else x=null;else x=C;return"XMLHTTP REQ ("+p+") [attempt "+b+"]: "+u+`
`+d+`
`+x})}function ry(o,u,d,p,b,C,x){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+b+"]: "+u+`
`+d+`
`+C+" "+x})}function jn(o,u,d,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+sy(o,d)+(p?" "+p:"")})}function iy(o,u){o.info(function(){return"TIMEOUT: "+u})}Ur.prototype.info=function(){};function sy(o,u){if(!o.g)return u;if(!u)return null;try{var d=JSON.parse(u);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var p=d[o];if(!(2>p.length)){var b=p[1];if(Array.isArray(b)&&!(1>b.length)){var C=b[0];if(C!="noop"&&C!="stop"&&C!="close")for(var x=1;x<b.length;x++)b[x]=""}}}}return Jo(d)}catch{return u}}var zi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ah={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ta;function Wi(){}D(Wi,Xo),Wi.prototype.g=function(){return new XMLHttpRequest},Wi.prototype.i=function(){return{}},ta=new Wi;function Wt(o,u,d,p){this.j=o,this.i=u,this.l=d,this.R=p||1,this.U=new Vr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ch}function Ch(){this.i=null,this.g="",this.h=!1}var Sh={},na={};function ra(o,u,d){o.L=1,o.v=Qi(At(u)),o.m=d,o.P=!0,Rh(o,null)}function Rh(o,u){o.F=Date.now(),Gi(o),o.A=At(o.v);var d=o.A,p=o.R;Array.isArray(p)||(p=[String(p)]),jh(d.i,"t",p),o.C=0,d=o.j.J,o.h=new Ch,o.g=od(o.j,d?u:null,!o.m),0<o.O&&(o.M=new Zg(_(o.Y,o,o.g),o.O)),u=o.U,d=o.g,p=o.ca;var b="readystatechange";Array.isArray(b)||(b&&(yh[0]=b.toString()),b=yh);for(var C=0;C<b.length;C++){var x=lh(d,b[C],p||u.handleEvent,!1,u.h||u);if(!x)break;u.g[x.key]=x}u=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Mr(),ny(o.i,o.u,o.A,o.l,o.R,o.m)}Wt.prototype.ca=function(o){o=o.target;let u=this.M;u&&Ct(o)==3?u.j():this.Y(o)},Wt.prototype.Y=function(o){try{if(o==this.g)e:{let De=Ct(this.g);var u=this.g.Ba();let Wn=this.g.Z();if(!(3>De)&&(De!=3||this.g&&(this.h.h||this.g.oa()||Qh(this.g)))){this.J||De!=4||u==7||(u==8||0>=Wn?Mr(3):Mr(2)),ia(this);var d=this.g.Z();this.X=d;t:if(Ph(this)){var p=Qh(this.g);o="";var b=p.length,C=Ct(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){pn(this),$r(this);var x="";break t}this.h.i=new c.TextDecoder}for(u=0;u<b;u++)this.h.h=!0,o+=this.h.i.decode(p[u],{stream:!(C&&u==b-1)});p.length=0,this.h.g+=o,this.C=0,x=this.h.g}else x=this.g.oa();if(this.o=d==200,ry(this.i,this.u,this.A,this.l,this.R,De,d),this.o){if(this.T&&!this.K){t:{if(this.g){var se,Ae=this.g;if((se=Ae.g?Ae.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(se)){var X=se;break t}}X=null}if(d=X)jn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sa(this,d);else{this.o=!1,this.s=3,Me(12),pn(this),$r(this);break e}}if(this.P){d=!0;let Ze;for(;!this.J&&this.C<x.length;)if(Ze=oy(this,x),Ze==na){De==4&&(this.s=4,Me(14),d=!1),jn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ze==Sh){this.s=4,Me(15),jn(this.i,this.l,x,"[Invalid Chunk]"),d=!1;break}else jn(this.i,this.l,Ze,null),sa(this,Ze);if(Ph(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),De!=4||x.length!=0||this.h.h||(this.s=1,Me(16),d=!1),this.o=this.o&&d,!d)jn(this.i,this.l,x,"[Invalid Chunked Response]"),pn(this),$r(this);else if(0<x.length&&!this.W){this.W=!0;var ke=this.j;ke.g==this&&ke.ba&&!ke.M&&(ke.j.info("Great, no buffering proxy detected. Bytes received: "+x.length),ha(ke),ke.M=!0,Me(11))}}else jn(this.i,this.l,x,null),sa(this,x);De==4&&pn(this),this.o&&!this.J&&(De==4?nd(this.j,this):(this.o=!1,Gi(this)))}else Ty(this.g),d==400&&0<x.indexOf("Unknown SID")?(this.s=3,Me(12)):(this.s=0,Me(13)),pn(this),$r(this)}}}catch{}finally{}};function Ph(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function oy(o,u){var d=o.C,p=u.indexOf(`
`,d);return p==-1?na:(d=Number(u.substring(d,p)),isNaN(d)?Sh:(p+=1,p+d>u.length?na:(u=u.slice(p,p+d),o.C=p+d,u)))}Wt.prototype.cancel=function(){this.J=!0,pn(this)};function Gi(o){o.S=Date.now()+o.I,kh(o,o.I)}function kh(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Fr(_(o.ba,o),u)}function ia(o){o.B&&(c.clearTimeout(o.B),o.B=null)}Wt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(iy(this.i,this.A),this.L!=2&&(Mr(),Me(17)),pn(this),this.s=2,$r(this)):kh(this,this.S-o)};function $r(o){o.j.G==0||o.J||nd(o.j,o)}function pn(o){ia(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,_h(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function sa(o,u){try{var d=o.j;if(d.G!=0&&(d.g==o||oa(d.h,o))){if(!o.K&&oa(d.h,o)&&d.G==3){try{var p=d.Da.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var b=p;if(b[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)es(d),Xi(d);else break e;la(d),Me(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=Fr(_(d.Za,d),6e3));if(1>=xh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else gn(d,11)}else if((o.K||d.g==o)&&es(d),!j(u))for(b=d.Da.g.parse(u),u=0;u<b.length;u++){let X=b[u];if(d.T=X[0],X=X[1],d.G==2)if(X[0]=="c"){d.K=X[1],d.ia=X[2];let ke=X[3];ke!=null&&(d.la=ke,d.j.info("VER="+d.la));let De=X[4];De!=null&&(d.Aa=De,d.j.info("SVER="+d.Aa));let Wn=X[5];Wn!=null&&typeof Wn=="number"&&0<Wn&&(p=1.5*Wn,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let Ze=o.g;if(Ze){let ns=Ze.g?Ze.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ns){var C=p.h;C.g||ns.indexOf("spdy")==-1&&ns.indexOf("quic")==-1&&ns.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(aa(C,C.h),C.h=null))}if(p.D){let da=Ze.g?Ze.g.getResponseHeader("X-HTTP-Session-Id"):null;da&&(p.ya=da,oe(p.I,p.D,da))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var x=o;if(p.qa=sd(p,p.J?p.ia:null,p.W),x.K){Oh(p.h,x);var se=x,Ae=p.L;Ae&&(se.I=Ae),se.B&&(ia(se),Gi(se)),p.g=x}else ed(p);0<d.i.length&&Zi(d)}else X[0]!="stop"&&X[0]!="close"||gn(d,7);else d.G==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?gn(d,7):ua(d):X[0]!="noop"&&d.l&&d.l.ta(X),d.v=0)}}Mr(4)}catch{}}var ay=class{constructor(o,u){this.g=o,this.map=u}};function Dh(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Nh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function xh(o){return o.h?1:o.g?o.g.size:0}function oa(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function aa(o,u){o.g?o.g.add(u):o.h=u}function Oh(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Dh.prototype.cancel=function(){if(this.i=Vh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Vh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let d of o.g.values())u=u.concat(d.D);return u}return V(o.i)}function cy(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var u=[],d=o.length,p=0;p<d;p++)u.push(o[p]);return u}u=[],d=0;for(p in o)u[d++]=o[p];return u}function uy(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var u=[];o=o.length;for(var d=0;d<o;d++)u.push(d);return u}u=[],d=0;for(let p in o)u[d++]=p;return u}}}function Lh(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var d=uy(o),p=cy(o),b=p.length,C=0;C<b;C++)u.call(void 0,p[C],d&&d[C],o)}var Mh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ly(o,u){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var p=o[d].indexOf("="),b=null;if(0<=p){var C=o[d].substring(0,p);b=o[d].substring(p+1)}else C=o[d];u(C,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function mn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof mn){this.h=o.h,Hi(this,o.j),this.o=o.o,this.g=o.g,Ki(this,o.s),this.l=o.l;var u=o.i,d=new qr;d.i=u.i,u.g&&(d.g=new Map(u.g),d.h=u.h),Fh(this,d),this.m=o.m}else o&&(u=String(o).match(Mh))?(this.h=!1,Hi(this,u[1]||"",!0),this.o=Br(u[2]||""),this.g=Br(u[3]||"",!0),Ki(this,u[4]),this.l=Br(u[5]||"",!0),Fh(this,u[6]||"",!0),this.m=Br(u[7]||"")):(this.h=!1,this.i=new qr(null,this.h))}mn.prototype.toString=function(){var o=[],u=this.j;u&&o.push(jr(u,Uh,!0),":");var d=this.g;return(d||u=="file")&&(o.push("//"),(u=this.o)&&o.push(jr(u,Uh,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(jr(d,d.charAt(0)=="/"?fy:dy,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",jr(d,my)),o.join("")};function At(o){return new mn(o)}function Hi(o,u,d){o.j=d?Br(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Ki(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Fh(o,u,d){u instanceof qr?(o.i=u,gy(o.i,o.h)):(d||(u=jr(u,py)),o.i=new qr(u,o.h))}function oe(o,u,d){o.i.set(u,d)}function Qi(o){return oe(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Br(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function jr(o,u,d){return typeof o=="string"?(o=encodeURI(o).replace(u,hy),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function hy(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Uh=/[#\/\?@]/g,dy=/[#\?:]/g,fy=/[#\?]/g,py=/[#\?@]/g,my=/#/g;function qr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function Gt(o){o.g||(o.g=new Map,o.h=0,o.i&&ly(o.i,function(u,d){o.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=qr.prototype,n.add=function(o,u){Gt(this),this.i=null,o=qn(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(u),this.h+=1,this};function $h(o,u){Gt(o),u=qn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Bh(o,u){return Gt(o),u=qn(o,u),o.g.has(u)}n.forEach=function(o,u){Gt(this),this.g.forEach(function(d,p){d.forEach(function(b){o.call(u,b,p,this)},this)},this)},n.na=function(){Gt(this);let o=Array.from(this.g.values()),u=Array.from(this.g.keys()),d=[];for(let p=0;p<u.length;p++){let b=o[p];for(let C=0;C<b.length;C++)d.push(u[p])}return d},n.V=function(o){Gt(this);let u=[];if(typeof o=="string")Bh(this,o)&&(u=u.concat(this.g.get(qn(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)u=u.concat(o[d])}return u},n.set=function(o,u){return Gt(this),this.i=null,o=qn(this,o),Bh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function jh(o,u,d){$h(o,u),0<d.length&&(o.i=null,o.g.set(qn(o,u),V(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(var d=0;d<u.length;d++){var p=u[d];let C=encodeURIComponent(String(p)),x=this.V(p);for(p=0;p<x.length;p++){var b=C;x[p]!==""&&(b+="="+encodeURIComponent(String(x[p]))),o.push(b)}}return this.i=o.join("&")};function qn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function gy(o,u){u&&!o.j&&(Gt(o),o.i=null,o.g.forEach(function(d,p){var b=p.toLowerCase();p!=b&&($h(this,p),jh(this,b,d))},o)),o.j=u}function yy(o,u){let d=new Ur;if(c.Image){let p=new Image;p.onload=S(Ht,d,"TestLoadImage: loaded",!0,u,p),p.onerror=S(Ht,d,"TestLoadImage: error",!1,u,p),p.onabort=S(Ht,d,"TestLoadImage: abort",!1,u,p),p.ontimeout=S(Ht,d,"TestLoadImage: timeout",!1,u,p),c.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function _y(o,u){let d=new Ur,p=new AbortController,b=setTimeout(()=>{p.abort(),Ht(d,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(C=>{clearTimeout(b),C.ok?Ht(d,"TestPingServer: ok",!0,u):Ht(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(b),Ht(d,"TestPingServer: error",!1,u)})}function Ht(o,u,d,p,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),p(d)}catch{}}function Iy(){this.g=new ty}function vy(o,u,d){let p=d||"";try{Lh(o,function(b,C){let x=b;h(b)&&(x=Jo(b)),u.push(p+C+"="+encodeURIComponent(x))})}catch(b){throw u.push(p+"type="+encodeURIComponent("_badmap")),b}}function zr(o){this.l=o.Ub||null,this.j=o.eb||!1}D(zr,Xo),zr.prototype.g=function(){return new Yi(this.l,this.j)},zr.prototype.i=(function(o){return function(){return o}})({});function Yi(o,u){Pe.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Yi,Pe),n=Yi.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Gr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Wr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Gr(this)),this.g&&(this.readyState=3,Gr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function qh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Wr(this):Gr(this),this.readyState==3&&qh(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Wr(this))},n.Qa=function(o){this.g&&(this.response=o,Wr(this))},n.ga=function(){this.g&&Wr(this)};function Wr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Gr(o)}n.setRequestHeader=function(o,u){this.u.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=u.next();return o.join(`\r
`)};function Gr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Yi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function zh(o){let u="";return re(o,function(d,p){u+=p,u+=":",u+=d,u+=`\r
`}),u}function ca(o,u,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=zh(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):oe(o,u,d))}function de(o){Pe.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(de,Pe);var wy=/^https?$/i,Ey=["POST","PUT"];n=de.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,u,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ta.g(),this.v=this.o?Ih(this.o):Ih(ta),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(C){Wh(this,C);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var b in p)d.set(b,p[b]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let C of p.keys())d.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),b=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ey,u,void 0))||p||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,x]of d)this.g.setRequestHeader(C,x);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kh(this),this.u=!0,this.g.send(o),this.u=!1}catch(C){Wh(this,C)}};function Wh(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,Gh(o),Ji(o)}function Gh(o){o.A||(o.A=!0,Le(o,"complete"),Le(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Le(this,"complete"),Le(this,"abort"),Ji(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ji(this,!0)),de.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Hh(this):this.bb())},n.bb=function(){Hh(this)};function Hh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Ct(o)!=4||o.Z()!=2)){if(o.u&&Ct(o)==4)mh(o.Ea,0,o);else if(Le(o,"readystatechange"),Ct(o)==4){o.h=!1;try{let x=o.Z();e:switch(x){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var p;if(p=x===0){var b=String(o.D).match(Mh)[1]||null;!b&&c.self&&c.self.location&&(b=c.self.location.protocol.slice(0,-1)),p=!wy.test(b?b.toLowerCase():"")}d=p}if(d)Le(o,"complete"),Le(o,"success");else{o.m=6;try{var C=2<Ct(o)?o.g.statusText:""}catch{C=""}o.l=C+" ["+o.Z()+"]",Gh(o)}}finally{Ji(o)}}}}function Ji(o,u){if(o.g){Kh(o);let d=o.g,p=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Le(o,"ready");try{d.onreadystatechange=p}catch{}}}function Kh(o){o.I&&(c.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function Ct(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<Ct(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),ey(u)}};function Qh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ty(o){let u={};o=(o.g&&2<=Ct(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(j(o[p]))continue;var d=T(o[p]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=u[b]||[];u[b]=C,C.push(d)}E(u,function(p){return p.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Hr(o,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||u}function Yh(o){this.Aa=0,this.i=[],this.j=new Ur,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Hr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Hr("baseRetryDelayMs",5e3,o),this.cb=Hr("retryDelaySeedMs",1e4,o),this.Wa=Hr("forwardChannelMaxRetries",2,o),this.wa=Hr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Dh(o&&o.concurrentRequestLimit),this.Da=new Iy,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Yh.prototype,n.la=8,n.G=1,n.connect=function(o,u,d,p){Me(0),this.W=o,this.H=u||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=sd(this,null,this.W),Zi(this)};function ua(o){if(Jh(o),o.G==3){var u=o.U++,d=At(o.I);if(oe(d,"SID",o.K),oe(d,"RID",u),oe(d,"TYPE","terminate"),Kr(o,d),u=new Wt(o,o.j,u),u.L=2,u.v=Qi(At(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=u.v,d=!0),d||(u.g=od(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Gi(u)}id(o)}function Xi(o){o.g&&(ha(o),o.g.cancel(),o.g=null)}function Jh(o){Xi(o),o.u&&(c.clearTimeout(o.u),o.u=null),es(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function Zi(o){if(!Nh(o.h)&&!o.s){o.s=!0;var u=o.Ga;Dr||uh(),Nr||(Dr(),Nr=!0),jo.add(u,o),o.B=0}}function by(o,u){return xh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Fr(_(o.Ga,o,u),rd(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let b=new Wt(this,this.j,o),C=this.o;if(this.S&&(C?(C=g(C),w(C,this.S)):C=this.S),this.m!==null||this.O||(b.H=C,C=null),this.P)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,4096<u){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Zh(this,b,u),d=At(this.I),oe(d,"RID",o),oe(d,"CVER",22),this.D&&oe(d,"X-HTTP-Session-Id",this.D),Kr(this,d),C&&(this.O?u="headers="+encodeURIComponent(String(zh(C)))+"&"+u:this.m&&ca(d,this.m,C)),aa(this.h,b),this.Ua&&oe(d,"TYPE","init"),this.P?(oe(d,"$req",u),oe(d,"SID","null"),b.T=!0,ra(b,d,null)):ra(b,d,u),this.G=2}}else this.G==3&&(o?Xh(this,o):this.i.length==0||Nh(this.h)||Xh(this))};function Xh(o,u){var d;u?d=u.l:d=o.U++;let p=At(o.I);oe(p,"SID",o.K),oe(p,"RID",d),oe(p,"AID",o.T),Kr(o,p),o.m&&o.o&&ca(p,o.m,o.o),d=new Wt(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Zh(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),aa(o.h,d),ra(d,p,u)}function Kr(o,u){o.H&&re(o.H,function(d,p){oe(u,p,d)}),o.l&&Lh({},function(d,p){oe(u,p,d)})}function Zh(o,u,d){d=Math.min(o.i.length,d);var p=o.l?_(o.l.Na,o.l,o):null;e:{var b=o.i;let C=-1;for(;;){let x=["count="+d];C==-1?0<d?(C=b[0].g,x.push("ofs="+C)):C=0:x.push("ofs="+C);let se=!0;for(let Ae=0;Ae<d;Ae++){let X=b[Ae].g,ke=b[Ae].map;if(X-=C,0>X)C=Math.max(0,b[Ae].g-100),se=!1;else try{vy(ke,x,"req"+X+"_")}catch{p&&p(ke)}}if(se){p=x.join("&");break e}}}return o=o.i.splice(0,d),u.D=o,p}function ed(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;Dr||uh(),Nr||(Dr(),Nr=!0),jo.add(u,o),o.v=0}}function la(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Fr(_(o.Fa,o),rd(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,td(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Fr(_(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Me(10),Xi(this),td(this))};function ha(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function td(o){o.g=new Wt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=At(o.qa);oe(u,"RID","rpc"),oe(u,"SID",o.K),oe(u,"AID",o.T),oe(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&oe(u,"TO",o.ja),oe(u,"TYPE","xmlhttp"),Kr(o,u),o.m&&o.o&&ca(u,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Qi(At(u)),d.m=null,d.P=!0,Rh(d,o)}n.Za=function(){this.C!=null&&(this.C=null,Xi(this),la(this),Me(19))};function es(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function nd(o,u){var d=null;if(o.g==u){es(o),ha(o),o.g=null;var p=2}else if(oa(o.h,u))d=u.D,Oh(o.h,u),p=1;else return;if(o.G!=0){if(u.o)if(p==1){d=u.m?u.m.length:0,u=Date.now()-u.F;var b=o.B;p=qi(),Le(p,new bh(p,d)),Zi(o)}else ed(o);else if(b=u.s,b==3||b==0&&0<u.X||!(p==1&&by(o,u)||p==2&&la(o)))switch(d&&0<d.length&&(u=o.h,u.i=u.i.concat(d)),b){case 1:gn(o,5);break;case 4:gn(o,10);break;case 3:gn(o,6);break;default:gn(o,2)}}}function rd(o,u){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*u}function gn(o,u){if(o.j.info("Error code "+u),u==2){var d=_(o.fb,o),p=o.Xa;let b=!p;p=new mn(p||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Hi(p,"https"),Qi(p),b?yy(p.toString(),d):_y(p.toString(),d)}else Me(2);o.G=0,o.l&&o.l.sa(u),id(o),Jh(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))};function id(o){if(o.G=0,o.ka=[],o.l){let u=Vh(o.h);(u.length!=0||o.i.length!=0)&&(N(o.ka,u),N(o.ka,o.i),o.h.i.length=0,V(o.i),o.i.length=0),o.l.ra()}}function sd(o,u,d){var p=d instanceof mn?At(d):new mn(d);if(p.g!="")u&&(p.g=u+"."+p.g),Ki(p,p.s);else{var b=c.location;p=b.protocol,u=u?u+"."+b.hostname:b.hostname,b=+b.port;var C=new mn(null);p&&Hi(C,p),u&&(C.g=u),b&&Ki(C,b),d&&(C.l=d),p=C}return d=o.D,u=o.ya,d&&u&&oe(p,d,u),oe(p,"VER",o.la),Kr(o,p),p}function od(o,u,d){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new de(new zr({eb:d})):new de(o.pa),u.Ha(o.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ad(){}n=ad.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ts(){}ts.prototype.g=function(o,u){return new je(o,u)};function je(o,u){Pe.call(this),this.g=new Yh(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!j(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!j(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new zn(this)}D(je,Pe),je.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},je.prototype.close=function(){ua(this.g)},je.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=Jo(o),o=d);u.i.push(new ay(u.Ya++,o)),u.G==3&&Zi(u)},je.prototype.N=function(){this.g.l=null,delete this.j,ua(this.g),delete this.g,je.aa.N.call(this)};function cd(o){Zo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(let d in u){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}D(cd,Zo);function ud(){ea.call(this),this.status=1}D(ud,ea);function zn(o){this.g=o}D(zn,ad),zn.prototype.ua=function(){Le(this.g,"a")},zn.prototype.ta=function(o){Le(this.g,new cd(o))},zn.prototype.sa=function(o){Le(this.g,new ud)},zn.prototype.ra=function(){Le(this.g,"b")},ts.prototype.createWebChannel=ts.prototype.g,je.prototype.send=je.prototype.o,je.prototype.open=je.prototype.m,je.prototype.close=je.prototype.close,$c=Lt.createWebChannelTransport=function(){return new ts},Uc=Lt.getStatEventTarget=function(){return qi()},Fc=Lt.Event=fn,$s=Lt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},zi.NO_ERROR=0,zi.TIMEOUT=8,zi.HTTP_ERROR=6,fi=Lt.ErrorCode=zi,Ah.COMPLETE="complete",Mc=Lt.EventType=Ah,vh.EventType=Lr,Lr.OPEN="a",Lr.CLOSE="b",Lr.ERROR="c",Lr.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,sr=Lt.WebChannel=vh,tE=Lt.FetchXmlHttpFactory=zr,de.prototype.listenOnce=de.prototype.L,de.prototype.getLastError=de.prototype.Ka,de.prototype.getLastErrorCode=de.prototype.Ba,de.prototype.getStatus=de.prototype.Z,de.prototype.getResponseJson=de.prototype.Oa,de.prototype.getResponseText=de.prototype.oa,de.prototype.send=de.prototype.ea,de.prototype.setWithCredentials=de.prototype.Ha,Lc=Lt.XhrIo=de}).apply(typeof Us<"u"?Us:typeof self<"u"?self:typeof window<"u"?window:{});var up="@firebase/firestore",lp="4.8.0";var Te=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");var br="11.10.0";var Dn=new ft("@firebase/firestore");function or(){return Dn.logLevel}function L(n,...e){if(Dn.logLevel<=Q.DEBUG){let t=e.map(Nl);Dn.debug(`Firestore (${br}): ${n}`,...t)}}function Mt(n,...e){if(Dn.logLevel<=Q.ERROR){let t=e.map(Nl);Dn.error(`Firestore (${br}): ${n}`,...t)}}function cn(n,...e){if(Dn.logLevel<=Q.WARN){let t=e.map(Nl);Dn.warn(`Firestore (${br}): ${n}`,...t)}}function Nl(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,nm(n,r,t)}function nm(n,e,t){let r=`FIRESTORE (${br}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Mt(r),new Error(r)}function te(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||nm(e,i,r)}function q(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends qe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var it=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Hs=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Gc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Te.UNAUTHENTICATED))}shutdown(){}},Hc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Kc=class{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){te(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new it;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new it,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>m(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},c=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new it)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string",31837,{l:r}),new Hs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string",2055,{h:e}),new Te(e)}},Qc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Yc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Qc(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Te.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ks=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Jc=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ue(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){te(this.o===void 0,3512);let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ks(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ks(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function nE(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function rm(){return new TextEncoder}var Ii=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=nE(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function K(n,e){return n<e?-1:n>e?1:0}function Xc(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return K(r,i);{let s=rm(),a=rE(s.encode(hp(n,t)),s.encode(hp(e,t)));return a!==0?a:K(r,i)}}t+=r>65535?2:1}return K(n.length,e.length)}function hp(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function rE(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return K(n[t],e[t]);return K(n.length,e.length)}function fr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var dp="__name__",Qs=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return K(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Xc(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}},ae=class n extends Qs{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new O(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},iE=/^[_a-zA-Z][_a-zA-Z0-9]*$/,We=class n extends Qs{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return iE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===dp}static keyField(){return new n([dp])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new O(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new O(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new O(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(s(),i++)}if(s(),a)throw new O(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(ae.fromString(e))}static fromName(e){return new n(ae.fromString(e).popFirst(5))}static empty(){return new n(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ae(e.slice()))}};function xl(n,e,t){if(!t)throw new O(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function sE(n,e,t,r){if(e===!0&&r===!0)throw new O(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function fp(n){if(!U.isDocumentKey(n))throw new O(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function pp(n){if(U.isDocumentKey(n))throw new O(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function im(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ro(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function xe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ro(n);throw new O(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function oE(n,e){if(e<=0)throw new O(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function _e(n,e){let t={typeString:n};return e&&(t.value=e),t}function xi(n,e){if(!im(n))throw new O(R.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new O(R.INVALID_ARGUMENT,t);return!0}var mp=-62135596800,gp=1e6,Ie=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*gp);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<mp)throw new O(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gp}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(xi(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-mp;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Ie._jsonSchemaVersion="firestore/timestamp/1.0",Ie._jsonSchema={type:_e("string",Ie._jsonSchemaVersion),seconds:_e("number"),nanoseconds:_e("number")};var z=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Ie(0,0))}static max(){return new n(new Ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var vi=-1,Zc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Zc.UNKNOWN_ID=-1;function aE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new Ie(t+1,0):new Ie(t,r));return new Nn(i,U.empty(),e)}function cE(n){return new Nn(n.readTime,n.key,vi)}var Nn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),U.empty(),vi)}static max(){return new n(z.max(),U.empty(),vi)}};function uE(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:K(n.largestBatchId,e.largestBatchId))}var lE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",eu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ar(n){return m(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==lE)throw n;L("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),c=0;for(let l=0;l<s;l++){let h=l;t(e[h]).next(f=>{a[h]=f,++c,c===s&&r(a)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function hE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Cr(n){return n.name==="IndexedDbTransactionError"}var Ol=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),Vl=-1;function Po(n){return n==null}function wi(n){return n===0&&1/n==-1/0}function dE(n){return typeof n=="number"&&Number.isInteger(n)&&!wi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var sm="";function fE(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yp(e)),e=pE(n.get(t),e);return yp(e)}function pE(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case sm:t+="";break;default:t+=s}}return t}function yp(n){return n+sm+""}var mE="remoteDocuments",om="owner";var am="mutationQueues";var cm="mutations";var um="documentMutations",gE="remoteDocumentsV14";var lm="remoteDocumentGlobal";var hm="targets";var dm="targetDocuments";var fm="targetGlobal",pm="collectionParents";var mm="clientMetadata";var gm="bundles";var ym="namedQueries";var yE="indexConfiguration";var _E="indexState";var IE="indexEntries";var _m="documentOverlays";var vE="globals";var wE=[am,cm,um,mE,hm,om,fm,dm,mm,lm,pm,gm,ym],GC=[...wE,_m],EE=[am,cm,um,gE,hm,om,fm,dm,mm,lm,pm,gm,ym,_m],TE=EE,bE=[...TE,yE,_E,IE];var HC=[...bE,vE];function _p(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function dn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Im(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var pe=class n{constructor(e,t){this.comparator=e,this.root=t||yt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,yt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lr(this.root,e,this.comparator,!1)}getReverseIterator(){return new lr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lr(this.root,e,this.comparator,!0)}},lr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},yt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}};yt.EMPTY=null,yt.RED=!0,yt.BLACK=!1;yt.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var be=class n{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ys(this.data.getIterator())}getIteratorFrom(e){return new Ys(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ys=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Ye=class n{constructor(e){this.fields=e,e.sort(We.comparator)}static empty(){return new n([])}unionWith(e){let t=new be(We.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Js=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Oe=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Js("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Oe.EMPTY_BYTE_STRING=new Oe("");var AE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ft(n){if(te(!!n,39018),typeof n=="string"){let e=0,t=AE.exec(n);if(te(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:le(n.seconds),nanos:le(n.nanos)}}function le(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ut(n){return typeof n=="string"?Oe.fromBase64String(n):Oe.fromUint8Array(n)}var vm="server_timestamp",wm="__type__",Em="__previous_value__",Tm="__local_write_time__";function Ll(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[wm])===null||t===void 0?void 0:t.stringValue)===vm}function ko(n){let e=n.mapValue.fields[Em];return Ll(e)?ko(e):e}function Ei(n){let e=Ft(n.mapValue.fields[Tm].timestampValue);return new Ie(e.seconds,e.nanos)}var tu=class{constructor(e,t,r,i,s,a,c,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=f}},Xs="(default)",Zs=class n{constructor(e,t){this.projectId=e,this.database=t||Xs}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Xs}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Ml="__type__",bm="__max__",Bs={mapValue:{fields:{__type__:{stringValue:bm}}}},Fl="__vector__",pr="value";function un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ll(n)?4:Cm(n)?9007199254740991:Am(n)?10:11:$(28295,{value:n})}function vt(n,e){if(n===e)return!0;let t=un(n);if(t!==un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ei(n).isEqual(Ei(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Ft(i.timestampValue),c=Ft(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Ut(i.bytesValue).isEqual(Ut(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return le(i.geoPointValue.latitude)===le(s.geoPointValue.latitude)&&le(i.geoPointValue.longitude)===le(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return le(i.integerValue)===le(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=le(i.doubleValue),c=le(s.doubleValue);return a===c?wi(a)===wi(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return fr(n.arrayValue.values||[],e.arrayValue.values||[],vt);case 10:case 11:return(function(i,s){let a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(_p(a)!==_p(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!vt(a[l],c[l])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function Ti(n,e){return(n.values||[]).find(t=>vt(t,e))!==void 0}function mr(n,e){if(n===e)return 0;let t=un(n),r=un(e);if(t!==r)return K(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return K(n.booleanValue,e.booleanValue);case 2:return(function(s,a){let c=le(s.integerValue||s.doubleValue),l=le(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(n,e);case 3:return Ip(n.timestampValue,e.timestampValue);case 4:return Ip(Ei(n),Ei(e));case 5:return Xc(n.stringValue,e.stringValue);case 6:return(function(s,a){let c=Ut(s),l=Ut(a);return c.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(s,a){let c=s.split("/"),l=a.split("/");for(let h=0;h<c.length&&h<l.length;h++){let f=K(c[h],l[h]);if(f!==0)return f}return K(c.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,a){let c=K(le(s.latitude),le(a.latitude));return c!==0?c:K(le(s.longitude),le(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return vp(n.arrayValue,e.arrayValue);case 10:return(function(s,a){var c,l,h,f;let y=s.fields||{},_=a.fields||{},S=(c=y[pr])===null||c===void 0?void 0:c.arrayValue,D=(l=_[pr])===null||l===void 0?void 0:l.arrayValue,V=K(((h=S?.values)===null||h===void 0?void 0:h.length)||0,((f=D?.values)===null||f===void 0?void 0:f.length)||0);return V!==0?V:vp(S,D)})(n.mapValue,e.mapValue);case 11:return(function(s,a){if(s===Bs.mapValue&&a===Bs.mapValue)return 0;if(s===Bs.mapValue)return 1;if(a===Bs.mapValue)return-1;let c=s.fields||{},l=Object.keys(c),h=a.fields||{},f=Object.keys(h);l.sort(),f.sort();for(let y=0;y<l.length&&y<f.length;++y){let _=Xc(l[y],f[y]);if(_!==0)return _;let S=mr(c[l[y]],h[f[y]]);if(S!==0)return S}return K(l.length,f.length)})(n.mapValue,e.mapValue);default:throw $(23264,{le:t})}}function Ip(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return K(n,e);let t=Ft(n),r=Ft(e),i=K(t.seconds,r.seconds);return i!==0?i:K(t.nanos,r.nanos)}function vp(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=mr(t[i],r[i]);if(s)return s}return K(t.length,r.length)}function gr(n){return nu(n)}function nu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=Ft(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ut(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return U.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=nu(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${nu(t.fields[a])}`;return i+"}"})(n.mapValue):$(61005,{value:n})}function zs(n){switch(un(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=ko(n);return e?16+zs(e):16;case 5:return 2*n.stringValue.length;case 6:return Ut(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+zs(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return dn(r.fields,(s,a)=>{i+=s.length+zs(a)}),i})(n.mapValue);default:throw $(13486,{value:n})}}function wp(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ru(n){return!!n&&"integerValue"in n}function Ul(n){return!!n&&"arrayValue"in n}function Ep(n){return!!n&&"nullValue"in n}function Tp(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function Am(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Ml])===null||t===void 0?void 0:t.stringValue)===Fl}function mi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return dn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=mi(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mi(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Cm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===bm}var QC={mapValue:{fields:{[Ml]:{stringValue:Fl},[pr]:{arrayValue:{}}}}};var ze=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mi(t)}setAll(e){let t=We.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=mi(a):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ws(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){dn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(mi(this.value))}};function Sm(n){let e=[];return dn(n.fields,(t,r)=>{let i=new We([t]);if(Ws(r)){let s=Sm(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Ye(e)}var st=class n{constructor(e,t,r,i,s,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),ze.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),ze.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var yr=class{constructor(e,t){this.position=e,this.inclusive=t}};function bp(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=U.comparator(U.fromName(a.referenceValue),t.key):r=mr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ap(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!vt(n.position[t],e.position[t]))return!1;return!0}var xn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function CE(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var eo=class{},ye=class n extends eo{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new su(e,t,r):t==="array-contains"?new cu(e,r):t==="in"?new uu(e,r):t==="not-in"?new lu(e,r):t==="array-contains-any"?new hu(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ou(e,r):new au(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(mr(t,this.value)):t!==null&&un(this.value)===un(t)&&this.matchesComparison(mr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ot=class n extends eo{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return Rm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function Rm(n){return n.op==="and"}function Pm(n){return SE(n)&&Rm(n)}function SE(n){for(let e of n.filters)if(e instanceof ot)return!1;return!0}function iu(n){if(n instanceof ye)return n.field.canonicalString()+n.op.toString()+gr(n.value);if(Pm(n))return n.filters.map(e=>iu(e)).join(",");{let e=n.filters.map(t=>iu(t)).join(",");return`${n.op}(${e})`}}function km(n,e){return n instanceof ye?(function(r,i){return i instanceof ye&&r.op===i.op&&r.field.isEqual(i.field)&&vt(r.value,i.value)})(n,e):n instanceof ot?(function(r,i){return i instanceof ot&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,c)=>s&&km(a,i.filters[c]),!0):!1})(n,e):void $(19439)}function Dm(n){return n instanceof ye?(function(t){return`${t.field.canonicalString()} ${t.op} ${gr(t.value)}`})(n):n instanceof ot?(function(t){return t.op.toString()+" {"+t.getFilters().map(Dm).join(" ,")+"}"})(n):"Filter"}var su=class extends ye{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},ou=class extends ye{constructor(e,t){super(e,"in",t),this.keys=Nm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},au=class extends ye{constructor(e,t){super(e,"not-in",t),this.keys=Nm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Nm(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var cu=class extends ye{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ul(t)&&Ti(t.arrayValue,this.value)}},uu=class extends ye{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ti(this.value.arrayValue,t)}},lu=class extends ye{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ti(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ti(this.value.arrayValue,t)}},hu=class extends ye{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ul(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ti(this.value.arrayValue,r))}};var du=class{constructor(e,t=null,r=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.Pe=null}};function Cp(n,e=null,t=[],r=[],i=null,s=null,a=null){return new du(n,e,t,r,i,s,a)}function $l(n){let e=q(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>iu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),Po(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>gr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>gr(r)).join(",")),e.Pe=t}return e.Pe}function Bl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!CE(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!km(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ap(n.startAt,e.startAt)&&Ap(n.endAt,e.endAt)}function fu(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var $t=class{constructor(e,t=null,r=[],i=[],s=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function RE(n,e,t,r,i,s,a,c){return new $t(n,e,t,r,i,s,a,c)}function Do(n){return new $t(n)}function Sp(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function xm(n){return n.collectionGroup!==null}function gi(n){let e=q(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new be(We.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new xn(s,r))}),t.has(We.keyField().canonicalString())||e.Te.push(new xn(We.keyField(),r))}return e.Te}function _t(n){let e=q(n);return e.Ie||(e.Ie=PE(e,gi(n))),e.Ie}function PE(n,e){if(n.limitType==="F")return Cp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new xn(i.field,s)});let t=n.endAt?new yr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new yr(n.startAt.position,n.startAt.inclusive):null;return Cp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function pu(n,e){let t=n.filters.concat([e]);return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function to(n,e,t){return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function No(n,e){return Bl(_t(n),_t(e))&&n.limitType===e.limitType}function Om(n){return`${$l(_t(n))}|lt:${n.limitType}`}function ar(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Dm(i)).join(", ")}]`),Po(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>gr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>gr(i)).join(",")),`Target(${r})`})(_t(n))}; limitType=${n.limitType})`}function xo(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):U.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of gi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,c,l){let h=bp(a,c,l);return a.inclusive?h<=0:h<0})(r.startAt,gi(r),i)||r.endAt&&!(function(a,c,l){let h=bp(a,c,l);return a.inclusive?h>=0:h>0})(r.endAt,gi(r),i))})(n,e)}function kE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Vm(n){return(e,t)=>{let r=!1;for(let i of gi(n)){let s=DE(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function DE(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):(function(s,a,c){let l=a.data.field(s),h=c.data.field(s);return l!==null&&h!==null?mr(l,h):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}var Bt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){dn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Im(this.inner)}size(){return this.innerSize}};var NE=new pe(U.comparator);function jt(){return NE}var Lm=new pe(U.comparator);function pi(...n){let e=Lm;for(let t of n)e=e.insert(t.key,t);return e}function Mm(n){let e=Lm;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Cn(){return yi()}function Fm(){return yi()}function yi(){return new Bt(n=>n.toString(),(n,e)=>n.isEqual(e))}var xE=new pe(U.comparator),OE=new be(U.comparator);function Y(...n){let e=OE;for(let t of n)e=e.add(t);return e}var VE=new be(K);function LE(){return VE}function jl(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wi(e)?"-0":e}}function Um(n){return{integerValue:""+n}}function ME(n,e){return dE(e)?Um(e):jl(n,e)}var _r=class{constructor(){this._=void 0}};function FE(n,e,t){return n instanceof On?(function(i,s){let a={fields:{[wm]:{stringValue:vm},[Tm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ll(s)&&(s=ko(s)),s&&(a.fields[Em]=s),{mapValue:a}})(t,e):n instanceof Vn?Bm(n,e):n instanceof Ln?jm(n,e):(function(i,s){let a=$m(i,s),c=Rp(a)+Rp(i.Ee);return ru(a)&&ru(i.Ee)?Um(c):jl(i.serializer,c)})(n,e)}function UE(n,e,t){return n instanceof Vn?Bm(n,e):n instanceof Ln?jm(n,e):t}function $m(n,e){return n instanceof Ir?(function(r){return ru(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var On=class extends _r{},Vn=class extends _r{constructor(e){super(),this.elements=e}};function Bm(n,e){let t=qm(e);for(let r of n.elements)t.some(i=>vt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Ln=class extends _r{constructor(e){super(),this.elements=e}};function jm(n,e){let t=qm(e);for(let r of n.elements)t=t.filter(i=>!vt(i,r));return{arrayValue:{values:t}}}var Ir=class extends _r{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function Rp(n){return le(n.integerValue||n.doubleValue)}function qm(n){return Ul(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var mu=class{constructor(e,t){this.field=e,this.transform=t}};function $E(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Vn&&i instanceof Vn||r instanceof Ln&&i instanceof Ln?fr(r.elements,i.elements,vt):r instanceof Ir&&i instanceof Ir?vt(r.Ee,i.Ee):r instanceof On&&i instanceof On})(n.transform,e.transform)}var gu=class{constructor(e,t){this.version=e,this.transformResults=t}},Ge=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Gs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var vr=class{};function zm(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new wr(n.key,Ge.none()):new Mn(n.key,n.data,Ge.none());{let t=n.data,r=ze.empty(),i=new be(We.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new wt(n.key,r,new Ye(i.toArray()),Ge.none())}}function BE(n,e,t){n instanceof Mn?(function(i,s,a){let c=i.value.clone(),l=kp(i.fieldTransforms,s,a.transformResults);c.setAll(l),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof wt?(function(i,s,a){if(!Gs(i.precondition,s))return void s.convertToUnknownDocument(a.version);let c=kp(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Wm(i)),l.setAll(c),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function _i(n,e,t,r){return n instanceof Mn?(function(s,a,c,l){if(!Gs(s.precondition,a))return c;let h=s.value.clone(),f=Dp(s.fieldTransforms,l,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof wt?(function(s,a,c,l){if(!Gs(s.precondition,a))return c;let h=Dp(s.fieldTransforms,l,a),f=a.data;return f.setAll(Wm(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(y=>y.field))})(n,e,t,r):(function(s,a,c){return Gs(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function jE(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=$m(r.transform,i||null);s!=null&&(t===null&&(t=ze.empty()),t.set(r.field,s))}return t||null}function Pp(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&fr(r,i,(s,a)=>$E(s,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Mn=class extends vr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},wt=class extends vr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Wm(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function kp(n,e,t){let r=new Map;te(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,c=e.data.field(s.field);r.set(s.field,UE(a,c,t[i]))}return r}function Dp(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,FE(s,a,e))}return r}var wr=class extends vr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},yu=class extends vr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var _u=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&BE(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=_i(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=_i(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Fm();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;let l=zm(a,c);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&fr(this.mutations,e.mutations,(t,r)=>Pp(t,r))&&fr(this.baseMutations,e.baseMutations,(t,r)=>Pp(t,r))}},Iu=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){te(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=(function(){return xE})(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var vu=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var wu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var me,J;function qE(n){switch(n){case R.OK:return $(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Gm(n){if(n===void 0)return Mt("GRPC error has no .code"),R.UNKNOWN;switch(n){case me.OK:return R.OK;case me.CANCELLED:return R.CANCELLED;case me.UNKNOWN:return R.UNKNOWN;case me.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case me.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case me.INTERNAL:return R.INTERNAL;case me.UNAVAILABLE:return R.UNAVAILABLE;case me.UNAUTHENTICATED:return R.UNAUTHENTICATED;case me.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case me.NOT_FOUND:return R.NOT_FOUND;case me.ALREADY_EXISTS:return R.ALREADY_EXISTS;case me.PERMISSION_DENIED:return R.PERMISSION_DENIED;case me.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case me.ABORTED:return R.ABORTED;case me.OUT_OF_RANGE:return R.OUT_OF_RANGE;case me.UNIMPLEMENTED:return R.UNIMPLEMENTED;case me.DATA_LOSS:return R.DATA_LOSS;default:return $(39323,{code:n})}}(J=me||(me={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var Np=null;var zE=new Vt([4294967295,4294967295],0);function xp(n){let e=rm().encode(n),t=new Vc;return t.update(e),new Uint8Array(t.digest())}function Op(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Vt([t,r],0),new Vt([i,s],0)]}var Eu=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Sn(`Invalid padding: ${t}`);if(r<0)throw new Sn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Sn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Sn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Vt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(Vt.fromNumber(r)));return i.compare(zE)===1&&(i=new Vt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=xp(e),[r,i]=Op(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.fe===0)return;let t=xp(e),[r,i]=Op(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);this.we(a)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Sn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var no=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,bi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new pe(K),jt(),Y())}},bi=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Y(),Y(),Y())}};var hr=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},ro=class{constructor(e,t){this.targetId=e,this.De=t}},io=class{constructor(e,t,r=Oe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},so=class{constructor(){this.ve=0,this.Ce=Vp(),this.Fe=Oe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Y(),t=Y(),r=Y();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:$(38017,{changeType:s})}}),new bi(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Vp()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,te(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Tu=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=jt(),this.je=js(),this.Je=js(),this.He=new pe(K)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:$(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(fu(s))if(r===0){let a=new U(s.path);this.Xe(t,a,st.newNoDocument(a,z.min()))}else te(r===1,20013,{expectedCount:r});else{let a=this.ot(t);if(a!==r){let c=this._t(e),l=c?this.ut(c,e,a):1;if(l!==0){this.rt(t);let h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,h)}Np?.ct((function(f,y,_,S,D){var V,N,G,j,H,ie;let Ve={localCacheCount:f,existenceFilterCount:y.count,databaseId:_.database,projectId:_.projectId},re=y.unchangedNames;return re&&(Ve.bloomFilter={applied:D===0,hashCount:(V=re?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(j=(G=(N=re?.bits)===null||N===void 0?void 0:N.bitmap)===null||G===void 0?void 0:G.length)!==null&&j!==void 0?j:0,padding:(ie=(H=re?.bits)===null||H===void 0?void 0:H.padding)!==null&&ie!==void 0?ie:0,mightContain:E=>{var g;return(g=S?.mightContain(E))!==null&&g!==void 0&&g}}),Ve})(a,e.De,this.We.lt(),c,l))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,c;try{a=Ut(r).toUint8Array()}catch(l){if(l instanceof Js)return cn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new Eu(a,i,s)}catch(l){return cn(l instanceof Sn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.We.lt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,a)=>{let c=this.st(a);if(c){if(s.current&&fu(c.target)){let l=new U(c.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,st.newNoDocument(l,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=Y();this.Je.forEach((s,a)=>{let c=!0;a.forEachWhile(l=>{let h=this.st(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));let i=new no(e,t,this.He,this.ze,r);return this.ze=jt(),this.je=js(),this.Je=js(),this.He=new pe(K),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new so,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new be(K),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new be(K),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new so),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function js(){return new pe(U.comparator)}function Vp(){return new pe(U.comparator)}var WE={asc:"ASCENDING",desc:"DESCENDING"},GE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HE={and:"AND",or:"OR"},bu=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Au(n,e){return n.useProto3Json||Po(e)?e:{value:e}}function oo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hm(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function KE(n,e){return oo(n,e.toTimestamp())}function It(n){return te(!!n,49232),z.fromTimestamp((function(t){let r=Ft(t);return new Ie(r.seconds,r.nanos)})(n))}function ql(n,e){return Cu(n,e).canonicalString()}function Cu(n,e){let t=(function(i){return new ae(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Km(n){let e=ae.fromString(n);return te(Zm(e),10190,{key:e.toString()}),e}function Su(n,e){return ql(n.databaseId,e.path)}function Bc(n,e){let t=Km(e);if(t.get(1)!==n.databaseId.projectId)throw new O(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(Ym(t))}function Qm(n,e){return ql(n.databaseId,e)}function QE(n){let e=Km(n);return e.length===4?ae.emptyPath():Ym(e)}function Ru(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ym(n){return te(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Lp(n,e,t){return{name:Su(n,e),fields:t.value.mapValue.fields}}function YE(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(te(f===void 0||typeof f=="string",58123),Oe.fromBase64String(f||"")):(te(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Oe.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(h){let f=h.code===void 0?R.UNKNOWN:Gm(h.code);return new O(f,h.message||"")})(a);t=new io(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Bc(n,r.document.name),s=It(r.document.updateTime),a=r.document.createTime?It(r.document.createTime):z.min(),c=new ze({mapValue:{fields:r.document.fields}}),l=st.newFoundDocument(i,s,a,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new hr(h,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Bc(n,r.document),s=r.readTime?It(r.readTime):z.min(),a=st.newNoDocument(i,s),c=r.removedTargetIds||[];t=new hr([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Bc(n,r.document),s=r.removedTargetIds||[];t=new hr([],s,i,null)}else{if(!("filter"in e))return $(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new wu(i,s),c=r.targetId;t=new ro(c,a)}}return t}function JE(n,e){let t;if(e instanceof Mn)t={update:Lp(n,e.key,e.value)};else if(e instanceof wr)t={delete:Su(n,e.key)};else if(e instanceof wt)t={update:Lp(n,e.key,e.data),updateMask:oT(e.fieldMask)};else{if(!(e instanceof yu))return $(16599,{Rt:e.type});t={verify:Su(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,a){let c=a.transform;if(c instanceof On)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Vn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Ln)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ir)return{fieldPath:a.field.canonicalString(),increment:c.Ee};throw $(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:KE(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:$(27497)})(n,e.precondition)),t}function XE(n,e){return n&&n.length>0?(te(e!==void 0,14353),n.map(t=>(function(i,s){let a=i.updateTime?It(i.updateTime):It(s);return a.isEqual(z.min())&&(a=It(s)),new gu(a,i.transformResults||[])})(t,e))):[]}function ZE(n,e){return{documents:[Qm(n,e.path)]}}function eT(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Qm(n,i);let s=(function(h){if(h.length!==0)return Xm(ot.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let a=(function(h){if(h.length!==0)return h.map(f=>(function(_){return{field:cr(_.field),direction:rT(_.dir)}})(f))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=Au(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{Vt:t,parent:i}}function tT(n){let e=QE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){te(r===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=(function(y){let _=Jm(y);return _ instanceof ot&&Pm(_)?_.getFilters():[_]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map(_=>(function(D){return new xn(ur(D.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(_))})(t.orderBy));let c=null;t.limit&&(c=(function(y){let _;return _=typeof y=="object"?y.value:y,Po(_)?null:_})(t.limit));let l=null;t.startAt&&(l=(function(y){let _=!!y.before,S=y.values||[];return new yr(S,_)})(t.startAt));let h=null;return t.endAt&&(h=(function(y){let _=!y.before,S=y.values||[];return new yr(S,_)})(t.endAt)),RE(e,i,a,s,c,"F",l,h)}function nT(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Jm(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=ur(t.unaryFilter.field);return ye.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ur(t.unaryFilter.field);return ye.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ur(t.unaryFilter.field);return ye.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=ur(t.unaryFilter.field);return ye.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ye.create(ur(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ot.create(t.compositeFilter.filters.map(r=>Jm(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function rT(n){return WE[n]}function iT(n){return GE[n]}function sT(n){return HE[n]}function cr(n){return{fieldPath:n.canonicalString()}}function ur(n){return We.fromServerFormat(n.fieldPath)}function Xm(n){return n instanceof ye?(function(t){if(t.op==="=="){if(Tp(t.value))return{unaryFilter:{field:cr(t.field),op:"IS_NAN"}};if(Ep(t.value))return{unaryFilter:{field:cr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Tp(t.value))return{unaryFilter:{field:cr(t.field),op:"IS_NOT_NAN"}};if(Ep(t.value))return{unaryFilter:{field:cr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cr(t.field),op:iT(t.op),value:t.value}}})(n):n instanceof ot?(function(t){let r=t.getFilters().map(i=>Xm(i));return r.length===1?r[0]:{compositeFilter:{op:sT(t.op),filters:r}}})(n):$(54877,{filter:n})}function oT(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Zm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ai=class n{constructor(e,t,r,i,s=z.min(),a=z.min(),c=Oe.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Pu=class{constructor(e){this.gt=e}};function aT(n){let e=tT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?to(e,e.limit,"L"):e}var ao=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(le(e.integerValue));else if("doubleValue"in e){let r=le(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),wi(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=Ft(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Ut(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Cm(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Am(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):$(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let a=pr,c=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(le(c)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),U.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};ao.Ut=new ao;var ku=class{constructor(){this.Dn=new Du}addToCollectionParentIndex(e,t){return this.Dn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Nn.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Nn.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},Du=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new be(ae.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new be(ae.comparator)).toArray()}};var YC=new Uint8Array(0);var Mp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},eg=41943040,Qe=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Qe.DEFAULT_COLLECTION_PERCENTILE=10,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qe.DEFAULT=new Qe(eg,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qe.DISABLED=new Qe(-1,0,0);var Ci=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var Fp="LruGarbageCollector",cT=1048576;function Up([n,e],[t,r]){let i=K(n,t);return i===0?K(e,r):i}var Nu=class{constructor(e){this.Tr=e,this.buffer=new be(Up),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Up(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},xu=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){L(Fp,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cr(t)?L(Fp,"Ignoring IndexedDB error during garbage collection: ",t):yield Ar(t)}yield this.Rr(3e5)}))}},Ou=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Ol.ue);let r=new Nu(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Mp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Mp):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,c,l,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,a=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,c=Date.now(),this.removeTargets(e,r,t))).next(y=>(s=y,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(h=Date.now(),or()<=Q.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(c-a)+`ms
	Removed ${s} targets in `+(l-c)+`ms
	Removed ${y} documents in `+(h-l)+`ms
Total Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:y})))}};function uT(n,e){return new Ou(n,e)}var Vu=class{constructor(){this.changes=new Bt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,st.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Lu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Mu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&_i(r.mutation,i,Ye.empty(),Ie.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Y()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Y()){let i=Cn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=pi();return s.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Cn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Y()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let s=jt(),a=yi(),c=(function(){return yi()})();return t.forEach((l,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof wt)?s=s.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),_i(f.mutation,h,f.mutation.getFieldMask(),Ie.now())):a.set(h.key,Ye.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var y;return c.set(h,new Lu(f,(y=a.get(h))!==null&&y!==void 0?y:null))}),c))}recalculateAndSaveOverlays(e,t){let r=yi(),i=new pe((a,c)=>a-c),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(l=>{let h=t.get(l);if(h===null)return;let f=r.get(l)||Ye.empty();f=c.applyToLocalView(h,f),r.set(l,f);let y=(i.get(c.batchId)||Y()).add(l);i=i.insert(c.batchId,y)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),h=l.key,f=l.value,y=Fm();f.forEach(_=>{if(!s.has(_)){let S=zm(t.get(_),r.get(_));S!==null&&y.set(_,S),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,y))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return U.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):P.resolve(Cn()),c=vi,l=s;return a.next(h=>P.forEach(h,(f,y)=>(c<y.largestBatchId&&(c=y.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,l,h,Y())).next(f=>({batchId:c,changes:Mm(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=pi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=pi();return this.indexManager.getCollectionParents(e,s).next(c=>P.forEach(c,l=>{let h=(function(y,_){return new $t(_,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(f=>{f.forEach((y,_)=>{a=a.insert(y,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,st.newInvalidDocument(f)))});let c=pi();return a.forEach((l,h)=>{let f=s.get(l);f!==void 0&&_i(f.mutation,h,Ye.empty(),Ie.now()),xo(t,h)&&(c=c.insert(l,h))}),c})}};var Fu=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return P.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:It(i.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:aT(i.bundledQuery),readTime:It(i.readTime)}})(t)),P.resolve()}};var Uu=class{constructor(){this.overlays=new pe(U.comparator),this.kr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Cn();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Cn(),s=t.length+1,a=new U(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new pe((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=Cn(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=Cn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return P.resolve(c)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new vu(t,r));let s=this.kr.get(t);s===void 0&&(s=Y(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var $u=class{constructor(){this.sessionToken=Oe.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var Si=class{constructor(){this.qr=new be(ge.Qr),this.$r=new be(ge.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new ge(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new ge(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new U(new ae([])),r=new ge(t,e),i=new ge(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new U(new ae([])),r=new ge(t,e),i=new ge(t,e+1),s=Y();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new ge(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ge=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return U.comparator(e.key,t.key)||K(e.Hr,t.Hr)}static Ur(e,t){return K(e.Hr,t.Hr)||U.comparator(e.key,t.key)}};var Bu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new be(ge.Qr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new _u(s,t,r,i);this.mutationQueue.push(a);for(let c of i)this.Yr=this.Yr.add(new ge(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Vl:this.er-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ge(t,0),i=new ge(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{let c=this.Zr(a.Hr);s.push(c)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new be(K);return t.forEach(i=>{let s=new ge(i,0),a=new ge(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],c=>{r=r.add(c.Hr)})}),P.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let a=new ge(new U(s),0),c=new be(K);return this.Yr.forEachWhile(l=>{let h=l.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(l.Hr)),!0)},a),P.resolve(this.ei(c))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){te(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return P.forEach(t.mutations,i=>{let s=new ge(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new ge(t,0),i=this.Yr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ju=class{constructor(e){this.ni=e,this.docs=(function(){return new pe(U.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():st.newInvalidDocument(t))}getEntries(e,t){let r=jt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():st.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=jt(),a=t.path,c=new U(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:h,value:{document:f}}=l.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||uE(cE(f),r)<=0||(i.has(f.key)||xo(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,r,i){$(9500)}ri(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new qu(this)}getSize(e){return P.resolve(this.size)}},qu=class extends Vu{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var zu=class{constructor(e){this.persistence=e,this.ii=new Bt(t=>$l(t),Bl),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.si=0,this.oi=new Si,this.targetCount=0,this._i=Ci.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),P.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Ci(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.hr(t),P.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.oi.containsKey(t))}};var co=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Ol(0),this.ci=!1,this.ci=!0,this.li=new $u,this.referenceDelegate=e(this),this.hi=new zu(this),this.indexManager=new ku,this.remoteDocumentCache=(function(i){return new ju(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new Pu(t),this.Ti=new Fu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Uu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Bu(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);let i=new Wu(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return P.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Wu=class extends eu{constructor(e){super(),this.currentSequenceNumber=e}},Gu=class n{constructor(e){this.persistence=e,this.Ai=new Si,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw $(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.mi,r=>{let i=U.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return P.or([()=>P.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},uo=class n{constructor(e,t){this.persistence=e,this.gi=new Bt(r=>fE(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=uT(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return P.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(c=>{c||(r++,s.removeEntry(a,z.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=zs(e.data.value)),t}Sr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Hu=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Ku=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Qu=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return Rd()?8:hE(Ee())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Ku;return this.ws(e,t,a).next(c=>{if(s.result=c,this.Rs)return this.Ss(e,t,a,c.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(or()<=Q.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",ar(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(or()<=Q.DEBUG&&L("QueryEngine","Query:",ar(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(or()<=Q.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",ar(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_t(t))):P.resolve())}ps(e,t){if(Sp(t))return P.resolve(null);let r=_t(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=to(t,null,"F"),r=_t(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=Y(...s);return this.gs.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(l=>{let h=this.bs(t,c);return this.Ds(t,h,a,l.readTime)?this.ps(e,to(t,null,"F")):this.vs(e,h,t,l)}))})))}ys(e,t,r,i){return Sp(t)||i.isEqual(z.min())?P.resolve(null):this.gs.getDocuments(e,r).next(s=>{let a=this.bs(t,s);return this.Ds(t,a,r,i)?P.resolve(null):(or()<=Q.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ar(t)),this.vs(e,a,t,aE(i,vi)).next(c=>c))})}bs(e,t){let r=new be(Vm(e));return t.forEach((i,s)=>{xo(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return or()<=Q.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",ar(t)),this.gs.getDocumentsMatchingQuery(e,t,Nn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var zl="LocalStore",lT=3e8,Yu=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new pe(K),this.Ms=new Bt(s=>$l(s),Bl),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Mu(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function hT(n,e,t,r){return new Yu(n,e,t,r)}function tg(n,e){return m(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],c=[],l=Y();for(let h of i){a.push(h.batchId);for(let f of h.mutations)l=l.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(r,l).next(h=>({Bs:h,removedBatchIds:a,addedBatchIds:c}))})})})}function dT(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return(function(c,l,h,f){let y=h.batch,_=y.keys(),S=P.resolve();return _.forEach(D=>{S=S.next(()=>f.getEntry(l,D)).next(V=>{let N=h.docVersions.get(D);te(N!==null,48541),V.version.compareTo(N)<0&&(y.applyToRemoteDocument(V,h),V.isValidDocument()&&(V.setReadTime(h.commitVersion),f.addEntry(V)))})}),S.next(()=>c.mutationQueue.removeMutationBatch(l,y))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let l=Y();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(l=l.add(c.batch.mutations[h].key));return l})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function ng(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function fT(n,e){let t=q(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let c=[];e.targetChanges.forEach((f,y)=>{let _=i.get(y);if(!_)return;c.push(t.hi.removeMatchingKeys(s,f.removedDocuments,y).next(()=>t.hi.addMatchingKeys(s,f.addedDocuments,y)));let S=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(y)!==null?S=S.withResumeToken(Oe.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,r)),i=i.insert(y,S),(function(V,N,G){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=lT?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(_,S,f)&&c.push(t.hi.updateTargetData(s,S))});let l=jt(),h=Y();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(pT(s,a,e.documentUpdates).next(f=>{l=f.Ls,h=f.ks})),!r.isEqual(z.min())){let f=t.hi.getLastRemoteSnapshotVersion(s).next(y=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return P.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,h)).next(()=>l)}).then(s=>(t.Fs=i,s))}function pT(n,e,t){let r=Y(),i=Y();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=jt();return t.forEach((c,l)=>{let h=s.get(c);l.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),l.isNoDocument()&&l.version.isEqual(z.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):L(zl,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function mT(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Vl),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function gT(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,P.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new Ai(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function Ju(n,e,t){return m(this,null,function*(){let r=q(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Cr(a))throw a;L(zl,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function $p(n,e,t){let r=q(n),i=z.min(),s=Y();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(l,h,f){let y=q(l),_=y.Ms.get(f);return _!==void 0?P.resolve(y.Fs.get(_)):y.hi.getTargetData(h,f)})(r,a,_t(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:z.min(),t?s:Y())).next(c=>(yT(r,kE(e),c),{documents:c,qs:s})))}function yT(n,e,t){let r=n.xs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}var lo=class{constructor(){this.activeTargetIds=LE()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Xu=class{constructor(){this.Fo=new lo,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new lo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Zu=class{xo(e){}shutdown(){}};var Bp="ConnectivityMonitor",ho=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){L(Bp,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){L(Bp,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var qs=null;function el(){return qs===null?qs=(function(){return 268435456+Math.round(2147483648*Math.random())})():qs++,"0x"+qs.toString(16)}var jc="RestConnection",_T={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},tl=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Xs?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let a=el(),c=this.Go(e,t.toUriEncodedString());L(jc,`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:h}=new URL(c),f=Qt(h);return this.jo(e,c,l,r,f).then(y=>(L(jc,`Received RPC '${e}' ${a}: `,y),y),y=>{throw cn(jc,`RPC '${e}' ${a} failed with error: `,y,"url: ",c,"request:",r),y})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+br})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=_T[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var nl=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Ne="WebChannelConnection",rl=class extends tl{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let a=el();return new Promise((c,l)=>{let h=new Lc;h.setWithCredentials(!0),h.listenOnce(Mc.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case fi.NO_ERROR:let y=h.getResponseJson();L(Ne,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),c(y);break;case fi.TIMEOUT:L(Ne,`RPC '${e}' ${a} timed out`),l(new O(R.DEADLINE_EXCEEDED,"Request time out"));break;case fi.HTTP_ERROR:let _=h.getStatus();if(L(Ne,`RPC '${e}' ${a} failed with status:`,_,"response text:",h.getResponseText()),_>0){let S=h.getResponseJson();Array.isArray(S)&&(S=S[0]);let D=S?.error;if(D&&D.status&&D.message){let V=(function(G){let j=G.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(j)>=0?j:R.UNKNOWN})(D.status);l(new O(V,D.message))}else l(new O(R.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new O(R.UNAVAILABLE,"Connection failed."));break;default:$(9055,{c_:e,streamId:a,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{L(Ne,`RPC '${e}' ${a} completed.`)}});let f=JSON.stringify(i);L(Ne,`RPC '${e}' ${a} sending request:`,i),h.send(t,"POST",f,r,15)})}P_(e,t,r){let i=el(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=$c(),c=Uc(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let f=s.join("");L(Ne,`Creating RPC '${e}' stream ${i}: ${f}`,l);let y=a.createWebChannel(f,l);this.T_(y);let _=!1,S=!1,D=new nl({Ho:N=>{S?L(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(_||(L(Ne,`Opening RPC '${e}' stream ${i} transport.`),y.open(),_=!0),L(Ne,`RPC '${e}' stream ${i} sending:`,N),y.send(N))},Yo:()=>y.close()}),V=(N,G,j)=>{N.listen(G,H=>{try{j(H)}catch(ie){setTimeout(()=>{throw ie},0)}})};return V(y,sr.EventType.OPEN,()=>{S||(L(Ne,`RPC '${e}' stream ${i} transport opened.`),D.s_())}),V(y,sr.EventType.CLOSE,()=>{S||(S=!0,L(Ne,`RPC '${e}' stream ${i} transport closed`),D.__(),this.I_(y))}),V(y,sr.EventType.ERROR,N=>{S||(S=!0,cn(Ne,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),D.__(new O(R.UNAVAILABLE,"The operation could not be completed")))}),V(y,sr.EventType.MESSAGE,N=>{var G;if(!S){let j=N.data[0];te(!!j,16349);let H=j,ie=H?.error||((G=H[0])===null||G===void 0?void 0:G.error);if(ie){L(Ne,`RPC '${e}' stream ${i} received error:`,ie);let Ve=ie.status,re=(function(v){let w=me[v];if(w!==void 0)return Gm(w)})(Ve),E=ie.message;re===void 0&&(re=R.INTERNAL,E="Unknown error status: "+Ve+" with message "+ie.message),S=!0,D.__(new O(re,E)),y.close()}else L(Ne,`RPC '${e}' stream ${i} received:`,j),D.a_(j)}}),V(c,Fc.STAT_EVENT,N=>{N.stat===$s.PROXY?L(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===$s.NOPROXY&&L(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.o_()},0),D}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function qc(){return typeof document<"u"?document:null}function Oo(n){return new bu(n,!0)}var fo=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var jp="PersistentStream",po=class{constructor(e,t,r,i,s,a,c,l){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new fo(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return m(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return m(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return m(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Mt(t.toString()),Mt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new O(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>m(this,null,function*(){this.state=0,this.start()}))}G_(e){return L(jp,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(L(jp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},il=class extends po{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=YE(this.serializer,e),r=(function(s){if(!("targetChange"in s))return z.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?It(a.readTime):z.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=Ru(this.serializer),t.addTarget=(function(s,a){let c,l=a.target;if(c=fu(l)?{documents:ZE(s,l)}:{query:eT(s,l).Vt},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Hm(s,a.resumeToken);let h=Au(s,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo(z.min())>0){c.readTime=oo(s,a.snapshotVersion.toTimestamp());let h=Au(s,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);let r=nT(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=Ru(this.serializer),t.removeTarget=e,this.k_(t)}},sl=class extends po{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=XE(e.writeResults,e.commitTime),r=It(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=Ru(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>JE(this.serializer,r))};this.k_(t)}};var ol=class{},al=class extends ol{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new O(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,Cu(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new O(R.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Jo(e,Cu(t,r),i,a,c,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(R.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},cl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Mt(t),this._a=!1):L("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Fn="RemoteStore",ul=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(()=>m(this,null,function*(){Bn(this)&&(L(Fn,"Restarting streams for network reachability change."),yield(function(l){return m(this,null,function*(){let h=q(l);h.Ia.add(4),yield Oi(h),h.Aa.set("Unknown"),h.Ia.delete(4),yield Vo(h)})})(this))}))}),this.Aa=new cl(r,i)}};function Vo(n){return m(this,null,function*(){if(Bn(n))for(let e of n.da)yield e(!0)})}function Oi(n){return m(this,null,function*(){for(let e of n.da)yield e(!1)})}function rg(n,e){let t=q(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Kl(t)?Hl(t):Sr(t).x_()&&Gl(t,e))}function Wl(n,e){let t=q(n),r=Sr(t);t.Ta.delete(e),r.x_()&&ig(t,e),t.Ta.size===0&&(r.x_()?r.B_():Bn(t)&&t.Aa.set("Unknown"))}function Gl(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Sr(n).H_(e)}function ig(n,e){n.Ra.$e(e),Sr(n).Y_(e)}function Hl(n){n.Ra=new Tu({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),Sr(n).start(),n.Aa.aa()}function Kl(n){return Bn(n)&&!Sr(n).M_()&&n.Ta.size>0}function Bn(n){return q(n).Ia.size===0}function sg(n){n.Ra=void 0}function IT(n){return m(this,null,function*(){n.Aa.set("Online")})}function vT(n){return m(this,null,function*(){n.Ta.forEach((e,t)=>{Gl(n,e)})})}function wT(n,e){return m(this,null,function*(){sg(n),Kl(n)?(n.Aa.la(e),Hl(n)):n.Aa.set("Unknown")})}function ET(n,e,t){return m(this,null,function*(){if(n.Aa.set("Online"),e instanceof io&&e.state===2&&e.cause)try{yield(function(i,s){return m(this,null,function*(){let a=s.cause;for(let c of s.targetIds)i.Ta.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.Ta.delete(c),i.Ra.removeTarget(c))})})(n,e)}catch(r){L(Fn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield mo(n,r)}else if(e instanceof hr?n.Ra.Ye(e):e instanceof ro?n.Ra.it(e):n.Ra.et(e),!t.isEqual(z.min()))try{let r=yield ng(n.localStore);t.compareTo(r)>=0&&(yield(function(s,a){let c=s.Ra.Pt(a);return c.targetChanges.forEach((l,h)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.Ta.get(h);f&&s.Ta.set(h,f.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,h)=>{let f=s.Ta.get(l);if(!f)return;s.Ta.set(l,f.withResumeToken(Oe.EMPTY_BYTE_STRING,f.snapshotVersion)),ig(s,l);let y=new Ai(f.target,l,h,f.sequenceNumber);Gl(s,y)}),s.remoteSyncer.applyRemoteEvent(c)})(n,t))}catch(r){L(Fn,"Failed to raise snapshot:",r),yield mo(n,r)}})}function mo(n,e,t){return m(this,null,function*(){if(!Cr(e))throw e;n.Ia.add(1),yield Oi(n),n.Aa.set("Offline"),t||(t=()=>ng(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(null,null,function*(){L(Fn,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield Vo(n)}))})}function og(n,e){return e().catch(t=>mo(n,t,e))}function Lo(n){return m(this,null,function*(){let e=q(n),t=ln(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Vl;for(;TT(e);)try{let i=yield mT(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,bT(e,i)}catch(i){yield mo(e,i)}ag(e)&&cg(e)})}function TT(n){return Bn(n)&&n.Pa.length<10}function bT(n,e){n.Pa.push(e);let t=ln(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function ag(n){return Bn(n)&&!ln(n).M_()&&n.Pa.length>0}function cg(n){ln(n).start()}function AT(n){return m(this,null,function*(){ln(n).na()})}function CT(n){return m(this,null,function*(){let e=ln(n);for(let t of n.Pa)e.X_(t.mutations)})}function ST(n,e,t){return m(this,null,function*(){let r=n.Pa.shift(),i=Iu.from(r,e,t);yield og(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Lo(n)})}function RT(n,e){return m(this,null,function*(){e&&ln(n).Z_&&(yield(function(r,i){return m(this,null,function*(){if((function(a){return qE(a)&&a!==R.ABORTED})(i.code)){let s=r.Pa.shift();ln(r).N_(),yield og(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Lo(r)}})})(n,e)),ag(n)&&cg(n)})}function qp(n,e){return m(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),L(Fn,"RemoteStore received new credentials");let r=Bn(t);t.Ia.add(3),yield Oi(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield Vo(t)})}function PT(n,e){return m(this,null,function*(){let t=q(n);e?(t.Ia.delete(2),yield Vo(t)):e||(t.Ia.add(2),yield Oi(t),t.Aa.set("Unknown"))})}function Sr(n){return n.Va||(n.Va=(function(t,r,i){let s=q(t);return s.ia(),new il(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:IT.bind(null,n),e_:vT.bind(null,n),n_:wT.bind(null,n),J_:ET.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.Va.N_(),Kl(n)?Hl(n):n.Aa.set("Unknown")):(yield n.Va.stop(),sg(n))}))),n.Va}function ln(n){return n.ma||(n.ma=(function(t,r,i){let s=q(t);return s.ia(),new sl(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:AT.bind(null,n),n_:RT.bind(null,n),ea:CT.bind(null,n),ta:ST.bind(null,n)}),n.da.push(e=>m(null,null,function*(){e?(n.ma.N_(),yield Lo(n)):(yield n.ma.stop(),n.Pa.length>0&&(L(Fn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var ll=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new it,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,c=new n(e,t,a,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ql(n,e){if(Mt("AsyncQueue",`${e}: ${n}`),Cr(n))return new O(R.UNAVAILABLE,`${e}: ${n}`);throw n}var go=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=pi(),this.sortedSet=new pe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var yo=class{constructor(){this.fa=new pe(U.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):$(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},Er=class n{constructor(e,t,r,i,s,a,c,l,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,go.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&No(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var hl=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},dl=class{constructor(){this.queries=zp(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=zp(),s.forEach((a,c)=>{for(let l of c.wa)l.onError(r)})})(this,new O(R.ABORTED,"Firestore shutting down"))}};function zp(){return new Bt(n=>Om(n),No)}function Yl(n,e){return m(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new hl,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=Ql(a,`Initialization of query '${ar(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Xl(t)})}function Jl(n,e){return m(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function kT(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let c of a.wa)c.Ca(i)&&(r=!0);a.ya=i}}r&&Xl(t)}function DT(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Xl(n){n.Da.forEach(e=>{e.next()})}var fl,Wp;(Wp=fl||(fl={})).Fa="default",Wp.Cache="cache";var Ri=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Er(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Er.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==fl.Cache}};var _o=class{constructor(e){this.key=e}},Io=class{constructor(e){this.key=e}},pl=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Y(),this.mutatedKeys=Y(),this.Xa=Vm(e),this.eu=new go(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new yo,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,y)=>{let _=i.get(f),S=xo(this.query,y)?y:null,D=!!_&&this.mutatedKeys.has(_.key),V=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),N=!1;_&&S?_.data.isEqual(S.data)?D!==V&&(r.track({type:3,doc:S}),N=!0):this.iu(_,S)||(r.track({type:2,doc:S}),N=!0,(l&&this.Xa(S,l)>0||h&&this.Xa(S,h)<0)&&(c=!0)):!_&&S?(r.track({type:0,doc:S}),N=!0):_&&!S&&(r.track({type:1,doc:_}),N=!0,(l||h)&&(c=!0)),N&&(S?(a=a.add(S),s=V?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{eu:a,ru:r,Ds:c,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((f,y)=>(function(S,D){let V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{At:N})}};return V(S)-V(D)})(f.type,y.type)||this.Xa(f.doc,y.doc)),this.su(r),i=i!=null&&i;let c=t&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,h=l!==this.Ya;return this.Ya=l,a.length!==0||h?{snapshot:new Er(this.query,e.eu,s,a,e.mutatedKeys,l===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new yo,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=Y(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new Io(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new _o(r))}),t}uu(e){this.Ha=e.qs,this.Za=Y();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Er.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Zl="SyncEngine",ml=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},gl=class{constructor(e){this.key=e,this.lu=!1}},yl=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Bt(c=>Om(c),No),this.Tu=new Map,this.Iu=new Set,this.du=new pe(U.comparator),this.Eu=new Map,this.Au=new Si,this.Ru={},this.Vu=new Map,this.mu=Ci.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function NT(n,e,t=!0){return m(this,null,function*(){let r=pg(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield ug(r,e,t,!0),i})}function xT(n,e){return m(this,null,function*(){let t=pg(n);yield ug(t,e,!0,!1)})}function ug(n,e,t,r){return m(this,null,function*(){let i=yield gT(n.localStore,_t(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield OT(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&rg(n.remoteStore,i),c})}function OT(n,e,t,r,i){return m(this,null,function*(){n.gu=(y,_,S)=>(function(V,N,G,j){return m(this,null,function*(){let H=N.view.nu(G);H.Ds&&(H=yield $p(V.localStore,N.query,!1).then(({documents:E})=>N.view.nu(E,H)));let ie=j&&j.targetChanges.get(N.targetId),Ve=j&&j.targetMismatches.get(N.targetId)!=null,re=N.view.applyChanges(H,V.isPrimaryClient,ie,Ve);return Hp(V,N.targetId,re._u),re.snapshot})})(n,y,_,S);let s=yield $p(n.localStore,e,!0),a=new pl(e,s.qs),c=a.nu(s.documents),l=bi.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=a.applyChanges(c,n.isPrimaryClient,l);Hp(n,t,h._u);let f=new ml(e,t,a);return n.Pu.set(e,f),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),h.snapshot})}function VT(n,e,t){return m(this,null,function*(){let r=q(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!No(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ju(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Wl(r.remoteStore,i.targetId),_l(r,i.targetId)}).catch(Ar))):(_l(r,i.targetId),yield Ju(r.localStore,i.targetId,!0))})}function LT(n,e){return m(this,null,function*(){let t=q(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Wl(t.remoteStore,r.targetId))})}function MT(n,e,t){return m(this,null,function*(){let r=zT(n);try{let i=yield(function(a,c){let l=q(a),h=Ie.now(),f=c.reduce((S,D)=>S.add(D.key),Y()),y,_;return l.persistence.runTransaction("Locally write mutations","readwrite",S=>{let D=jt(),V=Y();return l.Os.getEntries(S,f).next(N=>{D=N,D.forEach((G,j)=>{j.isValidDocument()||(V=V.add(G))})}).next(()=>l.localDocuments.getOverlayedDocuments(S,D)).next(N=>{y=N;let G=[];for(let j of c){let H=jE(j,y.get(j.key).overlayedDocument);H!=null&&G.push(new wt(j.key,H,Sm(H.value.mapValue),Ge.exists(!0)))}return l.mutationQueue.addMutationBatch(S,h,G,c)}).next(N=>{_=N;let G=N.applyToLocalDocumentSet(y,V);return l.documentOverlayCache.saveOverlays(S,N.batchId,G)})}).then(()=>({batchId:_.batchId,changes:Mm(y)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,c,l){let h=a.Ru[a.currentUser.toKey()];h||(h=new pe(K)),h=h.insert(c,l),a.Ru[a.currentUser.toKey()]=h})(r,i.batchId,t),yield Vi(r,i.changes),yield Lo(r.remoteStore)}catch(i){let s=Ql(i,"Failed to persist write");t.reject(s)}})}function lg(n,e){return m(this,null,function*(){let t=q(n);try{let r=yield fT(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Eu.get(s);a&&(te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?te(a.lu,14607):i.removedDocuments.size>0&&(te(a.lu,42227),a.lu=!1))}),yield Vi(t,r,e)}catch(r){yield Ar(r)}})}function Gp(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,a)=>{let c=a.view.va(e);c.snapshot&&i.push(c.snapshot)}),(function(a,c){let l=q(a);l.onlineState=c;let h=!1;l.queries.forEach((f,y)=>{for(let _ of y.wa)_.va(c)&&(h=!0)}),h&&Xl(l)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function FT(n,e,t){return m(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let a=new pe(U.comparator);a=a.insert(s,st.newNoDocument(s,z.min()));let c=Y().add(s),l=new no(z.min(),new Map,new pe(K),a,c);yield lg(r,l),r.du=r.du.remove(s),r.Eu.delete(e),eh(r)}else yield Ju(r.localStore,e,!1).then(()=>_l(r,e,t)).catch(Ar)})}function UT(n,e){return m(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield dT(t.localStore,e);dg(t,r,null),hg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Vi(t,i)}catch(i){yield Ar(i)}})}function $T(n,e,t){return m(this,null,function*(){let r=q(n);try{let i=yield(function(a,c){let l=q(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return l.mutationQueue.lookupMutationBatch(h,c).next(y=>(te(y!==null,37113),f=y.keys(),l.mutationQueue.removeMutationBatch(h,y))).next(()=>l.mutationQueue.performConsistencyCheck(h)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>l.localDocuments.getDocuments(h,f))})})(r.localStore,e);dg(r,e,t),hg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Vi(r,i)}catch(i){yield Ar(i)}})}function hg(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function dg(n,e,t){let r=q(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function _l(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||fg(n,r)})}function fg(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Wl(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),eh(n))}function Hp(n,e,t){for(let r of t)r instanceof _o?(n.Au.addReference(r.key,e),BT(n,r)):r instanceof Io?(L(Zl,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||fg(n,r.key)):$(19791,{yu:r})}function BT(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(L(Zl,"New document in limbo: "+t),n.Iu.add(r),eh(n))}function eh(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new U(ae.fromString(e)),r=n.mu.next();n.Eu.set(r,new gl(t)),n.du=n.du.insert(t,r),rg(n.remoteStore,new Ai(_t(Do(t.path)),r,"TargetPurposeLimboResolution",Ol.ue))}}function Vi(n,e,t){return m(this,null,function*(){let r=q(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((c,l)=>{a.push(r.gu(l,e,t).then(h=>{var f;if((h||t)&&r.isPrimaryClient){let y=h?!h.fromCache:(f=t?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(l.targetId,y?"current":"not-current")}if(h){i.push(h);let y=Hu.Es(l.targetId,h);s.push(y)}}))}),yield Promise.all(a),r.hu.J_(i),yield(function(l,h){return m(this,null,function*(){let f=q(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>P.forEach(h,_=>P.forEach(_.Is,S=>f.persistence.referenceDelegate.addReference(y,_.targetId,S)).next(()=>P.forEach(_.ds,S=>f.persistence.referenceDelegate.removeReference(y,_.targetId,S)))))}catch(y){if(!Cr(y))throw y;L(zl,"Failed to update sequence numbers: "+y)}for(let y of h){let _=y.targetId;if(!y.fromCache){let S=f.Fs.get(_),D=S.snapshotVersion,V=S.withLastLimboFreeSnapshotVersion(D);f.Fs=f.Fs.insert(_,V)}}})})(r.localStore,s))})}function jT(n,e){return m(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){L(Zl,"User change. New user:",e.toKey());let r=yield tg(t.localStore,e);t.currentUser=e,(function(s,a){s.Vu.forEach(c=>{c.forEach(l=>{l.reject(new O(R.CANCELLED,a))})}),s.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Vi(t,r.Bs)}})}function qT(n,e){let t=q(n),r=t.Eu.get(e);if(r&&r.lu)return Y().add(r.key);{let i=Y(),s=t.Tu.get(e);if(!s)return i;for(let a of s){let c=t.Pu.get(a);i=i.unionWith(c.view.tu)}return i}}function pg(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=lg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=FT.bind(null,e),e.hu.J_=kT.bind(null,e.eventManager),e.hu.pu=DT.bind(null,e.eventManager),e}function zT(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=UT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$T.bind(null,e),e}var mg=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return m(this,null,function*(){this.serializer=Oo(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return hT(this.persistence,new Qu,t.initialUser,this.serializer)}Du(t){return new co(Gu.Vi,this.serializer)}bu(t){return new Xu}terminate(){return m(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Il=class extends mg{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){te(this.persistence.referenceDelegate instanceof uo,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new xu(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?Qe.withCacheSize(this.cacheSizeBytes):Qe.DEFAULT;return new co(r=>uo.Vi(r,t),this.serializer)}};var WT=(()=>{class n{initialize(t,r){return m(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Gp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=jT.bind(null,this.syncEngine),yield PT(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new dl})()}createDatastore(t){let r=Oo(t.databaseInfo.databaseId),i=(function(a){return new rl(a)})(t.databaseInfo);return(function(a,c,l,h){return new al(a,c,l,h)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,a,c,l){return new ul(i,s,a,c,l)})(this.localStore,this.datastore,t.asyncQueue,r=>Gp(this.syncEngine,r,0),(function(){return ho.C()?new ho:new Zu})())}createSyncEngine(t,r){return(function(s,a,c,l,h,f,y){let _=new yl(s,a,c,l,h,f);return y&&(_.fu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return m(this,null,function*(){var t,r;yield(function(s){return m(this,null,function*(){let a=q(s);L(Fn,"RemoteStore shutting down."),a.Ia.add(5),yield Oi(a),a.Ea.shutdown(),a.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Pi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Mt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var hn="FirestoreClient",vl=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Te.UNAUTHENTICATED,this.clientId=Ii.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>m(this,null,function*(){L(hn,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(L(hn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new it;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ql(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function zc(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L(hn,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(null,null,function*(){r.isEqual(i)||(yield tg(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{cn("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{L("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{cn("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function Kp(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield GT(n);L(hn,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>qp(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>qp(e.remoteStore,i)),n._onlineComponents=e})}function GT(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(hn,"Using user provided OfflineComponentProvider");try{yield zc(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;cn("Error using user provided cache. Falling back to memory cache: "+t),yield zc(n,new mg)}}else L(hn,"Using default OfflineComponentProvider"),yield zc(n,new Il(void 0));return n._offlineComponents})}function gg(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(hn,"Using user provided OnlineComponentProvider"),yield Kp(n,n._uninitializedComponentsProvider._online)):(L(hn,"Using default OnlineComponentProvider"),yield Kp(n,new WT))),n._onlineComponents})}function HT(n){return gg(n).then(e=>e.syncEngine)}function vo(n){return m(this,null,function*(){let e=yield gg(n),t=e.eventManager;return t.onListen=NT.bind(null,e.syncEngine),t.onUnlisten=VT.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=LT.bind(null,e.syncEngine),t})}function KT(n,e,t={}){let r=new it;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,c,l,h){let f=new Pi({next:_=>{f.Ou(),a.enqueueAndForget(()=>Jl(s,y));let S=_.docs.has(c);!S&&_.fromCache?h.reject(new O(R.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&_.fromCache&&l&&l.source==="server"?h.reject(new O(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),y=new Ri(Do(c.path),f,{includeMetadataChanges:!0,ka:!0});return Yl(s,y)})(yield vo(n),n.asyncQueue,e,t,r)})),r.promise}function QT(n,e,t={}){let r=new it;return n.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return(function(s,a,c,l,h){let f=new Pi({next:_=>{f.Ou(),a.enqueueAndForget(()=>Jl(s,y)),_.fromCache&&l.source==="server"?h.reject(new O(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),y=new Ri(c,f,{includeMetadataChanges:!0,ka:!0});return Yl(s,y)})(yield vo(n),n.asyncQueue,e,t,r)})),r.promise}function yg(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Qp=new Map;var _g="firestore.googleapis.com",Yp=!0,wo=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new O(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_g,this.ssl=Yp}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Yp;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=eg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<cT)throw new O(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yg((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Un=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wo(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Gc;switch(r.type){case"firstParty":return new Yc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return m(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=Qp.get(t);r&&(L("ComponentProvider","Removing Datastore"),Qp.delete(t),r.terminate())})(this),Promise.resolve()}};function th(n,e,t,r={}){var i;n=xe(n,Un);let s=Qt(e),a=n._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;s&&(cs(`https://${l}`),us("Firestore",!0)),a.host!==_g&&a.host!==l&&cn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!dt(h,c)&&(n._setSettings(h),r.mockUserToken)){let f,y;if(typeof r.mockUserToken=="string")f=r.mockUserToken,y=Te.MOCK_USER;else{f=Ed(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new O(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new Te(_)}n._authCredentials=new Hc(new Hs(f,y))}}var Et=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ve=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(xi(t,n._jsonSchema))return new n(e,r||null,new U(ae.fromString(t.referencePath)))}};ve._jsonSchemaVersion="firestore/documentReference/1.0",ve._jsonSchema={type:_e("string",ve._jsonSchemaVersion),referencePath:_e("string")};var rn=class n extends Et{constructor(e,t,r){super(e,t,Do(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Ig(n,e,...t){if(n=ue(n),xl("collection","path",e),n instanceof Un){let r=ae.fromString(e,...t);return pp(r),new rn(n,null,r)}{if(!(n instanceof ve||n instanceof rn))throw new O(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ae.fromString(e,...t));return pp(r),new rn(n.firestore,null,r)}}function vg(n,e){if(n=xe(n,Un),xl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new O(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(n,null,(function(r){return new $t(ae.emptyPath(),r)})(e))}function nh(n,e,...t){if(n=ue(n),arguments.length===1&&(e=Ii.newId()),xl("doc","path",e),n instanceof Un){let r=ae.fromString(e,...t);return fp(r),new ve(n,null,new U(r))}{if(!(n instanceof ve||n instanceof rn))throw new O(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ae.fromString(e,...t));return fp(r),new ve(n.firestore,n instanceof rn?n.converter:null,new U(r))}}var Jp="AsyncQueue",Eo=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new fo(this,"async_queue_retry"),this.oc=()=>{let r=qc();r&&L(Jp,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=qc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=qc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new it;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return m(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Cr(e))throw e;L(Jp,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,Mt("INTERNAL UNHANDLED ERROR: ",Xp(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=ll.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&$(47125,{hc:Xp(this.tc)})}verifyOperationInProgress(){}Pc(){return m(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function Xp(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Zp(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var Je=class extends Un{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Eo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return m(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Eo(e),this._firestoreClient=void 0,yield e}})}};function wg(n,e){let t=typeof n=="object"?n:vn(),r=typeof n=="string"?n:e||Xs,i=Jn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=wd("firestore");s&&th(i,...s)}return i}function Li(n){if(n._terminated)throw new O(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||YT(n),n._firestoreClient}function YT(n){var e,t,r;let i=n._freezeSettings(),s=(function(c,l,h,f){return new tu(c,l,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,yg(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new vl(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(c){let l=c?._online.build();return{_offline:c?._offline.build(l),_online:l}})(n._componentsProvider))}var sn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Oe.fromBase64String(e))}catch(t){throw new O(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Oe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(xi(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};sn._jsonSchemaVersion="firestore/bytes/1.0",sn._jsonSchema={type:_e("string",sn._jsonSchemaVersion),bytes:_e("string")};var $n=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new We(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Tr=class{constructor(e){this._methodName=e}};var on=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(xi(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};on._jsonSchemaVersion="firestore/geoPoint/1.0",on._jsonSchema={type:_e("string",on._jsonSchemaVersion),latitude:_e("number"),longitude:_e("number")};var an=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(xi(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new O(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};an._jsonSchemaVersion="firestore/vectorValue/1.0",an._jsonSchema={type:_e("string",an._jsonSchemaVersion),vectorValues:_e("object")};var JT=/^__.*__$/,wl=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mn(e,this.data,t,this.fieldTransforms)}},To=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Eg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ec:n})}}var El=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Ao(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Eg(this.Ec)&&JT.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},Tl=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Oo(e)}Dc(e,t,r,i=!1){return new El({Ec:e,methodName:t,bc:r,path:We.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Mi(n){let e=n._freezeSettings(),t=Oo(n._databaseId);return new Tl(n._databaseId,!!e.ignoreUndefinedProperties,t)}function rh(n,e,t,r,i,s={}){let a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);ih("Data must be an object, but it was:",a,r);let c=Ag(r,a),l,h;if(s.merge)l=new Ye(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let y of s.mergeFields){let _=Al(e,y,t);if(!a.contains(_))throw new O(R.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Sg(f,_)||f.push(_)}l=new Ye(f),h=a.fieldTransforms.filter(y=>l.covers(y.field))}else l=null,h=a.fieldTransforms;return new wl(new ze(c),l,h)}var bo=class n extends Tr{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};var bl=class n extends Tr{_toFieldTransform(e){return new mu(e.path,new On)}isEqual(e){return e instanceof n}};function Tg(n,e,t,r){let i=n.Dc(1,e,t);ih("Data must be an object, but it was:",i,r);let s=[],a=ze.empty();dn(r,(l,h)=>{let f=sh(e,l,t);h=ue(h);let y=i.gc(f);if(h instanceof bo)s.push(f);else{let _=Fi(h,y);_!=null&&(s.push(f),a.set(f,_))}});let c=new Ye(s);return new To(a,c,i.fieldTransforms)}function bg(n,e,t,r,i,s){let a=n.Dc(1,e,t),c=[Al(e,r,t)],l=[i];if(s.length%2!=0)throw new O(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)c.push(Al(e,s[_])),l.push(s[_+1]);let h=[],f=ze.empty();for(let _=c.length-1;_>=0;--_)if(!Sg(h,c[_])){let S=c[_],D=l[_];D=ue(D);let V=a.gc(S);if(D instanceof bo)h.push(S);else{let N=Fi(D,V);N!=null&&(h.push(S),f.set(S,N))}}let y=new Ye(h);return new To(f,y,a.fieldTransforms)}function XT(n,e,t,r=!1){return Fi(t,n.Dc(r?4:3,e))}function Fi(n,e){if(Cg(n=ue(n)))return ih("Unsupported field value:",e,n),Ag(n,e);if(n instanceof Tr)return(function(r,i){if(!Eg(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,i){let s=[],a=0;for(let c of r){let l=Fi(c,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=ue(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ME(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Ie.fromDate(r);return{timestampValue:oo(i.serializer,s)}}if(r instanceof Ie){let s=new Ie(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:oo(i.serializer,s)}}if(r instanceof on)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sn)return{bytesValue:Hm(i.serializer,r._byteString)};if(r instanceof ve){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ql(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof an)return(function(a,c){return{mapValue:{fields:{[Ml]:{stringValue:Fl},[pr]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw c.wc("VectorValues must only contain numeric values.");return jl(c.serializer,h)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${Ro(r)}`)})(n,e)}function Ag(n,e){let t={};return Im(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dn(n,(r,i)=>{let s=Fi(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Cg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ie||n instanceof on||n instanceof sn||n instanceof ve||n instanceof Tr||n instanceof an)}function ih(n,e,t){if(!Cg(t)||!im(t)){let r=Ro(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Al(n,e,t){if((e=ue(e))instanceof $n)return e._internalPath;if(typeof e=="string")return sh(n,e);throw Ao("Field path arguments must be of type string or ",n,!1,void 0,t)}var ZT=new RegExp("[~\\*/\\[\\]]");function sh(n,e,t){if(e.search(ZT)>=0)throw Ao(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new $n(...e.split("."))._internalPath}catch{throw Ao(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ao(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new O(R.INVALID_ARGUMENT,c+n+l)}function Sg(n,e){return n.some(t=>t.isEqual(e))}var Co=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Cl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Mo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Cl=class extends Co{data(){return super.data()}};function Mo(n,e){return typeof e=="string"?sh(n,e):e instanceof $n?e._internalPath:e._delegate._internalPath}function Rg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ki=class{},Di=class extends ki{};function Pg(n,e,...t){let r=[];e instanceof ki&&r.push(e),r=r.concat(t),(function(s){let a=s.filter(l=>l instanceof Sl).length,c=s.filter(l=>l instanceof So).length;if(a>1||a>0&&c>0)throw new O(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var So=class n extends Di{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return xg(e._query,t),new Et(e.firestore,e.converter,pu(e._query,t))}_parse(e){let t=Mi(e.firestore);return(function(s,a,c,l,h,f,y){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new O(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){tm(y,f);let D=[];for(let V of y)D.push(em(l,s,V));_={arrayValue:{values:D}}}else _=em(l,s,y)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||tm(y,f),_=XT(c,a,y,f==="in"||f==="not-in");return ye.create(h,f,_)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function kg(n,e,t){let r=e,i=Mo("where",n);return So._create(i,r,t)}var Sl=class n extends ki{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ot.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let a=i,c=s.getFlattenedFilters();for(let l of c)xg(a,l),a=pu(a,l)})(e._query,t),new Et(e.firestore,e.converter,pu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Rl=class n extends Di{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,a){if(i.startAt!==null)throw new O(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new O(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xn(s,a)})(e._query,this._field,this._direction);return new Et(e.firestore,e.converter,(function(i,s){let a=i.explicitOrderBy.concat([s]);return new $t(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function Dg(n,e="asc"){let t=e,r=Mo("orderBy",n);return Rl._create(r,t)}var Pl=class n extends Di{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Et(e.firestore,e.converter,to(e._query,this._limit,this._limitType))}};function Ng(n){return oE("limit",n),Pl._create("limit",n,"F")}function em(n,e,t){if(typeof(t=ue(t))=="string"){if(t==="")throw new O(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xm(e)&&t.indexOf("/")!==-1)throw new O(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ae.fromString(t));if(!U.isDocumentKey(r))throw new O(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return wp(n,new U(r))}if(t instanceof ve)return wp(n,t._key);throw new O(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ro(t)}.`)}function tm(n,e){if(!Array.isArray(n)||n.length===0)throw new O(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xg(n,e){let t=(function(i,s){for(let a of i)for(let c of a.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new O(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var kl=class{convertValue(e,t="none"){switch(un(e)){case 0:return null;case 1:return e.booleanValue;case 2:return le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ut(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return dn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[pr].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>le(a.doubleValue));return new an(s)}convertGeoPoint(e){return new on(le(e.latitude),le(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=ko(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ei(e));default:return null}}convertTimestamp(e){let t=Ft(e);return new Ie(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ae.fromString(e);te(Zm(r),9688,{name:e});let i=new Zs(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Mt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function oh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Rn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Pn=class n extends Co{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new dr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Mo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Pn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pn._jsonSchema={type:_e("string",Pn._jsonSchemaVersion),bundleSource:_e("string","DocumentSnapshot"),bundleName:_e("string"),bundle:_e("string")};var dr=class extends Pn{data(e={}){return super.data(e)}},kn=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Rn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new dr(this._firestore,this._userDataWriter,r.key,r,new Rn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let l=new dr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Rn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let l=new dr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Rn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:eb(c.type),doc:l,oldIndex:h,newIndex:f}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ii.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function eb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}function Og(n){n=xe(n,ve);let e=xe(n.firestore,Je);return KT(Li(e),n._key).then(t=>Bg(e,n,t))}kn._jsonSchemaVersion="firestore/querySnapshot/1.0",kn._jsonSchema={type:_e("string",kn._jsonSchemaVersion),bundleSource:_e("string","QuerySnapshot"),bundleName:_e("string"),bundle:_e("string")};var Ni=class extends kl{constructor(e){super(),this.firestore=e}convertBytes(e){return new sn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};function Vg(n){n=xe(n,Et);let e=xe(n.firestore,Je),t=Li(e),r=new Ni(e);return Rg(n._query),QT(t,n._query).then(i=>new kn(e,r,n,i))}function Lg(n,e,t){n=xe(n,ve);let r=xe(n.firestore,Je),i=oh(n.converter,e,t);return Ui(r,[rh(Mi(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ge.none())])}function Mg(n,e,t,...r){n=xe(n,ve);let i=xe(n.firestore,Je),s=Mi(i),a;return a=typeof(e=ue(e))=="string"||e instanceof $n?bg(s,"updateDoc",n._key,e,t,r):Tg(s,"updateDoc",n._key,e),Ui(i,[a.toMutation(n._key,Ge.exists(!0))])}function Fg(n){return Ui(xe(n.firestore,Je),[new wr(n._key,Ge.none())])}function Ug(n,e){let t=xe(n.firestore,Je),r=nh(n),i=oh(n.converter,e);return Ui(t,[rh(Mi(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ge.exists(!1))]).then(()=>r)}function $g(n,...e){var t,r,i;n=ue(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Zp(e[a])||(s=e[a++]);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Zp(e[a])){let y=e[a];e[a]=(t=y.next)===null||t===void 0?void 0:t.bind(y),e[a+1]=(r=y.error)===null||r===void 0?void 0:r.bind(y),e[a+2]=(i=y.complete)===null||i===void 0?void 0:i.bind(y)}let l,h,f;if(n instanceof ve)h=xe(n.firestore,Je),f=Do(n._key.path),l={next:y=>{e[a]&&e[a](Bg(h,n,y))},error:e[a+1],complete:e[a+2]};else{let y=xe(n,Et);h=xe(y.firestore,Je),f=y._query;let _=new Ni(h);l={next:S=>{e[a]&&e[a](new kn(h,_,y,S))},error:e[a+1],complete:e[a+2]},Rg(n._query)}return(function(_,S,D,V){let N=new Pi(V),G=new Ri(S,N,D);return _.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Yl(yield vo(_),G)})),()=>{N.Ou(),_.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return Jl(yield vo(_),G)}))}})(Li(h),f,c,l)}function Ui(n,e){return(function(r,i){let s=new it;return r.asyncQueue.enqueueAndForget(()=>m(null,null,function*(){return MT(yield HT(r),i,s)})),s.promise})(Li(n),e)}function Bg(n,e,t){let r=t.docs.get(e._key),i=new Ni(n);return new Pn(n,i,e._key,r,new Rn(t.hasPendingWrites,t.fromCache),e.converter)}var Dl=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Mi(e)}set(e,t,r){this._verifyNotCommitted();let i=Wc(e,this._firestore),s=oh(i.converter,t,r),a=rh(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Ge.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Wc(e,this._firestore),a;return a=typeof(t=ue(t))=="string"||t instanceof $n?bg(this._dataReader,"WriteBatch.update",s._key,t,r,i):Tg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Ge.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Wc(e,this._firestore);return this._mutations=this._mutations.concat(new wr(t._key,Ge.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Wc(n,e){if((n=ue(n)).firestore!==e)throw new O(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function ce(){return new bl("serverTimestamp")}function jg(n){return Li(n=xe(n,Je)),new Dl(n,e=>Ui(n,e))}(function(e,t=!0){(function(i){br=i})(Jt),tt(new Fe("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),c=new Je(new Kc(r.getProvider("auth-internal")),new Jc(a,r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new O(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zs(h.options.projectId,f)})(a,i),a);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),fe(up,lp,e),fe(up,lp,"esm2017")})();var at=class{constructor(e){return e}},qg="firestore",ah=class{constructor(){return Zn(qg)}};var ch=new Gn("angularfire2.firestore-instances");function tb(n,e){let t=ei(qg,n,e);return t&&new at(t)}function nb(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new at(r)}}var rb={provide:ah,deps:[[new He,ch]]},ib={provide:at,useFactory:tb,deps:[[new He,ch],Rt]};function YS(n,...e){return fe("angularfire",Xt.full,"fst"),Hn([ib,rb,{provide:ch,useFactory:nb(n),multi:!0,deps:[ht,$e,Zt,En,[new He,di],[new He,er],...e]}])}var Tt=ee(Ug,!0,2);var B=ee(Ig,!0,2),zg=ee(vg,!0,2),JS=ee(th,!0);var Ce=ee(Fg,!0,2);var W=ee(nh,!0,2);var Be=ee(Og,!0);var ne=ee(Vg,!0);var XS=ee(wg,!0);var Rr=ee(Ng,!0,2);var ct=ee($g,!0);var qt=ee(Dg,!0,2),we=ee(Pg,!0,2);var ut=ee(Lg,!0,2);var Se=ee(Mg,!0,2);var Xe=ee(kg,!0,2),Fo=ee(jg,!0,2);var Pr=class n{firestore=he(at);injector=he($e);firestoreService=he(Uo);createCompany(e){return m(this,null,function*(){try{let t=W(B(this.firestore,"companies")),r=new Date,i=Z(M({},e),{id:t.id,smtpConfig:e.smtpConfig||{host:"smtp.gmail.com",port:587,secure:!1,user:"",password:"",fromName:e.name,fromEmail:e.contactEmail||""},apiConfig:{enabled:!0,token:this.generateApiToken(),endpoint:`https://${e.subdomain}.taskboard.com.br/api/v1/lead-intake`,webhookUrl:""},features:this.getFeaturesByPlan(e.plan),status:"active",createdAt:r,updatedAt:r});return yield ut(t,i),yield this.createDefaultSettings(t.id,e.ownerId),t.id}catch(t){throw t}})}getCompanyBySubdomain(e){return m(this,null,function*(){return this.queryCompanyBySubdomain(e)})}queryCompanyBySubdomain(e){return m(this,null,function*(){try{return console.log("\u{1F50D} Buscando empresa por subdom\xEDnio:",e),yield k(this.injector,()=>m(this,null,function*(){let t=B(this.firestore,"companies"),r=we(t,Xe("subdomain","==",e)),i=yield ne(r);if(console.log("\u{1F4CA} Resultado da query:",{empty:i.empty,size:i.size,docs:i.docs.map(c=>({id:c.id,subdomain:c.data().subdomain}))}),i.empty)return console.log("\u274C Nenhuma empresa encontrada para subdom\xEDnio:",e),null;let s=i.docs[0],a=M({id:s.id},s.data());return console.log("\u2705 Empresa encontrada:",{id:a.id,subdomain:a.subdomain,name:a.name}),a}))}catch(t){return console.error("\u274C Erro ao buscar empresa por subdom\xEDnio:",e,t),null}})}getCompany(e){return m(this,null,function*(){try{return yield k(this.injector,()=>m(this,null,function*(){let t=W(this.firestore,"companies",e),r=yield Be(t);return r.exists()?M({id:r.id},r.data()):null}))}catch(t){throw t}})}getCompaniesByOwner(e){return m(this,null,function*(){try{return yield k(this.injector,()=>m(this,null,function*(){let t=B(this.firestore,"companies"),r=we(t,Xe("ownerId","==",e)),i=yield ne(r),s=[];return i.docs.forEach(a=>{s.push(M({id:a.id},a.data()))}),s}))}catch{return[]}})}updateCompany(e,t){return m(this,null,function*(){try{let r=W(this.firestore,"companies",e);yield Se(r,Z(M({},t),{updatedAt:new Date}))}catch(r){throw r}})}addUserToCompany(e,t,r,i){return m(this,null,function*(){try{let s=W(this.firestore,"companies",e,"users",t),a=i?.trim()||this.extractNameFromEmail(t),c={uid:"",email:t,displayName:a,role:r,permissions:this.getPermissionsByRole(r),joinedAt:new Date,inviteStatus:"pending",inviteToken:this.generateInviteToken()};yield ut(s,c);try{yield this.sendInvitationEmail(t,r,e,c.inviteToken,a)}catch(l){console.error("Erro ao enviar email de convite:",l);let h="Usu\xE1rio adicionado com sucesso, mas houve erro ao enviar email de convite.";throw l?.message&&l.message.includes("Configura\xE7\xE3o SMTP")?h=`Erro ao enviar convite: ${l.message}`:l?.message?h=`Erro ao enviar convite: ${l.message}`:h+=" Verifique a configura\xE7\xE3o do SMTP.",new Error(h)}}catch(s){throw s}})}extractNameFromEmail(e){return e.split("@")[0].split(/[._-]/).map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" ")}generateInviteToken(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}sendInvitationEmail(e,t,r,i,s){return m(this,null,function*(){try{console.log("\u{1F4E7} Debug Email - Enviando convite:",{userEmail:e,role:t,companyId:r,inviteToken:i,displayName:s});let{SmtpService:a}=yield import("./chunk-FG7JAFC3.js"),c=this.injector.get(a),l=yield this.getCompany(r);if(!l)throw new Error("Empresa n\xE3o encontrada");let h={admin:"Administrador",manager:"Gerente",user:"Usu\xE1rio"},f=`${window.location.origin}/accept-invite?token=${i}&email=${encodeURIComponent(e)}&companyId=${r}`;console.log("\u{1F517} Debug Email - Link do convite:",f);let y=`Convite para participar da ${l.name}`,_=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #f8f9fa;">
          <!-- Header do TaskBoard -->
          <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div style="display: inline-block; background: ${l.brandingConfig?.primaryColor||"#3B82F6"}; color: white; padding: 15px; border-radius: 50%; margin-bottom: 15px;">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
            ${l.brandingConfig?.logo?`<img src="${l.brandingConfig.logo}" alt="${l.name}" style="max-height: 60px; margin-bottom: 15px;">`:""}
            <h1 style="color: ${l.brandingConfig?.primaryColor||"#3B82F6"}; margin: 10px 0 5px 0; font-size: 28px;">
              TaskBoard
            </h1>
            <p style="color: #666; margin: 0; font-size: 14px;">Sistema de Gest\xE3o Kanban</p>
          </div>
          
          <!-- Conte\xFAdo do convite -->
          <div style="background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="color: #333; margin-top: 0; font-size: 24px;">\u{1F389} Voc\xEA foi convidado!</h2>
            <p style="color: #555; font-size: 16px; line-height: 1.6;">Ol\xE1${s?` ${s}`:""},</p>
            <p style="color: #555; font-size: 16px; line-height: 1.6;">
              Voc\xEA foi convidado para fazer parte da empresa <strong>${l.name}</strong> no <strong>TaskBoard</strong> 
              com a fun\xE7\xE3o de <strong>${h[t]}</strong>.
            </p>
            <p style="color: #555; font-size: 16px; line-height: 1.6;">
              O TaskBoard \xE9 um sistema de gest\xE3o Kanban que permite organizar e acompanhar projetos de forma visual e colaborativa.
            </p>
            <p style="color: #555; font-size: 16px; line-height: 1.6;">
              Para aceitar o convite e criar sua conta, clique no bot\xE3o abaixo:
            </p>
            
            <div style="text-align: center; margin: 35px 0;">
              <a href="${f}" 
                 style="background: linear-gradient(135deg, ${l.brandingConfig?.primaryColor||"#3B82F6"} 0%, #5a67d8 100%); 
                        color: white; 
                        padding: 16px 32px; 
                        text-decoration: none; 
                        border-radius: 8px; 
                        font-weight: 600;
                        font-size: 16px;
                        display: inline-block;
                        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
                        transition: transform 0.2s ease;">
                \u{1F680} Aceitar Convite e Criar Conta
              </a>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid ${l.brandingConfig?.primaryColor||"#3B82F6"};">
              <p style="margin: 0; color: #666; font-size: 14px;">
                <strong>\u{1F4A1} Sobre o TaskBoard:</strong><br>
                \u2022 Organize projetos em quadros Kanban visuais<br>
                \u2022 Colabore em tempo real com sua equipe<br>
                \u2022 Acompanhe o progresso de leads e projetos<br>
                \u2022 Gerencie usu\xE1rios e permiss\xF5es
              </p>
            </div>
          </div>
          
          <!-- Footer -->
          <div style="text-align: center; color: #888; font-size: 13px; line-height: 1.6;">
            <p>Se voc\xEA n\xE3o conseguir clicar no bot\xE3o, copie e cole este link no seu navegador:</p>
            <p style="background: white; padding: 10px; border-radius: 6px; word-break: break-all; border: 1px solid #e1e5e9;">
              <a href="${f}" style="color: #3B82F6;">${f}</a>
            </p>
            <p style="margin-top: 20px;">
              Este convite foi enviado por <strong>${l.name}</strong> atrav\xE9s do <strong>TaskBoard</strong>.<br>
              <em>Se voc\xEA j\xE1 possui uma conta, fa\xE7a login normalmente em vez de usar este link.</em>
            </p>
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e1e5e9;">
              <p style="margin: 0; color: #aaa; font-size: 12px;">
                \xA9 2024 TaskBoard - Sistema de Gest\xE3o Kanban<br>
                Transformando a gest\xE3o de projetos em uma experi\xEAncia visual
              </p>
            </div>
          </div>
        </div>
      `;yield c.sendEmail({to:e,subject:y,html:_}).toPromise()}catch(a){throw a}})}getCompanyUsers(e){return m(this,null,function*(){try{let t=B(this.firestore,"companies",e,"users");return(yield k(this.injector,()=>ne(t))).docs.map(s=>{let a=s.data();return Z(M({},a),{uid:a.uid||"",email:s.id})})}catch(t){return console.warn("Erro ao buscar usu\xE1rios da empresa:",t),[]}})}removeUserFromCompany(e,t){return m(this,null,function*(){try{console.log("\u{1F5D1}\uFE0F Debug Service - Removendo usu\xE1rio:",{companyId:e,userEmail:t});let r=W(this.firestore,"companies",e,"users",t);console.log("\u{1F4C4} Debug Service - Refer\xEAncia do documento:",r.path),yield k(this.injector,()=>Ce(r)),console.log("\u2705 Debug Service - Documento deletado com sucesso")}catch(r){throw console.error("\u274C Debug Service - Erro ao deletar documento:",r),r}})}updateUserRole(e,t,r){return m(this,null,function*(){try{let i=W(this.firestore,"companies",e,"users",t);yield Se(i,{role:r,permissions:this.getPermissionsByRole(r)})}catch(i){throw i}})}updateUserInCompany(e,t,r){return m(this,null,function*(){try{let i=W(this.firestore,"companies",e,"users",t);yield Se(i,r)}catch(i){throw i}})}getCompanyUser(e,t){return m(this,null,function*(){try{let r=W(this.firestore,"companies",e,"users",t),i=yield k(this.injector,()=>Be(r));return i.exists()?M({uid:i.id},i.data()):null}catch(r){return console.warn("Erro ao buscar usu\xE1rio da empresa:",r),null}})}deleteCompany(e){return m(this,null,function*(){try{let t=B(this.firestore,"companies",e,"users"),r=yield k(this.injector,()=>ne(t));for(let h of r.docs)yield k(this.injector,()=>Ce(h.ref));let i=W(this.firestore,"companies",e,"settings","general");(yield k(this.injector,()=>Be(i))).exists()&&(yield k(this.injector,()=>Ce(i)));let a=B(this.firestore,"companies",e,"boards"),c=yield k(this.injector,()=>ne(a));for(let h of c.docs){let f=h.id,y=B(this.firestore,"companies",e,"boards",f,"columns"),_=yield k(this.injector,()=>ne(y));for(let V of _.docs)yield k(this.injector,()=>Ce(V.ref));let S=B(this.firestore,"companies",e,"boards",f,"leads"),D=yield k(this.injector,()=>ne(S));for(let V of D.docs)yield k(this.injector,()=>Ce(V.ref));yield k(this.injector,()=>Ce(h.ref))}let l=W(this.firestore,"companies",e);yield k(this.injector,()=>Ce(l))}catch(t){throw t}})}createDefaultSettings(e,t){return m(this,null,function*(){try{let r=W(this.firestore,"companies",e,"settings","general");yield ut(r,{companyId:e,timezone:"America/Sao_Paulo",language:"pt-BR",dateFormat:"DD/MM/YYYY",notifications:{emailOnNewLead:!0,emailOnLeadMove:!0,emailOnLeadComment:!1},formSettings:{allowPublicForm:!0,requireCaptcha:!1,thankyouMessage:"Obrigado! Entraremos em contato em breve."}})}catch(r){throw r}})}getCompanySettings(e){return m(this,null,function*(){try{let t=W(this.firestore,"companies",e,"settings","general"),r=yield k(this.injector,()=>Be(t));return r.exists()?r.data():null}catch(t){throw t}})}updateCompanySettings(e,t){return m(this,null,function*(){try{let r=W(this.firestore,"companies",e,"settings","general");yield Se(r,t)}catch(r){throw r}})}isSubdomainAvailable(e){return m(this,null,function*(){try{return(yield this.getCompanyBySubdomain(e))===null}catch{return!1}})}getCompanySubdomain(){if(typeof window<"u"){let e=window.location.hostname;if(e==="localhost"||e==="127.0.0.1")return localStorage.getItem("dev-subdomain")||null;if(e.includes("taskboard.com.br")){let t=e.split(".");if(t.length>=3)return t[0]}}return null}getCompanyByUserEmail(e){return m(this,null,function*(){try{return console.log("\u{1F50D} Debug Service - Buscando empresa para email:",e),yield k(this.injector,()=>m(this,null,function*(){console.log("\u{1F451} Debug Service - Procurando como propriet\xE1rio...");let t=B(this.firestore,"companies"),r=we(t,Xe("ownerEmail","==",e),Rr(1)),i=yield k(this.injector,()=>ne(r));if(console.log("\u{1F451} Debug Service - Documentos encontrados como owner:",i.size),!i.empty){let c=i.docs[0];return console.log("\u2705 Debug Service - Empresa encontrada como owner:",c.id),M({id:c.id},c.data())}console.log("\u{1F465} Debug Service - Procurando como usu\xE1rio da empresa...");let s=zg(this.firestore,"users"),a=yield k(this.injector,()=>ne(we(s,Xe("email","==",e),Rr(1))));if(console.log("\u{1F465} Debug Service - Documentos encontrados como usu\xE1rio:",a.size),!a.empty){let c=a.docs[0];console.log("\u{1F464} Debug Service - Usu\xE1rio encontrado no documento:",c.ref.path),console.log("\u{1F464} Debug Service - Dados do usu\xE1rio:",c.data());let l=c.ref.parent?.parent;if(l){console.log("\u{1F3E2} Debug Service - Refer\xEAncia da empresa:",l.path);let h=yield k(this.injector,()=>Be(l));if(h.exists())return console.log("\u2705 Debug Service - Empresa encontrada:",h.id),M({id:h.id},h.data());console.log("\u274C Debug Service - Documento da empresa n\xE3o existe")}else console.log("\u274C Debug Service - Refer\xEAncia da empresa \xE9 null")}return console.log("\u274C Debug Service - Nenhuma empresa encontrada"),null}))}catch(t){return console.error("\u274C Debug Service - Erro na busca:",t),null}})}validateInviteWithCompanyId(e,t,r){return m(this,null,function*(){try{console.log("\u{1F50D} Debug - Validando convite com ID da empresa:",{companyId:e,email:t,token:r});let i=yield this.getCompany(e);if(!i)return console.log("\u274C Debug - Empresa n\xE3o encontrada"),{valid:!1};let s=yield this.getCompanyUser(e,t);return s?s.inviteToken!==r?(console.log("\u274C Debug - Token inv\xE1lido"),{valid:!1}):s.inviteStatus!=="pending"?(console.log("\u274C Debug - Status inv\xE1lido:",s.inviteStatus),{valid:!1}):(console.log("\u2705 Debug - Convite v\xE1lido!"),{valid:!0,company:i,companyUser:s}):(console.log("\u274C Debug - Usu\xE1rio n\xE3o encontrado na empresa"),{valid:!1})}catch(i){return console.error("\u274C Debug - Erro na valida\xE7\xE3o:",i),{valid:!1}}})}generateApiToken(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*",t="";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}getFeaturesByPlan(e){switch(e){case"free":return{maxBoards:1,maxUsers:2,maxLeadsPerMonth:100,maxEmailsPerMonth:50,customBranding:!1,apiAccess:!1,webhooks:!1,advancedReports:!1,whiteLabel:!1};case"starter":return{maxBoards:3,maxUsers:5,maxLeadsPerMonth:1e3,maxEmailsPerMonth:500,customBranding:!0,apiAccess:!0,webhooks:!1,advancedReports:!1,whiteLabel:!1};case"professional":return{maxBoards:10,maxUsers:20,maxLeadsPerMonth:5e3,maxEmailsPerMonth:2500,customBranding:!0,apiAccess:!0,webhooks:!0,advancedReports:!0,whiteLabel:!1};case"enterprise":return{maxBoards:-1,maxUsers:-1,maxLeadsPerMonth:-1,maxEmailsPerMonth:-1,customBranding:!0,apiAccess:!0,webhooks:!0,advancedReports:!0,whiteLabel:!0};default:return this.getFeaturesByPlan("free")}}getPermissionsByRole(e){switch(e){case"admin":return["*"];case"manager":return["leads.read","leads.create","leads.update","leads.delete","boards.read","boards.create","boards.update","users.read","users.invite","templates.read","templates.create","templates.update","templates.delete","automations.read","automations.create","automations.update","automations.delete","reports.read"];case"user":return["leads.read","leads.create","leads.update","boards.read","templates.read","automations.read"];default:return["leads.read"]}}subscribeToCompany(e,t){let r=W(this.firestore,"companies",e);return k(this.injector,()=>ct(r,i=>{i.exists()?t(M({id:i.id},i.data())):t(null)}))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})};var $o=class n{companyService=he(Pr);currentCompanySubject=new fa(null);currentCompany$=this.currentCompanySubject.asObservable();isInitializedSubject=new fa(!1);isInitialized$=this.isInitializedSubject.asObservable();initializeFromSubdomain(){return m(this,null,function*(){try{let e=this.extractSubdomain();if(console.log("\u{1F310} Subdom\xEDnio extra\xEDdo:",e,"from hostname:",window?.location?.hostname),!e)return console.log("\u274C Nenhum subdom\xEDnio encontrado"),this.isInitializedSubject.next(!0),null;console.log("\u{1F504} Iniciando busca por empresa com subdom\xEDnio:",e);let t=yield this.companyService.getCompanyBySubdomain(e);return t?(console.log("\u2705 Empresa encontrada, definindo no contexto:",t.name),this.currentCompanySubject.next(t)):(console.log("\u274C Empresa n\xE3o encontrada, chamando handleInvalidSubdomain"),this.handleInvalidSubdomain(e)),this.isInitializedSubject.next(!0),t}catch(e){return console.error("\u274C Erro em initializeFromSubdomain:",e),this.isInitializedSubject.next(!0),null}})}extractSubdomain(){if(typeof window>"u")return null;let e=window.location.hostname;if(e==="localhost"||e==="127.0.0.1"){let t=localStorage.getItem("dev-subdomain");if(t)return t;let i=new URLSearchParams(window.location.search).get("subdomain");return i?(localStorage.setItem("dev-subdomain",i),i):null}if(e.includes("taskboard.com.br")){let t=e.split(".");if(t.length>=3&&t[0]!=="www"&&t[0]!=="taskboard")return t[0]}if(e==="taskboard.com.br"||e==="www.taskboard.com.br")return null;if(e.includes(".")){let t=e.split(".");if(t.length>=2&&t[0]!=="www"&&t[0]!=="taskboard")return t[0]}return null}handleInvalidSubdomain(e){if(typeof window<"u"){let t=window.location.hostname,r=this.isDevelopment();if(console.log("\u{1F6A8} handleInvalidSubdomain chamado:",{subdomain:e,hostname:t,isDevelopment:r}),r){console.log("\u{1F527} Ambiente de desenvolvimento - n\xE3o exibindo alert");return}if(t.includes(`${e}.taskboard.com.br`)){console.log("\u26A0\uFE0F Exibindo alert para empresa n\xE3o encontrada"),alert(`Empresa '${e}' n\xE3o encontrada. Entre em contato com o suporte.`);return}console.log("\u{1F504} Redirecionando para p\xE1gina de empresa n\xE3o encontrada"),window.location.href="https://taskboard.com.br/empresa-nao-encontrada?subdomain="+encodeURIComponent(e)}}getCurrentCompany(){return this.currentCompanySubject.value}setCurrentCompany(e){if(this.currentCompanySubject.next(e),typeof window<"u")try{e?localStorage.setItem("current-company",JSON.stringify({id:e.id,subdomain:e.subdomain,name:e.name})):localStorage.removeItem("current-company")}catch{}}clearCurrentCompany(){this.currentCompanySubject.next(null),typeof window<"u"&&localStorage.removeItem("current-company")}restorePersistedCompany(){if(typeof window>"u")return null;try{let e=localStorage.getItem("current-company");if(!e)return null;let t=JSON.parse(e);if(t?.id&&t?.subdomain){let r={id:t.id,subdomain:t.subdomain,name:t.name};return this.currentCompanySubject.next(r),this.companyService.getCompany(t.id).then(i=>{i&&this.currentCompanySubject.next(i)}).catch(()=>{}),r}return null}catch{return null}}setDevSubdomain(e){typeof window<"u"&&(localStorage.setItem("dev-subdomain",e),window.location.reload())}clearDevSubdomain(){typeof window<"u"&&(localStorage.removeItem("dev-subdomain"),window.location.reload())}isDevelopment(){if(typeof window>"u")return!1;let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"}getBaseUrl(){if(typeof window>"u")return"http://localhost:4200";let{protocol:e,hostname:t,port:r}=window.location,i=r?`:${r}`:"";return`${e}//${t}${i}`}getCompanyUrl(e){return this.isDevelopment()?`${this.getBaseUrl()}?subdomain=${e}`:`https://${e}.taskboard.com.br`}getApiUrl(){let e=this.getCurrentCompany();return e?this.isDevelopment()?`http://localhost:${this.getFunctionsPort()}/api/v1/companies/${e.id}`:`https://api.taskboard.com.br/v1/companies/${e.id}`:null}getFunctionsPort(){let e=localStorage.getItem("firebase-functions-port");if(e)return parseInt(e,10);try{let t=window.__FIREBASE_DEFAULTS__;if(t?.emulatorHosts?.functions){let i=t.emulatorHosts.functions.match(/:(\d+)$/);if(i)return parseInt(i[1],10)}}catch{}return 3001}getPublicFormUrl(){let e=this.getCurrentCompany();return e?this.isDevelopment()?`${this.getBaseUrl()}/form/${e.subdomain}`:`https://${e.subdomain}.taskboard.com.br/form`:null}createDevelopmentCompany(e){return m(this,null,function*(){})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})};var Bo=class n{auth=he(An);firestore=he(at);injector=he($e);user$=np(this.auth);signInWithEmail(e,t){return m(this,null,function*(){try{return{success:!0,user:(yield ip(this.auth,e,t)).user}}catch(r){return{success:!1,error:r.message}}})}createUserWithEmail(e,t){return m(this,null,function*(){try{return{success:!0,user:(yield xc(this.auth,e,t)).user}}catch(r){return{success:!1,error:r.message}}})}updateUserProfile(e){return m(this,null,function*(){try{let t=this.auth.currentUser;if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado");return yield op(t,{displayName:e.displayName,photoURL:e.photoURL}),yield ut(W(this.firestore,"users",t.uid),{email:t.email,displayName:e.displayName||t.displayName,phoneNumber:e.phoneNumber,photoURL:e.photoURL||t.photoURL,createdAt:new Date,lastLogin:new Date}),{success:!0}}catch(t){return{success:!1,error:t.message}}})}signUpWithEmail(e,t,r){return m(this,null,function*(){try{let i=yield xc(this.auth,e,t);return yield this.updateUserProfile({displayName:r}),{success:!0,user:i.user}}catch(i){return{success:!1,error:i.message}}})}sendPasswordReset(e){return m(this,null,function*(){try{let t={url:`${window.location.origin}/login?recovered=true`,handleCodeInApp:!1};return yield rp(this.auth,e,t),{success:!0}}catch(t){return{success:!1,error:t.message}}})}signInWithGoogle(){return m(this,null,function*(){try{let e=new vc,t=yield k(this.injector,()=>sp(this.auth,e));if(!(yield this.isUserRegistered(t.user.email)))throw yield Oc(this.auth),new Error("Usu\xE1rio n\xE3o est\xE1 cadastrado no sistema. Entre em contato com o administrador para receber um convite.");return yield this.createOrUpdateUser(t.user),t}catch(e){throw console.error("Erro no login com Google:",e),e}})}isUserRegistered(e){return m(this,null,function*(){try{let{CompanyService:t}=yield import("./chunk-L7JCZWVO.js");return(yield this.injector.get(t).getCompanyByUserEmail(e))!==null}catch(t){return console.error("Erro ao verificar usu\xE1rio cadastrado:",t),!1}})}createOrUpdateUser(e){return m(this,null,function*(){try{let t=W(this.firestore,"users",e.uid);(yield k(this.injector,()=>Be(t))).exists()?yield k(this.injector,()=>Se(t,{lastLogin:new Date})):yield k(this.injector,()=>ut(t,{email:e.email,displayName:e.displayName,createdAt:new Date,lastLogin:new Date}))}catch(t){console.error("Erro ao criar/atualizar usu\xE1rio:",t)}})}logout(){return m(this,null,function*(){try{return yield Oc(this.auth),{success:!0}}catch(e){return{success:!1,error:e.message}}})}getCurrentUser(){return this.auth.currentUser}isAuthenticated(){return this.user$.pipe(dd(e=>!!e))}getUserCompany(e){return m(this,null,function*(){try{let t=yield k(this.injector,()=>Be(W(this.firestore,"users",e)));return t.exists()&&t.data().companyId||null}catch(t){return console.error("Erro ao buscar empresa do usu\xE1rio:",t),null}})}linkUserToCompany(e,t){return m(this,null,function*(){try{yield ut(W(this.firestore,"users",e),{companyId:t,updatedAt:new Date},{merge:!0})}catch(r){throw console.error("Erro ao associar usu\xE1rio \xE0 empresa:",r),r}})}processPendingInvite(e,t,r){return m(this,null,function*(){try{console.log("\u{1F504} Debug Auth - Processando convite pendente...",{companyId:e,email:t}),yield new Promise(f=>setTimeout(f,1e3));let{CompanyService:i}=yield import("./chunk-L7JCZWVO.js"),s=this.injector.get(i),a=yield s.validateInviteWithCompanyId(e,t,r);if(!a.valid)return console.log("\u274C Debug Auth - Convite inv\xE1lido"),!1;let{company:c,companyUser:l}=a;if(!c||!l)return console.log("\u274C Debug Auth - Dados do convite n\xE3o encontrados"),!1;let h=this.getCurrentUser();return h?(console.log("\u{1F464} Debug Auth - Atualizando status do convite para o usu\xE1rio:",h.uid),yield s.updateUserInCompany(c.id,t,{uid:h.uid,displayName:h.displayName||l.displayName,inviteStatus:"accepted",inviteToken:null,acceptedAt:new Date}),yield this.linkUserToCompany(h.uid,c.id),console.log("\u2705 Debug Auth - Convite processado com sucesso"),!0):(console.log("\u274C Debug Auth - Usu\xE1rio n\xE3o autenticado"),!1)}catch(i){return console.error("\u274C Debug Auth - Erro ao processar convite:",i),!1}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})};var Uo=class n{firestore=he(at);authService=he(Bo);injector=he($e);get companyService(){return this.injector.get(Pr)}currentCompanyId=null;safeGetDocs(e,t="buscar dados"){return m(this,null,function*(){try{return(yield k(this.injector,()=>ne(e))).docs.map(i=>M({id:i.id},i.data()))}catch(r){return r.code==="permission-denied"?(console.log(`Permiss\xF5es para ${t} n\xE3o configuradas - retornando array vazio`),[]):(console.error(`Erro cr\xEDtico ao ${t}:`,r),[])}})}currentCompany=null;initializeCompanyContext(){return m(this,null,function*(){try{let t=this.injector.get($o)?.getCurrentCompany?.();if(t?.id)return this.setCompanyContext(t),t;let r=this.companyService.getCompanySubdomain();if(r){let s=yield this.companyService.getCompanyBySubdomain(r);if(s?.id)return this.setCompanyContext(s),s}let i=this.authService.getCurrentUser();if(i?.email){let s=yield this.companyService.getCompanyByUserEmail(i.email);if(s?.id)return this.setCompanyContext(s),s}return null}catch{return null}})}getCurrentCompany(){return this.currentCompany}getCurrentCompanyId(){return this.currentCompanyId}setCompanyContext(e){this.currentCompany=e,this.currentCompanyId=e.id}getBoards(e){return m(this,null,function*(){try{let t=this.currentCompanyId;if(!t)try{yield this.initializeCompanyContext(),t=this.currentCompanyId}catch{return[]}if(!t)return[];try{let r=k(this.injector,()=>B(this.firestore,"companies",t,"boards")),s=(yield k(this.injector,()=>ne(r))).docs.map(a=>Z(M({id:a.id},a.data()),{companyId:t}));if(s.length===0)try{let a=k(this.injector,()=>B(this.firestore,"users",e,"boards"));s=(yield k(this.injector,()=>ne(a))).docs.map(h=>Z(M({id:h.id},h.data()),{companyId:t}))}catch{}return s=s.filter(a=>(a.status||"active")==="active"),s}catch{return[]}}catch{return[]}})}createBoard(e,t){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let r=k(this.injector,()=>B(this.firestore,"companies",this.currentCompanyId,"boards")),i=Z(M({},t),{companyId:this.currentCompanyId,owner:e,ownerEmail:"",status:"active",createdAt:ce()});return yield k(this.injector,()=>Tt(r,i))}catch(r){throw console.error("Erro ao criar quadro:",r),r}})}updateBoard(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t));return yield k(this.injector,()=>Se(i,r))}catch(i){throw console.error("Erro ao atualizar quadro:",i),i}})}deleteBoard(e,t){return m(this,null,function*(){try{if(!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");console.log("\u{1F5D1}\uFE0F Iniciando exclus\xE3o completa do quadro:",t),yield this.deleteBoardSubcollections(t);let r=W(this.firestore,"companies",this.currentCompanyId,"boards",t);yield Ce(r),console.log("\u2705 Quadro exclu\xEDdo completamente:",t)}catch(r){throw console.error("\u274C Erro ao excluir quadro:",r),r}})}deleteBoardSubcollections(e){return m(this,null,function*(){if(!this.currentCompanyId)return;let t=`companies/${this.currentCompanyId}/boards/${e}`;console.log("\u{1F504} Excluindo subcole\xE7\xF5es do quadro:",t);try{let r=["leads","columns","emailTemplates","automations","phaseFormConfigs","outboxEmails","mail","automationHistory"];for(let i of r)yield this.deleteCollection(`${t}/${i}`);console.log("\u2705 Subcole\xE7\xF5es exclu\xEDdas com sucesso")}catch(r){throw console.error("\u274C Erro ao excluir subcole\xE7\xF5es:",r),r}})}deleteCollection(e){return m(this,null,function*(){try{let t=B(this.firestore,e),r=yield k(this.injector,()=>ne(t));if(r.empty){console.log(`\u{1F4ED} Cole\xE7\xE3o ${e} j\xE1 est\xE1 vazia`);return}console.log(`\u{1F5D1}\uFE0F Excluindo ${r.docs.length} documentos de ${e}`);let i=500,s=[];for(let a=0;a<r.docs.length;a+=i){let c=r.docs.slice(a,a+i),l=Fo(this.firestore);c.forEach(h=>{l.delete(h.ref)}),s.push(l.commit())}yield Promise.all(s),console.log(`\u2705 ${r.docs.length} documentos exclu\xEDdos de ${e}`)}catch(t){console.warn(`\u26A0\uFE0F Erro ao excluir cole\xE7\xE3o ${e}:`,t)}})}getColumns(e,t){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return console.log("Contexto da empresa n\xE3o inicializado - retornando array vazio"),[];let r=k(this.injector,()=>B(this.firestore,"companies",this.currentCompanyId,"boards",t,"columns")),i=we(r,qt("order"));return(yield this.safeGetDocs(i,"buscar colunas")).map(a=>Z(M({},a),{companyId:this.currentCompanyId,boardId:t}))})}createColumn(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=k(this.injector,()=>B(this.firestore,"companies",this.currentCompanyId,"boards",t,"columns")),s=Z(M({},r),{companyId:this.currentCompanyId,boardId:t,createdAt:ce(),updatedAt:ce()});return yield k(this.injector,()=>Tt(i,s))}catch(i){throw console.error("Erro ao criar coluna:",i),i}})}updateColumn(e,t,r,i){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"columns",r));return yield k(this.injector,()=>Se(s,i))}catch(s){throw console.error("Erro ao atualizar coluna:",s),s}})}deleteColumn(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"columns",r));return yield k(this.injector,()=>Ce(i))}catch(i){throw console.error("Erro ao excluir coluna:",i),i}})}getLeads(e,t){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return console.error("Contexto da empresa n\xE3o inicializado"),[];let r=k(this.injector,()=>B(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads"));return(yield k(this.injector,()=>ne(r))).docs.map(s=>Z(M({id:s.id},s.data()),{companyId:this.currentCompanyId,boardId:t}))}catch(r){return console.error("Erro ao buscar leads:",r),[]}})}createLead(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=k(this.injector,()=>B(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads")),s=ce(),a={[r.columnId]:{phaseId:r.columnId,enteredAt:s}},c=Z(M({},r),{companyId:this.currentCompanyId,boardId:t,createdAt:s,movedToCurrentColumnAt:s,phaseHistory:r.phaseHistory&&Object.keys(r.phaseHistory).length?r.phaseHistory:a,executedAutomations:r.executedAutomations||{}});return yield k(this.injector,()=>Tt(i,c))}catch(i){throw console.error("Erro ao criar lead:",i),i}})}updateLead(e,t,r,i){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r));return yield k(this.injector,()=>Se(s,i))}catch(s){throw console.error("Erro ao atualizar lead:",s),s}})}getLead(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;let i=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r)),s=yield k(this.injector,()=>Be(i));if(!s.exists())return null;let a=s.data();return Z(M({id:r},a),{companyId:this.currentCompanyId,boardId:t})}catch(i){return console.error("Erro ao buscar lead por id:",i),null}})}deleteLead(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r));return yield k(this.injector,()=>Ce(i))}catch(i){throw console.error("Erro ao excluir lead:",i),i}})}moveLead(e,t,r,i){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=k(this.injector,()=>W(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r)),a=yield k(this.injector,()=>Be(s));if(!a.exists())throw new Error("Lead n\xE3o encontrado");let c=a.data(),l=c.columnId,h=new Date,f=M({},c.phaseHistory||{});if(l&&f[l]){let _=f[l].enteredAt?.toDate()||new Date(f[l].enteredAt||h);f[l].exitedAt=h,f[l].duration=h.getTime()-_.getTime()}f[i]={phaseId:i,enteredAt:h},console.log("\u{1F4DD} Atualizando hist\xF3rico de fases:",{leadId:r,from:l,to:i,phaseHistoryKeys:Object.keys(f)});let y={columnId:i,movedToCurrentColumnAt:ce(),phaseHistory:f};return yield k(this.injector,()=>Se(s,y))}catch(s){throw console.error("Erro ao mover lead:",s),s}})}subscribeToBoards(e,t){return this.currentCompanyId?this.performBoardsSubscription(t):(this.initializeCompanyContext().then(()=>{this.currentCompanyId&&this.performBoardsSubscription(t)}),()=>{})}performBoardsSubscription(e){if(!this.currentCompanyId)return e([]),()=>{};let t=B(this.firestore,"companies",this.currentCompanyId,"boards");return k(this.injector,()=>ct(t,r=>{let i=r.docs.map(s=>Z(M({id:s.id},s.data()),{companyId:this.currentCompanyId})).filter(s=>(s.status||"active")==="active");e(i)}))}subscribeToColumns(e,t,r){return this.currentCompanyId?this.performColumnsSubscription(t,r):(this.initializeCompanyContext().then(()=>{this.currentCompanyId&&this.performColumnsSubscription(t,r)}),()=>{})}performColumnsSubscription(e,t){if(!this.currentCompanyId)return t([]),()=>{};let r=B(this.firestore,"companies",this.currentCompanyId,"boards",e,"columns"),i=we(r,qt("order"));return k(this.injector,()=>ct(i,s=>{let a=s.docs.map(c=>Z(M({id:c.id},c.data()),{companyId:this.currentCompanyId,boardId:e}));t(a)}))}subscribeToLeads(e,t,r){return this.currentCompanyId?this.performLeadsSubscription(t,r):(this.initializeCompanyContext().then(()=>{this.currentCompanyId&&this.performLeadsSubscription(t,r)}),()=>{})}performLeadsSubscription(e,t){if(!this.currentCompanyId)return t([]),()=>{};let r=B(this.firestore,"companies",this.currentCompanyId,"boards",e,"leads");return k(this.injector,()=>ct(r,i=>{let s=i.docs.map(a=>Z(M({id:a.id},a.data()),{companyId:this.currentCompanyId,boardId:e}));t(s)}))}updateMultipleLeads(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=Fo(this.firestore);return r.forEach(s=>{let a=W(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",s.leadId);i.update(a,s.data)}),yield i.commit()}catch(i){throw console.error("Erro ao atualizar m\xFAltiplos leads:",i),i}})}addLeadHistory(e,t,r,i){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=B(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r,"history"),a=Z(M({},i),{timestamp:ce()});return yield Tt(s,a)}catch(s){throw console.error("Erro ao adicionar hist\xF3rico do lead:",s),s}})}getLeadHistory(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return console.error("Contexto da empresa n\xE3o inicializado"),[];let i=B(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r,"history"),s=we(i,qt("timestamp","desc"));return(yield k(this.injector,()=>ne(s))).docs.map(c=>M({id:c.id},c.data()))}catch(i){return console.error("Erro ao buscar hist\xF3rico do lead:",i),[]}})}subscribeToLeadHistory(e,t,r,i){if(this.currentCompanyId||this.initializeCompanyContext().then(()=>{}).catch(()=>{}),!this.currentCompanyId)return i([]),()=>{};let s=B(this.firestore,"companies",this.currentCompanyId,"boards",t,"leads",r,"history"),a=we(s,qt("timestamp","desc"));return k(this.injector,()=>ct(a,c=>{let l=c.docs.map(h=>M({id:h.id},h.data()));i(l)},c=>{console.error("Erro na subscri\xE7\xE3o do hist\xF3rico do lead:",c),i([])}))}getInitialFormConfig(e){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;try{let t=W(this.firestore,`companies/${this.currentCompanyId}/boards/${e}/initialForm/config`),r=yield k(this.injector,()=>Be(t));return r.exists()?M({id:r.id},r.data()):null}catch{return null}})}saveInitialFormConfig(e,t){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let r=k(this.injector,()=>W(this.firestore,`companies/${this.currentCompanyId}/boards/${e}/initialForm/config`));yield k(this.injector,()=>ut(r,Z(M({},t),{boardId:e,companyId:this.currentCompanyId,updatedAt:ce(),createdAt:t?.createdAt||ce()})))})}createPhaseFormConfig(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/phaseFormConfigs`),s=Z(M({},r),{boardId:t,companyId:this.currentCompanyId,createdAt:ce(),updatedAt:ce()});return yield Tt(i,s)})}updatePhaseFormConfig(e,t,r,i){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/phaseFormConfigs/${r}`),a=Z(M({},i),{boardId:t,companyId:this.currentCompanyId,updatedAt:ce()});return yield Se(s,a)})}getPhaseFormConfig(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/phaseFormConfigs`),s=we(i,Xe("columnId","==",r)),a=yield k(this.injector,()=>ne(s));if(!a.empty){let c=a.docs[0];return M({id:c.id},c.data())}try{let c=B(this.firestore,`boards/${t}/phaseFormConfigs`),l=we(c,Xe("columnId","==",r)),h=yield k(this.injector,()=>ne(l));if(!h.empty){let f=h.docs[0];return M({id:f.id},f.data())}}catch{}return null})}deletePhaseFormConfig(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/phaseFormConfigs/${r}`);return yield Ce(i)})}getInitialColumnId(e){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;let t=B(this.firestore,"companies",this.currentCompanyId,"boards",e,"columns"),r=we(t,Xe("isInitialPhase","==",!0),qt("order"),Rr(1)),i=yield k(this.injector,()=>ne(r));return i.empty?null:i.docs[0].id})}getFlowConfig(e){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;try{let t=W(this.firestore,`companies/${this.currentCompanyId}/boards/${e}/flow/config`),r=yield k(this.injector,()=>Be(t));return r.exists()?M({id:r.id},r.data()):null}catch{return null}})}saveFlowConfig(e,t){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let r=k(this.injector,()=>W(this.firestore,`companies/${this.currentCompanyId}/boards/${e}/flow/config`));yield k(this.injector,()=>ut(r,Z(M({},t),{boardId:e,companyId:this.currentCompanyId,updatedAt:ce(),createdAt:t?.createdAt||ce()})))})}unsetOtherInitialPhases(e,t){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return;let r=B(this.firestore,"companies",this.currentCompanyId,"boards",e,"columns"),i=yield k(this.injector,()=>ne(r)),s=[];i.docs.forEach(a=>{a.id!==t&&a.data().isInitialPhase&&s.push(Se(W(this.firestore,"companies",this.currentCompanyId,"boards",e,"columns",a.id),{isInitialPhase:!1}))}),yield Promise.all(s)})}getOutboxEmails(e,t){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return console.log("Contexto da empresa n\xE3o inicializado - retornando array vazio"),[];let r=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail`),i=we(r,qt("createdAt","desc"));return(yield k(this.injector,()=>ne(i))).docs.map(a=>M({id:a.id},a.data()))})}createOutboxEmail(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail`),s=Z(M({},r),{companyId:this.currentCompanyId,boardId:t,createdAt:ce(),updatedAt:ce()});return yield Tt(i,s)})}updateOutboxEmail(e,t,r,i){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail/${r}`),a=Z(M({},i),{updatedAt:ce()});return yield Se(s,a)})}findRecentOutboxEmail(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return null;let i=r.withinMs??120*1e3;try{let a=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail`);r.automationId&&(a=we(a,Xe("automationId","==",r.automationId))),r.leadId&&(a=we(a,Xe("leadId","==",r.leadId))),a=we(a,qt("createdAt","desc"),Rr(5));let c=yield k(this.injector,()=>ne(a)),l=Date.now();for(let h of c.docs){let f=h.data(),y=f?.createdAt?.toDate?f.createdAt.toDate().getTime():f?.createdAt?new Date(f.createdAt).getTime():0;if(y&&l-y<=i&&(!r.subject||r.subject===f.subject))return h.id}}catch{}return null})}deleteOutboxEmail(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail/${r}`);return yield Ce(i)})}subscribeToOutboxEmails(e,t,r){if(!this.currentCompanyId)return console.warn("Contexto da empresa n\xE3o definido, retornando array vazio"),r([]),()=>{};let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail`),s=we(i,qt("createdAt","desc"));return k(this.injector,()=>ct(s,a=>{let c=a.docs.map(l=>M({id:l.id},l.data()));r(c)}))}clearOutboxEmails(e,t){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let r=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/mail`),s=(yield k(this.injector,()=>ne(r))).docs.map(a=>Ce(a.ref));yield Promise.all(s),console.log(`\u2705 Exclu\xEDdos ${s.length} emails da caixa de sa\xEDda`)}catch(r){throw console.error("\u274C Erro ao limpar caixa de sa\xEDda:",r),r}})}getEmailTemplates(e,t){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)return console.warn("Contexto da empresa n\xE3o inicializado - retornando array vazio"),[];let r=`companies/${this.currentCompanyId}/boards/${t}/emailTemplates`;console.log("Buscando templates em (multi-empresa):",r);let i=B(this.firestore,r),a=(yield k(this.injector,()=>ne(i))).docs.map(c=>M({id:c.id},c.data()));return console.log(`Templates encontrados (multi-empresa): ${a.length} itens`),a}catch(r){return r.code==="permission-denied"?(console.log("Permiss\xF5es de templates n\xE3o configuradas - retornando array vazio"),[]):(console.error("Erro cr\xEDtico ao buscar templates:",r),[])}})}createEmailTemplate(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=`companies/${this.currentCompanyId}/boards/${t}/emailTemplates`,s=B(this.firestore,i),a=Z(M({},r),{boardId:t,companyId:this.currentCompanyId,createdAt:ce(),updatedAt:ce()});return console.log("Criando template em:",i,a),yield Tt(s,a)})}updateEmailTemplate(e,t,r,i){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=`companies/${this.currentCompanyId}/boards/${t}/emailTemplates/${r}`,a=W(this.firestore,s),c=Z(M({},i),{boardId:t,companyId:this.currentCompanyId,updatedAt:ce()});return console.log("Atualizando template em:",s,c),yield Se(a,c)})}deleteEmailTemplate(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=`companies/${this.currentCompanyId}/boards/${t}/emailTemplates/${r}`,s=W(this.firestore,i);return yield Ce(s)})}subscribeToEmailTemplates(e,t,r){if(console.log(`Iniciando subscri\xE7\xE3o de templates para boardId: ${t}`),!this.currentCompanyId)return console.warn("Contexto da empresa n\xE3o definido, retornando array vazio"),r([]),()=>{};let i=`companies/${this.currentCompanyId}/boards/${t}/emailTemplates`;console.log("Subscribing templates em:",i);let s=B(this.firestore,i);return k(this.injector,()=>ct(s,a=>{let c=a.docs.map(l=>M({id:l.id,path:l.ref.path},l.data()));console.log(`Templates encontrados (multi-empresa) para boardId: ${t}:`,c.length),r(c)},a=>{if(a.code==="permission-denied"){console.log("Permiss\xF5es de templates n\xE3o configuradas - retornando array vazio"),r([]);return}console.error("Erro cr\xEDtico ao subscrever templates:",a),r([])}))}getAutomations(e,t){return m(this,null,function*(){try{if(console.log("Buscando automa\xE7\xF5es para boardId:",t),this.currentCompanyId){let c=`companies/${this.currentCompanyId}/boards/${t}/automations`;console.log("Buscando automa\xE7\xF5es em (multi-empresa):",c);let l=B(this.firestore,c),f=(yield k(this.injector,()=>ne(l))).docs.map(y=>M({id:y.id},y.data()));return console.log(`Automa\xE7\xF5es encontradas (multi-empresa): ${f.length} itens`),f}console.log("Contexto de empresa n\xE3o definido, usando estrutura antiga");let r=`users/${e}/boards/${t}/automations`;console.log("Buscando automa\xE7\xF5es em (estrutura antiga):",r);let i=B(this.firestore,r),a=(yield k(this.injector,()=>ne(i))).docs.map(c=>M({id:c.id},c.data()));return console.log(`Automa\xE7\xF5es encontradas (estrutura antiga): ${a.length} itens`),a}catch(r){return r.code==="permission-denied"?(console.log("Permiss\xF5es de automa\xE7\xF5es n\xE3o configuradas - retornando array vazio"),[]):(console.error("Erro cr\xEDtico ao buscar automa\xE7\xF5es:",r),[])}})}createAutomation(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/automations`),s=Z(M({},r),{boardId:t,companyId:this.currentCompanyId,createdAt:ce(),updatedAt:ce(),active:!0});return console.log("Criando automa\xE7\xE3o em (multi-empresa):",`companies/${this.currentCompanyId}/boards/${t}/automations`,s),yield Tt(i,s)})}updateAutomation(e,t,r,i){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let s=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/automations/${r}`),a=Z(M({},i),{boardId:t,companyId:this.currentCompanyId,updatedAt:ce()});return console.log("Atualizando automa\xE7\xE3o em (multi-empresa):",`companies/${this.currentCompanyId}/boards/${t}/automations/${r}`,a),yield Se(s,a)})}deleteAutomation(e,t,r){return m(this,null,function*(){if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=W(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/automations/${r}`);return console.log("Excluindo automa\xE7\xE3o (multi-empresa):",`companies/${this.currentCompanyId}/boards/${t}/automations/${r}`),yield Ce(i)})}subscribeToAutomationHistory(e,t,r,i){if(console.log("Subscribing to automation history for:",{userId:e,boardId:t,automationId:r}),!this.currentCompanyId)return console.warn("Contexto da empresa n\xE3o definido, retornando array vazio"),i([]),()=>{};let s=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/automationHistory`),a=we(s,Xe("automationId","==",r));return k(this.injector,()=>ct(a,c=>{let l=c.docs.map(h=>M({id:h.id},h.data()));console.log(`Hist\xF3rico de automa\xE7\xE3o (multi-empresa): ${l.length} itens`),i(l)},c=>{console.error("Erro ao buscar hist\xF3rico de automa\xE7\xE3o (multi-empresa):",c),i([])}))}addAutomationHistoryItem(e,t,r){return m(this,null,function*(){try{if(this.currentCompanyId||(yield this.initializeCompanyContext()),!this.currentCompanyId)throw new Error("Contexto da empresa n\xE3o inicializado");let i=B(this.firestore,`companies/${this.currentCompanyId}/boards/${t}/automationHistory`),s=yield Tt(i,Z(M({},r),{companyId:this.currentCompanyId,boardId:t,timestamp:ce(),createdAt:ce()}));return console.log("Item de hist\xF3rico de automa\xE7\xE3o adicionado (multi-empresa):",s.id),s.id}catch(i){throw console.error("Erro ao adicionar item de hist\xF3rico de automa\xE7\xE3o:",i),i}})}subscribeToAutomations(e,t,r){if(console.log(`Iniciando subscri\xE7\xE3o de automa\xE7\xF5es para boardId: ${t}`),!this.currentCompanyId)return console.warn("Contexto da empresa n\xE3o definido, retornando array vazio"),r([]),()=>{};let i=`companies/${this.currentCompanyId}/boards/${t}/automations`;console.log("Subscribing automa\xE7\xF5es em:",i);let s=B(this.firestore,i);return k(this.injector,()=>ct(s,a=>{let c=a.docs.map(l=>M({id:l.id,path:l.ref.path},l.data()));console.log(`Automa\xE7\xF5es encontradas (multi-empresa) para boardId: ${t}:`,c.length),r(c)},a=>{if(a.code==="permission-denied"){console.log("Permiss\xF5es de automa\xE7\xF5es n\xE3o configuradas - retornando array vazio"),r([]);return}console.error("Erro cr\xEDtico ao subscrever automa\xE7\xF5es:",a),r([])}))}clearAllData(e){return m(this,null,function*(){try{let t=Fo(this.firestore),r=0;if(this.currentCompanyId){let i=B(this.firestore,`companies/${this.currentCompanyId}/boards`),s=yield k(this.injector,()=>ne(i));for(let a of s.docs){let c=a.id,l=["leads","columns","emailTemplates","automations","phaseFormConfigs","outboxEmails","mail","automationHistory"];for(let h of l)try{let f=B(this.firestore,`companies/${this.currentCompanyId}/boards/${c}/${h}`);(yield k(this.injector,()=>ne(f))).docs.forEach(_=>{t.delete(_.ref),r++})}catch{}t.delete(a.ref),r++}}if(e){let i=["boards","emailTemplates","automations","outboxEmails","leads","columns"];for(let s of i)try{let a=B(this.firestore,`users/${e}/${s}`);(yield k(this.injector,()=>ne(a))).docs.forEach(l=>{t.delete(l.ref),r++})}catch{}}r>0&&(yield t.commit())}catch(t){throw t}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})};export{wd as a,Qt as b,cs as c,Ed as d,us as e,qe as f,ue as g,Fe as h,tt as i,Jn as j,Ue as k,Jt as l,vn as m,fe as n,Xt as o,ei as p,Zn as q,Zt as r,ee as s,Rt as t,En as u,sA as v,oA as w,er as x,di as y,PC as z,kC as A,DC as B,YS as C,JS as D,XS as E,$o as F,Bo as G,Uo as H,Pr as I};
