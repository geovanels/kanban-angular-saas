import{C as d,D as c,F as g,G as w,H as f,I as U,K as D,Q as a,R as h,X as o,Y as b,y as p,z as y}from"./chunk-WLUU74ML.js";import{_ as m,da as u,f as s,z as l}from"./chunk-3D7XR5P5.js";var N=class i{auth=u(y);firestore=u(D);user$=d(this.auth);signInWithEmail(e,r){return s(this,null,function*(){try{return{success:!0,user:(yield g(this.auth,e,r)).user}}catch(t){return{success:!1,error:t.message}}})}createUserWithEmail(e,r){return s(this,null,function*(){try{return{success:!0,user:(yield c(this.auth,e,r)).user}}catch(t){return{success:!1,error:t.message}}})}updateUserProfile(e){return s(this,null,function*(){try{let r=this.auth.currentUser;if(!r)throw new Error("Usu\xE1rio n\xE3o autenticado");return yield U(r,{displayName:e.displayName,photoURL:e.photoURL}),yield o(a(this.firestore,"users",r.uid),{email:r.email,displayName:e.displayName||r.displayName,phoneNumber:e.phoneNumber,photoURL:e.photoURL||r.photoURL,createdAt:new Date,lastLogin:new Date}),{success:!0}}catch(r){return{success:!1,error:r.message}}})}signUpWithEmail(e,r,t){return s(this,null,function*(){try{let n=yield c(this.auth,e,r);return yield this.updateUserProfile({displayName:t}),{success:!0,user:n.user}}catch(n){return{success:!1,error:n.message}}})}signInWithGoogle(){return s(this,null,function*(){try{let e=new p,r=yield w(this.auth,e);return yield this.createOrUpdateUser(r.user),r}catch(e){throw console.error("Erro no login com Google:",e),e}})}createOrUpdateUser(e){return s(this,null,function*(){try{let r=a(this.firestore,"users",e.uid);(yield h(r)).exists()?yield b(r,{lastLogin:new Date}):yield o(r,{email:e.email,displayName:e.displayName,createdAt:new Date,lastLogin:new Date})}catch(r){console.error("Erro ao criar/atualizar usu\xE1rio:",r)}})}logout(){return s(this,null,function*(){try{return yield f(this.auth),{success:!0}}catch(e){return{success:!1,error:e.message}}})}getCurrentUser(){return this.auth.currentUser}isAuthenticated(){return this.user$.pipe(l(e=>!!e))}getUserCompany(e){return s(this,null,function*(){try{let r=yield h(a(this.firestore,"users",e));return r.exists()&&r.data().companyId||null}catch(r){return console.error("Erro ao buscar empresa do usu\xE1rio:",r),null}})}linkUserToCompany(e,r){return s(this,null,function*(){try{yield o(a(this.firestore,"users",e),{companyId:r,updatedAt:new Date},{merge:!0})}catch(t){throw console.error("Erro ao associar usu\xE1rio \xE0 empresa:",t),t}})}static \u0275fac=function(r){return new(r||i)};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};export{N as a};
