import{a as q}from"./chunk-QYFWIVZ2.js";import{a as W}from"./chunk-IU7U2KCH.js";import{K as R,j as N,m as D,u as F}from"./chunk-N33KF77X.js";import{$ as V}from"./chunk-WLUU74ML.js";import{Ab as i,Bb as l,Hb as S,Hc as P,Ib as c,Jb as u,Sb as y,Ta as a,Tb as r,Ub as v,Vb as g,Yb as M,Zb as I,_b as U,a as x,bb as A,da as k,f as w,ja as C,ka as _,ta as m,tb as b,ub as h,wb as T,xb as L,yb as f,zb as n}from"./chunk-3D7XR5P5.js";var j=(s,e)=>e.name;function z(s,e){s&1&&(l(0,"i",40),r(1," Salvando... "))}function $(s,e){s&1&&(l(0,"i",41),r(1," Salvar Configura\xE7\xF5es "))}function B(s,e){if(s&1&&(n(0,"div",4),l(1,"i",42),r(2),i()),s&2){let o=u();a(2),g(" ",o.successMessage()," ")}}function H(s,e){if(s&1&&(n(0,"div",5),l(1,"i",43),r(2),i()),s&2){let o=u();a(2),g(" ",o.errorMessage()," ")}}function G(s,e){if(s&1){let o=S();n(0,"button",52),c("click",function(){C(o);let d=u().$implicit,p=u();return _(p.copyToClipboard(d.url))}),l(1,"i",22),i()}}function J(s,e){if(s&1){let o=S();n(0,"div",39)(1,"div",44)(2,"div",15)(3,"div"),l(4,"i"),i(),n(5,"div")(6,"h4",45),r(7),i(),n(8,"p",46),r(9),i()()(),b(10,G,2,0,"button",47),i(),n(11,"div",48)(12,"div",19),l(13,"input",49),n(14,"button",50),c("click",function(){let d=C(o).$implicit,p=u();return _(p.openLink(d.url))}),l(15,"i",51),i()()()()}if(s&2){let o=e.$implicit,t=u();a(3),y(t.getLinkIconClass(o.category)),a(),y(o.icon),a(3),v(o.name),a(2),v(o.description),a(),h(o.copyable?10:-1),a(3),f("value",o.url)}}var O=class s{companyService=k(V);subdomainService=k(W);currentCompany=m(null);apiEnabled=m(!1);apiToken=m("");webhookUrl=m("");showApiToken=m(!1);isSaving=m(!1);successMessage=m(null);errorMessage=m(null);ngOnInit(){this.loadApiConfiguration(),this.generateCompanyLinks()}loadApiConfiguration(){let e=this.subdomainService.getCurrentCompany();e&&(this.currentCompany.set(e),this.apiEnabled.set(e.apiConfig?.enabled||!1),this.apiToken.set(e.apiConfig?.token||this.generateApiToken()),this.webhookUrl.set(e.apiConfig?.webhookUrl||""))}saveApiConfig(){return w(this,null,function*(){let e=this.currentCompany();if(!e){this.showError("Empresa n\xE3o encontrada");return}this.isSaving.set(!0),this.clearMessages();try{let o={apiConfig:{enabled:this.apiEnabled(),token:this.apiToken(),endpoint:this.getLeadIntakeUrl(),webhookUrl:this.webhookUrl()}};yield this.companyService.updateCompany(e.id,o);let t=x(x({},e),o);this.subdomainService.setCurrentCompany(t),this.currentCompany.set(t),this.showSuccess("Configura\xE7\xF5es de API salvas com sucesso!")}catch(o){console.error("Erro ao salvar configura\xE7\xF5es de API:",o),this.showError("Erro ao salvar configura\xE7\xF5es. Tente novamente.")}finally{this.isSaving.set(!1)}})}toggleApiStatus(e){this.apiEnabled.set(e)}toggleTokenVisibility(){this.showApiToken.set(!this.showApiToken())}regenerateApiToken(){if(confirm("Tem certeza que deseja regenerar o token da API? Isso invalidar\xE1 o token atual.")){let e=this.generateApiToken();this.apiToken.set(e),this.showSuccess("Novo token gerado! Lembre-se de atualizar suas integra\xE7\xF5es.")}}getLeadIntakeUrl(){let e=this.currentCompany();return e?this.subdomainService.isDevelopment()?`http://localhost:5000/api/v1/companies/${e.id}/leads`:`https://api.taskboard.com.br/v1/companies/${e.id}/leads`:""}companyLinks=m([]);generateCompanyLinks(){let e=this.currentCompany();if(!e)return;let o=[{name:"Painel Principal",url:this.subdomainService.getCompanyUrl(e.subdomain),description:"Acesso principal ao sistema da empresa",icon:"fas fa-home",category:"app",copyable:!0},{name:"Formul\xE1rio P\xFAblico",url:this.subdomainService.getPublicFormUrl()||"",description:"Formul\xE1rio para captura de leads externos",icon:"fas fa-wpforms",category:"form",copyable:!0},{name:"Endpoint de API",url:this.getLeadIntakeUrl(),description:"URL para integra\xE7\xE3o via API REST",icon:"fas fa-plug",category:"api",copyable:!0},{name:"Webhook",url:this.webhookUrl()||"N\xE3o configurado",description:"URL que recebe notifica\xE7\xF5es de novos leads",icon:"fas fa-bell",category:"webhook",copyable:!!this.webhookUrl()}];this.companyLinks.set(o.filter(t=>t.url&&t.url!=="N\xE3o configurado"))}getLinkIconClass(e){let o="w-10 h-10 rounded-lg flex items-center justify-center text-white text-sm";switch(e){case"app":return o+" bg-blue-500";case"form":return o+" bg-green-500";case"api":return o+" bg-purple-500";case"webhook":return o+" bg-orange-500";default:return o+" bg-gray-500"}}getStatusText(){return this.currentCompany()?.status==="active"?"Ativo":"Inativo"}openLink(e){e&&e!=="N\xE3o configurado"&&window.open(e,"_blank")}copyToClipboard(e){e&&e!=="N\xE3o configurado"&&navigator.clipboard.writeText(e).then(()=>{this.showSuccess("Copiado para a \xE1rea de transfer\xEAncia!")}).catch(()=>{this.showError("Erro ao copiar para a \xE1rea de transfer\xEAncia.")})}generateApiToken(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o="";for(let t=0;t<32;t++)o+=e.charAt(Math.floor(Math.random()*e.length));return o}showSuccess(e){this.successMessage.set(e),this.errorMessage.set(null),setTimeout(()=>this.successMessage.set(null),5e3)}showError(e){this.errorMessage.set(e),this.successMessage.set(null),setTimeout(()=>this.errorMessage.set(null),5e3)}clearMessages(){this.successMessage.set(null),this.errorMessage.set(null)}static \u0275fac=function(o){return new(o||s)};static \u0275cmp=A({type:s,selectors:[["app-api-links-config"]],decls:88,vars:17,consts:[[1,"min-h-screen","bg-gray-100"],["title","API e Integra\xE7\xF5es"],[1,"bg-green-500","hover:bg-green-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-6","p-4","bg-green-50","border","border-green-200","rounded-lg","text-green-800"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-800"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","mb-8"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center"],[1,"fas","fa-plug","text-blue-500","mr-2"],[1,"text-sm","text-gray-600","mt-1"],[1,"p-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","space-x-3"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-gray-200","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-300","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-600"],[1,"flex","space-x-2"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","bg-gray-50","text-gray-600",3,"value"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"fas","fa-copy"],[1,"text-xs","text-gray-500","mt-1"],["type","text","readonly","",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","font-mono","text-sm",3,"value"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-3","py-2","rounded-md","text-sm","transition-colors",3,"click"],[1,"w-full","bg-orange-500","hover:bg-orange-600","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors",3,"click"],[1,"fas","fa-sync-alt","mr-1"],[1,"mt-6","pt-6","border-t","border-gray-200"],[1,"text-md","font-medium","text-gray-900","mb-4"],["type","url","placeholder","https://exemplo.com/webhook",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","input","ngModel"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"fas","fa-link","text-blue-500","mr-2"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6","p-4","bg-gray-50","rounded-lg"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-lg","font-semibold","text-gray-900"],[1,"inline-flex","px-3","py-1","text-sm","font-medium","rounded-full","bg-blue-100","text-blue-800"],[1,"inline-flex","px-3","py-1","text-sm","font-medium","rounded-full","bg-green-100","text-green-800"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"border","border-gray-200","rounded-lg","p-4"],[1,"fas","fa-spinner","fa-spin","mr-1"],[1,"fas","fa-save","mr-1"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-exclamation-circle","mr-2"],[1,"flex","items-start","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","text-gray-500"],["title","Copiar URL",1,"text-gray-400","hover:text-gray-600","p-1"],[1,"mt-3"],["type","text","readonly","",1,"flex-1","px-3","py-1","text-xs","border","border-gray-300","rounded","bg-gray-50","text-gray-600",3,"value"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-2","py-1","rounded","text-xs","transition-colors",3,"click"],[1,"fas","fa-external-link-alt"],["title","Copiar URL",1,"text-gray-400","hover:text-gray-600","p-1",3,"click"]],template:function(o,t){if(o&1&&(n(0,"div",0)(1,"app-config-header",1)(2,"button",2),c("click",function(){return t.saveApiConfig()}),b(3,z,2,0)(4,$,2,0),i()(),n(5,"div",3),b(6,B,3,1,"div",4),b(7,H,3,1,"div",5),n(8,"div",6)(9,"div",7)(10,"h3",8),l(11,"i",9),r(12," Configura\xE7\xE3o da API "),i(),n(13,"p",10),r(14,"Configure e gerencie sua API para receber leads externos"),i()(),n(15,"div",11)(16,"div",12)(17,"div",13)(18,"div")(19,"label",14),r(20,"Status da API"),i(),n(21,"div",15)(22,"span"),r(23),i(),n(24,"label",16)(25,"input",17),c("change",function(p){return t.toggleApiStatus(p.target.checked)}),i(),l(26,"div",18),i()()(),n(27,"div")(28,"label",14),r(29,"Endpoint da API"),i(),n(30,"div",19),l(31,"input",20),n(32,"button",21),c("click",function(){return t.copyToClipboard(t.getLeadIntakeUrl())}),l(33,"i",22),i()(),n(34,"p",23),r(35,"URL para envio de leads via API"),i()()(),n(36,"div",13)(37,"div")(38,"label",14),r(39,"Token de API"),i(),n(40,"div",19),l(41,"input",24),n(42,"button",21),c("click",function(){return t.toggleTokenVisibility()}),l(43,"i"),i(),n(44,"button",25),c("click",function(){return t.copyToClipboard(t.apiToken())}),l(45,"i",22),i()(),n(46,"p",23),r(47,"Token para autentica\xE7\xE3o nas requisi\xE7\xF5es API"),i()(),n(48,"div")(49,"button",26),c("click",function(){return t.regenerateApiToken()}),l(50,"i",27),r(51," Regenerar Token "),i()()()(),n(52,"div",28)(53,"h4",29),r(54,"Webhook (Opcional)"),i(),n(55,"div")(56,"label",14),r(57,"URL do Webhook"),i(),n(58,"input",30),U("ngModelChange",function(p){return I(t.webhookUrl,p)||(t.webhookUrl=p),p}),c("input",function(p){return t.webhookUrl.set(p.target.value)}),i(),n(59,"p",23),r(60,"URL que receber\xE1 notifica\xE7\xF5es quando um novo lead for criado via API"),i()()()()(),n(61,"div",31)(62,"div",7)(63,"h3",8),l(64,"i",32),r(65," Links da Empresa "),i(),n(66,"p",10),r(67),i()(),n(68,"div",11)(69,"div",33)(70,"div")(71,"p",34),r(72,"Nome da Empresa"),i(),n(73,"p",35),r(74),i()(),n(75,"div")(76,"p",34),r(77,"Subdom\xEDnio"),i(),n(78,"span",36),r(79),i()(),n(80,"div")(81,"p",34),r(82,"Status"),i(),n(83,"span",37),r(84),i()()(),n(85,"div",38),T(86,J,16,8,"div",39,j),i()()()()()),o&2){let d,p,E;a(2),f("disabled",t.isSaving()),a(),h(t.isSaving()?3:4),a(3),h(t.successMessage()?6:-1),a(),h(t.errorMessage()?7:-1),a(15),y(t.apiEnabled()?"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800":"inline-flex px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a(),g(" ",t.apiEnabled()?"Ativa":"Inativa"," "),a(2),f("checked",t.apiEnabled()),a(6),f("value",t.getLeadIntakeUrl()),a(10),f("value",t.showApiToken()?t.apiToken():"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),a(2),y(t.showApiToken()?"fas fa-eye-slash":"fas fa-eye"),a(15),M("ngModel",t.webhookUrl),a(9),g("Links personalizados para ",(d=t.currentCompany())==null?null:d.name),a(7),v((p=t.currentCompany())==null?null:p.name),a(5),g(" ",(E=t.currentCompany())==null?null:E.subdomain," "),a(5),g(" ",t.getStatusText()," "),a(2),L(t.companyLinks())}},dependencies:[P,R,N,D,F,q],styles:["[_nghost-%COMP%]{display:block}"]})};export{O as ApiLinksConfigComponent};
