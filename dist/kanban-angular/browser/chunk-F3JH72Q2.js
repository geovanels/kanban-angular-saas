import{a as Z}from"./chunk-WH66MBNX.js";import{a as J}from"./chunk-JFKEP2SW.js";import"./chunk-YCDQ7WJ4.js";import{E as X,G as Y,J as G,e as A,i as R,l as z,m as H,p as W,s as $,t as K}from"./chunk-LHANRCP5.js";import"./chunk-6AJJVOLD.js";import{F as D,G as E,H as k}from"./chunk-ZHFGQ2KS.js";import{Ab as y,Cb as L,Db as O,Eb as x,Fb as r,Gb as n,Hb as p,Ob as C,Pc as Q,Qb as b,Sb as d,Vb as F,Wb as q,Wc as B,Xa as P,Xb as U,Ya as c,Zb as j,bc as s,dc as h,f,fa as _,gb as M,gc as V,hc as I,ic as N,la as m,lb as S,ma as u,ob as T,zb as v}from"./chunk-SDND5RWF.js";function oe(a,t){if(a&1&&(r(0,"div",21),s(1),n()),a&2){let e=d(2);c(),h(" ",e.errorMessage," ")}}function re(a,t){a&1&&p(0,"div",22)}function ne(a,t){if(a&1){let e=C();r(0,"div",1),b("click",function(o){m(e);let l=d();return u(l.onBackdropClick(o))}),r(1,"div",2)(2,"div",3)(3,"h2",4),s(4,"Novo Quadro Kanban"),n(),r(5,"button",5),b("click",function(){m(e);let o=d();return u(o.hide())}),s(6," \xD7 "),n()(),r(7,"form",6),b("ngSubmit",function(){m(e);let o=d();return u(o.createBoard())}),r(8,"div")(9,"label",7),s(10," Nome do Quadro * "),n(),r(11,"input",8),N("ngModelChange",function(o){m(e);let l=d();return I(l.boardName,o)||(l.boardName=o),u(o)}),n()(),r(12,"div")(13,"label",9),s(14," Descri\xE7\xE3o (Opcional) "),n(),r(15,"textarea",10),N("ngModelChange",function(o){m(e);let l=d();return I(l.boardDescription,o)||(l.boardDescription=o),u(o)}),n()(),S(16,oe,2,1,"div",11),r(17,"div",12)(18,"div",13),p(19,"i",14),r(20,"div",15)(21,"strong"),s(22,"Ap\xF3s criar o quadro:"),n(),r(23,"ul",16)(24,"li"),s(25,"Configure as fases do seu processo"),n(),r(26,"li"),s(27,"Defina os campos do formul\xE1rio conforme sua necessidade"),n(),r(28,"li"),s(29,"Personalize para qualquer tipo de processo (vendas, compras, viagens, etc.)"),n()()()()(),r(30,"div",17)(31,"button",18),b("click",function(){m(e);let o=d();return u(o.hide())}),s(32," Cancelar "),n(),r(33,"button",19),S(34,re,1,0,"div",20),s(35),n()()()()()}if(a&2){let e=d();c(5),x("disabled",e.isLoading),c(6),V("ngModel",e.boardName),x("disabled",e.isLoading),c(4),V("ngModel",e.boardDescription),x("disabled",e.isLoading),c(),x("ngIf",e.errorMessage),c(15),x("disabled",e.isLoading),c(2),j("background-color",e.getPrimaryColor())("opacity",e.isLoading||!e.boardName.trim()?"0.6":"1"),x("disabled",e.isLoading||!e.boardName.trim()),c(),x("ngIf",e.isLoading),c(),h(" ",e.isLoading?"Criando...":"Criar Quadro"," ")}}var w=class a{authService=_(E);firestoreService=_(k);subdomainService=_(D);boardCreated=new T;closeModal=new T;boardName="";boardDescription="";isLoading=!1;errorMessage="";isVisible=!1;show(){this.isVisible=!0,this.resetForm()}hide(){this.isVisible=!1,this.closeModal.emit()}resetForm(){this.boardName="",this.boardDescription="",this.errorMessage="",this.isLoading=!1}createBoard(){return f(this,null,function*(){if(!this.boardName.trim()){this.errorMessage="Nome do quadro \xE9 obrigat\xF3rio";return}let t=this.authService.getCurrentUser();if(!t){this.errorMessage="Usu\xE1rio n\xE3o autenticado";return}this.isLoading=!0,this.errorMessage="";try{let e={name:this.boardName.trim(),description:this.boardDescription.trim(),companyId:"",createdAt:null},i=yield this.firestoreService.createBoard(t.uid,e);yield this.firestoreService.updateBoard(t.uid,i.id,{ownerEmail:t.email||""}),this.boardCreated.emit(),this.hide()}catch(e){console.error("Erro ao criar quadro:",e),this.errorMessage="Erro ao criar quadro. Tente novamente."}finally{this.isLoading=!1}})}onBackdropClick(t){t.target===t.currentTarget&&this.hide()}getPrimaryColor(){let t=this.subdomainService.getCurrentCompany();return t?.primaryColor||t?.brandingConfig?.primaryColor||"#3B82F6"}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=M({type:a,selectors:[["app-create-board-modal"]],outputs:{boardCreated:"boardCreated",closeModal:"closeModal"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","text-2xl","font-bold",3,"click","disabled"],[1,"space-y-4",3,"ngSubmit"],["for","boardName",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","boardName","name","boardName","placeholder","Ex: Vendas 2024","maxlength","100","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors",3,"ngModelChange","ngModel","disabled"],["for","boardDescription",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","boardDescription","name","boardDescription","rows","3","placeholder","Descreva o prop\xF3sito deste quadro...","maxlength","500",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","resize-none",3,"ngModelChange","ngModel","disabled"],["class","text-red-500 text-sm",4,"ngIf"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"flex","items-start"],[1,"fas","fa-info-circle","text-blue-500","mt-0.5","mr-2"],[1,"text-sm","text-blue-700"],[1,"mt-1","ml-2","list-disc"],[1,"flex","justify-end","gap-3","pt-4"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-200","hover:bg-gray-300","rounded-lg","font-medium","transition-colors",3,"click","disabled"],["type","submit",1,"px-6","py-2","text-white","rounded-lg","font-medium","transition-colors","flex","items-center",3,"disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[1,"text-red-500","text-sm"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"]],template:function(e,i){e&1&&S(0,ne,36,14,"div",0),e&2&&x("ngIf",i.isVisible)},dependencies:[B,Q,G,K,R,z,H,X,Y,$,W],styles:[".fixed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.bg-white[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]})};var ae=(a,t)=>t.id;function se(a,t){a&1&&(r(0,"div",6)(1,"div",9),p(2,"i",10),r(3,"p",11),s(4,"Carregando seus quadros..."),n()()())}function de(a,t){if(a&1){let e=C();r(0,"div",7)(1,"div",12),p(2,"i",13),n(),r(3,"h3",14),s(4,"Nenhum quadro encontrado"),n(),r(5,"p",15),s(6,"Crie seu primeiro quadro Kanban para come\xE7ar a organizar suas tarefas."),n(),r(7,"button",16),b("click",function(){m(e);let o=d();return u(o.showCreateBoardModal())}),p(8,"i",4),s(9," Criar Primeiro Quadro "),n()()}}function le(a,t){if(a&1&&(r(0,"p",23),s(1),n()),a&2){let e=d().$implicit;c(),h(" ",e.description," ")}}function ce(a,t){if(a&1){let e=C();r(0,"div",27)(1,"div",34)(2,"button",35),b("click",function(o){m(e);let l=d().$implicit,g=d(2);return o.stopPropagation(),u(g.editBoard(l))}),p(3,"i",36),s(4," Editar "),n(),r(5,"button",35),b("click",function(o){m(e);let l=d().$implicit,g=d(2);return o.stopPropagation(),u(g.duplicateBoard(l))}),p(6,"i",37),s(7," Duplicar "),n(),p(8,"hr",38),r(9,"button",39),b("click",function(o){m(e);let l=d().$implicit,g=d(2);return o.stopPropagation(),u(g.deleteBoard(l.id))}),p(10,"i",40),s(11," Excluir "),n()()()}}function me(a,t){if(a&1){let e=C();r(0,"div",18),b("click",function(){let o=m(e).$implicit,l=d(2);return u(l.openBoard(o.id))}),r(1,"div",19)(2,"div",20)(3,"div",21)(4,"h3",22),s(5),n(),v(6,le,2,1,"p",23),n(),r(7,"div",24)(8,"button",25),b("click",function(o){let l=m(e).$implicit,g=d(2);return o.stopPropagation(),u(g.toggleBoardMenu(l.id))}),p(9,"i",26),n(),v(10,ce,12,0,"div",27),n()()(),r(11,"div",28)(12,"div",29)(13,"div",30)(14,"span",11),p(15,"i",31),s(16),n(),r(17,"span",11),p(18,"i",32),s(19),n()(),r(20,"div",33),s(21),n()()()()}if(a&2){let e=t.$implicit,i=d(2);c(5),h(" ",e.name," "),c(),y(e.description?6:-1),c(4),y(i.activeBoardMenu===e.id?10:-1),c(6),h(" ",i.getBoardColumnCount(e.id)," colunas "),c(3),h(" ",i.getBoardTaskCount(e.id)," leads "),c(2),h(" ",i.formatDate(e.createdAt)," ")}}function ue(a,t){if(a&1&&(r(0,"div",8),L(1,me,22,6,"div",17,ae),n()),a&2){let e=d();c(),O(e.boards)}}function pe(a,t){if(a&1){let e=C();r(0,"app-create-board-modal",41,0),b("boardCreated",function(o){m(e);let l=d();return u(l.onBoardCreated(o))})("closeModal",function(){m(e);let o=d();return u(o.showCreateModal=!1)}),n()}}var ee=class a{authService=_(E);firestoreService=_(k);subdomainService=_(D);router=_(A);createBoardModal;boards=[];isLoading=!1;currentUser=null;showConfigMenu=!1;showCreateModal=!1;activeBoardMenu=null;subscription;activeTab="boards";tabs=[{id:"boards",name:"Meus Quadros",icon:"fa-th-large"}];boardStats={};ngOnInit(){return f(this,null,function*(){this.currentUser=this.authService.getCurrentUser(),this.currentUser&&(yield this.processPendingInvites(),yield this.loadBoards())})}processPendingInvites(){return f(this,null,function*(){try{let t=localStorage.getItem("pendingInvite");if(!t)return;let e=JSON.parse(t);console.log("\u{1F504} Debug Dashboard - Processando convite pendente...",e);let i=3600*1e3;if(Date.now()-e.timestamp>i){console.log("\u23F0 Debug Dashboard - Convite expirado, removendo"),localStorage.removeItem("pendingInvite");return}(yield this.authService.processPendingInvite(e.companyId,e.email,e.token))?(console.log("\u2705 Debug Dashboard - Convite processado com sucesso"),localStorage.removeItem("pendingInvite")):console.log("\u274C Debug Dashboard - Falha ao processar convite")}catch(t){console.error("\u274C Debug Dashboard - Erro ao processar convite pendente:",t)}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}ngAfterViewInit(){}loadBoards(){return f(this,null,function*(){if(this.currentUser){this.isLoading=!0;try{this.boards=yield this.firestoreService.getBoards(this.currentUser.uid),yield this.loadBoardStatistics()}catch{}finally{this.isLoading=!1}}})}loadBoardStatistics(){return f(this,null,function*(){for(let t of this.boards)if(t.id)try{let e=yield this.firestoreService.getColumns(this.currentUser.uid,t.id),i=yield this.firestoreService.getLeads(this.currentUser.uid,t.id);this.boardStats[t.id]={columnCount:e.length,leadCount:i.length}}catch{this.boardStats[t.id]={columnCount:0,leadCount:0}}})}logout(){return f(this,null,function*(){(yield this.authService.logout()).success&&(window.location.href="/login")})}openBoard(t){let e=this.boards.find(i=>i.id===t);e&&e.owner?this.router.navigate(["/kanban",t],{queryParams:{ownerId:e.owner}}):this.router.navigate(["/kanban",t],{queryParams:{ownerId:this.currentUser.uid}})}formatDate(t){return t?t.seconds?new Date(t.seconds*1e3).toLocaleDateString("pt-BR"):new Date(t).toLocaleDateString("pt-BR"):""}showCreateBoardModal(){this.showCreateModal=!0,setTimeout(()=>{this.createBoardModal&&this.createBoardModal.show()},0)}onBoardCreated(t){this.loadBoards(),this.showCreateModal=!1}toggleBoardMenu(t){this.activeBoardMenu=this.activeBoardMenu===t?null:t}editBoard(t){this.activeBoardMenu=null}duplicateBoard(t){this.activeBoardMenu=null}deleteBoard(t){return f(this,null,function*(){let i=this.boards.find(g=>g.id===t)?.name||"Quadro",o=`\u26A0\uFE0F ATEN\xC7\xC3O: Esta a\xE7\xE3o n\xE3o pode ser desfeita!

Deseja excluir o quadro "${i}"?

Isso ir\xE1 remover PERMANENTEMENTE:
\u2022 Todas as colunas/fases
\u2022 Todos os leads/registros
\u2022 Todos os templates de email
\u2022 Todas as automa\xE7\xF5es
\u2022 Todo o hist\xF3rico e configura\xE7\xF5es

Digite "EXCLUIR" para confirmar:`;if(prompt(o)==="EXCLUIR")try{yield this.firestoreService.deleteBoard(this.currentUser.uid,t),yield this.loadBoards(),alert(`\u2705 Quadro "${i}" foi exclu\xEDdo com sucesso!`)}catch{alert("\u274C Erro ao excluir o quadro. Tente novamente.")}this.activeBoardMenu=null})}getBoardColumnCount(t){return this.boardStats[t]?.columnCount||0}getBoardTaskCount(t){return this.boardStats[t]?.leadCount||0}toggleConfigMenu(){this.showConfigMenu=!this.showConfigMenu}closeConfigMenu(){this.showConfigMenu=!1}closeBoardMenu(t){t.target.closest(".board-menu-container")||(this.activeBoardMenu=null)}switchTab(t){this.activeTab=t}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=M({type:a,selectors:[["app-dashboard"]],viewQuery:function(e,i){if(e&1&&F(w,5),e&2){let o;q(o=U())&&(i.createBoardModal=o.first)}},hostBindings:function(e,i){e&1&&b("click",function(l){return i.closeBoardMenu(l)},P)},decls:11,vars:2,consts:[["createBoardModal",""],["title","Meus quadros Kanban"],[1,"flex","space-x-2"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors","flex","items-center",3,"click"],[1,"fas","fa-plus","mr-2"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center","py-12"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6"],[1,"text-center"],[1,"fas","fa-spinner","fa-spin","text-4xl","text-gray-400","mb-4"],[1,"text-gray-600"],[1,"w-24","h-24","mx-auto","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-4"],[1,"fas","fa-th-large","text-3xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"bg-blue-500","hover:bg-blue-600","text-white","px-6","py-3","rounded-lg","font-medium","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","hover:shadow-md","transition-shadow","cursor-pointer","group"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","hover:shadow-md","transition-shadow","cursor-pointer","group",3,"click"],[1,"p-6","border-b","border-gray-100"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"font-semibold","text-gray-900","group-hover:text-blue-600","transition-colors"],[1,"text-sm","text-gray-600","mt-1","line-clamp-2"],[1,"relative","ml-4","board-menu-container"],[1,"p-2","text-gray-600","hover:text-gray-800","hover:bg-gray-100","rounded-md","transition-all",2,"display","flex","align-items","center","justify-content","center","min-width","32px","min-height","32px",3,"click"],[1,"fas","fa-ellipsis-v"],[1,"absolute","right-0","mt-2","w-48","bg-white","rounded-md","shadow-lg","border","border-gray-200","z-50",2,"box-shadow","0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"],[1,"p-4","bg-gray-50"],[1,"flex","items-center","justify-between","text-sm"],[1,"flex","items-center","space-x-4"],[1,"fas","fa-columns","mr-1"],[1,"fas","fa-tasks","mr-1"],[1,"text-xs","text-gray-500"],[1,"py-1"],[1,"w-full","text-left","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],[1,"fas","fa-edit","mr-2"],[1,"fas","fa-copy","mr-2"],[1,"my-1"],[1,"w-full","text-left","px-4","py-2","text-sm","text-red-700","hover:bg-red-50",3,"click"],[1,"fas","fa-trash","mr-2"],[3,"boardCreated","closeModal"]],template:function(e,i){e&1&&(r(0,"app-main-layout")(1,"app-company-breadcrumb",1)(2,"div",2)(3,"button",3),b("click",function(){return i.showCreateBoardModal()}),p(4,"i",4),s(5," Novo Quadro "),n()()(),r(6,"div",5),v(7,se,5,0,"div",6)(8,de,10,0,"div",7)(9,ue,3,0,"div",8),n(),v(10,pe,2,0,"app-create-board-modal"),n()),e&2&&(c(7),y(i.isLoading?7:i.boards.length===0?8:9),c(3),y(i.showCreateModal?10:-1))},dependencies:[B,w,J,Z],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.board-menu-container[_ngcontent-%COMP%]{position:relative}.board-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:1!important;visibility:visible!important}.board-menu-container[_ngcontent-%COMP%]   .absolute[_ngcontent-%COMP%]{position:absolute!important;z-index:1000!important}"]})};export{ee as DashboardComponent};
