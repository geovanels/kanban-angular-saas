import{a as R}from"./chunk-J5BZOYHT.js";import"./chunk-KJIKDUO6.js";import{a as F}from"./chunk-OQZFYMYT.js";import{D as N}from"./chunk-CXGKOLI5.js";import{$ as D}from"./chunk-3VCHQSRR.js";import{Ab as e,Bb as l,Bc as V,Hb as y,Ib as m,Ic as O,Jb as f,Pb as P,Rb as x,Sb as L,Ta as r,Tb as i,Ub as b,Vb as C,a as w,b as I,bb as M,da as h,f as A,gb as T,ja as c,ka as d,ta as v,yb as _,zb as t}from"./chunk-CM3JQ4U2.js";function U(p,n){if(p&1){let o=y();t(0,"div",29)(1,"div",40)(2,"h6"),l(3,"i",28),i(4," Exemplos de Integra\xE7\xE3o"),e(),t(5,"button",41),m("click",function(){c(o);let s=f();return d(s.showIntegrationExamples.set(!1))}),e()(),t(6,"div",6)(7,"ul",42)(8,"li",43)(9,"button",44),m("click",function(){c(o);let s=f();return d(s.selectedLanguage.set("curl"))}),i(10," cURL "),e()(),t(11,"li",43)(12,"button",44),m("click",function(){c(o);let s=f();return d(s.selectedLanguage.set("javascript"))}),i(13," JavaScript "),e()(),t(14,"li",43)(15,"button",44),m("click",function(){c(o);let s=f();return d(s.selectedLanguage.set("php"))}),i(16," PHP "),e()(),t(17,"li",43)(18,"button",44),m("click",function(){c(o);let s=f();return d(s.selectedLanguage.set("python"))}),i(19," Python "),e()()(),t(20,"div",45)(21,"pre",46)(22,"code"),i(23),e()(),t(24,"div",32)(25,"button",47),m("click",function(){c(o);let s=f();return d(s.copyToClipboard(s.getSelectedExample()))}),l(26,"i",14),i(27," Copiar C\xF3digo "),e()()()()()}if(p&2){let o=f();r(9),x("active",o.selectedLanguage()==="curl"),r(3),x("active",o.selectedLanguage()==="javascript"),r(3),x("active",o.selectedLanguage()==="php"),r(3),x("active",o.selectedLanguage()==="python"),r(5),b(o.getSelectedExample())}}function q(p,n){if(p&1&&(t(0,"div",29)(1,"div",3)(2,"h6"),l(3,"i",48),i(4," Estat\xEDsticas da API (\xFAltimas 24h)"),e()(),t(5,"div",6)(6,"div",49)(7,"div",50)(8,"div",51)(9,"h4",52),i(10),e(),t(11,"small",5),i(12,"Requisi\xE7\xF5es"),e()()(),t(13,"div",50)(14,"div",51)(15,"h4",53),i(16),e(),t(17,"small",5),i(18,"Sucessos"),e()()(),t(19,"div",50)(20,"div",51)(21,"h4",54),i(22),e(),t(23,"small",5),i(24,"Erros"),e()()(),t(25,"div",50)(26,"div",51)(27,"h4",55),i(28),e(),t(29,"small",5),i(30,"Leads Criados"),e()()()()()()),p&2){let o,a,s,u,g=f();r(10),b(((o=g.apiStats())==null?null:o.requests)||0),r(6),b(((a=g.apiStats())==null?null:a.successful)||0),r(6),b(((s=g.apiStats())==null?null:s.errors)||0),r(6),b(((u=g.apiStats())==null?null:u.leads)||0)}}function j(p,n){if(p&1&&(t(0,"div",56),l(1,"i",57),i(2),e()),p&2){let o=f();r(2),C(" ",o.successMessage()," ")}}function B(p,n){if(p&1&&(t(0,"div",58),l(1,"i",59),i(2),e()),p&2){let o=f();r(2),C(" ",o.errorMessage()," ")}}var z=class p{apiService=h(R);subdomainService=h(F);companyService=h(D);currentCompany=v(null);isLoading=v(!1);showToken=v(!1);successMessage=v(null);errorMessage=v(null);showIntegrationExamples=v(!1);selectedLanguage=v("curl");apiStats=v(null);integrationExamples=v({});ngOnInit(){this.currentCompany.set(this.subdomainService.getCurrentCompany()),this.loadApiStats(),this.loadIntegrationExamples()}getLeadIntakeUrl(){try{return this.apiService.getLeadIntakeUrl()}catch{return"Erro: empresa n\xE3o configurada"}}getExampleRequestBody(){return JSON.stringify({companyName:"Nome da Empresa Exemplo",cnpj:"00.000.000/0001-00",contactName:"Nome do Contato",contactEmail:"email@exemplo.com",contactPhone:"(11) 99999-9999",phaseId:"(Opcional) ID da fase para onde o lead deve ir"},null,2)}toggleApiStatus(){return A(this,null,function*(){let n=this.currentCompany();if(n){this.isLoading.set(!0),this.clearMessages();try{let o=!n.apiConfig.enabled;yield this.companyService.updateCompany(n.id,{apiConfig:I(w({},n.apiConfig),{enabled:o})}),n.apiConfig.enabled=o,this.currentCompany.set(n),this.subdomainService.setCurrentCompany(n),this.showSuccess(`API ${o?"ativada":"desativada"} com sucesso!`)}catch(o){console.error("Erro ao alterar status da API:",o),this.showError("Erro ao alterar status da API.")}finally{this.isLoading.set(!1)}}})}regenerateToken(){this.isLoading.set(!0),this.clearMessages(),this.apiService.regenerateApiToken().subscribe({next:n=>{let o=this.currentCompany();o&&(o.apiConfig.token=n.token,this.currentCompany.set(o)),this.showSuccess("Token regenerado com sucesso! Certifique-se de atualizar suas integra\xE7\xF5es."),this.loadIntegrationExamples(),this.isLoading.set(!1)},error:n=>{console.error("Erro ao regenerar token:",n),this.showError("Erro ao regenerar token da API."),this.isLoading.set(!1)}})}testApi(){this.isLoading.set(!0),this.clearMessages(),this.apiService.testApiEndpoint().subscribe({next:n=>{n.success?this.showSuccess("API testada com sucesso! Lead de teste criado."):this.showError("Falha no teste da API: "+(n.error||"Erro desconhecido")),this.isLoading.set(!1)},error:n=>{console.error("Erro ao testar API:",n),this.showError("Erro ao testar API: "+(n.message||"Erro desconhecido")),this.isLoading.set(!1)}})}toggleTokenVisibility(n){let o=n.type==="password";n.type=o?"text":"password",this.showToken.set(o)}copyToClipboard(n){navigator.clipboard.writeText(n).then(()=>{this.showSuccess("Copiado para \xE1rea de transfer\xEAncia!")}).catch(()=>{this.showError("Erro ao copiar para \xE1rea de transfer\xEAncia.")})}getSelectedExample(){return this.integrationExamples()[this.selectedLanguage()]||"Exemplo n\xE3o dispon\xEDvel"}loadApiStats(){this.apiService.getApiStats("24h").subscribe({next:n=>{this.apiStats.set(n)},error:n=>{console.error("Erro ao carregar estat\xEDsticas da API:",n)}})}loadIntegrationExamples(){try{let n=this.apiService.getIntegrationExamples();this.integrationExamples.set(n)}catch(n){console.error("Erro ao carregar exemplos de integra\xE7\xE3o:",n)}}showSuccess(n){this.successMessage.set(n),this.errorMessage.set(null),setTimeout(()=>this.successMessage.set(null),5e3)}showError(n){this.errorMessage.set(n),this.successMessage.set(null),setTimeout(()=>this.errorMessage.set(null),5e3)}clearMessages(){this.successMessage.set(null),this.errorMessage.set(null)}static \u0275fac=function(o){return new(o||p)};static \u0275cmp=M({type:p,selectors:[["app-api-config"]],decls:118,vars:21,consts:[["tokenInput",""],[1,"api-config-container"],[1,"card"],[1,"card-header"],[1,"fas","fa-plug"],[1,"text-muted"],[1,"card-body"],[1,"row"],[1,"col-md-8"],[1,"mb-3"],[1,"form-label"],[1,"input-group"],["type","text","readonly","",1,"form-control",3,"value"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-copy"],[1,"form-text"],[1,"col-md-4"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],["type","password","readonly","",1,"form-control",3,"value"],[1,"fas"],[1,"d-grid"],[1,"btn","btn-warning",3,"click","disabled"],[1,"fas","fa-sync-alt"],[1,"d-flex","gap-2","flex-wrap"],[1,"btn","btn-outline-info",3,"click","disabled"],[1,"fas","fa-paper-plane"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-code"],[1,"card","mt-3"],[1,"fas","fa-file-code"],[1,"bg-light","p-3","rounded"],[1,"mt-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],["class","card mt-3",4,"ngIf"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"fas","fa-book"],[1,"col-md-6"],[1,"small"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"btn-close",3,"click"],[1,"nav","nav-tabs"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"tab-content","mt-3"],[1,"bg-dark","text-light","p-3","rounded"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"fas","fa-chart-line"],[1,"row","text-center"],[1,"col-md-3"],[1,"border","rounded","p-3"],[1,"text-primary","mb-1"],[1,"text-success","mb-1"],[1,"text-danger","mb-1"],[1,"text-info","mb-1"],[1,"alert","alert-success","mt-3"],[1,"fas","fa-check-circle"],[1,"alert","alert-danger","mt-3"],[1,"fas","fa-exclamation-circle"]],template:function(o,a){if(o&1){let s=y();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3"),l(4,"i",4),i(5," Configura\xE7\xE3o da API"),e(),t(6,"p",5),i(7,"Configure e gerencie sua API para receber leads externos"),e()(),t(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10)(13,"strong"),i(14,"Endpoint da API:"),e()(),t(15,"div",11),l(16,"input",12),t(17,"button",13),m("click",function(){return c(s),d(a.copyToClipboard(a.getLeadIntakeUrl()))}),l(18,"i",14),e()(),t(19,"div",15),i(20,"URL para envio de leads via API"),e()()(),t(21,"div",16)(22,"div",9)(23,"label",10)(24,"strong"),i(25,"Status da API:"),e()(),t(26,"div",17)(27,"span"),i(28),e(),t(29,"button",18),m("click",function(){return c(s),d(a.toggleApiStatus())}),i(30),e()()()()(),t(31,"div",7)(32,"div",8)(33,"div",9)(34,"label",10)(35,"strong"),i(36,"Token de Autentica\xE7\xE3o:"),e()(),t(37,"div",11),l(38,"input",19,0),t(40,"button",13),m("click",function(){c(s);let g=P(39);return d(a.toggleTokenVisibility(g))}),l(41,"i",20),e(),t(42,"button",13),m("click",function(){let g;return c(s),d(a.copyToClipboard(((g=a.currentCompany())==null||g.apiConfig==null?null:g.apiConfig.token)||""))}),l(43,"i",14),e()(),t(44,"div",15),i(45,"Use este token no header Authorization: Bearer [token]"),e()()(),t(46,"div",16)(47,"div",9)(48,"label",10),i(49,"\xA0"),e(),t(50,"div",21)(51,"button",22),m("click",function(){return c(s),d(a.regenerateToken())}),l(52,"i",23),i(53),e()()()()(),t(54,"div",24)(55,"button",25),m("click",function(){return c(s),d(a.testApi())}),l(56,"i",26),i(57),e(),t(58,"button",27),m("click",function(){return c(s),d(a.showIntegrationExamples.set(!a.showIntegrationExamples()))}),l(59,"i",28),i(60," Exemplos de Integra\xE7\xE3o "),e()()()(),t(61,"div",29)(62,"div",3)(63,"h6"),l(64,"i",30),i(65," Corpo da Requisi\xE7\xE3o (JSON)"),e()(),t(66,"div",6)(67,"pre",31)(68,"code"),i(69),e()(),t(70,"div",32)(71,"button",33),m("click",function(){return c(s),d(a.copyToClipboard(a.getExampleRequestBody()))}),l(72,"i",14),i(73," Copiar Exemplo "),e()()()(),T(74,U,28,9,"div",34)(75,q,31,4,"div",34)(76,j,3,1,"div",35)(77,B,3,1,"div",36),t(78,"div",29)(79,"div",3)(80,"h6"),l(81,"i",37),i(82," Documenta\xE7\xE3o da API"),e()(),t(83,"div",6)(84,"div",7)(85,"div",38)(86,"h6"),i(87,"Headers Obrigat\xF3rios:"),e(),t(88,"ul",39)(89,"li")(90,"code"),i(91,"Content-Type: application/json"),e()(),t(92,"li")(93,"code"),i(94,"Authorization: Bearer [seu-token]"),e()(),t(95,"li")(96,"code"),i(97),e()()()(),t(98,"div",38)(99,"h6"),i(100,"Campos Opcionais:"),e(),t(101,"ul",39)(102,"li")(103,"strong"),i(104,"phaseId:"),e(),i(105," ID da fase de destino"),e(),t(106,"li")(107,"strong"),i(108,"source:"),e(),i(109," Origem do lead"),e(),t(110,"li")(111,"strong"),i(112,"utm_*:"),e(),i(113," Par\xE2metros UTM"),e(),t(114,"li")(115,"strong"),i(116,"customFields:"),e(),i(117," Campos personalizados"),e()()()()()()()}if(o&2){let s,u,g,E,S,k;r(16),_("value",a.getLeadIntakeUrl()),r(11),L(!((s=a.currentCompany())==null||s.apiConfig==null)&&s.apiConfig.enabled?"badge bg-success":"badge bg-danger"),r(),C(" ",!((u=a.currentCompany())==null||u.apiConfig==null)&&u.apiConfig.enabled?"Ativa":"Inativa"," "),r(),_("disabled",a.isLoading()),r(),C(" ",!((g=a.currentCompany())==null||g.apiConfig==null)&&g.apiConfig.enabled?"Desativar":"Ativar"," "),r(8),_("value",(E=a.currentCompany())==null||E.apiConfig==null?null:E.apiConfig.token),r(3),x("fa-eye",!a.showToken())("fa-eye-slash",a.showToken()),r(10),_("disabled",a.isLoading()),r(2),C(" ",a.isLoading()?"Gerando...":"Regenerar Token"," "),r(2),_("disabled",a.isLoading()||!(!((S=a.currentCompany())==null||S.apiConfig==null)&&S.apiConfig.enabled)),r(2),C(" ",a.isLoading()?"Testando...":"Testar API"," "),r(12),b(a.getExampleRequestBody()),r(5),_("ngIf",a.showIntegrationExamples),r(),_("ngIf",a.apiStats()),r(),_("ngIf",a.successMessage()),r(),_("ngIf",a.errorMessage()),r(20),C("X-Company-Subdomain: ",(k=a.currentCompany())==null?null:k.subdomain)}},dependencies:[O,V,N],styles:[".api-config-container[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:20px}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#495057}.input-group[_ngcontent-%COMP%]{position:relative}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{border:none;color:#6c757d}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-color:#007bff}pre[_ngcontent-%COMP%]{font-size:.875rem;max-height:400px;overflow-y:auto}.badge[_ngcontent-%COMP%]{font-size:.75rem}.border[_ngcontent-%COMP%]{border:1px solid #dee2e6!important}code[_ngcontent-%COMP%]{color:#e83e8c;font-size:.875rem}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;line-height:1;opacity:.5}.btn-close[_ngcontent-%COMP%]:hover{opacity:.75}"]})};export{z as ApiConfigComponent};
